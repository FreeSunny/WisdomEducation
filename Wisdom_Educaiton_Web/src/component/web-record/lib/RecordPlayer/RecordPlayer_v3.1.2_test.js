/*
 * @Copyright (c) 2021 NetEase, Inc.  All rights reserved.
 * Use of this source code is governed by a MIT license that can be found in the LICENSE file
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["RecordPlayer"] = factory();
	else
		root["RecordPlayer"] = factory();
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 1);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./new_src/assets/cursors/cursor.svg":
/*!*******************************************!*\
  !*** ./new_src/assets/cursors/cursor.svg ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MzA2MTkyNDQ5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU2IDBsNjEyLjY1MDY2NyA1NzMuODI0LTI1MC4yODI2NjcgMjIuNzQxMzMzLTQ1LjQ0IDQuMDk2IDE4LjkwMTMzMyA0MS41NTczMzMgMTUxLjg1MDY2NyAzMzIuNTQ0TDYzMS42OCAxMDI0bC0xNDQuODk2LTMzNi4xMjgtMTguMTc2LTQyLjM2OC0zMy41Nzg2NjcgMzEuNTMwNjY3LTE3Ny43OTIgMTY2Ljc0MTMzM0wyNTYgMCIgcC1pZD0iMjA5NyI+PC9wYXRoPjwvc3ZnPg=="

/***/ }),

/***/ "./new_src/assets/cursors/element-eraser.svg":
/*!***************************************************!*\
  !*** ./new_src/assets/cursors/element-eraser.svg ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEuNDQyMjkiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAxMiAxLjQ0MjI5KSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuNTg0NSA4Ljg1Nzc5TDEwLjUxNjkgMTQuNzkwMiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuMjI0NjQgMTcuNjgxOEgxNS43NjA0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="

/***/ }),

/***/ "./new_src/assets/cursors/pen.svg":
/*!****************************************!*\
  !*** ./new_src/assets/cursors/pen.svg ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi41Mzg2IDIuNDYwMzRDMTMuMTUyNCAxLjg0NjU2IDE0LjE0NzUgMS44NDY1NSAxNC43NjEzIDIuNDYwMzRMMTcuNTM5NyA1LjIzODcxQzE4LjE1MzQgNS44NTI0OSAxOC4xNTM0IDYuODQ3NjIgMTcuNTM5NyA3LjQ2MTRMNy44MDEyMiAxNy4xOTk4QzcuNTQyMjIgMTcuNDU4OCA3LjIwMDkgMTcuNjE5MiA2LjgzNjIyIDE3LjY1MzRMMy4xODEyNyAxNy45OTUyQzIuNTA3MTMgMTguMDU4MiAxLjk0MTc2IDE3LjQ5MjkgMi4wMDQ4MSAxNi44MTg3TDIuMzQ2NjQgMTMuMTYzOEMyLjM4MDc1IDEyLjc5OTEgMi41NDExNSAxMi40NTc4IDIuODAwMTUgMTIuMTk4OEwxMi41Mzg2IDIuNDYwMzRaTTEzLjkyNzggMy4yOTM4NUMxMy43NzQzIDMuMTQwNCAxMy41MjU2IDMuMTQwNCAxMy4zNzIxIDMuMjkzODVMMy42MzM2NiAxMy4wMzIzQzMuNTY4OTEgMTMuMDk3IDMuNTI4ODEgMTMuMTgyNCAzLjUyMDI4IDEzLjI3MzVMMy4xODk0OSAxNi44MTA1TDYuNzI2NDYgMTYuNDc5N0M2LjgxNzYzIDE2LjQ3MTIgNi45MDI5NiAxNi40MzExIDYuOTY3NyAxNi4zNjYzTDE2LjcwNjIgNi42Mjc4OUMxNi44NTk2IDYuNDc0NDUgMTYuODU5NiA2LjIyNTY2IDE2LjcwNjIgNi4wNzIyMkwxMy45Mjc4IDMuMjkzODVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjYyMjQgOS41NDUxOEwxMC40NTQ4IDUuMzc3NjJMMTEuMjg4MyA0LjU0NDExTDE1LjQ1NTkgOC43MTE2N0wxNC42MjI0IDkuNTQ1MThaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"

/***/ }),

/***/ "./new_src/assets/image/imageIsLoading.svg":
/*!*************************************************!*\
  !*** ./new_src/assets/image/imageIsLoading.svg ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgwIiBoZWlnaHQ9IjM2MCIgdmlld0JveD0iMCAwIDQ4MCAzNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wIDBINDgwVjM2MEgwVjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQ3OCAySDJWMzU4SDQ3OFYyWk0wIDBWMzYwSDQ4MFYwSDBaIiBmaWxsPSIjRDlEOURCIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTY2LjI5NCAxMjZIMzE1TDMxNSAxODkuMzg2TDI5NS4wNDkgMTY3LjY0QzI5MS4xNDQgMTYzLjM4NCAyODQuNDU2IDE2My4zMTEgMjgwLjQ2IDE2Ny40ODNMMjM4Ljc5MiAyMTAuOTc3TDIxOS45MTcgMTkxLjU3MkMyMTYuNzg0IDE4OC4zNTEgMjExLjYxMyAxODguMzQxIDIwOC40NjggMTkxLjU1MUwxNjcuMzM4IDIzMy41MjlIMTY2LjI5NEwxNjYuMjk0IDEyNlpNMTY2LjI5NCAyNDEuNTI5QzE2NC40NzggMjQxLjUyOSAxNjIuODAzIDI0MC45MjQgMTYxLjQ2IDIzOS45MDRIMTYxLjA5MkwxNjEuMjUyIDIzOS43NDFDMTU5LjQ0NyAyMzguMjc0IDE1OC4yOTQgMjM2LjAzNiAxNTguMjk0IDIzMy41MjlWMTI2QzE1OC4yOTQgMTIxLjU4MiAxNjEuODc2IDExOCAxNjYuMjk0IDExOEgzMTVDMzE5LjQxOCAxMTggMzIzIDEyMS41ODIgMzIzIDEyNlYyMzMuNTI5QzMyMyAyMzcuOTQ4IDMxOS40MTggMjQxLjUyOSAzMTUgMjQxLjUyOUgxNjYuMjk0Wk0yMDEgMTcxLjgwNEMyMDkuMjg0IDE3MS44MDQgMjE2IDE2NS4wODggMjE2IDE1Ni44MDRDMjE2IDE0OC41MiAyMDkuMjg0IDE0MS44MDQgMjAxIDE0MS44MDRDMTkyLjcxNiAxNDEuODA0IDE4NiAxNDguNTIgMTg2IDE1Ni44MDRDMTg2IDE2NS4wODggMTkyLjcxNiAxNzEuODA0IDIwMSAxNzEuODA0WiIgZmlsbD0iI0U2RTdFQiIvPgo8L3N2Zz4K"

/***/ }),

/***/ "./new_src/component/toast/index.ts":
/*!******************************************!*\
  !*** ./new_src/component/toast/index.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.hideToast = exports.showToast = undefined;

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _toastCtrl = __webpack_require__(/*! ./toast-ctrl */ "./new_src/component/toast/toast-ctrl.ts");

var _toastCtrl2 = _interopRequireDefault(_toastCtrl);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * option.msg toast内容
 * option.time 停留时间: 默认2s，设置null: 无限期显示
 * @param {*} option
 */
var showToast = exports.showToast = function showToast(option) {
    var msg = option.msg,
        _option$time = option.time,
        time = _option$time === undefined ? 2 : _option$time,
        _option$type = option.type,
        type = _option$type === undefined ? 'info' : _option$type,
        _option$top = option.top,
        top = _option$top === undefined ? 30 : _option$top;

    var param = {
        message: msg.constructor === String ? msg : (0, _stringify2.default)(msg),
        time: time,
        type: type,
        top: top
    };
    _toastCtrl2.default.show(param);
}; /*
    * @Author: lduoduo
    * @Date: 2018-01-27 22:09:41
    * @Last Modified by: lduoduo
    * @Last Modified time: 2018-01-27 22:16:25
    * toast 消息提示组件
    */
var hideToast = exports.hideToast = function hideToast() {
    _toastCtrl2.default.hide();
};

/***/ }),

/***/ "./new_src/component/toast/toast-ctrl.ts":
/*!***********************************************!*\
  !*** ./new_src/component/toast/toast-ctrl.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _toast = __webpack_require__(/*! ./toast */ "./new_src/component/toast/toast.ts");

var _toast2 = _interopRequireDefault(_toast);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var timer = void 0; /*
                     * @Author: lduoduo
                     * @Date: 2018-01-26 20:12:09
                     * @Last Modified by: lduoduo
                     * @Last Modified time: 2018-01-27 23:06:46
                     * toast控制器
                     */

var ToastCtrl = function () {
    function ToastCtrl() {
        (0, _classCallCheck3.default)(this, ToastCtrl);
    }

    (0, _createClass3.default)(ToastCtrl, null, [{
        key: 'createInstance',
        value: function createInstance() {
            this._instance = this._instance || new _toast2.default();
            return this._instance;
        }
    }, {
        key: 'show',
        value: function show(inOptions) {
            var _this = this;

            var _inOptions$time = inOptions.time,
                time = _inOptions$time === undefined ? 3 : _inOptions$time;

            if (!this._instance) {
                this.createInstance();
            }
            this._instance.show(inOptions);
            if (timer) {
                clearTimeout(timer);
            }
            if (time) {
                timer = setTimeout(function () {
                    _this.hide();
                }, time * 1000);
            }
        }
    }, {
        key: 'hide',
        value: function hide() {
            if (timer) {
                clearTimeout(timer);
            }
            if (this._instance) {
                this._instance.hide();
            }
        }
    }, {
        key: 'destory',
        value: function destory() {
            if (this._instance) {
                this._instance.destroy();
                this._instance = null;
            }
        }
    }]);
    return ToastCtrl;
}();

exports.default = ToastCtrl;

ToastCtrl._instance = null;

/***/ }),

/***/ "./new_src/component/toast/toast.less":
/*!********************************************!*\
  !*** ./new_src/component/toast/toast.less ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {


var content = __webpack_require__(/*! !../../../node_modules/css-loader/dist/cjs.js??ref--7-1!../../../node_modules/postcss-loader/src??postcss!./toast.less */ "./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/src/index.js?!./new_src/component/toast/toast.less");

if(typeof content === 'string') content = [[module.i, content, '']];

var transform;
var insertInto;



var options = {"hmr":true}

options.transform = transform
options.insertInto = undefined;

var update = __webpack_require__(/*! ../../../node_modules/style-loader/lib/addStyles.js */ "./node_modules/style-loader/lib/addStyles.js")(content, options);

if(content.locals) module.exports = content.locals;

if(false) {}

/***/ }),

/***/ "./new_src/component/toast/toast.ts":
/*!******************************************!*\
  !*** ./new_src/component/toast/toast.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _isInteger = __webpack_require__(/*! babel-runtime/core-js/number/is-integer */ "./node_modules/babel-runtime/core-js/number/is-integer.js");

var _isInteger2 = _interopRequireDefault(_isInteger);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

__webpack_require__(/*! ./toast.less */ "./new_src/component/toast/toast.less");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Toast = function () {
    function Toast() {
        (0, _classCallCheck3.default)(this, Toast);

        this.toastDiv = document.createElement('div');
        this.toastDiv.className = 'whiteboard-toast';
        this.toastDiv.onclick = this.hide.bind(this);
        document.body.appendChild(this.toastDiv);
    }

    (0, _createClass3.default)(Toast, [{
        key: 'show',
        value: function show(inOptions) {
            var toastDiv = this.toastDiv;
            toastDiv.style.display = 'block';
            if (inOptions.type === 'warn') {
                toastDiv.style.color = '#8a6d3b';
                toastDiv.style.backgroundColor = '#fcf8e3';
                toastDiv.style.borderColor = '#faebcc';
            } else if (inOptions.type === 'info') {
                toastDiv.style.color = '#31708f';
                toastDiv.style.backgroundColor = '#d9edf7';
                toastDiv.style.borderColor = '#bce8f1';
            } else if (inOptions.type === 'error') {
                toastDiv.style.color = '#a94442';
                toastDiv.style.backgroundColor = '#f2dede';
                toastDiv.style.borderColor = '#ebccd1';
            } else {
                toastDiv.style.color = '#3c763d';
                toastDiv.style.backgroundColor = '#dff0d8';
                toastDiv.style.borderColor = '#d6e9c6';
            }
            if ((0, _isInteger2.default)(inOptions.top)) {
                toastDiv.style.top = inOptions.top + 'px';
            }
            toastDiv.innerHTML = inOptions.message;
        }
    }, {
        key: 'hide',
        value: function hide() {
            if (this.toastDiv) {
                this.toastDiv.style.display = 'none';
            }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            if (this.toastDiv) {
                document.body.removeChild(this.toastDiv);
                this.toastDiv = null;
            }
        }
    }]);
    return Toast;
}(); /*
      * @Author: lduoduo
      * @Date: 2018-01-26 19:45:27
      * @Last Modified by: lduoduo
      * @Last Modified time: 2018-01-28 15:34:14
      * toast 消息提示组件
      */


exports.default = Toast;

/***/ }),

/***/ "./new_src/core/animation/index.ts":
/*!*****************************************!*\
  !*** ./new_src/core/animation/index.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var timer = void 0;
var transitionToCameraBound = exports.transitionToCameraBound = function transitionToCameraBound(camera, boundary, callback) {
    var end = boundary;
    var start = {
        centerX: camera.centerX,
        centerY: camera.centerY,
        width: camera.width,
        height: camera.height
    };
    /**
     * 录像回放时，不要用动画，否则位置有些问题
     */
    var total = camera.app.isRecordPlayer ? 1 : 15;
    animate({
        total: total,
        worker: function worker(curr) {
            var percent = (curr + 1) / total;
            camera.setCameraBound({
                centerX: end.centerX * percent + start.centerX * (1 - percent),
                centerY: end.centerY * percent + start.centerY * (1 - percent),
                width: end.width * percent + start.width * (1 - percent),
                height: end.height * percent + start.height * (1 - percent)
            });
        },
        callback: callback
    });
};
var animate = exports.animate = function animate(opt) {
    cancelAnimationFrame(timer);
    step(0, opt);
};
var step = function step(curr, opt) {
    if (curr >= opt.total) {
        if (typeof opt.callback === 'function') {
            opt.callback();
        }
    } else {
        requestAnimationFrame(function () {
            opt.worker(curr);
            step(curr + 1, opt);
        });
    }
};

/***/ }),

/***/ "./new_src/core/board/actions.ts":
/*!***************************************!*\
  !*** ./new_src/core/board/actions.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.deletePage = exports.gotoPage = exports.addPage = undefined;

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _page = __webpack_require__(/*! ../page */ "./new_src/core/page/index.ts");

var _page2 = _interopRequireDefault(_page);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * snapshot为引起addPage动作的快照，它可能来自于Board类快照
 */
var addPage = exports.addPage = function addPage(board, insertAfter, snapshot) {
    board.app.opsManager.hooks.prePageChange.call(snapshot);
    board.pages[board.currIndex].cleanNonCanvasElements();
    board.pages[board.newPageIndex] = new _page2.default(board.app, board.boardName, board.newPageIndex.toString());
    if (snapshot.category === 'pageOp') {
        board.pages[board.newPageIndex].setPayload(snapshot.data.payload);
    }
    insertAfter = insertAfter === undefined ? board.pageNames.length - 1 : insertAfter;
    board.pageNames.splice(insertAfter + 1, 0, board.newPageIndex.toString());
    if (!board.app.room.isReceivingBatchSnapshots) {
        board.pages[board.newPageIndex].calcDrawOpQueue();
        // board.pages[board.newPageIndex].refresh()
        board.app.room.pageToRefresh = board.pages[board.newPageIndex];
    }
    //更新新页面index
    board.currIndex = board.newPageIndex;
    board.newPageIndex += 1;
    board.app.opsManager.hooks.pageChange.call(snapshot);
};
/**
 * snapshot为引起gotoPage动作的快照，它可能来自于Board类快照
 */
var gotoPage = exports.gotoPage = function gotoPage(board, index, snapshot) {
    if (!board.pages.hasOwnProperty(index)) {
        throw new Error('跳转至不存在的页面');
    }
    board.app.opsManager.hooks.prePageChange.call(snapshot);
    board.pages[board.currIndex].cleanNonCanvasElements();
    board.currIndex = Number(index);
    board.app.opsManager.hooks.pageChange.call(snapshot);
    if (!board.app.room.isReceivingBatchSnapshots) {
        board.pages[index].calcDrawOpQueue();
        // board.pages[index].refresh()
        board.app.room.pageToRefresh = board.pages[index];
    }
};
/**
 * snapshot为引起deletePage动作的快照，它可能来自于Board类快照
 */
var deletePage = exports.deletePage = function deletePage(board, index, snapshot) {
    if (!board.pages.hasOwnProperty(index)) {
        if (true) {
            console.error('白板-->', '\u5220\u9664\u9875\u9762:' + index + ', \u4F46\u662F\u9875\u9762\u4E0D\u5B58\u5728');
        }
    } else if ((0, _keys2.default)(board.pages).length === 1) {
        if (true) {
            console.error('白板-->', '\u4E0D\u80FD\u5220\u9664\u6700\u540E\u4E00\u9875');
        }
    } else {
        board.app.opsManager.hooks.prePageChange.call(snapshot);
        board.pages[board.currIndex].cleanNonCanvasElements();
        delete board.pages[index];
        var indexInPageNames = board.pageNames.indexOf(index.toString());
        if (indexInPageNames !== -1) {
            board.pageNames.splice(indexInPageNames, 1);
        }
        var nextPageIndex = indexInPageNames;
        if (indexInPageNames === board.pageNames.length) {
            //被删除的是最后一页，跳到被删除页面的前一页
            nextPageIndex = indexInPageNames - 1;
        }
        board.currIndex = Number(board.pageNames[nextPageIndex]);
        board.app.opsManager.hooks.pageChange.call(snapshot);
        if (!board.app.room.isReceivingBatchSnapshots) {
            board.pages[board.currIndex].calcDrawOpQueue();
            // board.pages[board.currIndex].refresh()
            board.app.room.pageToRefresh = board.pages[board.currIndex];
        }
    }
};

/***/ }),

/***/ "./new_src/core/board/index.ts":
/*!*************************************!*\
  !*** ./new_src/core/board/index.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _page = __webpack_require__(/*! ../page */ "./new_src/core/page/index.ts");

var _page2 = _interopRequireDefault(_page);

var _actions = __webpack_require__(/*! ./actions */ "./new_src/core/board/actions.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 默认白板中所有页都属于同一个Board实例。
 *
 * 每添加一个文件（图片除外），都会添加一个Board。多页文件的Board含有多页Page。
 *
 * 引入Board概念是希望能够方便用户快速定位，切换多文件，以及原有白板。
 */
var Board = function () {
    function Board(app, boardName, displayName) {
        (0, _classCallCheck3.default)(this, Board);

        this.pages = {};
        //pages中的key的顺序通过pageNames来控制。
        this.pageNames = [];
        //创建新页面时，新页面的索引号。该索引号会随着新页面创建而递增
        this.newPageIndex = 1;
        this.app = app;
        this.dispatch = app.dispatcher;
        this.boardName = boardName;
        this.displayName = displayName;
        this.pages = {
            '0': new _page2.default(app, boardName, '0')
        };
        this.pageNames = ['0'];
        this.currIndex = 0;
    }

    (0, _createClass3.default)(Board, [{
        key: "getCurrPageIndex",

        /**
         * currIndex是page的内在索引。
         *
         * 添加页面时，新页面会获得一个内在索引。内在索引从0开始递增
         * 下面这个函数会返回当前页面在所有页面当中的位置。
         *
         * 举个例子：
         * 添加三个页面，三个页面的内在索引为0,1,2
         * 删除第二个页面，剩余下面的内在索引为0，2
         *
         * 2这个页面的currPageIndex为1，
         * 0的currPageIndex为0
         */
        value: function getCurrPageIndex() {
            return this.pageNames.indexOf(this.currIndex.toString());
        }
    }, {
        key: "getPageBuiltInIndex",
        value: function getPageBuiltInIndex(index) {
            return Number(this.pageNames[index]);
        }
    }, {
        key: "addOpInBoard",
        value: function addOpInBoard(snapshot) {
            var _snapshot$data = snapshot.data,
                action = _snapshot$data.action,
                page = _snapshot$data.page,
                insertAfter = _snapshot$data.insertAfter;

            if (action === 'add') {
                (0, _actions.addPage)(this, insertAfter, snapshot);
            }
            if (action === 'goto') {
                (0, _actions.gotoPage)(this, page, snapshot);
            }
            if (action === 'delete') {
                (0, _actions.deletePage)(this, page, snapshot);
            }
            this.app.opsManager.hooks.addOpHook.call(snapshot, true);
        }
    }, {
        key: "currPage",
        get: function get() {
            return this.pages[this.currIndex];
        }
    }, {
        key: "payloadOfPages",
        get: function get() {
            var _this = this;

            return this.pageNames.map(function (name) {
                return _this.pages[name].payload;
            });
        }
    }]);
    return Board;
}();

exports.default = Board;

/***/ }),

/***/ "./new_src/core/camera/index.ts":
/*!**************************************!*\
  !*** ./new_src/core/camera/index.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _container = __webpack_require__(/*! ../container */ "./new_src/core/container/index.ts");

var _shapeHelper = __webpack_require__(/*! ../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 在白板应用中，存在以白板容器左上角为起点的屏幕坐标系。以及一个虚拟的世界坐标系。世界坐标系的初始原点为（0，0），在屏幕的中心位置。所有操作的坐标均以世界坐标系记录。
 *
 * 在任一时刻，应用都有一个世界坐标系范围，该范围可以通过setCameraBound设置。白板容器显示的内容要大于等于世界此刻世界坐标系范围。
 *
 * *****<------------------>********
 * *****<---世界坐标系范围--->********
 * *****<------------------>********
 *
 * 单机模式下，以下操作会更新世界坐标系范围：
 * 1. 缩放
 * 2. 平移
 * 3. 重置世界坐标系
 * 4. 移动设备旋转。根据模式不同，可以设置世界坐标系宽高互换，或者竖屏时显示横屏所有内容，或者反过来
 * 5. 白板容器缩放，根据默认世界的宽高比，重新设置新的屏幕对应的世界坐标系
 *
 * 联机模式下，以下操作会更新世界坐标系范围：
 * 1. 跟随主播，世界坐标系与主播保持同步
 * 2. 与主播解绑
 *
 *
 * 初始世界坐标系范围有两个选择：
 * 1. 所有机器均保持一致，如1920*1080， 竖屏时为1080*1920
 * 2. 所有机器使用1920*1080的世界坐标系，倒推其屏幕的世界坐标系（如上图，可能为2500，1080），然后将该坐标系作为自己的世界坐标系
 *
 * 单机模式下两者没有区别。
 * 第一种模式在视角跟随时有些吃亏，因为主播需要额外上传自己屏幕代表的世界坐标系范围
 * 第二种模式相对较为简单直接。在视角跟随，以及世界坐标系范围更新时，要将自己的世界坐标系快照上传
 */
var Camera = function () {
    function Camera(app, defaultCameraBound) {
        var _this = this;

        (0, _classCallCheck3.default)(this, Camera);

        this.scale = 1;
        /**
         *  > 10%, < 1000%
         * 初始缩放比例为100%
         */
        // zoomFactor: number = 1
        this.cameraBoundByUser = {};
        this.app = app;
        this.translateX = 0;
        this.translateY = 0;
        this.scale = 1;
        if (defaultCameraBound) {
            this.width = defaultCameraBound.width;
            this.height = defaultCameraBound.height;
            this.centerX = defaultCameraBound.centerX;
            this.centerY = defaultCameraBound.centerY;
        } else {
            this.width = 1920;
            this.height = 1080;
            this.centerX = 0;
            this.centerY = 0;
        }
        this.app.on('container:set', function () {
            _this.updateTransParamAndRefresh();
        });
    }

    (0, _createClass3.default)(Camera, [{
        key: "getContainerWorldRect",

        /**
         * 获取当前容器在世界坐标系的显示区域
         */
        value: function getContainerWorldRect() {
            var rect = this.container.el.getBoundingClientRect();
            var w = rect.width;
            var h = rect.height;

            var _convertToPointInWorl = this.convertToPointInWorld(0, 0),
                _convertToPointInWorl2 = (0, _slicedToArray3.default)(_convertToPointInWorl, 2),
                sx = _convertToPointInWorl2[0],
                sy = _convertToPointInWorl2[1];

            var _convertToPointInWorl3 = this.convertToPointInWorld(w, h),
                _convertToPointInWorl4 = (0, _slicedToArray3.default)(_convertToPointInWorl3, 2),
                ex = _convertToPointInWorl4[0],
                ey = _convertToPointInWorl4[1];

            return {
                centerX: sx / 2 + ex / 2,
                centerY: sy / 2 + ey / 2,
                width: ex - sx,
                height: ey - sy
            };
        }
        /**
         * 计算给定世界坐标时，返回屏幕的四个角落的在世界坐标系代表的范围
         */

    }, {
        key: "getContainerWorldRectByCameraBound",
        value: function getContainerWorldRectByCameraBound(opts) {
            var w = this.container.width;
            var h = this.container.height;
            if (w / h > opts.width / opts.height) {
                opts.width = opts.height / h * w;
            } else {
                opts.height = opts.width / w * h;
            }
            return opts;
        }
        /**
         * 转换屏幕上的坐标。
         * 转换后在不同大小的屏幕上点击相似的位置，会得到大致相似的坐标
         * @param mx
         * @param my
         */

    }, {
        key: "convertToPointInWorld",
        value: function convertToPointInWorld(mx, my) {
            mx = (mx - this.translateX) / this.scale;
            my = (my - this.translateY) / this.scale;
            return [mx, my];
        }
        /**
         * 将世界坐标系上的点转化成container上的坐标
         * @param mx
         * @param my
         */

    }, {
        key: "convertWorldPointInContainer",
        value: function convertWorldPointInContainer(mx, my) {
            mx = mx * this.scale + this.translateX;
            my = my * this.scale + this.translateY;
            return [mx, my];
        }
    }, {
        key: "convertDom",
        value: function convertDom(dom) {
            dom.style.transform = "translate(" + this.translateX + "px, " + this.translateY + "px) scale(" + this.scale + ")";
        }
    }, {
        key: "convertDomAndRefresh",
        value: function convertDomAndRefresh() {
            var _a, _b, _c;
            this.convertDom(this.container.backgroundEl);
            this.convertDom(this.container.imageEl);
            this.convertDom(this.container.domEl);
            this.convertDom(this.container.textAreaEl);
            // this.app.room?.currBoard?.currPage?.refresh()
            this.app.room.pageToRefresh = (_b = (_a = this.app.room) === null || _a === void 0 ? void 0 : _a.currBoard) === null || _b === void 0 ? void 0 : _b.currPage;
            (_c = this.app.previewFactory) === null || _c === void 0 ? void 0 : _c.resizeElements();
        }
    }, {
        key: "convertCanvas",
        value: function convertCanvas(ctx) {
            ctx.translate(this.translateX * _container.DPI, this.translateY * _container.DPI);
            ctx.scale(this.scale * _container.DPI, this.scale * _container.DPI);
        }
        /**
         * 预览窗口的canvas大小和container中canvas大小不一致，需要单独计算缩放属性
         * @param ctx
         */

    }, {
        key: "convertPreviewCanvas",
        value: function convertPreviewCanvas(ctx) {
            var width = ctx.canvas.width;
            var height = ctx.canvas.height;

            var _getTransParam = this.getTransParam(width, height),
                scale = _getTransParam.scale,
                translateX = _getTransParam.translateX,
                translateY = _getTransParam.translateY;

            ctx.translate(translateX, translateY);
            ctx.scale(scale, scale);
        }
        /**
         * 也由快照引发，快照的type为: cameraBound
         * @param opts
         */

    }, {
        key: "setCameraBound",
        value: function setCameraBound(opts) {
            //各个终端会调整自身的translate及scale，确保boundary范围内的元素是可见的。且boundary至少有一边会顶着终端窗口的边界
            this.centerX = opts.centerX;
            this.centerY = opts.centerY;
            this.width = opts.width;
            this.height = opts.height;
            this.updateTransParamAndRefresh();
        }
        /**
         * 计算经过snapshot变化后，屏幕显示范围代表的世界坐标系
         * @param snapshot
         */

    }, {
        key: "getNextCameraBound",
        value: function getNextCameraBound(data) {
            if (data.type === 'pan') {
                return this._roundBoundary(this.getCameraBoundPan(data));
            } else if (data.type === 'zoom') {
                return this._roundBoundary(this.getCameraBoundZoom(data));
            } else if (data.type === 'reset-camera') {
                return this._roundBoundary(this.getCameraBoundReset());
            } else if (data.type === 'fit-to-content') {
                return this._roundBoundary(this.getCameraBoundFitToContent());
            } else if (data.type === 'fit-to-doc') {
                return this._roundBoundary(this.getCameraBoundFitToDoc());
            } else if (data.type === 'resize-camera') {
                return this._roundBoundary(this.getCameraBoundResize());
            } else {
                throw new Error("\u4E0D\u5E94\u8BE5\u8FDB\u5165\u6B64\u5206\u652F(getCameraBound), data\u7C7B\u578B\u4E3A\uFF1A" + data);
            }
        }
    }, {
        key: "_roundBoundary",
        value: function _roundBoundary(boundary) {
            return {
                centerX: Number(boundary.centerX.toFixed(1)),
                centerY: Number(boundary.centerY.toFixed(1)),
                width: Number(boundary.width.toFixed(1)),
                height: Number(boundary.height.toFixed(1))
            };
        }
    }, {
        key: "getCameraBoundPan",
        value: function getCameraBoundPan(data) {
            var cx = this.centerX;
            var cy = this.centerY;
            var w = this.width;
            var h = this.height;
            cx += data.dx / this.scale;
            cy += data.dy / this.scale;
            return this.getContainerWorldRectByCameraBound({
                centerX: cx,
                centerY: cy,
                width: w,
                height: h
            });
        }
    }, {
        key: "getCameraBoundZoom",
        value: function getCameraBoundZoom(data) {
            var cx = this.centerX;
            var cy = this.centerY;
            var w = this.width;
            var h = this.height;
            var center = void 0;
            if (data.center) {
                center = this.convertToPointInWorld(data.center[0], data.center[1]);
            } else {
                center = [cx, cy];
            }
            var scale = data.scale;
            cx = center[0] - (center[0] - cx) / scale;
            cy = center[1] - (center[1] - cy) / scale;
            w = w / scale;
            h = h / scale;
            return this.getContainerWorldRectByCameraBound({
                centerX: cx,
                centerY: cy,
                width: w,
                height: h
            });
        }
    }, {
        key: "getCameraBoundReset",
        value: function getCameraBoundReset() {
            return {
                centerX: 0,
                centerY: 0,
                width: this.container.width,
                height: this.container.height
            };
        }
    }, {
        key: "getCameraBoundFitToDoc",
        value: function getCameraBoundFitToDoc() {
            var backgroundOp = this.app.room.currBoard.currPage.backgroundSnapshot;
            if (!backgroundOp) {
                return {
                    centerX: this.centerX,
                    centerY: this.centerY,
                    width: this.width,
                    height: this.height
                };
            } else {
                var _backgroundOp$data$bo = backgroundOp.data.boundary,
                    sx = _backgroundOp$data$bo.sx,
                    sy = _backgroundOp$data$bo.sy,
                    w = _backgroundOp$data$bo.w,
                    h = _backgroundOp$data$bo.h;

                return this.getContainerWorldRectByCameraBound({
                    centerX: sx + w / 2,
                    centerY: sy + h / 2,
                    width: w,
                    height: h
                });
            }
        }
    }, {
        key: "getCameraBoundFitToContent",
        value: function getCameraBoundFitToContent() {
            /**
             * 缩放至和内容的boundary一致
             */
            var page = this.app.room.currBoard.currPage;
            var drawOpQueue = page.drawOpQueue;
            var backgroundOp = page.backgroundSnapshot;
            if ((0, _keys2.default)(drawOpQueue).length === 0 && !backgroundOp) {
                return this.getCameraBoundReset();
            }
            var boundary = {
                sx: 10000000,
                sy: 10000000,
                ex: -10000000,
                ey: -10000000
            };
            if (backgroundOp) {
                var _backgroundOp$data$bo2 = backgroundOp.data.boundary,
                    sx = _backgroundOp$data$bo2.sx,
                    sy = _backgroundOp$data$bo2.sy,
                    w = _backgroundOp$data$bo2.w,
                    h = _backgroundOp$data$bo2.h;

                boundary.sx = Math.min(boundary.sx, sx);
                boundary.sy = Math.min(boundary.sy, sy);
                boundary.ex = Math.max(boundary.ex, sx + w);
                boundary.ey = Math.max(boundary.ey, sy + h);
            }
            for (var key in drawOpQueue) {
                var data = drawOpQueue[key].data;
                if (!data.boundary || data.boundary.sx === null || data.boundary.sx === undefined || data.boundary.sy === null || data.boundary.sy === undefined || data.boundary.w === null || data.boundary.w === undefined || data.boundary.h === null || data.boundary.h === undefined) {
                    continue;
                }

                var _getTransformedBounda = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY),
                    _sx = _getTransformedBounda.sx,
                    _sy = _getTransformedBounda.sy,
                    _w = _getTransformedBounda.w,
                    _h = _getTransformedBounda.h;

                boundary.sx = Math.min(boundary.sx, _sx);
                boundary.sy = Math.min(boundary.sy, _sy);
                boundary.ex = Math.max(boundary.ex, _sx + _w);
                boundary.ey = Math.max(boundary.ey, _sy + _h);
            }
            if (boundary.ex - boundary.sx < 100 && boundary.ey - boundary.sy < 100) {
                //如果范围太小, 则适当的扩大范围至100 * 100。
                var horizontalPadding = 100 - (boundary.ex - boundary.sx);
                var verticalPadding = 100 - (boundary.ey - boundary.ex);
                boundary.sx = boundary.sx - horizontalPadding / 2;
                boundary.ex = boundary.ex + horizontalPadding / 2;
                boundary.sy = boundary.sy - verticalPadding / 2;
                boundary.ey = boundary.ey + verticalPadding / 2;
            }
            var padding = 0;
            return this.getContainerWorldRectByCameraBound({
                centerX: boundary.sx / 2 + boundary.ex / 2,
                centerY: boundary.sy / 2 + boundary.ey / 2,
                width: boundary.ex - boundary.sx + padding * 2,
                height: boundary.ey - boundary.sy + padding * 2
            });
        }
    }, {
        key: "getCameraBoundResize",
        value: function getCameraBoundResize() {
            if (this.app.disableAutoResize) {
                /**
                 * 保持窗口内元素大小不变
                 * 屏幕中心点位置不变, scale不变
                 */
                return {
                    centerX: this.centerX,
                    centerY: this.centerY,
                    width: this.container.width / this.zoomFactor,
                    height: this.container.height / this.zoomFactor
                };
            } else {
                /**
                 * 窗口内内容不变。大小改变
                 *
                 * 由于变化前后的宽高比可能发生变化，因此以宽作为基准。保持同样宽度内的内容不变
                 */
                return {
                    centerX: this.centerX,
                    centerY: this.centerY,
                    width: this.width,
                    height: this.width / this.container.width * this.container.height
                };
            }
        }
        /**
         * 根据世界坐标系设置dom的transform。计算后dom能够完全包含世界坐标系的范围，并且高度，或者宽度和世界坐标系的范围一致
         * @param opt
         */

    }, {
        key: "getTransParam",
        value: function getTransParam(_width, _height) {
            var cameraWidth = this.width;
            var cameraHeight = this.height;
            var centerX = this.centerX;
            var centerY = this.centerY;
            var scale = void 0,
                translateX = void 0,
                translateY = void 0;
            var cameraWhRatio = cameraWidth / cameraHeight;
            if (_width / _height > cameraWhRatio) {
                //容器较宽，根据容器高度和摄像机视野高度的比值，来确定缩放值
                //缩放后，容器垂直范围内显示的内容和摄像机垂直范围内显示高度一致
                scale = _height / cameraHeight;
            } else {
                scale = _width / cameraWidth;
            }
            translateX = _width / 2 - centerX * scale;
            translateY = _height / 2 - centerY * scale;
            return { scale: scale, translateX: translateX, translateY: translateY };
        }
    }, {
        key: "updateTransParamAndRefresh",
        value: function updateTransParamAndRefresh() {
            var _getTransParam2 = this.getTransParam(this.container.width, this.container.height),
                scale = _getTransParam2.scale,
                translateX = _getTransParam2.translateX,
                translateY = _getTransParam2.translateY;

            this.scale = scale;
            this.translateX = translateX;
            this.translateY = translateY;
            this.convertDomAndRefresh();
            this.app.emit('event:appState:change', 'zoomFactor', this.zoomFactor);
        }
    }, {
        key: "zoomFactor",
        get: function get() {
            return this.scale;
        }
    }, {
        key: "container",
        get: function get() {
            return this.app.container;
        }
    }]);
    return Camera;
}();

exports.default = Camera;

/***/ }),

/***/ "./new_src/core/camera/vision.ts":
/*!***************************************!*\
  !*** ./new_src/core/camera/vision.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _toast = __webpack_require__(/*! ../../component/toast */ "./new_src/component/toast/index.ts");

var _animation = __webpack_require__(/*! ../animation */ "./new_src/core/animation/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Vision = function () {
    function Vision(app) {
        (0, _classCallCheck3.default)(this, Vision);

        /**
         * 当前用户的身份
         */
        this.mode = 'freeObserver';
        this.app = app;
        this.camera = this.app.camera;
    }

    (0, _createClass3.default)(Vision, [{
        key: "setMode",
        value: function setMode(mode) {
            this.mode = mode;
            this.app.emit('event:appState:change', 'vision', {
                mode: mode,
                isBroadcasting: this.broadcaster !== undefined
            });
        }
    }, {
        key: "setBroadcaster",
        value: function setBroadcaster(value, nickname) {
            this.broadcaster = value;
            this.broadcasterNickname = nickname;
            // this.app.emit('event:vision:isBroadcasting', this.broadcaster !== undefined)
            this.app.emit('event:appState:change', 'vision', {
                mode: this.mode,
                isBroadcasting: this.broadcaster !== undefined
            });
        }
        /**
         * 设置当前用户为广播者, 并将消息广播给其他用户
         */

    }, {
        key: "setSelfAsBroadcaster",
        value: function setSelfAsBroadcaster() {
            if (this.app.dataHub.isSynchronizing) return;
            var account = this.app.account;
            var nickname = this.app.nickname;
            this.setMode('broadcaster');
            this.setBroadcaster(account, nickname);
            (0, _toast.showToast)({
                type: 'success',
                msg: '其他用户将与您保持视角同步',
                time: 3
            });
            this.app.dataHub.broadcastRoomState({
                broadcaster: account,
                nickname: nickname
            }, 'broadcaster');
            /**
             * 将本机的camera-bound发送给其他用户
             */
            this.app.emit('op:camera-bound:send', this.camera.getContainerWorldRect(), true);
        }
        /**
         * 停止设置自己为广播者
         */

    }, {
        key: "unsetSelfAsBroadcaster",
        value: function unsetSelfAsBroadcaster() {
            if (this.app.dataHub.isSynchronizing) return;
            if (this.mode === 'broadcaster') {
                if (this.broadcaster !== this.app.account) {
                    //运行时不应该走到该分支
                    console.error('白板--> 取消广播。但事实上目前用户并不是房间的广播者', this.broadcaster, this.app.account);
                }
                this.setMode('freeObserver');
                this.setBroadcaster(undefined);
                (0, _toast.showToast)({
                    type: 'success',
                    msg: '其他用户将停止与您保持视角同步'
                });
                this.app.dataHub.broadcastRoomState({
                    broadcaster: undefined
                }, 'broadcaster');
            }
        }
        /**
         * 设置当前用户为跟随者，只有房间状态存在broadcaster时才可用
         * 设置的目的是为了回放时接收到此数据，然后正确的还原用户当时的视角
         */

    }, {
        key: "setSelfAsFollower",
        value: function setSelfAsFollower() {
            if (this.app.dataHub.isSynchronizing) return;
            if (this.mode === 'broadcaster') {
                console.error('请先停止广播');
            } else if (this.mode === 'freeObserver') {
                this.setMode('follower');
                var boundary = this.camera.cameraBoundByUser[this.broadcaster];
                (0, _animation.transitionToCameraBound)(this.camera, boundary);
                (0, _toast.showToast)({
                    type: 'success',
                    msg: "\u4E0E" + this.broadcasterName + "\u4FDD\u6301\u89C6\u89D2\u540C\u6B65"
                });
                this.app.dataHub.broadcastRoomState({
                    account: this.app.account,
                    mode: 'follower'
                }, 'observeMode');
            }
        }
        /**
         * 设置自己为自由视角。通过setSelfAsFollower可以重新设置为跟随者
         */

    }, {
        key: "setSelfAsFreeObserver",
        value: function setSelfAsFreeObserver() {
            if (this.app.dataHub.isSynchronizing) return;
            if (this.mode === 'broadcaster') {
                console.error('请先停止广播');
            } else if (this.mode === 'follower') {
                this.setMode('freeObserver');
                (0, _toast.showToast)({
                    type: 'success',
                    msg: "\u4E0E" + this.broadcasterName + "\u89E3\u9664\u89C6\u89D2\u540C\u6B65"
                });
                this.app.dataHub.broadcastRoomState({
                    account: this.app.account,
                    mode: 'freeObserver'
                }, 'observeMode');
                /**
                 * 发送切换时的camera-bound
                 * 保证录像回放时，若切换到freeObserver, 能够通过自己的camera-bound查询到目前的camera
                 * 若没有发送，回放时则需要追溯上一次broadcaster的camera-bound是多少，并且还要截止到broadcaster结束主播前的camera，逻辑非常复杂
                 */
                this.app.emit('op:camera-bound:send', this.camera.getContainerWorldRect(), false);
            }
        }
    }, {
        key: "receiveBroadcaster",
        value: function receiveBroadcaster(value) {
            var broadcaster = value.broadcaster,
                nickname = value.nickname;

            if (broadcaster) {
                this.setMode('follower');
                this.setBroadcaster(broadcaster, nickname);
                //设置主播：account
                (0, _toast.showToast)({
                    msg: "\u6B63\u5728\u4E0E" + this.broadcasterName + "\u4FDD\u6301\u89C6\u89D2\u540C\u6B65",
                    type: 'success',
                    time: 3
                });
            } else {
                (0, _toast.showToast)({
                    msg: this.broadcasterName + "\u53D6\u6D88\u4E86\u89C6\u89D2\u540C\u6B65",
                    type: 'success',
                    time: 3
                });
                this.setMode('freeObserver');
                this.setBroadcaster(undefined);
            }
        }
        /**
         * 同步之后设置当前视角状态。
         * @param visionData
         */

    }, {
        key: "receiveBroadcasterAfterSync",
        value: function receiveBroadcasterAfterSync(lastVisionData) {
            if (lastVisionData.broadcaster === this.app.account) {
                (0, _toast.showToast)({
                    type: 'success',
                    msg: '其他用户正在与您保持视角同步',
                    time: 3
                });
                this.setMode('broadcaster');
                this.setBroadcaster(this.app.account, this.app.nickname);
            } else if (lastVisionData.broadcaster) {
                this.setMode('follower');
                this.setBroadcaster(lastVisionData.broadcaster, lastVisionData.nickname);
                (0, _toast.showToast)({
                    msg: "\u6B63\u5728\u4E0E" + this.broadcasterName + "\u4FDD\u6301\u89C6\u89D2\u540C\u6B65",
                    type: 'success',
                    time: 3
                });
            } else {
                this.setMode('freeObserver');
                this.setBroadcaster(undefined);
            }
        }
        /**
         * 录像回放时，根据该函数设置用户的观看状态：是自由视角，还是跟随视角
         * @param lastFree
         */

    }, {
        key: "receiveObserveModeAfterSync",
        value: function receiveObserveModeAfterSync(lastObserveModeOfAccount) {
            if (lastObserveModeOfAccount.account !== this.app.account) return;
            if (lastObserveModeOfAccount.mode === 'follower') {
                this.setMode('follower');
                var boundary = this.camera.cameraBoundByUser[this.broadcaster];
                (0, _animation.transitionToCameraBound)(this.camera, boundary);
                (0, _toast.showToast)({
                    type: 'success',
                    msg: "\u6B63\u5728\u4E0E" + this.broadcasterName + "\u4FDD\u6301\u89C6\u89D2\u540C\u6B65"
                });
            } else {
                this.setMode('freeObserver');
                var _boundary = this.camera.cameraBoundByUser[this.app.account];
                (0, _animation.transitionToCameraBound)(this.camera, _boundary);
                (0, _toast.showToast)({
                    type: 'success',
                    msg: "\u4E0E" + this.broadcasterName + "\u89E3\u9664\u89C6\u89D2\u540C\u6B65"
                });
            }
        }
    }, {
        key: "broadcasterName",
        get: function get() {
            return this.broadcasterNickname ? this.broadcasterNickname : this.broadcaster;
        }
    }]);
    return Vision;
}();

exports.default = Vision;

/***/ }),

/***/ "./new_src/core/config.ts":
/*!********************************!*\
  !*** ./new_src/core/config.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.DEFAULT_FONTSIZE = undefined;

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DEFAULT_FONTSIZE = exports.DEFAULT_FONTSIZE = 32;
//之所以设计为类，是想要创建多个DrawPlugin实例时，各个实例之间的配置支持相互独立

var AppConfig = function AppConfig(app) {
    var _this = this;

    (0, _classCallCheck3.default)(this, AppConfig);

    this.setAppConfig = function (partialConfig) {
        var _a;
        if ((0, _keys2.default)(partialConfig).length === 0) {
            console.error('白板-->', '调用了setAppConfig, 但传入的参数为空', partialConfig);
        } else {
            for (var key in partialConfig) {
                if (!_this.config.hasOwnProperty(key)) {
                    console.error('白板-->', 'setAppConfig\u4F20\u5165\u7684\u53C2\u6570\u952E\u503C' + key + '\u4E0D\u662F\u6709\u6548\u7684\u914D\u7F6E\u9879');
                    console.error('白板-->', '\u76EE\u524D\u652F\u6301\u7684\u914D\u7F6E\u9879\u6709\uFF1A' + (0, _keys2.default)(_this.config));
                } else if (key === 'canvas_bg_color') {
                    //设置背景色
                    _this.config.canvas_bg_color = partialConfig.canvas_bg_color;
                    _this.app.container.setBackgroundColor();
                    (_a = _this.app.previewFactory) === null || _a === void 0 ? void 0 : _a.setBackgroundColor();
                } else {
                    _this.config[key] = partialConfig[key];
                }
            }
        }
        (0, _assign2.default)(_this.config, partialConfig);
    };
    this.getAppConfig = function () {
        return _this.config;
    };
    this.app = app;
    this.config = {
        canvas_bg_color: '#f5f5f7',
        showCursorNickname: true,
        showSelectNickname: true,
        showLaserNickname: true,
        cameraTransformEnabled: true
    };
};

exports.default = AppConfig;

/***/ }),

/***/ "./new_src/core/container/index.ts":
/*!*****************************************!*\
  !*** ./new_src/core/container/index.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.DPI = undefined;

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _domEvents = __webpack_require__(/*! ../misc/dom-events */ "./new_src/core/misc/dom-events.ts");

var _shapeHelper = __webpack_require__(/*! ../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DPI = exports.DPI = window.devicePixelRatio || 1;
console.log("白板--> DPI", DPI);
//click不能超过100ms
var TIMER_THRESHOLD = 150;
//超过5px的移动就不能被判定为click
var MOVE_THRESHOLD = 5;

var Container = function () {
    function Container(app) {
        var _this = this;

        (0, _classCallCheck3.default)(this, Container);

        this.elInitW = 1920;
        this.elInitH = 1080;
        this.isLandscape = false;
        this.elesToResize = [];
        this.top = 0;
        this.left = 0;
        this.keyPressed = {};
        /**
         * 若不判定为click，则发送mousedown,mousemove[], mouseup事件
         * 否则发送click事件
         */
        //怀疑本次操作是点击操作
        this.maybeClick = false;
        //怀疑本次操作是连续点击操作
        //发射鼠标动作前，将动作存在这里
        this.mouseEventCache = [];
        this.isMouseDown = false;
        this.sx = 0;
        this.sy = 0;
        this.lastMx = 0;
        this.lastMy = 0;
        this.lastClientX = 0;
        this.lastClientY = 0;
        this._resize = function (event) {
            var _a;
            var rect = _this.el.getBoundingClientRect();
            _this.containerRect = rect;
            if (_this.app.ifDeviceSupportOrientation) {
                //触摸屏横竖屏切换时，需要设置isLandscape
                _this.isLandscape = rect.width > rect.height;
            }
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = (0, _getIterator3.default)(_this.elesToResize), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var ele = _step.value;

                    if (ele instanceof HTMLCanvasElement) {
                        ele.width = rect.width * DPI;
                        ele.height = rect.height * DPI;
                    }
                    ele.style.width = rect.width + "px";
                    ele.style.height = rect.height + "px";
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }

            _this.top = rect.top;
            _this.left = rect.left;
            _this.setElePosition(_this.backgroundEl, 'fixed');
            _this.setElePosition(_this.imageEl, 'fixed');
            _this.setElePosition(_this.domEl, 'fixed');
            _this.setElePosition(_this.textAreaEl, 'fixed');
            //很不喜欢使用eventEmitter，但是不这样做不好解决text工具栏大小没动态更新的bug
            _this.dispatcher.emit('container:resize');
            /**
             * 必须设置canvas宽高后才能够设置lineCap, lineJoin
             */
            _this.ctx.lineCap = 'round';
            _this.ctx.lineJoin = 'round';
            _this.frontCtx.lineCap = 'round';
            _this.frontCtx.lineJoin = 'round';
            _this.laserCtx.lineCap = 'round';
            _this.laserCtx.lineJoin = 'round';
            /**
             * 初始化时不要用resize发送camera-bound
             */
            if (event) {
                (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.resize(event, rect.width, rect.height);
            }
        };
        this.unbindEvents = function () {
            var _a;
            (_a = _this._ro) === null || _a === void 0 ? void 0 : _a.disconnect();
            window.removeEventListener('scroll', _this._resize);
            window.removeEventListener('resize', _this._resize);
            window.removeEventListener('orientationchange', _this._resize);
            (0, _domEvents.off)(_this.el, 'mousedown', _this._mousedown);
            (0, _domEvents.off)(_this.el, 'mouseleave', _this._mouseleave);
            (0, _domEvents.off)(window.document, 'mousemove', _this._mousemove);
            (0, _domEvents.off)(window.document, 'mouseup', _this._mouseup);
            (0, _domEvents.off)(window.document, 'mousewheel', _this._mousewheel);
            (0, _domEvents.off)(_this.el, 'touchstart', _this._mousedown);
            (0, _domEvents.off)(_this.el, 'touchmove', _this._mousemove);
            (0, _domEvents.off)(_this.el, 'touchend', _this._mouseup);
            (0, _domEvents.off)(window.document, 'keyup', _this._keyup);
            (0, _domEvents.off)(window.document, 'keydown', _this._keydown);
            (0, _domEvents.off)(document.body, 'contextmenu', _this._contextmenu);
        };
        this.getEventClientPos = function (event) {
            var clientX = void 0;
            var clientY = void 0;
            if (event instanceof MouseEvent) {
                clientX = event.clientX;
                clientY = event.clientY;
            } else {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            }
            //减去canvas到browser左上角的差值
            clientX = clientX - _this.left;
            clientY = clientY - _this.top;
            //前两个是在世界坐标系
            //后两个是在canvas上的位置
            return [].concat((0, _toConsumableArray3.default)(_this.app.camera.convertToPointInWorld(clientX, clientY)), [clientX, clientY]);
        };
        this._contextmenu = function (event) {
            event.preventDefault();
        };
        this._mousedown = function (event) {
            if (_this.isMouseDown) {
                //忽略暴力测试下的连续mousedown操作
                return;
            }

            var _getEventClientPos = _this.getEventClientPos(event),
                _getEventClientPos2 = (0, _slicedToArray3.default)(_getEventClientPos, 4),
                mx = _getEventClientPos2[0],
                my = _getEventClientPos2[1],
                clientX = _getEventClientPos2[2],
                clientY = _getEventClientPos2[3];

            _this.lastMx = mx;
            _this.lastMy = my;
            _this.lastClientX = clientX;
            _this.lastClientY = clientY;
            _this.isMouseDown = true;
            //怀疑可能是点击操作
            _this.maybeClick = true;
            _this.sx = mx;
            _this.sy = my;
            _this.mouseEventCache.push({
                type: 'mousedown',
                args: [event, _this.sx, _this.sy, clientX, clientY]
            });
            _this.mouseEmitTimer = setTimeout(function () {
                //时间过长，不是点击操作
                _this.maybeClick = false;
                _this._emitMouseEvents();
            }, TIMER_THRESHOLD);
        };
        this._mousemove = function (event) {
            var _a;

            var _getEventClientPos3 = _this.getEventClientPos(event),
                _getEventClientPos4 = (0, _slicedToArray3.default)(_getEventClientPos3, 4),
                mx = _getEventClientPos4[0],
                my = _getEventClientPos4[1],
                clientX = _getEventClientPos4[2],
                clientY = _getEventClientPos4[3];

            _this.lastMx = mx;
            _this.lastMy = my;
            _this.lastClientX = clientX;
            _this.lastClientY = clientY;
            if (_this.maybeClick) {
                //如果鼠标移动过多，则不是点击操作
                _this.maybeClick = (0, _shapeHelper.distSqrt)([mx, my], [_this.sx, _this.sy]) <= MOVE_THRESHOLD;
            }
            if (!_this.maybeClick) {
                /**
                 * 确定不是点击操作，直接发送鼠标移动事件，以及之前缓存的鼠标动作
                 */
                if (_this.mouseEmitTimer) {
                    _this.mouseEmitTimer = clearTimeout(_this.mouseEmitTimer);
                    _this._emitMouseEvents();
                }
                (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.mousemove(event, mx, my, clientX, clientY);
            } else {
                /**
                 * 不确定是不是点击操作，先将动作存放起来
                 */
                _this.mouseEventCache.push({
                    type: 'mousemove',
                    args: [event, mx, my, clientX, clientY]
                });
            }
        };
        this._mouseup = function (event) {
            var _a, _b;
            var _ref = [_this.lastMx, _this.lastMy, _this.lastClientX, _this.lastClientY],
                mx = _ref[0],
                my = _ref[1],
                clientX = _ref[2],
                clientY = _ref[3];

            if (!_this.maybeClick) {
                //确定不是点击操作，将之前缓存的操作，以及本次mouseup发送出去
                if (_this.mouseEmitTimer) {
                    _this.mouseEmitTimer = clearTimeout(_this.mouseEmitTimer);
                    _this._emitMouseEvents();
                }
                _this.mouseEventCache = [];
                (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.mouseup(event, mx, my, clientX, clientY);
            } else {
                //是点击操作，不用发送down，up以及move
                _this.mouseEmitTimer = clearTimeout(_this.mouseEmitTimer);
                _this.mouseEventCache = [];
                _this.maybeClick = false;
                //发送点击操作
                (_b = _this.opsManager) === null || _b === void 0 ? void 0 : _b.click(event, mx, my, clientX, clientY);
            }
            _this.isMouseDown = false;
        };
        this._mouseleave = function (event) {
            var _a;

            var _getEventClientPos5 = _this.getEventClientPos(event),
                _getEventClientPos6 = (0, _slicedToArray3.default)(_getEventClientPos5, 4),
                mx = _getEventClientPos6[0],
                my = _getEventClientPos6[1],
                clientX = _getEventClientPos6[2],
                clientY = _getEventClientPos6[3];

            (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.mouseleave(event, mx, my, clientX, clientY);
        };
        this._mousewheel = function (event) {
            var _a;

            var _getEventClientPos7 = _this.getEventClientPos(event),
                _getEventClientPos8 = (0, _slicedToArray3.default)(_getEventClientPos7, 4),
                mx = _getEventClientPos8[0],
                my = _getEventClientPos8[1],
                clientX = _getEventClientPos8[2],
                clientY = _getEventClientPos8[3];

            (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.mousewheel(event, mx, my, clientX, clientY);
        };
        //处理完事件后，再将key状态置为松开
        this._keyup = function (event) {
            var _a;
            var key = event.key.toLocaleLowerCase();
            (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.keyup(event);
            _this.keyPressed[key] = false;
        };
        this._keydown = function (event) {
            var _a;
            var key = event.key.toLocaleLowerCase();
            _this.keyPressed[key] = true;
            (_a = _this.opsManager) === null || _a === void 0 ? void 0 : _a.keydown(event);
        };
        this.app = app;
        this.dispatcher = app.dispatcher;
        this.el = document.createElement('div');
        this.el.style.position = 'relative';
        this.el.style.width = '100%';
        this.el.style.height = '100%';
        this.setBackgroundColor();
        this.backgroundEl = this.setupDivElement('bg-el');
        this.imageEl = this.setupDivElement('image-el');
        var temp = this.setupCanvasElement('bg-canvas');
        this.canvas = temp.canvas;
        this.ctx = temp.ctx;
        temp = this.setupCanvasElement('front-canvas');
        this.frontCanvas = temp.canvas;
        this.frontCtx = temp.ctx;
        this.domEl = this.setupDivElement('dom-el');
        this.textAreaEl = this.setupDivElement('toolbar-el');
        temp = this.setupCanvasElement('laser-canvas');
        this.laserCanvas = temp.canvas;
        this.laserCtx = temp.ctx;
    }
    /**
     * config变动时，需要调用此函数修改背景色
     */


    (0, _createClass3.default)(Container, [{
        key: "setBackgroundColor",
        value: function setBackgroundColor() {
            this.el.style.backgroundColor = this.app.appConfig.canvas_bg_color;
        }
    }, {
        key: "appendTo",
        value: function appendTo(container) {
            container.appendChild(this.el);
            this._resize();
            this.dispatcher.emit('container:set');
            this._bindEvents(container);
        }
    }, {
        key: "addOpsManager",
        value: function addOpsManager(opsManager) {
            this.opsManager = opsManager;
        }
    }, {
        key: "isKeyDown",
        value: function isKeyDown(key) {
            return this.keyPressed.hasOwnProperty(key) && this.keyPressed[key];
        }
        /**
         * 测试鼠标在container或者其子元素上面
         * @param div
         */

    }, {
        key: "isTargetOnContainer",
        value: function isTargetOnContainer(div) {
            var _a;
            return div === this.el || (div === null || div === void 0 ? void 0 : div.parentNode) === this.el || ((_a = div === null || div === void 0 ? void 0 : div.parentNode) === null || _a === void 0 ? void 0 : _a.parentNode) === this.el;
        }
    }, {
        key: "setupDivElement",
        value: function setupDivElement(className) {
            var ele = document.createElement('div');
            ele.style.transformOrigin = 'left top';
            ele.className = className;
            this.el.appendChild(ele);
            return ele;
        }
    }, {
        key: "setupCanvasElement",
        value: function setupCanvasElement(className) {
            var ele = document.createElement('canvas');
            this.setElePosition(ele);
            ele.className = className;
            ele.style.pointerEvents = 'none';
            var ctx = ele.getContext('2d');
            this.el.appendChild(ele);
            this.elesToResize.push(ele);
            return { canvas: ele, ctx: ctx };
        }
    }, {
        key: "_bindEvents",
        value: function _bindEvents(parentContainer) {
            var _this2 = this;

            var _a;
            this.unbindEvents();
            this._ro = new MutationObserver(function (mutationList, observer) {
                _this2._resize(true);
            });
            (_a = this._ro) === null || _a === void 0 ? void 0 : _a.observe(parentContainer, {
                attributes: true,
                attributeFilter: ['style']
            });
            window.addEventListener('scroll', this._resize);
            window.addEventListener('resize', this._resize);
            window.addEventListener("orientationchange", this._resize);
            (0, _domEvents.on)(this.el, 'mousedown', this._mousedown);
            (0, _domEvents.on)(this.el, 'mouseleave', this._mouseleave);
            (0, _domEvents.on)(window.document, 'mousemove', this._mousemove);
            (0, _domEvents.on)(window.document, 'mouseup', this._mouseup);
            (0, _domEvents.on)(window.document, 'mousewheel', this._mousewheel);
            (0, _domEvents.on)(this.el, 'touchstart', this._mousedown);
            (0, _domEvents.on)(this.el, 'touchmove', this._mousemove);
            (0, _domEvents.on)(this.el, 'touchend', this._mouseup);
            (0, _domEvents.on)(window.document, 'keyup', this._keyup);
            (0, _domEvents.on)(window.document, 'keydown', this._keydown);
            (0, _domEvents.on)(document.body, 'contextmenu', this._contextmenu);
        }
    }, {
        key: "destroy",
        value: function destroy() {
            this.unbindEvents();
        }
    }, {
        key: "setElePosition",
        value: function setElePosition(ele) {
            var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'absolute';

            if (position === 'absolute') {
                ele.style.position = position;
                ele.style.left = '0px';
                ele.style.right = '0px';
                ele.style.top = '0px';
                ele.style.bottom = '0px';
            } else {
                /**
                 * 若textarea编辑时，文本超出屏幕宽度，即使body的overflow为hidden，
                 * 依旧会导致body向右侧scroll。
                 *
                 * 此时，将textarea的任意一个祖先元素设置为fixed，就能够解决该问题。
                 *
                 * 但是，如果除了fixed祖先元素之外，还有其他祖先元素带有transform属性，依然
                 * 会有上述问题。
                 *
                 * 如果将带有transform属性的祖先元素带有fixed属性，该问题就能被解决。
                 *
                 * 综上，将带有transform属性的textarea的祖先元素设置为fixed，能解决textarea
                 * 编辑时导致页面横移的缺陷。
                 */
                ele.style.position = 'fixed';
                ele.style.left = this.left + "px";
                ele.style.width = this.width + "px";
                ele.style.top = this.top + "px";
                ele.style.height = this.height + "px";
            }
        }
        /**
         * 确定不是点击事件后，发送之前缓存的事件
         */

    }, {
        key: "_emitMouseEvents",
        value: function _emitMouseEvents() {
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = (0, _getIterator3.default)(this.mouseEventCache), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var _opsManager;

                    var eventArg = _step2.value;

                    (_opsManager = this.opsManager)[eventArg.type].apply(_opsManager, (0, _toConsumableArray3.default)(eventArg.args));
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }

            this.mouseEventCache = [];
        }
    }, {
        key: "width",
        get: function get() {
            if (this.containerRect) {
                return this.containerRect.width;
            } else {
                return this.canvas.width;
            }
        }
    }, {
        key: "height",
        get: function get() {
            if (this.containerRect) {
                return this.containerRect.height;
            } else {
                return this.canvas.height;
            }
        }
    }]);
    return Container;
}();

exports.default = Container;

/***/ }),

/***/ "./new_src/core/dataHub/index.ts":
/*!***************************************!*\
  !*** ./new_src/core/dataHub/index.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _toast = __webpack_require__(/*! ../../component/toast */ "./new_src/component/toast/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 每个dataType队列，两个包之间的最小间隔
 */
var MINIMUM_BROADCAST_GAP_PER_DATATYPE = 70; /**
                                              * 管理和服务器之间的数据传输
                                              *
                                              * 同步流程：
                                              * 1. 客户端向服务器发送最后一个包id: A
                                              * 2. 服务器向客户端发送最后一个包id: B
                                              * 3. 服务器向客户端发送这两个id之间的所有包, A => B
                                              * 4. 客户端完全接收到A => B，客户端判定同步完成，并执行接收到的数据快照
                                              * 5. 若客户端长时间没有收到这些包，则客户端再次向服务器发送同步指令
                                              *
                                              * 如果在同步过程中，接收到广播数据，暂时先不执行这些命令。保存起来，待同步结束一并执行
                                              */

var overwritableTypes = ['select', 'select-hover', 'camera-bound', 'mouse-pointer', 'laser'];
/**
 * 若10s内同步未完成，重新发送同步请求
 */
var ResendSyncRequestInterval = 10;
/**
 * 发送5次还没有得到所有的同步数据时，不再请求同步
 */
var ResendSyncRequestLimit = 8;

var DataHub = function () {
    function DataHub(app, handler) {
        var _this = this;

        (0, _classCallCheck3.default)(this, DataHub);

        /**
         * 延迟广播发送数据
         * 不同dataType应该走不同的timer队列，避免发送到一个包里面
         */
        this.debounceData = {};
        /**
         * 本地数据发送前，会猜测其在远程写入服务器时的server_pkg_id, 这里的id就是本地猜测的id，value是对应的数据
         * 收到广播回包后，会根据这个id和回包实际得到的server_pkg_id比较，判断是否需要进一步修改
         */
        this.clientIdToData = {};
        /**
         * 0...lastContinueServerPkgId都已经在本地
         */
        this.lastContinueServerPkgId = -1;
        /**
         * id > serverPkgSinceLast的所有包的seq id数组
         */
        this.serverPkgSinceLast = [];
        /**
         * 本次同步最后一个包的id
         */
        this.lastPkgIdToSync = -1;
        this.dataOfSync = {};
        /**
         * 是否正在同步中
         */
        this.isSynchronizing = false;
        this._scheduleNextBroadcast = function (debounceDataEntry, dataType) {
            return requestAnimationFrame(function () {
                var now = new Date().valueOf();
                if (now - debounceDataEntry.time < MINIMUM_BROADCAST_GAP_PER_DATATYPE) {
                    /**
                     * 生成该dataType的广播队列后，至少要隔一定时间才会发送
                     * 如果没有到该间隔，则安排下一次requestAnimationFrame检查
                     */
                    debounceDataEntry.timer = _this._scheduleNextBroadcast(debounceDataEntry, dataType);
                } else {
                    _this._doBroadcastData(debounceDataEntry, dataType);
                }
            });
        };
        this._doBroadcastData = function (debounceDataEntry, dataType) {
            /**
             * 时间到，发送数据
             */
            var data = _this.app.room.mergeDebouncedData(debounceDataEntry.dataQueue, dataType);
            var params = {
                strategy: dataType === 'snapshot' ? 1 : 2,
                data: (0, _stringify2.default)(data),
                client_pkg_id: debounceDataEntry.client_pkg_id
            };
            if (dataType !== 'snapshot') {
                params.dataType = dataType;
            }
            _this.handler.broadcastData(params);
            _this.clientIdToData[params.client_pkg_id] = data;
            _this.debounceData[dataType] = {
                timer: null,
                client_pkg_id: -1,
                time: 0,
                dataQueue: []
            };
        };
        /**
         * 一段时间后，没有完全收到同步需要的数据，则重试
         */
        this._setupResendSyncRequestTimer = function () {
            var currRetryCount = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;

            /**
             * 如果不clear，则连续两次同步请求时，第一个timer的句柄无法再获取，
             * 导致clearTimeout无法取消第一个timer的回调函数
             */
            clearTimeout(_this.resendSyncRequestTimer);
            _this.resendSyncRequestTimer = setTimeout(function () {
                if (currRetryCount <= ResendSyncRequestLimit) {
                    console.error('\u767D\u677F-->\uFF0C\u540C\u6B65\u6570\u636E\u8D85\u65F6\uFF0C\u7B2C' + (currRetryCount + 1) + '\u6B21\u8BF7\u6C42\u540C\u6B65\u6570\u636E, ' + _this.lastContinueServerPkgId);
                    _this.handler.sendSyncRequest(_this.lastContinueServerPkgId);
                    _this._setupResendSyncRequestTimer(currRetryCount + 1);
                } else {
                    (0, _toast.showToast)({
                        type: 'error',
                        msg: '无法同步数据，请检查你的网络',
                        time: 1000
                    });
                    console.error('\u767D\u677F-->\u591A\u6B21\u540C\u6B65\u6570\u636E\u5931\u8D25');
                }
            }, ResendSyncRequestInterval * 1000);
        };
        this.app = app;
        this.handler = handler;
        this.bindEvents();
    }

    (0, _createClass3.default)(DataHub, [{
        key: 'reset',

        /**
         * 应用状态重置。一般用于测试
         */
        value: function reset() {
            for (var key in this.debounceData) {
                if (this.debounceData[key].timer) {
                    cancelAnimationFrame(this.debounceData[key].timer);
                }
            }
            this.debounceData = {};
            this.clientIdToData = {};
            this.lastContinueServerPkgId = -1;
            this.serverPkgSinceLast = [];
            this.lastPkgIdToSync = -1;
            this.dataOfSync = {};
            this.isSynchronizing = false;
            clearTimeout(this.resendSyncRequestTimer);
        }
    }, {
        key: 'bindEvents',
        value: function bindEvents() {
            this.handler.on('data', this.onData.bind(this));
            this.handler.on('broadcastAck', this.onBroadcastAck.bind(this));
            this.handler.on('syncRequestAck', this.onSendRequestAck.bind(this));
            this.handler.on('syncRequestResponse', this.onSendRequestResponse.bind(this));
        }
        /**
         * 接到其他用户发来的广播数据
         * @param msg
         */

    }, {
        key: 'onData',
        value: function onData(msg) {
            var data = msg.data,
                server_pkg_id = msg.server_pkg_id;

            this._updateServerPkgInfo(server_pkg_id, server_pkg_id);
            if (this.isSynchronizing) {
                /**
                 * 正在同步中，暂时不执行
                 */
                this.dataOfSync[server_pkg_id] = data;
            } else {
                var type = data.type,
                    value = data.value;

                if (type === 'snapshot') {
                    this.room.execSnapshot({
                        snapshot: value,
                        pkgId: server_pkg_id
                    });
                } else if (type === 'broadcaster') {
                    this.app.vision.receiveBroadcaster(value);
                } else if (type === 'snapshotArr') {
                    this.room.execBatchSnapshots(value.map(function (_) {
                        return {
                            snapshot: _,
                            pkgId: server_pkg_id
                        };
                    }));
                }
            }
        }
        /**
         * 同步步骤一：
         * 客户端通知服务器客户端最后一个包的序列号
         */

    }, {
        key: 'sendSyncRequest',
        value: function sendSyncRequest() {
            console.log('白板--> 请求同步数据, 是否正在同步数据', this.isSynchronizing);
            if (this.isSynchronizing) {
                return;
            }
            this.isSynchronizing = true;
            this.handler.sendSyncRequest(this.lastContinueServerPkgId);
            // 设置服务器最后一个包为-1，收到syncRequestAck之后，会更新该变量
            this.lastPkgIdToSync = -1;
            /**
             * 服务器上存在，本地不存在的数据。同步后执行
             */
            this.dataOfSync = {};
            /**
             * 一段时间后，没有完全收到同步需要的数据，则重试
             */
            this._setupResendSyncRequestTimer();
        }
        /**
         * 同步步骤二：
         * 服务器通知客户端，服务器中的最后一个包的序列号
         */

    }, {
        key: 'onSendRequestAck',
        value: function onSendRequestAck(message) {
            this.lastPkgIdToSync = message.last_server_pkg_id;
            this._updateAppAfterSync();
        }
        /**
         * 同步步骤三：
         * 服务器给客户端返回客户端缺失的包，会分块返回
         * 当所有包都补齐了之后，客户端执行这些包
         */

    }, {
        key: 'onSendRequestResponse',
        value: function onSendRequestResponse(message) {
            //步骤二告知客户端没有新包需要同步
            if (!this.isSynchronizing) return;
            var start_server_pkg_id = message.start_server_pkg_id,
                end_server_pkg_id = message.end_server_pkg_id,
                packages = message.packages;

            if (!Array.isArray(packages)) {
                packages = [];
            }
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = (0, _getIterator3.default)(packages), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var pkg = _step.value;

                    this.dataOfSync[pkg.server_pkg_id] = pkg.data;
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }

            this._updateServerPkgInfo(start_server_pkg_id, end_server_pkg_id);
            this._updateAppAfterSync();
        }
        /**
         * 收到广播回包
         * 更新应用最后一个连续的server_pkg_id, 以及server_pkg_id之后的不连续包的数组
         * @param message
         */

    }, {
        key: 'onBroadcastAck',
        value: function onBroadcastAck(message) {
            var _this2 = this;

            var server_pkg_id = message.server_pkg_id,
                client_pkg_id = message.client_pkg_id;

            this._updateServerPkgInfo(server_pkg_id, server_pkg_id);
            var data = this.clientIdToData[client_pkg_id];
            delete this.clientIdToData[client_pkg_id];
            /**
             * 如果服务器中该包的顺序和预测的不同，则需要更新room中的快照数据
             */
            if (!data) {
                console.warn('\u767D\u677F--> broadcastAck, client_pkg_id:' + client_pkg_id + '\u7684\u6570\u636E\u4E0D\u5B58\u5728');
            }
            if (data && data.type === 'snapshot' && client_pkg_id !== server_pkg_id) {
                this.app.room.cacheSnapshot({
                    pkgId: server_pkg_id,
                    snapshot: data.value
                });
            } else if (data && data.type === 'snapshotArr' && client_pkg_id !== server_pkg_id) {
                data.value.forEach(function (_) {
                    _this2.app.room.cacheSnapshot({
                        pkgId: server_pkg_id,
                        snapshot: _
                    });
                });
            }
        }
    }, {
        key: 'sendSnapshot',
        value: function sendSnapshot(snapshot) {
            if (overwritableTypes.includes(snapshot.data.type)) {
                return this.broadcastData({
                    data: {
                        type: 'snapshot',
                        value: snapshot
                    }
                }, snapshot.opId);
            } else {
                return this.broadcastData({
                    data: {
                        type: 'snapshot',
                        value: snapshot
                    }
                }, 'snapshot');
            }
        }
    }, {
        key: 'broadcastRoomState',
        value: function broadcastRoomState(value, dataType) {
            return this.broadcastData({
                data: {
                    type: dataType,
                    value: value
                }
            }, dataType);
        }
    }, {
        key: 'broadcastData',
        value: function broadcastData(params, dataType) {
            if (!this.debounceData.hasOwnProperty(dataType) || !this.debounceData[dataType].timer) {
                var client_id = this.nextLocalFakeId;
                this.debounceData[dataType] = {
                    timer: null,
                    time: new Date().valueOf(),
                    client_pkg_id: client_id,
                    dataQueue: []
                };
                /**
                 * 占位。这样计算nextLocalFakeId时，不会和现在的client_id重复
                 */
                this.clientIdToData[client_id] = {};
            }
            var debounceDataEntry = this.debounceData[dataType];
            debounceDataEntry.dataQueue.push(params.data);
            if (debounceDataEntry.timer) {
                return debounceDataEntry.client_pkg_id;
            }
            debounceDataEntry.timer = this._scheduleNextBroadcast(debounceDataEntry, dataType);
            return debounceDataEntry.client_pkg_id;
        }
        /**
         * 判断是否同步结束，若同步结束，则执行同步时拉取的数据
         */

    }, {
        key: '_updateAppAfterSync',
        value: function _updateAppAfterSync() {
            var _this3 = this;

            if (this.lastContinueServerPkgId >= this.lastPkgIdToSync) {
                /**
                 * 防御性编程。防止isSynchronizing为false时，依旧有同步timer正在运行，然后报同步失败的错误
                 */
                clearTimeout(this.resendSyncRequestTimer);
            }
            if (this.lastContinueServerPkgId >= this.lastPkgIdToSync && this.isSynchronizing) {
                console.log('\u767D\u677F--> \u540C\u6B65\u6570\u636E\u63A5\u6536\u5B8C\u6BD5: ' + this.lastContinueServerPkgId + '--' + this.lastPkgIdToSync);
                this.isSynchronizing = false;
                if (true) {
                    console.log('白板-->', 'event:sync_finished');
                }
                this.app.emit('event:editable:change', this.app.editable);
                this.app.dispatcher.emit('event:sync_finished');
                var data = this._getDataToSync();
                var broadcasterData = void 0;
                for (var i = data.length - 1; i >= 0; i--) {
                    if (data[i].data.type === 'broadcaster') {
                        broadcasterData = data[i].data.value;
                        break;
                    }
                }
                var snapshotData = [];
                var _iteratorNormalCompletion2 = true;
                var _didIteratorError2 = false;
                var _iteratorError2 = undefined;

                try {
                    for (var _iterator2 = (0, _getIterator3.default)(data), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                        var pkg = _step2.value;

                        if (pkg.data.type === 'snapshot') {
                            snapshotData.push({
                                pkgId: pkg.pkgId,
                                snapshot: pkg.data.value
                            });
                        } else if (pkg.data.type === 'snapshotArr') {
                            var _iteratorNormalCompletion3 = true;
                            var _didIteratorError3 = false;
                            var _iteratorError3 = undefined;

                            try {
                                for (var _iterator3 = (0, _getIterator3.default)(pkg.data.value), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                                    var snapshot = _step3.value;

                                    snapshotData.push({
                                        pkgId: pkg.pkgId,
                                        snapshot: snapshot
                                    });
                                }
                            } catch (err) {
                                _didIteratorError3 = true;
                                _iteratorError3 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion3 && _iterator3.return) {
                                        _iterator3.return();
                                    }
                                } finally {
                                    if (_didIteratorError3) {
                                        throw _iteratorError3;
                                    }
                                }
                            }
                        }
                    }
                } catch (err) {
                    _didIteratorError2 = true;
                    _iteratorError2 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion2 && _iterator2.return) {
                            _iterator2.return();
                        }
                    } finally {
                        if (_didIteratorError2) {
                            throw _iteratorError2;
                        }
                    }
                }

                if (broadcasterData) {
                    this.app.vision.receiveBroadcasterAfterSync(broadcasterData);
                }
                this.app.room.execBatchSnapshots(snapshotData, function (hasBoundary) {
                    if (!hasBoundary) {
                        /**
                         * 如果未设置过boundary, 且存在文档页面，则设置初始boundary
                         */
                        if (_this3.app.defaultCameraBound) {
                            _this3.app.setCameraBound(_this3.app.defaultCameraBound);
                        } else if (_this3.app.hasBackground()) {
                            _this3.app.fitToContent(false);
                        }
                    }
                });
            }
        }
    }, {
        key: '_getDataToSync',
        value: function _getDataToSync() {
            var _this4 = this;

            var seqIds = (0, _keys2.default)(this.dataOfSync).sort(function (a, b) {
                return Number(a) - Number(b);
            });
            return seqIds.map(function (id) {
                try {
                    return {
                        data: JSON.parse(_this4.dataOfSync[id]),
                        pkgId: Number(id)
                    };
                } catch (_a) {
                    return undefined;
                }
            }).filter(function (_) {
                return _;
            });
        }
        /**
         * 更新 lastContinueServerPkgId, 以及serverPkgSinceLast
         * @param start: 第一个包
         * @param end :  最后一个包 [start, end]的每个包均存在
         *
         * 首先将start->end序列号均加入serverPkgSinceLast中，然后再更新
         */

    }, {
        key: '_updateServerPkgInfo',
        value: function _updateServerPkgInfo(start, end) {
            var i = 0,
                curr = start;
            //合并serverPkgSinceLast和[start, end]
            while (i <= this.serverPkgSinceLast.length) {
                if (curr > end) {
                    break;
                } else if (curr <= this.lastContinueServerPkgId) {
                    curr++;
                    continue;
                } else if (i === this.serverPkgSinceLast.length) {
                    var _serverPkgSinceLast;

                    /**
                     * 将[curr, end]压入serverPkgSinceLast的队尾
                     */
                    var arr = [];
                    while (curr <= end) {
                        arr.push(curr);
                        curr += 1;
                    }
                    (_serverPkgSinceLast = this.serverPkgSinceLast).splice.apply(_serverPkgSinceLast, [i, 0].concat(arr));
                } else if (this.serverPkgSinceLast[i] < curr) {
                    i++;
                } else if (this.serverPkgSinceLast[i] === curr) {
                    curr++;
                    i++;
                } else {
                    this.serverPkgSinceLast.splice(i, 0, curr);
                    curr++;
                    i++;
                }
            }
            //将serverPkgSinceLast中接在lastContinueServerPkgId后面的包提取出来，然后更新lastContinueServerPkgId
            i = 0;
            for (; i < this.serverPkgSinceLast.length; i++) {
                if (this.serverPkgSinceLast[i] === this.lastContinueServerPkgId + i + 1) {
                    continue;
                } else {
                    break;
                }
            }
            this.lastContinueServerPkgId += i;
            this.serverPkgSinceLast.splice(0, i);
        }
    }, {
        key: 'room',
        get: function get() {
            return this.app.room;
        }
        /**
         * 本地接收到的最后一个服务器包
         */

    }, {
        key: 'lastServerPkgId',
        get: function get() {
            if (this.serverPkgSinceLast.length > 0) {
                return this.serverPkgSinceLast[this.serverPkgSinceLast.length - 1];
            } else {
                return this.lastContinueServerPkgId;
            }
        }
        /**
         * 给本地包赋予一个服务器包id
         * 该id需要大于最后一个服务器包id，以及上一个本地包虚拟id
         */

    }, {
        key: 'nextLocalFakeId',
        get: function get() {
            var lastServerPkgId = this.lastServerPkgId;
            var inUseClientIds = (0, _keys2.default)(this.clientIdToData).map(function (_) {
                return Number(_);
            }).sort();
            if (inUseClientIds.length === 0) {
                return lastServerPkgId + 1;
            } else if (lastServerPkgId >= inUseClientIds[inUseClientIds.length - 1]) {
                return lastServerPkgId + 1;
            } else {
                return inUseClientIds[inUseClientIds.length - 1] + 1;
            }
        }
    }]);
    return DataHub;
}();

exports.default = DataHub;

/***/ }),

/***/ "./new_src/core/index.ts":
/*!*******************************!*\
  !*** ./new_src/core/index.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.App = undefined;

var _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ "./node_modules/babel-runtime/helpers/typeof.js");

var _typeof3 = _interopRequireDefault(_typeof2);

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _container = __webpack_require__(/*! ./container */ "./new_src/core/container/index.ts");

var _container2 = _interopRequireDefault(_container);

var _OpsManager = __webpack_require__(/*! ./ops/OpsManager */ "./new_src/core/ops/OpsManager.ts");

var _OpsManager2 = _interopRequireDefault(_OpsManager);

var _dispatcher2 = __webpack_require__(/*! ./misc/dispatcher */ "./new_src/core/misc/dispatcher.ts");

var _dispatcher3 = _interopRequireDefault(_dispatcher2);

var _room = __webpack_require__(/*! ./room */ "./new_src/core/room/index.ts");

var _room2 = _interopRequireDefault(_room);

var _dataHub = __webpack_require__(/*! ./dataHub */ "./new_src/core/dataHub/index.ts");

var _dataHub2 = _interopRequireDefault(_dataHub);

var _types = __webpack_require__(/*! ./types */ "./new_src/core/types.ts");

var _previewFactory = __webpack_require__(/*! ./previewFactory */ "./new_src/core/previewFactory/index.ts");

var _previewFactory2 = _interopRequireDefault(_previewFactory);

var _config = __webpack_require__(/*! ./config */ "./new_src/core/config.ts");

var _config2 = _interopRequireDefault(_config);

var _camera = __webpack_require__(/*! ./camera */ "./new_src/core/camera/index.ts");

var _camera2 = _interopRequireDefault(_camera);

var _validate = __webpack_require__(/*! ../util/validate */ "./new_src/util/validate.ts");

var _validate2 = _interopRequireDefault(_validate);

var _player = __webpack_require__(/*! ./player */ "./new_src/core/player/index.ts");

var _player2 = _interopRequireDefault(_player);

var _drawConfig = __webpack_require__(/*! ./ops/DrawOp/drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

var _simulator = __webpack_require__(/*! ./simulator */ "./new_src/core/simulator/index.ts");

var _simulator2 = _interopRequireDefault(_simulator);

var _vision = __webpack_require__(/*! ./camera/vision */ "./new_src/core/camera/vision.ts");

var _vision2 = _interopRequireDefault(_vision);

var _toast = __webpack_require__(/*! ../component/toast */ "./new_src/component/toast/index.ts");

var _util = __webpack_require__(/*! ./media/util */ "./new_src/core/media/util.ts");

var _isBase = __webpack_require__(/*! is-base64 */ "./node_modules/is-base64/is-base64.js");

var _isBase2 = _interopRequireDefault(_isBase);

var _textConfig = __webpack_require__(/*! ./ops/TextOp/textConfig */ "./new_src/core/ops/TextOp/textConfig.ts");

var _textConfig2 = _interopRequireDefault(_textConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * page，board类操作都必须生成快照，然后通过connector的sendData方法发送给其他客户端。
 *
 * syncRequest，resetRequest这一类同步操作不需要生成快照。它们属于同步逻辑。
 */
var App = function () {
    function App(opts) {
        (0, _classCallCheck3.default)(this, App);

        /**
         * 是否是录像模式
         */
        this.isRecordPlayer = false;
        /**
         * 编辑权限是否开启
         */
        this.editEnabled = false;
        /**
         * 是否展示鼠标
         */
        this.showCursor = false;
        /**
         * 信令是否处于连接状态
         */
        this.isConnected = false;
        this.account = opts.account;
        this.nickname = opts.nickname ? opts.nickname : opts.account;
        this.platform = opts.platform;
        this.defaultCameraBound = opts.cameraBound;
        this.disableAutoResize = opts.disableAutoResize !== undefined ? opts.disableAutoResize : true;
        this.nim = opts.nim;
        this.simulator = new _simulator2.default(this);
        this.configInstance = new _config2.default(this);
        this.dispatcher = new _dispatcher3.default();
        this.opsManager = new _OpsManager2.default(this);
        this.opsManager.extendDefaultOps();
        this.dataHub = new _dataHub2.default(this, opts.connector);
        this.container = new _container2.default(this);
        this.room = new _room2.default(this, this.dataHub);
        this.container.addOpsManager(this.opsManager);
        this.opsManager.addContainer(this.container);
        this.camera = new _camera2.default(this, this.defaultCameraBound);
        this.vision = new _vision2.default(this);
        this.isRecordPlayer = opts.isRecordPlayer ? true : false;
        if (!opts.isRecordPlayer) {
            this.previewFactory = new _previewFactory2.default(this);
        }
        if (opts.isRecordPlayer) {
            this.player = new _player2.default(this);
        }
        this.setContainer(opts.container);
    }

    (0, _createClass3.default)(App, [{
        key: "getStrokeWidth",
        value: function getStrokeWidth() {
            return _drawConfig2.default.strokeWidth;
        }
    }, {
        key: "getOpacity",
        value: function getOpacity() {
            return _drawConfig2.default.opacity;
        }
    }, {
        key: "getColor",
        value: function getColor() {
            return _drawConfig2.default.strokeColor;
        }
    }, {
        key: "getRedoCount",
        value: function getRedoCount() {
            return this.opsManager.opMap['redo'].getCount();
        }
    }, {
        key: "getUndoCount",
        value: function getUndoCount() {
            return this.opsManager.opMap['undo'].getCount();
        }
    }, {
        key: "isClearAvailable",
        value: function isClearAvailable() {
            return this.opsManager.opMap['clear'].isAvailable();
        }
    }, {
        key: "isTextAreaFocus",
        value: function isTextAreaFocus() {
            return this.opsManager.opMap['text'].isFocus;
        }
    }, {
        key: "getSelectedIds",
        value: function getSelectedIds() {
            return this.opsManager.opMap['select'].getSelectedIds();
        }
    }, {
        key: "getZoomFactor",
        value: function getZoomFactor() {
            return this.camera.zoomFactor;
        }
    }, {
        key: "getCameraBound",
        value: function getCameraBound() {
            return this.camera.getContainerWorldRect();
        }
    }, {
        key: "setAppConfig",
        value: function setAppConfig(config) {
            this.configInstance.setAppConfig(config);
        }
    }, {
        key: "setContainer",
        value: function setContainer(el) {
            el.innerHTML = '';
            this.container.appendTo(el);
        }
        /**
         * sdk初始化之后，请求同步数据
         *
         * 主播登录后，首先尝试恢复数据。恢复数据后，向其他用户广播恢复的数据
         * 主播登录需要置空所有其他用户
         * 非主播登录则需要向主播发送同步请求
         */

    }, {
        key: "readyToSyncData",
        value: function readyToSyncData() {
            if (true) {
                console.log('白板-->', 'drawPlugin.readyToSyncData');
            }
            document.body.style.cursor = 'auto';
            this.dataHub.sendSyncRequest();
        }
    }, {
        key: "setIsConnected",
        value: function setIsConnected(connected) {
            this.isConnected = connected;
            if (!this.isConnected) {
                document.body.style.cursor = 'auto';
            }
        }
    }, {
        key: "resetState",
        value: function resetState() {
            this.room.reset();
            this.dataHub.reset();
        }
    }, {
        key: "addImage",
        value: function addImage(opt) {
            if (true) {
                console.log('白板-->', 'drawPlugin.addImage', opt);
            }
            _validate2.default.validate('drawPlugin.addImage', opt, {
                url: {
                    type: 'string',
                    isRequire: true
                },
                width: {
                    type: 'number'
                },
                height: {
                    type: 'number'
                }
            });
            if ((0, _isBase2.default)(opt.url) || (0, _isBase2.default)(opt.url, { allowMime: true })) {
                /**
                 * 先将base64图片上传到nos服务器，再加入白板中
                 */
                (0, _util.uploadAndAddImage)(this, { dataURL: opt.url }, { width: opt.width, height: opt.height });
            } else if (opt.url.length > 10000) {
                console.error('白板-->', 'drawPlugin.addImage opt.url长度不应该大于10000');
            } else {
                this.emit('op:image:upload', opt.url, {
                    width: opt.width,
                    height: opt.height
                });
            }
        }
        /**
         * 选择本地图片
         */

    }, {
        key: "addLocalImage",
        value: function addLocalImage() {
            var opt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

            if (true) {
                console.log('白板-->', 'drawPlugin.addLocalImage', opt);
            }
            _validate2.default.validate('drawPlugin.addLocalImage', opt, {
                width: {
                    type: 'number'
                },
                height: {
                    type: 'number'
                }
            });
            (0, _util.popupImageChooserAndAddImage)(this, { width: opt.width, height: opt.height });
        }
    }, {
        key: "addVideo",
        value: function addVideo(opt) {
            if (true) {
                console.log('白板-->', 'drawPlugin.addVideo', opt);
            }
            _validate2.default.validate('drawPlugin.addVideo', opt, {
                url: {
                    type: 'string',
                    isRequire: true
                },
                width: {
                    type: 'number'
                }
            });
            this.emit('op:video:insert', opt.url, {
                width: opt.width
            });
        }
        /**
         * 设置页面的背景
         * @param url
         * @param width
         * @param height
         */

    }, {
        key: "setPageBackground",
        value: function setPageBackground(opt) {
            if (true) {
                console.log('白板-->', 'drawPlugin.setPageBackground', opt);
            }
            _validate2.default.validate('drawPlugin.setPageBackground', opt, {
                url: {
                    type: 'string',
                    isRequire: true
                },
                width: {
                    type: 'number',
                    isRequire: true
                },
                height: {
                    type: 'number',
                    isRequire: true
                }
            });
            this.emit('op:background:imageUpload', opt.url, {
                width: opt.width,
                height: opt.height,
                pageIndex: opt.pageIndex
            });
        }
        /**
         * 当前页面是否有background
         */

    }, {
        key: "hasBackground",
        value: function hasBackground() {
            return this.room.currBoard.currPage.backgroundSnapshot ? true : false;
        }
        /**
         * 添加文档
         */

    }, {
        key: "addDoc",
        value: function addDoc(opt) {
            if (true) {
                console.log('白板-->', 'drawPlugin.addDoc', opt);
            }
            _validate2.default.validate('drawPlugin.addDoc', opt, {
                docName: {
                    type: 'string',
                    isRequire: true
                },
                params: {
                    type: 'array',
                    isRequire: true
                }
            });
            for (var i = 0; i < opt.params.length; i++) {
                _validate2.default.validate("drawPlugin.addDoc opt.params[" + i + "]", opt.params[i], {
                    url: {
                        type: 'string',
                        isRequire: true
                    },
                    width: {
                        type: 'number',
                        isRequire: true
                    },
                    height: {
                        type: 'number',
                        isRequire: true
                    }
                });
            }
            if (opt.params.length === 0) {
                throw new Error('addDoc参数中params的数组长度必须大于0');
            }
            var docName = opt.docName,
                params = opt.params;

            var count = (0, _keys2.default)(this.room.boards).filter(function (name) {
                return name.startsWith(docName);
            }).length;
            if (count === 0) {
                this.addBoard(docName, params.length);
            } else {
                this.addBoard(docName + '-' + count, params.length);
            }
            for (var _i = 0; _i < params.length; _i++) {
                this.setPageBackground({
                    url: params[_i].url,
                    width: params[_i].width,
                    height: params[_i].height,
                    pageIndex: _i
                });
            }
        }
    }, {
        key: "setTool",
        value: function setTool(toolName) {
            this.emit("op:" + toolName + ":activate");
        }
    }, {
        key: "setFontsize",
        value: function setFontsize(fontsize) {
            this.emit('op:text:fontsize', fontsize);
        }
    }, {
        key: "setFontFamily",
        value: function setFontFamily(opt) {
            if (true) {
                console.log('白板-->', 'drawPlugin.setFontFamily', (0, _stringify2.default)(opt));
            }
            if (!opt.fontFace && !opt.fontFamily) {
                return console.error('白板--> drawPlugin.setFontFamily必须提供fontFamily或者fontFace');
            }
            if (opt.fontFace && Array.isArray(opt.fontFace) && opt.fontFace.length === 0) {
                return console.error('白板--> setFontFamily。你设置了fontFace为数组, 但是数组长度为0');
            }
            if (opt.fontFamily && true) {
                console.log("\u767D\u677F--> \u8BBE\u7F6E\u5B57\u4F53\u4E3A: " + opt.fontFamily + ", \u60A8\u63D0\u4F9B\u7684\u5B57\u4F53\u5E94\u8BE5\u5728\u5404\u4E2A\u8BBE\u5907\u4E2D\u5747\u53EF\u7528\u3002\u5982\u679C\u67D0\u4E9B\u8BBE\u5907\u4E2D\u5B57\u4F53\u4E0D\u53EF\u7528\uFF0C\u8BF7\u540C\u65F6\u8BBE\u7F6Eopt.fontFace\uFF0C\u4F5C\u4E3A\u5B57\u4F53\u7684\u4E0B\u8F7D\u5730\u5740");
            }
            if (opt.fontFace && true) {
                console.log("\u4F60\u8BBE\u7F6E\u4E86fontFace, \u8BF7\u4FDD\u8BC1\u8BE5URL\u80FD\u88AB\u60A8\u7528\u6237\u7684\u8BBE\u5907\u8BBF\u95EE, \u53EF\u4EE5\u901A\u8FC7\u5728web\u7AEF\u68C0\u67E5\u6D4F\u89C8\u5668\u7684Network->font\u68C0\u6D4B\u5B57\u4F53\u662F\u5426\u88AB\u4E0B\u8F7D");
            }
            if (opt.fontFamily) {
                _textConfig2.default.setFontFamily(opt.fontFamily);
            }
            if (opt.fontFace && Array.isArray(opt.fontFace)) {
                _textConfig2.default.setFontFace(opt.fontFace);
            } else if (opt.fontFace) {
                _textConfig2.default.setFontFace([opt.fontFace]);
            }
            /**
             * 更新已实例化的textArea，pre元素的fontfamily
             */
            this.opsManager.opMap['text'].updateFontFamily();
        }
    }, {
        key: "setColor",
        value: function setColor(color) {
            if (true) {
                console.log('白板-->', 'drawPlugin.setColor', color);
            }
            _drawConfig2.default.setStrokeColor(color);
            this.emit('event:appState:change', 'renderColor', color);
        }
    }, {
        key: "setShapeFill",
        value: function setShapeFill() {
            console.error('setShapeFill已弃用。如果你需要设置图形填充，可以直接设置tool为rect-fill, 或者ellipse-fill');
        }
    }, {
        key: "setStrokeWidth",
        value: function setStrokeWidth(width) {
            if (true) {
                console.log('白板-->', 'drawPlugin.setStrokeWidth', width);
            }
            _drawConfig2.default.setStrokeWidth(width);
            this.emit('event:appState:change', 'renderWidth', width);
        }
    }, {
        key: "setOpacity",
        value: function setOpacity(opacity) {
            if (true) {
                console.log('白板-->', 'drawPlugin.setOpacity', opacity);
            }
            if (opacity > 1 || opacity < 0) {
                return console.error('drawPlugin.setOpacity的透明度必须大于0，小于等于1');
            }
            _drawConfig2.default.setOpacity(opacity);
            this.emit('event:appState:change', 'opacity', opacity);
        }
    }, {
        key: "setShowCursor",
        value: function setShowCursor(value) {
            if (true) {
                console.log('白板-->', 'drawPlugin.setShowCursor', value);
            }
            this.showCursor = value;
        }
    }, {
        key: "enableDraw",
        value: function enableDraw(editEnabled) {
            if (true) {
                console.log('白板-->', 'drawPlugin.enableDraw', editEnabled);
            }
            _validate2.default.validate('drawPlugin.enableDraw', { editEnabled: editEnabled }, {
                editEnabled: {
                    type: 'boolean',
                    isRequire: true
                }
            });
            if (this.editEnabled === editEnabled) {
                return;
            }
            /**
             * 不可编辑时，鼠标样式需要还原
             */
            if (!editEnabled) {
                document.body.style.cursor = 'auto';
            }
            this.editEnabled = editEnabled;
            this.opsManager.hooks.enableDrawChange.call(editEnabled);
            this.emit('event:editable:change', this.editable);
        }
    }, {
        key: "enableCameraTransform",
        value: function enableCameraTransform() {
            var enable = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (true) {
                console.log('白板-->', 'drawPlugin.enableCameraTransform', enable);
            }
            this.setAppConfig({
                cameraTransformEnabled: enable
            });
        }
    }, {
        key: "resetCamera",
        value: function resetCamera() {
            var animate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (true) {
                console.log('白板-->', 'drawPlugin.resetCamera');
            }
            if (this.vision.mode === 'follower') {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
            } else {
                this.emit('op:reset-camera:exec', animate);
            }
        }
    }, {
        key: "setCameraBound",
        value: function setCameraBound(boundary) {
            var animate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            if (true) {
                console.log('白板-->', 'drawPlugin.setCameraBound boundary: ', boundary, 'animate: ', animate);
            }
            var valid = _validate2.default.validate('drawPlugin.setCameraBound', boundary, {
                centerX: {
                    type: 'number',
                    isRequire: true
                },
                centerY: {
                    type: 'number',
                    isRequire: true
                },
                width: {
                    type: 'number',
                    isRequire: true
                },
                height: {
                    type: 'number',
                    isRequire: true
                }
            });
            if (valid) {
                this.emit('op:camera-bound:send', boundary, animate);
            }
        }
    }, {
        key: "fitToContent",
        value: function fitToContent() {
            var animate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (true) {
                console.log('白板-->', 'drawPlugin.fitToContent');
            }
            if (this.vision.mode === 'follower') {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
            } else {
                this.emit('op:fit-to-content:exec', animate);
            }
        }
    }, {
        key: "fitToDoc",
        value: function fitToDoc() {
            var animate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (true) {
                console.log('白板-->', 'drawPlugin.fitToDoc');
            }
            if (this.vision.mode === 'follower') {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
            } else {
                this.emit('op:fit-to-doc:exec', animate);
            }
        }
    }, {
        key: "zoomIn",
        value: function zoomIn() {
            if (true) {
                console.log('白板-->', 'drawPlugin.zoomIn');
            }
            if (this.vision.mode === 'follower') {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
            } else {
                this.emit('op:zoom:in');
            }
        }
    }, {
        key: "zoomOut",
        value: function zoomOut() {
            if (true) {
                console.log('白板-->', 'drawPlugin.zoomOut');
            }
            if (this.vision.mode === 'follower') {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
            } else {
                this.emit('op:zoom:out');
            }
        }
    }, {
        key: "zoomTo",
        value: function zoomTo(scale) {
            var animate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            if (true) {
                console.log('白板-->', 'drawPlugin.zoomTo: ', scale, ' animate: ', animate);
            }
            if (this.vision.mode === 'follower') {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
            } else {
                this.emit('op:zoom:to', scale, animate);
            }
        }
    }, {
        key: "undo",
        value: function undo() {
            if (true) {
                console.log('白板-->', 'drawPlugin.undo');
            }
            this.emit('op:undo:exec');
        }
    }, {
        key: "redo",
        value: function redo() {
            if (true) {
                console.log('白板-->', 'drawPlugin.redo');
            }
            this.emit('op:redo:exec');
        }
    }, {
        key: "clear",
        value: function clear() {
            if (true) {
                console.log('白板-->', 'drawPlugin.clear');
            }
            this.emit('op:clear:exec');
        }
    }, {
        key: "duplicate",
        value: function duplicate() {
            if (true) {
                console.log('白板-->', 'drawPlugin.duplicate');
            }
            this.emit('op:duplicate:exec');
        }
        /**
         * 删除白板中选中的元素
         */

    }, {
        key: "deleteSelectedElements",
        value: function deleteSelectedElements() {
            if (true) {
                console.log('白板-->', 'drawPlugin.deleteSelectedElements');
            }
            this.emit('op:delete:exec');
        }
    }, {
        key: "addPage",
        value: function addPage(opt) {
            if ( true && (typeof opt === "undefined" ? "undefined" : (0, _typeof3.default)(opt)) === 'object') {
                console.log('白板-->', 'drawPlugin.addPage', (0, _stringify2.default)(opt));
            } else if (true) {
                console.log('白板-->', 'drawPlugin.addPage, insertAfter', opt);
            }
            if (typeof opt === 'number') {
                opt = {
                    insertAfter: opt
                };
            } else if (!opt) {
                opt = {};
            }
            this.emit('op:page:add', opt);
        }
    }, {
        key: "deletePage",
        value: function deletePage(index) {
            var board = this.room.currBoard;
            var builtInIndex = board.getPageBuiltInIndex(index);
            if (true) {
                console.log('白板-->', 'drawPlugin.deletePage: ', index, 'builtInIndex', builtInIndex);
            }
            this.emit('op:page:delete', builtInIndex);
        }
    }, {
        key: "gotoPage",
        value: function gotoPage(index) {
            var board = this.room.currBoard;
            var builtInIndex = board.getPageBuiltInIndex(index);
            if (true) {
                console.log('白板-->', 'drawPlugin.gotoPage: ', index, 'buildInIndex', builtInIndex);
            }
            if (isNaN(builtInIndex)) {
                console.error("\u767D\u677F--> \u7B2C" + (index + 1) + "\u4E0D\u5B58\u5728\uFF0C\u5F53\u524D\u6587\u6863\u5185\u7684\u9875\u9762\u603B\u6570\u4E3A: " + this.room.currBoard.pageNames.length);
            } else {
                this.emit('op:page:goto', builtInIndex);
            }
        }
    }, {
        key: "gotoFirstPage",
        value: function gotoFirstPage() {
            if (true) {
                console.log('白板-->', 'drawPlugin.gotoFirstPage');
            }
            var board = this.room.currBoard;
            var currPageIndex = board.getCurrPageIndex();
            if (currPageIndex > 0) {
                this.gotoPage(0);
            }
        }
    }, {
        key: "gotoPrevPage",
        value: function gotoPrevPage() {
            if (true) {
                console.log('白板-->', 'drawPlugin.gotoPrevPage');
            }
            var board = this.room.currBoard;
            var currPageIndex = board.getCurrPageIndex();
            if (currPageIndex > 0) {
                this.gotoPage(currPageIndex - 1);
            }
        }
    }, {
        key: "gotoNextPage",
        value: function gotoNextPage() {
            if (true) {
                console.log('白板-->', 'drawPlugin.gotoNextPage');
            }
            var board = this.room.currBoard;
            var currPageIndex = board.getCurrPageIndex();
            if (currPageIndex < board.pageNames.length - 1) {
                this.gotoPage(currPageIndex + 1);
            }
        }
    }, {
        key: "gotoLastPage",
        value: function gotoLastPage() {
            if (true) {
                console.log('白板-->', 'drawPlugin.gotoLastPage');
            }
            var board = this.room.currBoard;
            var currPageIndex = board.getCurrPageIndex();
            if (currPageIndex < board.pageNames.length - 1) {
                this.gotoPage(board.pageNames.length - 1);
            }
        }
    }, {
        key: "gotoBoard",
        value: function gotoBoard(boardName) {
            _validate2.default.validate('drawPlugin.gotoBoard', { boardName: boardName }, {
                boardName: {
                    type: 'string',
                    isRequire: true
                }
            });
            if (true) {
                console.log('白板-->', 'drawPlugin.gotoBoard:', boardName);
            }
            this.emit('op:board:goto', boardName);
        }
    }, {
        key: "addBoard",
        value: function addBoard(boardName, pageCount) {
            _validate2.default.validate('drawPlugin.addBoard', { boardName: boardName }, {
                boardName: {
                    type: 'string',
                    isRequire: true
                }
            });
            if (true) {
                console.log('白板-->', 'drawPlugin.addBoard, boardName:', boardName, ' pageCount:', pageCount);
            }
            this.emit('op:board:add', boardName, pageCount);
        }
    }, {
        key: "deleteBoard",
        value: function deleteBoard(boardName) {
            _validate2.default.validate('drawPlugin.deleteBoard', { boardName: boardName }, {
                boardName: {
                    type: 'string',
                    isRequire: true
                }
            });
            if (true) {
                console.log('白板-->', 'drawPlugin.deleteBoard: ', boardName);
            }
            this.emit('op:board:delete', boardName);
        }
    }, {
        key: "getPageInfos",
        value: function getPageInfos() {
            return {
                pageNames: this.opsManager.currBoard.pageNames.slice(),
                currPage: this.opsManager.currBoard.currIndex,
                activeIndex: this.opsManager.currBoard.getCurrPageIndex(),
                pagePayloads: this.opsManager.currBoard.payloadOfPages
            };
        }
    }, {
        key: "getBoardInfos",
        value: function getBoardInfos() {
            return {
                boardNames: (0, _keys2.default)(this.room.boards),
                currBoard: this.room.currIndex,
                currBoardDisplayName: this.room.currBoard.displayName,
                boardDisplayNames: this.room.getBoardDisplayNames()
            };
        }
    }, {
        key: "bindPreviewContainer",
        value: function bindPreviewContainer(opts) {
            var _a;
            (_a = this.previewFactory) === null || _a === void 0 ? void 0 : _a.bindPreviewContainer(opts);
        }
        /**
         * 开发者调用app.emit向内部模块发送事件
         * @param rest
         */

    }, {
        key: "emit",
        value: function emit(events) {
            var _dispatcher;

            for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                args[_key - 1] = arguments[_key];
            }

            (_dispatcher = this.dispatcher).emit.apply(_dispatcher, [events].concat(args));
        }
        /**
         * 开发者调用app.on监听内部模块派发的事件
         */

    }, {
        key: "on",
        value: function on(event, fn) {
            this.dispatcher.on(event, fn);
        }
        /**
         * 开发者调用app.on监听内部模块派发的事件
         */

    }, {
        key: "off",
        value: function off(event, fn) {
            this.dispatcher.off(event, fn);
        }
    }, {
        key: "getOpDoc",
        value: function getOpDoc(type) {
            return this.opsManager.getOpDoc(type);
        }
    }, {
        key: "getCurrTool",
        value: function getCurrTool() {
            var _a;
            return (_a = this.opsManager.currOp) === null || _a === void 0 ? void 0 : _a.type;
        }
        /**
         * 销毁各类事件监听，否则可能会造成内存泄漏
         */

    }, {
        key: "destroy",
        value: function destroy() {
            if (true) {
                console.log('白板-->', 'drawPlugin.destroy');
            }
            this.dispatcher.destroy();
            this.container.destroy();
            document.body.style.cursor = 'auto';
        }
    }, {
        key: "addRecordData",
        value: function addRecordData(records) {
            var _a;
            (_a = this.player) === null || _a === void 0 ? void 0 : _a.addRecordData(records);
        }
    }, {
        key: "seekTo",
        value: function seekTo(time) {
            var _a;
            (_a = this.player) === null || _a === void 0 ? void 0 : _a.seekTo(time);
        }
        /**
         * 录像回放时，切换观看者的视角
         * @param viewer
         */

    }, {
        key: "setViewer",
        value: function setViewer(viewer) {
            var _a;
            (_a = this.player) === null || _a === void 0 ? void 0 : _a.setViewer(viewer);
        }
    }, {
        key: "setSelfAsBroadcaster",
        value: function setSelfAsBroadcaster() {
            if (true) {
                console.log('白板-->', 'drawPlugin.setSelfAsBroadcaster');
            }
            this.vision.setSelfAsBroadcaster();
        }
        /**
         * 停止设置自己为广播者
         */

    }, {
        key: "unsetSelfAsBroadcaster",
        value: function unsetSelfAsBroadcaster() {
            if (true) {
                console.log('白板-->', 'drawPlugin.unsetSelfAsBroadcaster');
            }
            this.vision.unsetSelfAsBroadcaster();
        }
        /**
         * 设置当前用户为跟随者，只有房间状态存在broadcaster时才可用
         * 设置的目的是为了回放时接收到此数据，然后正确的还原用户当时的视角
         */

    }, {
        key: "setSelfAsFollower",
        value: function setSelfAsFollower() {
            if (true) {
                console.log('白板-->', 'drawPlugin.setSelfAsFollower');
            }
            this.vision.setSelfAsFollower();
        }
        /**
         * 设置自己为自由视角。通过setSelfAsFollower可以重新设置为跟随者
         */

    }, {
        key: "setSelfAsFreeObserver",
        value: function setSelfAsFreeObserver() {
            if (true) {
                console.log('白板-->', 'drawPlugin.setSelfAsFreeObserver');
            }
            this.vision.setSelfAsFreeObserver();
        }
    }, {
        key: "exportAsImage",
        value: function exportAsImage() {
            if (true) {
                console.log('白板-->', 'drawPlugin.exportAsImage');
            }
            //导出图片
            var data = this.previewFactory.generatePreviewToDataUrl({
                pageIndex: this.room.currBoard.currIndex.toString(),
                boardName: this.room.currIndex,
                state: 'ready'
            });
            var a = document.createElement("a"); //Create <a>
            a.href = data;
            var boardName = this.room.currBoard.boardName === 'whiteboard' ? '白板' : this.room.currBoard.boardName;
            var pageName = this.room.currBoard.currPage.pageIndex;
            var pageIndex = this.room.currBoard.pageNames.indexOf(pageName);
            a.download = boardName + "-" + (pageIndex + 1) + ".png"; //File name Here
            a.click(); //Downloaded file
        }
        /**
         * 从白板服务器得到userList，并通过事件传递给外部。
         * 外部可以根据此事件做出响应
         */

    }, {
        key: "setMemberList",
        value: function setMemberList(userList) {
            this.emit('event:member:change', userList.slice());
        }
    }, {
        key: "ifDeviceSupportOrientation",
        get: function get() {
            return _types.TouchPlatformArray.includes(this.platform.toLowerCase());
        }
        /**
         * 当编辑权限开启，且不处于同步时，才能够编辑
         */

    }, {
        key: "editable",
        get: function get() {
            return this.editEnabled && !this.dataHub.isSynchronizing && this.isConnected;
        }
    }, {
        key: "appConfig",
        get: function get() {
            return this.configInstance.getAppConfig();
        }
    }]);
    return App;
}();

var DrawPlugin = {
    getInstance: function getInstance(opt) {
        if (true) {
            console.log('白板-->', 'DrawPlugin.getInstance arguments:', opt);
        }
        _validate2.default.validate('DrawPlugin.instance', opt, {
            account: {
                type: 'string',
                isRequire: true
            },
            nickname: {
                type: 'string',
                isRequire: false
            },
            container: {
                type: 'dom',
                isRequire: true
            },
            platform: {
                type: 'string',
                isRequire: true,
                enum: _types.PlatformArray
            },
            connector: {
                type: 'object',
                isRequire: true
            },
            nim: {
                type: 'object',
                isRequire: true
            }
        });
        var app = new App(opt);
        return app;
    }
};
exports.App = App;
exports.default = DrawPlugin;

/***/ }),

/***/ "./new_src/core/media/util.ts":
/*!************************************!*\
  !*** ./new_src/core/media/util.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.popupImageChooserAndAddImage = exports.uploadAndAddImage = undefined;

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _toast = __webpack_require__(/*! ../../component/toast */ "./new_src/component/toast/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var drawPlugin = void 0;
var imageDimension = {};
var AcceptTypesArr = ['jpg', 'jpeg', 'png', 'bmp', 'webp'];
var imageInput = document.createElement('input');
window.onload = function () {
    document.body.appendChild(imageInput);
    imageInput.style.position = 'absolute';
    imageInput.style.visibility = 'hidden';
    imageInput.type = 'file';
    imageInput.accept = 'image/*';
    imageInput.onchange = function (ev) {
        if (!drawPlugin) {
            return console.error('白板--> uploadAndAddImage必须先设置drawPlugin');
        }
        var fileInput = ev.target;
        var file = ev.target.files[0];
        if (file && file.size && file.size > 10 * 1024 * 1024) {
            return (0, _toast.showToast)({
                msg: '图片大小不能超过10M',
                type: 'error'
            });
        }
        var nameParts = file.name.split('.');
        var suffix = nameParts[nameParts.length - 1];
        var isValidType = AcceptTypesArr.includes(suffix.toLowerCase());
        if (!isValidType) {
            return (0, _toast.showToast)({
                msg: '\u5F53\u524D\u4EC5\u652F\u6301' + AcceptTypesArr.join(',') + '\u683C\u5F0F\u6587\u4EF6',
                time: 3,
                type: 'error'
            });
        }
        uploadAndAddImage(drawPlugin, { fileInput: fileInput }, imageDimension);
    };
};
/**
 * 先将base64图片上传到nos中，然后添加到白板中
 * @param app
 * @param base64Url
 */
var uploadAndAddImage = exports.uploadAndAddImage = function uploadAndAddImage(app, opt, dimensions) {
    if (!opt.dataURL && !opt.fileInput) {
        return console.error('白板--> uploadAndAddImage dataURL和fileInput至少提供一个');
    }
    var nim = app.nim;
    nim.previewFile((0, _assign2.default)((0, _assign2.default)({}, opt), {
        beginupload: function beginupload(data) {
            // - 如果开发者传入 fileInput, 在此回调之前不能修改 fileInput
            // - 在此回调之后可以取消图片上传, 此回调会接收一个参数 `upload`, 调用 `upload.abort()` 来取消文件上传
            // 重置input的value为null，否则重新选择相同的文件不会触发onChange
            // 在这里修改fileInput的感觉很不好。previewFile这个函数不应该依赖于fileInput的
            if (opt.fileInput) {
                opt.fileInput.value = '';
            }
        },
        done: function done(err, res) {
            (0, _toast.hideToast)();
            if (err) {
                console.error('图片上传失败', err);
                (0, _toast.showToast)({
                    msg: '上传失败',
                    type: 'error',
                    time: 3
                });
            } else {
                app.addImage({
                    url: res.url,
                    width: dimensions.width,
                    height: dimensions.height
                });
            }
        } }));
    (0, _toast.showToast)({
        msg: '上传图片中...',
        time: 100000,
        type: 'info'
    });
};
var popupImageChooserAndAddImage = exports.popupImageChooserAndAddImage = function popupImageChooserAndAddImage(app, dimensions) {
    drawPlugin = app;
    imageDimension = dimensions;
    imageInput.click();
};

/***/ }),

/***/ "./new_src/core/misc/dispatcher.ts":
/*!*****************************************!*\
  !*** ./new_src/core/misc/dispatcher.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Dispatcher = function (_EventEmitter) {
    (0, _inherits3.default)(Dispatcher, _EventEmitter);

    function Dispatcher() {
        (0, _classCallCheck3.default)(this, Dispatcher);
        return (0, _possibleConstructorReturn3.default)(this, (Dispatcher.__proto__ || (0, _getPrototypeOf2.default)(Dispatcher)).apply(this, arguments));
    }

    (0, _createClass3.default)(Dispatcher, [{
        key: 'subMany',
        value: function subMany(eventDict) {
            for (var key in eventDict) {
                this.on(key, eventDict[key]);
            }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            var _this2 = this;

            this.eventNames().forEach(function (name) {
                _this2.removeAllListeners(name);
            });
        }
    }]);
    return Dispatcher;
}(_eventemitter2.default);

exports.default = Dispatcher;

/***/ }),

/***/ "./new_src/core/misc/dom-events.ts":
/*!*****************************************!*\
  !*** ./new_src/core/misc/dom-events.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.on = on;
exports.off = off;
/**
 * 解决注册事件时兼容性问题
 * @param el
 * @param name
 * @param cb
 */
function on(el, name, cb) {
    el.addEventListener(name, cb);
}
function off(el, name, cb) {
    el.removeEventListener(name, cb);
}

/***/ }),

/***/ "./new_src/core/misc/drawCurve.ts":
/*!****************************************!*\
  !*** ./new_src/core/misc/drawCurve.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.drawCurve = undefined;

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var drawCurve = exports.drawCurve = function drawCurve(ctx, points) {
    var k = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0.3;

    if (k > 0.5 || k <= 0) {
        console.error('k should be between 0 and 0.5');
    }
    ctx.beginPath();
    if (points.length <= 2) {
        if (points.length === 2) {
            ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)(points[0]));
            ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)(points[1]));
        }
    } else {
        ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)(points[0]));
        var lastP = points[0];
        var currP = points[1];
        // let segPoint1: Point = [k * lastP[0] + (1-k) * currP[0], k * lastP[1] + (1-k) * currP[1]]
        var ctrlPtInLastSeg = [k * lastP[0] + (1 - k) * currP[0], k * lastP[1] + (1 - k) * currP[1]];
        if (Math.abs(k - 0.5) > 0.01) {
            ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)(ctrlPtInLastSeg));
        }
        lastP = currP;
        for (var i = 2; i < points.length; i++) {
            currP = points[i];
            var ctrlPtInSeg1 = [(1 - k) * lastP[0] + k * currP[0], (1 - k) * lastP[1] + k * currP[1]];
            var ctrlPtInSeg2 = [k * lastP[0] + (1 - k) * currP[0], k * lastP[1] + (1 - k) * currP[1]];
            ctx.quadraticCurveTo.apply(ctx, (0, _toConsumableArray3.default)(lastP).concat(ctrlPtInSeg1));
            ctx.lineTo.apply(ctx, ctrlPtInSeg2);
            ctrlPtInLastSeg = ctrlPtInSeg2;
            lastP = currP;
        }
        ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)(points[points.length - 1]));
    }
};

/***/ }),

/***/ "./new_src/core/misc/shapeHelper.ts":
/*!******************************************!*\
  !*** ./new_src/core/misc/shapeHelper.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getLineFromPointsY = exports.getVerticalLineY = exports.getXFromCoefAndOffset = exports.getLineCoef = exports.getArrowPoints = undefined;
exports.distSqrt = distSqrt;
exports.dist = dist;
exports.rectCollide = rectCollide;
exports.pointCollideWithPoint = pointCollideWithPoint;
exports.pointCollideWithLine = pointCollideWithLine;
exports.pointInRect = pointInRect;
exports.getTransformedBoundary = getTransformedBoundary;
exports.getTransformedPoint = getTransformedPoint;
exports.combineBoundary = combineBoundary;
exports.getBoundaryBoxFromTwoPoints = getBoundaryBoxFromTwoPoints;

var _util = __webpack_require__(/*! ./util */ "./new_src/core/misc/util.ts");

/**
 * 两点之间距离的平方
 */
function distSqrt(p1, p2) {
    return (p1[0] - p2[0]) * (p1[0] - p2[0]) + (p1[1] - p2[1]) * (p1[1] - p2[1]);
} /**
   * 图像检测帮助函数
   */
function dist(p1, p2) {
    return Math.sqrt(distSqrt(p1, p2));
}
/**
 * 检测两个矩形是否有重叠区域
 * @param rect1
 * @param rect2
 */
function rectCollide(rect1, rect2) {
    return !(rect1.sx > rect2.sx + rect2.w || rect1.sx + rect1.w < rect2.sx || rect1.sy > rect2.sy + rect2.h || rect1.sy + rect1.h < rect2.sy);
}
/**
 * 判断点与点之间是否碰撞。若点之间的距离小于r，则无碰撞
 */
function pointCollideWithPoint(point, another, r) {
    return distSqrt(point, another) <= r * r;
}
/**
 * 判断点是否和直线相交
 * r为点的半径
 *
 * distance(A, C) + distance(B, C) == distance(A, B)
 */
function pointCollideWithLine(point, sp, ep, r) {
    return dist(point, sp) + dist(point, ep) - dist(sp, ep) <= r;
}
function pointInRect(rect, point) {
    return point[0] > rect.sx && point[0] < rect.sx + rect.w && point[1] > rect.sy && point[1] < rect.sy + rect.h;
}
/**
 * 先根据scaleX，scaleY缩放，然后在根据dx，dy平移
 * @param rect
 * @param dx
 * @param dy
 * @param scale
 */
function getTransformedBoundary(rect) {
    var dx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var dy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var scaleX = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {
        factor: 1,
        coordinate: 0
    };
    var scaleY = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {
        factor: 1,
        coordinate: 0
    };

    var sx = scaleX.factor * (rect.sx - scaleX.coordinate) + scaleX.coordinate;
    var sy = scaleY.factor * (rect.sy - scaleY.coordinate) + scaleY.coordinate;
    sx = sx + (dx ? dx : 0);
    sy = sy + (dy ? dy : 0);
    var w = rect.w * scaleX.factor;
    var h = rect.h * scaleY.factor;
    if (w < 0) {
        sx = sx + w;
        w = -w;
    }
    if (h < 0) {
        sy = sy + h;
        h = -h;
    }
    return {
        sx: sx, sy: sy, w: w, h: h
    };
}
function getTransformedPoint(point) {
    var dx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var dy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var scaleX = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {
        factor: 1,
        coordinate: 0
    };
    var scaleY = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {
        factor: 1,
        coordinate: 0
    };

    var x = scaleX.factor * (point[0] - scaleX.coordinate) + scaleX.coordinate;
    var y = scaleY.factor * (point[1] - scaleY.coordinate) + scaleY.coordinate;
    x = x + (dx ? dx : 0);
    y = y + (dy ? dy : 0);
    return [x, y];
}
function combineBoundary(b1, b2) {
    var sx = (0, _util.min)(b1.sx, b2.sx, b1.sx + b1.w, b2.sx + b2.w);
    var sy = (0, _util.min)(b1.sy, b2.sy, b1.sy + b1.h, b2.sy + b2.h);
    var ex = (0, _util.max)(b1.sx, b2.sx, b1.sx + b1.w, b2.sx + b2.w);
    var ey = (0, _util.max)(b1.sy, b2.sy, b1.sy + b1.h, b2.sy + b2.h);
    return {
        sx: sx,
        sy: sy,
        w: ex - sx,
        h: ey - sy
    };
}
function getBoundaryBoxFromTwoPoints(sp, ep) {
    var sx = (0, _util.min)(sp[0], ep[0]);
    var ex = (0, _util.max)(sp[0], ep[0]);
    var sy = (0, _util.min)(sp[1], ep[1]);
    var ey = (0, _util.max)(sp[1], ep[1]);
    return {
        sx: sx,
        sy: sy,
        w: ex - sx,
        h: ey - sy
    };
}
var ARROW_TIP_X_OFFSET = 5;
var ARROW_WINGS_X_OFFSET = 2;
var getArrowPoints = exports.getArrowPoints = function getArrowPoints(size, lastTwoPoints) {
    var tipXOffset = ARROW_TIP_X_OFFSET * size,
        wingsXOffset = ARROW_WINGS_X_OFFSET * size,
        lineCoef = getLineCoef(lastTwoPoints);
    var arrowTipX = lastTwoPoints[1][0] - lastTwoPoints[0][0] > 0 ? getXFromCoefAndOffset(lastTwoPoints[1], lineCoef, tipXOffset) : 2 * lastTwoPoints[1][0] - getXFromCoefAndOffset(lastTwoPoints[1], lineCoef, tipXOffset);
    var arrowTipY = lastTwoPoints[1][0] - lastTwoPoints[0][0] === 0 ? lastTwoPoints[1][1] + (lastTwoPoints[1][1] - lastTwoPoints[0][1] > 0 ? tipXOffset : -tipXOffset) : getLineFromPointsY(lastTwoPoints, arrowTipX);
    var arrowWing1X = getXFromCoefAndOffset(lastTwoPoints[1], -1 / lineCoef, wingsXOffset);
    var arrowWing1Y = lastTwoPoints[1][1] - lastTwoPoints[0][1] === 0 ? lastTwoPoints[1][1] - wingsXOffset : getVerticalLineY(lastTwoPoints[1], lineCoef, arrowWing1X);
    var arrowWing2X = 2 * lastTwoPoints[1][0] - getXFromCoefAndOffset(lastTwoPoints[1], -1 / lineCoef, wingsXOffset);
    var arrowWing2Y = lastTwoPoints[1][1] - lastTwoPoints[0][1] === 0 ? lastTwoPoints[1][1] + wingsXOffset : getVerticalLineY(lastTwoPoints[1], lineCoef, arrowWing2X);
    return [[arrowTipX, arrowTipY], [arrowWing1X, arrowWing1Y], [arrowWing2X, arrowWing2Y]];
};
var getLineCoef = exports.getLineCoef = function getLineCoef(points) {
    return (points[1][1] - points[0][1]) / (points[1][0] - points[0][0]) || 0;
};
var getXFromCoefAndOffset = exports.getXFromCoefAndOffset = function getXFromCoefAndOffset(refPoint, k, z) {
    return Math.sqrt(Math.pow(z, 2) / (Math.pow(k, 2) + 1)) + refPoint[0];
};
var getVerticalLineY = exports.getVerticalLineY = function getVerticalLineY(referencePoint, coef, x) {
    return (referencePoint[0] - x) / coef + referencePoint[1];
};
var getLineFromPointsY = exports.getLineFromPointsY = function getLineFromPointsY(points, x) {
    return Math.max(-1000000, (points[1][1] - points[0][1]) / (points[1][0] - points[0][0]) || 0) * (x - points[0][0]) + points[0][1];
};

/***/ }),

/***/ "./new_src/core/misc/text.ts":
/*!***********************************!*\
  !*** ./new_src/core/misc/text.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.MIN_FONT_SIZE = exports.MAX_FONT_SIZE = exports.printTextInMultiLine = undefined;

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

exports.testFontSizeText = testFontSizeText;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 检测工具栏中的字体大小是否有效
 * @param text
 */
function testFontSizeText(text) {
    var num = Number(text);
    if (isNaN(num)) {
        return 'nan';
    } else if (num > MAX_FONT_SIZE) {
        return 'exceed_max';
    } else if (num <= MIN_FONT_SIZE) {
        return 'exceed_min';
    } else {
        return 'valid';
    }
}
var printTextInMultiLine = exports.printTextInMultiLine = function printTextInMultiLine(context, text, x, y, lineHeight) {
    var textArr = text.split(/\r?\n/g);
    var currentLine = 0;
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = (0, _getIterator3.default)(textArr), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var str = _step.value;

            context.fillText(str, x, y + lineHeight * currentLine);
            currentLine++;
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }
};
var MAX_FONT_SIZE = exports.MAX_FONT_SIZE = 999;
var MIN_FONT_SIZE = exports.MIN_FONT_SIZE = 12;

/***/ }),

/***/ "./new_src/core/misc/util.ts":
/*!***********************************!*\
  !*** ./new_src/core/misc/util.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.min = min;
exports.max = max;
function min() {
    for (var _len = arguments.length, numbers = Array(_len), _key = 0; _key < _len; _key++) {
        numbers[_key] = arguments[_key];
    }

    return numbers.reduce(function (n1, n2) {
        return Math.min(n1, n2);
    });
}
function max() {
    for (var _len2 = arguments.length, numbers = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        numbers[_key2] = arguments[_key2];
    }

    return numbers.reduce(function (n1, n2) {
        return Math.max(n1, n2);
    });
}

/***/ }),

/***/ "./new_src/core/ops/BoardOp/index.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/BoardOp/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var BoardOp = function (_Operation) {
    (0, _inherits3.default)(BoardOp, _Operation);

    function BoardOp() {
        (0, _classCallCheck3.default)(this, BoardOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (BoardOp.__proto__ || (0, _getPrototypeOf2.default)(BoardOp)).apply(this, arguments));

        _this.type = 'board';
        _this.description = "board相关操作";
        return _this;
    }

    (0, _createClass3.default)(BoardOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.boardChange.tap("boardChangePlugin", this.onBoardChange.bind(this));
        }
    }, {
        key: "onBoardChange",
        value: function onBoardChange() {
            return this.emit('event:appState:change', 'board', {
                boardNames: (0, _keys2.default)(this.app.room.boards),
                boardDisplayNames: this.app.room.getBoardDisplayNames(),
                currBoard: this.app.room.currIndex,
                currBoardDisplayName: this.app.room.currBoard.displayName
            });
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'board:goto': {
                    value: this.goto.bind(this),
                    information: {
                        args: 'boardName: string',
                        message: "\u8DF3\u8F6C\u81F3board\u3002\u82E5board\u4E0D\u5B58\u5728\uFF0C\u5219\u521B\u5EFAboard"
                    }
                },
                'board:add': {
                    value: this.add.bind(this),
                    information: {
                        args: 'boardName: string, pageCount: number',
                        message: "\u521B\u5EFA[pageCount]\u9875\u6570\u7684board"
                    }
                },
                'board:delete': {
                    value: this.delete.bind(this),
                    information: {
                        args: 'boardName: string',
                        message: '删除board。只有当board数量大于1时可以删除board'
                    }
                }
            };
        }
    }, {
        key: "goto",
        value: function goto(boardName) {
            //跳转至board。若board不存在，则创建board
            if (boardName !== this.app.room.currIndex) {
                this.dispatch({
                    type: this.type,
                    action: 'goto',
                    boardName: boardName
                });
            }
        }
    }, {
        key: "add",
        value: function add(displayName, pageCount) {
            var boardName = displayName + "_" + new Date().valueOf();
            this.dispatch({
                type: this.type,
                action: 'add',
                boardName: boardName,
                displayName: displayName,
                pageCount: pageCount
            });
        }
    }, {
        key: "delete",
        value: function _delete(boardName) {
            var boards = this.app.room.boards;
            if (boardName in boards && (0, _keys2.default)(boards).length > 1) {
                this.dispatch({
                    type: this.type,
                    action: 'delete',
                    boardName: boardName
                });
            }
        }
    }]);
    return BoardOp;
}(_Operation3.default); /**
                         * board操作，一个board可以对应于一个文档。
                         */


exports.default = BoardOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/CameraBoundOp.ts":
/*!****************************************************!*\
  !*** ./new_src/core/ops/CameraOp/CameraBoundOp.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.convertToCameraBoundSnapshot = undefined;

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var convertToCameraBoundSnapshot = exports.convertToCameraBoundSnapshot = function convertToCameraBoundSnapshot(camera, snapshotData) {
    var boundary = camera.getNextCameraBound(snapshotData);
    /**
     * boundary的大小要被限制
     */
    var MAX_ALLOWED_WIDTH = 100000;
    if (boundary.width > MAX_ALLOWED_WIDTH || boundary.height > MAX_ALLOWED_WIDTH) {
        if (boundary.width > boundary.height) {
            boundary.height = boundary.height * MAX_ALLOWED_WIDTH / boundary.width;
            boundary.width = MAX_ALLOWED_WIDTH;
        } else {
            boundary.width = boundary.width * MAX_ALLOWED_WIDTH / boundary.height;
            boundary.height = MAX_ALLOWED_WIDTH;
        }
    }
    /**
     * 防止width，height崩溃
     */
    if (boundary.width === 0 || boundary.height === 0) {
        boundary.width = 1000;
        boundary.height = 1000;
    }
    if (true) {
        console.log('\u767D\u677F--> convert camera bound op: ' + (0, _stringify2.default)(snapshotData) + ' -> ' + (0, _stringify2.default)(boundary));
    }
    return {
        type: 'camera-bound',
        boundary: boundary,
        skipUndo: true,
        animate: snapshotData.animate,
        reuseOpType: 'camera-bound'
    };
};

var CameraBoundOp = function (_Operation) {
    (0, _inherits3.default)(CameraBoundOp, _Operation);

    function CameraBoundOp() {
        (0, _classCallCheck3.default)(this, CameraBoundOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CameraBoundOp.__proto__ || (0, _getPrototypeOf2.default)(CameraBoundOp)).apply(this, arguments));

        _this.type = 'camera-bound';
        _this.description = "视角位置";
        return _this;
    }

    (0, _createClass3.default)(CameraBoundOp, [{
        key: 'eventsToListen',
        value: function eventsToListen() {
            return {
                'camera-bound:send': {
                    value: this.sendCameraBound.bind(this),
                    information: {
                        args: 'boundary: {centerX: number, centerY: number, width: number, width: number}, animate: boolean',
                        message: '\u53D1\u9001\u5F53\u524D\u7528\u6237\u7684camera-bound\uFF0C\u5E38\u7528\u4E8E\u4E3B\u64AD\u540C\u6B65\u81EA\u5DF1\u7684camera-bound'
                    }
                }
            };
        }
    }, {
        key: 'sendCameraBound',
        value: function sendCameraBound(boundary, animate) {
            this.dispatch({
                type: 'camera-bound',
                boundary: boundary,
                skipUndo: true,
                animate: animate,
                reuseOpType: 'camera-bound'
            });
        }
    }]);
    return CameraBoundOp;
}(_Operation3.default);

exports.default = CameraBoundOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/FitToContent.ts":
/*!***************************************************!*\
  !*** ./new_src/core/ops/CameraOp/FitToContent.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _CameraBoundOp = __webpack_require__(/*! ./CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/CameraOp/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var FitToContentOp = function (_Operation) {
    (0, _inherits3.default)(FitToContentOp, _Operation);

    function FitToContentOp() {
        (0, _classCallCheck3.default)(this, FitToContentOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (FitToContentOp.__proto__ || (0, _getPrototypeOf2.default)(FitToContentOp)).apply(this, arguments));

        _this.type = 'fit-to-content';
        _this.description = "缩放至完全包含内容";
        return _this;
    }

    (0, _createClass3.default)(FitToContentOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u6267\u884C" + this.type + "\u4E8B\u4EF6"
                    }
                }
            };
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            var animate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (!(0, _util.shouldDispatch)(this.app)) return;
            return this.dispatch(this.getSnapshot(animate));
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(animate) {
            return (0, _CameraBoundOp.convertToCameraBoundSnapshot)(this.app.camera, {
                type: 'fit-to-content',
                animate: animate
            });
        }
    }]);
    return FitToContentOp;
}(_Operation3.default); /**
                         * 平移操作
                         */


exports.default = FitToContentOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/FitToDoc.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/CameraOp/FitToDoc.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _CameraBoundOp = __webpack_require__(/*! ./CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/CameraOp/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var FitToDocOp = function (_Operation) {
    (0, _inherits3.default)(FitToDocOp, _Operation);

    function FitToDocOp() {
        (0, _classCallCheck3.default)(this, FitToDocOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (FitToDocOp.__proto__ || (0, _getPrototypeOf2.default)(FitToDocOp)).apply(this, arguments));

        _this.type = 'fit-to-doc';
        _this.description = "缩放至完全包含文档";
        return _this;
    }

    (0, _createClass3.default)(FitToDocOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u6267\u884C" + this.type + "\u4E8B\u4EF6"
                    }
                }
            };
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            var animate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (!(0, _util.shouldDispatch)(this.app)) return;
            if (!this.app.room.currBoard.currPage.backgroundSnapshot) return;
            return this.dispatch(this.getSnapshot(animate));
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(animate) {
            return (0, _CameraBoundOp.convertToCameraBoundSnapshot)(this.app.camera, {
                type: 'fit-to-doc',
                animate: animate
            });
        }
    }]);
    return FitToDocOp;
}(_Operation3.default); /**
                         * 平移操作
                         */


exports.default = FitToDocOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/PanOp.ts":
/*!********************************************!*\
  !*** ./new_src/core/ops/CameraOp/PanOp.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _CameraBoundOp = __webpack_require__(/*! ./CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/CameraOp/util.ts");

var _toast = __webpack_require__(/*! ../../../component/toast */ "./new_src/component/toast/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 平移操作
 */
var PanOp = function (_Operation) {
    (0, _inherits3.default)(PanOp, _Operation);

    function PanOp() {
        (0, _classCallCheck3.default)(this, PanOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PanOp.__proto__ || (0, _getPrototypeOf2.default)(PanOp)).apply(this, arguments));

        _this.type = 'pan';
        _this.activate = false;
        _this.description = "平移操作";
        return _this;
    }

    (0, _createClass3.default)(PanOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event, mx, my, clientX, clientY) {
            if (!this.app.enableCameraTransform) {
                return;
            }
            if (!(0, _util.shouldDispatch)(this.app)) return;
            if (this.activate) {
                document.body.style.cursor = 'grabbing';
            } else if (this.app.container.isTargetOnContainer(event.target)) {
                document.body.style.cursor = 'grab';
            } else {
                document.body.style.cursor = 'auto';
            }
            if (this.activate && this.lastPoint) {
                this.dispatch(this.getSnapshot(clientX - this.lastPoint[0], clientY - this.lastPoint[1]));
                this.lastPoint = [clientX, clientY];
            }
        }
    }, {
        key: "handleMouseDown",
        value: function handleMouseDown(event, mx, my, clientX, clientY) {
            if (!this.app.appConfig.cameraTransformEnabled) {
                return;
            }
            if (!(0, _util.shouldDispatch)(this.app)) {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
                return;
            }
            this.activate = true;
            this.beginBatch();
            this.lastPoint = [clientX, clientY];
        }
    }, {
        key: "handleMouseUp",
        value: function handleMouseUp(event, mx, my, clientX, clientY) {
            if (!this.app.appConfig.cameraTransformEnabled) {
                return;
            }
            if (!(0, _util.shouldDispatch)(this.app)) return;
            if (this.activate && this.lastPoint) {
                this.dispatch(this.getSnapshot(clientX - this.lastPoint[0], clientY - this.lastPoint[1]));
                this.lastPoint = undefined;
            }
            this.activate = false;
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(dx, dy) {
            return (0, _CameraBoundOp.convertToCameraBoundSnapshot)(this.app.camera, {
                type: 'pan',
                dx: -dx,
                dy: -dy,
                animate: false
            });
        }
    }]);
    return PanOp;
}(_Operation3.default);

exports.default = PanOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/ResetCameraOp.ts":
/*!****************************************************!*\
  !*** ./new_src/core/ops/CameraOp/ResetCameraOp.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _CameraBoundOp = __webpack_require__(/*! ./CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/CameraOp/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ResetCameraOp = function (_Operation) {
    (0, _inherits3.default)(ResetCameraOp, _Operation);

    function ResetCameraOp() {
        (0, _classCallCheck3.default)(this, ResetCameraOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ResetCameraOp.__proto__ || (0, _getPrototypeOf2.default)(ResetCameraOp)).apply(this, arguments));

        _this.type = 'reset-camera';
        _this.description = "重置视角";
        return _this;
    }

    (0, _createClass3.default)(ResetCameraOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u6267\u884C" + this.type + "\u4E8B\u4EF6"
                    }
                }
            };
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            var animate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            if (!(0, _util.shouldDispatch)(this.app)) return;
            return this.dispatch(this.getSnapshot(animate));
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(animate) {
            return (0, _CameraBoundOp.convertToCameraBoundSnapshot)(this.app.camera, {
                type: 'reset-camera',
                animate: animate
            });
        }
    }]);
    return ResetCameraOp;
}(_Operation3.default); /**
                         * 平移操作
                         */


exports.default = ResetCameraOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/ResizeOp.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/CameraOp/ResizeOp.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _CameraBoundOp = __webpack_require__(/*! ./CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 平移操作
 */
var ResizeCameraOp = function (_Operation) {
    (0, _inherits3.default)(ResizeCameraOp, _Operation);

    function ResizeCameraOp() {
        (0, _classCallCheck3.default)(this, ResizeCameraOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ResizeCameraOp.__proto__ || (0, _getPrototypeOf2.default)(ResizeCameraOp)).apply(this, arguments));

        _this.type = 'resize-camera';
        _this.description = "重置视角";
        return _this;
    }

    (0, _createClass3.default)(ResizeCameraOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.resize.tap("ResizePlugin", this.handleResize.bind(this));
        }
    }, {
        key: "handleResize",
        value: function handleResize(event, width, height) {
            if (width === 0 || height === 0) {
                return;
            }
            if (this.app.vision.mode === 'follower') {
                /**
                 * 如果是跟随者，则用现在的camera-bound重新计算一遍自己的位置
                 */
                this.app.camera.updateTransParamAndRefresh();
            } else {
                this.dispatch(this.getSnapshot(width, height));
            }
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(width, height) {
            return (0, _CameraBoundOp.convertToCameraBoundSnapshot)(this.app.camera, {
                type: 'resize-camera',
                width: width,
                height: height,
                animate: false
            });
        }
    }]);
    return ResizeCameraOp;
}(_Operation3.default);

exports.default = ResizeCameraOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/ZoomOp.ts":
/*!*********************************************!*\
  !*** ./new_src/core/ops/CameraOp/ZoomOp.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _CameraBoundOp = __webpack_require__(/*! ./CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/CameraOp/util.ts");

var _toast = __webpack_require__(/*! ../../../component/toast */ "./new_src/component/toast/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 平移操作
 */
var FACTOR = 1 / 0.86;
var UPPER_BOUND = 20;
var LOWER_BOUND = 0.03;

var ZoomOp = function (_Operation) {
    (0, _inherits3.default)(ZoomOp, _Operation);

    function ZoomOp() {
        (0, _classCallCheck3.default)(this, ZoomOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ZoomOp.__proto__ || (0, _getPrototypeOf2.default)(ZoomOp)).apply(this, arguments));

        _this.type = 'zoom';
        _this.sp = [0, 0];
        _this.description = "缩放操作";
        return _this;
    }

    (0, _createClass3.default)(ZoomOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.mousewheel.tap("MousewheelPlugin", this.handleMouseWheel.bind(this));
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'zoom:in': {
                    value: this.zoomIn.bind(this),
                    information: {
                        args: '',
                        message: "\u7F29\u653E"
                    }
                },
                'zoom:out': {
                    value: this.zoomOut.bind(this),
                    information: {
                        args: '',
                        message: "\u7F29\u653E"
                    }
                },
                'zoom:to': {
                    value: this.zoomTo.bind(this),
                    information: {
                        args: 'scale: number, animate: boolean',
                        message: "\u7F29\u653E"
                    }
                }
            };
        }
    }, {
        key: "handleMouseWheel",
        value: function handleMouseWheel(event, mx, my, clientX, clientY) {
            if (!this.app.appConfig.cameraTransformEnabled) {
                return;
            }
            if (!(0, _util.shouldDispatch)(this.app)) {
                (0, _toast.showToast)({
                    msg: '你当前处于视角跟随状态',
                    type: 'info'
                });
                return;
            }
            var scale = void 0;
            if (event.deltaY > 0) {
                scale = FACTOR;
            } else {
                scale = 1 / FACTOR;
            }
            if (this.app.camera.zoomFactor * scale >= UPPER_BOUND && scale > 1) {
                return;
            } else if (this.app.camera.zoomFactor * scale <= LOWER_BOUND && scale < 1) {
                return;
            }
            if (this.isMouseDown) {
                return;
            }
            if (!this.app.container.isTargetOnContainer(event.target)) {
                return;
            }
            this.beginBatch();
            this.dispatch(this.getSnapshot(scale, false, [clientX, clientY]));
        }
    }, {
        key: "zoomIn",
        value: function zoomIn() {
            if (!(0, _util.shouldDispatch)(this.app)) return;
            if (this.app.camera.zoomFactor * FACTOR >= UPPER_BOUND) {
                return;
            }
            this.beginBatch();
            return this.dispatch(this.getSnapshot(FACTOR, false));
        }
    }, {
        key: "zoomOut",
        value: function zoomOut() {
            if (!(0, _util.shouldDispatch)(this.app)) return;
            if (this.app.camera.zoomFactor / FACTOR <= LOWER_BOUND) {
                return;
            }
            this.beginBatch();
            return this.dispatch(this.getSnapshot(1 / FACTOR, false));
        }
    }, {
        key: "zoomTo",
        value: function zoomTo(destScaleNum, animate) {
            if (!(0, _util.shouldDispatch)(this.app)) return;
            this.beginBatch();
            return this.dispatch(this.getSnapshot(destScaleNum / this.app.camera.zoomFactor, animate));
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(scale, animate, center) {
            return (0, _CameraBoundOp.convertToCameraBoundSnapshot)(this.app.camera, {
                type: 'zoom',
                animate: animate,
                center: center,
                scale: scale
            });
        }
    }]);
    return ZoomOp;
}(_Operation3.default);

exports.default = ZoomOp;

/***/ }),

/***/ "./new_src/core/ops/CameraOp/util.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/CameraOp/util.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var shouldDispatch = exports.shouldDispatch = function shouldDispatch(app) {
    var mode = app.vision.mode;
    if (mode === 'broadcaster' || mode === 'freeObserver') {
        return true;
    } else {
        return false;
    }
};

/***/ }),

/***/ "./new_src/core/ops/ClearOp/index.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/ClearOp/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ClearOp = function (_Operation) {
    (0, _inherits3.default)(ClearOp, _Operation);

    function ClearOp() {
        (0, _classCallCheck3.default)(this, ClearOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ClearOp.__proto__ || (0, _getPrototypeOf2.default)(ClearOp)).apply(this, arguments));

        _this.type = 'clear';
        _this.description = "清空操作";
        return _this;
    }

    (0, _createClass3.default)(ClearOp, [{
        key: "isAvailable",
        value: function isAvailable() {
            return (0, _keys2.default)(this.drawOpsOfPage).length > 0;
        }
    }, {
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.refresh.tap("RefreshPlugin", this.onRefresh.bind(this));
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u6267\u884C" + this.type + "\u4E8B\u4EF6"
                    }
                }
            };
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            if ((0, _keys2.default)(this.drawOpsOfPage).length > 0) {
                this.dispatch(this.getSnapshot());
            }
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot() {
            return {
                type: this.type
            };
        }
    }, {
        key: "onRefresh",
        value: function onRefresh() {
            var available = (0, _keys2.default)(this.drawOpsOfPage).length > 0;
            this.emit('event:appState:change', 'clearAvailable', available);
        }
    }]);
    return ClearOp;
}(_Operation3.default); /**
                         * 重做操作。重做只能跟在撤销操作后面
                         */


exports.default = ClearOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/EllipseFillOp.ts":
/*!**************************************************!*\
  !*** ./new_src/core/ops/DrawOp/EllipseFillOp.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _EllipseOp2 = __webpack_require__(/*! ./EllipseOp */ "./new_src/core/ops/DrawOp/EllipseOp.ts");

var _EllipseOp3 = _interopRequireDefault(_EllipseOp2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var EllipseFillOp = function (_EllipseOp) {
    (0, _inherits3.default)(EllipseFillOp, _EllipseOp);

    function EllipseFillOp() {
        (0, _classCallCheck3.default)(this, EllipseFillOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (EllipseFillOp.__proto__ || (0, _getPrototypeOf2.default)(EllipseFillOp)).apply(this, arguments));

        _this.type = 'ellipse-fill';
        return _this;
    }
    /**
     * 这个是新版本的动作。由于需要和老版本互通，因此将type设置为rect，老版本没有rect-fill op，如果type为rect-fill, 则老版本无法理解如何绘制该图形
     */


    (0, _createClass3.default)(EllipseFillOp, [{
        key: 'getSnapshot',
        value: function getSnapshot(inProgress) {
            return this.getTwoPointShapeCommonProperty({
                strokeOrFill: 'fill',
                inProgress: inProgress
            });
        }
    }]);
    return EllipseFillOp;
}(_EllipseOp3.default);

exports.default = EllipseFillOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/EllipseOp.ts":
/*!**********************************************!*\
  !*** ./new_src/core/ops/DrawOp/EllipseOp.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _MouseMoveDrawOp2 = __webpack_require__(/*! ./MouseMoveDrawOp */ "./new_src/core/ops/DrawOp/MouseMoveDrawOp.ts");

var _MouseMoveDrawOp3 = _interopRequireDefault(_MouseMoveDrawOp2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var EllipseOp = function (_MouseMoveDrawOp) {
    (0, _inherits3.default)(EllipseOp, _MouseMoveDrawOp);

    function EllipseOp() {
        (0, _classCallCheck3.default)(this, EllipseOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (EllipseOp.__proto__ || (0, _getPrototypeOf2.default)(EllipseOp)).apply(this, arguments));

        _this.type = 'ellipse';
        _this.shouldSaniteEp = true;
        _this.description = "绘制椭圆形";
        return _this;
    }

    (0, _createClass3.default)(EllipseOp, [{
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            return this.getTwoPointShapeCommonProperty({
                strokeOrFill: 'stroke',
                inProgress: inProgress
            });
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            var data = snapshot.data;
            var sp = (0, _shapeHelper.getTransformedPoint)(data.sp, data.dx, data.dy, data.scaleX, data.scaleY);
            var ep = (0, _shapeHelper.getTransformedPoint)(data.ep, data.dx, data.dy, data.scaleX, data.scaleY);
            var cx = sp[0] / 2 + ep[0] / 2;
            var cy = sp[1] / 2 + ep[1] / 2;
            var radiusX = Math.abs(ep[0] - sp[0]) / 2;
            var radiusY = Math.abs(ep[1] - sp[1]) / 2;
            ctx.beginPath();
            ctx.ellipse(cx, cy, radiusX, radiusY, 0, 0, Math.PI * 2, true);
            this.strokeOrFill(ctx, {
                stroke: data.stroke,
                fill: data.fill,
                lineWidth: data.lineWidth,
                opacity: data.opacity
            });
        }
    }, {
        key: "ifMouseOnOp",
        value: function ifMouseOnOp(baseOp, mx, my) {
            var ctx = this.app.container.ctx;
            var data = baseOp.data;
            var sp = (0, _shapeHelper.getTransformedPoint)(data.sp, data.dx, data.dy, data.scaleX, data.scaleY);
            var ep = (0, _shapeHelper.getTransformedPoint)(data.ep, data.dx, data.dy, data.scaleX, data.scaleY);
            var cx = sp[0] / 2 + ep[0] / 2;
            var cy = sp[1] / 2 + ep[1] / 2;
            var radiusX = Math.abs(ep[0] - sp[0]) / 2;
            var radiusY = Math.abs(ep[1] - sp[1]) / 2;
            ctx.beginPath();
            ctx.ellipse(cx, cy, radiusX, radiusY, 0, 0, Math.PI * 2, true);
            ctx.fillStyle = 'rgba(0,0,0,0)';
            ctx.fill();
            return ctx.isPointInPath(mx, my);
        }
    }]);
    return EllipseOp;
}(_MouseMoveDrawOp3.default);

exports.default = EllipseOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/LineArrowOp.ts":
/*!************************************************!*\
  !*** ./new_src/core/ops/DrawOp/LineArrowOp.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _LineOp2 = __webpack_require__(/*! ./LineOp */ "./new_src/core/ops/DrawOp/LineOp.ts");

var _LineOp3 = _interopRequireDefault(_LineOp2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var LineArrowOp = function (_LineOp) {
    (0, _inherits3.default)(LineArrowOp, _LineOp);

    function LineArrowOp() {
        (0, _classCallCheck3.default)(this, LineArrowOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (LineArrowOp.__proto__ || (0, _getPrototypeOf2.default)(LineArrowOp)).apply(this, arguments));

        _this.type = 'line-arrow';
        _this.description = "绘制带箭头线段。\n首先使用op:line-arrow:activate设置画布为线段模式。" + "通过op:line-arrow:lineWidth, op:line-arrow:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(LineArrowOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        event: "op:" + this.type + ":activate",
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            var withArrow = !inProgress && this.points.length > 2;
            var arrowPoints = [];
            if (this.points.length > 1 && withArrow) {
                var lastTwoPoints = [this.sp, this.ep];
                arrowPoints = (0, _shapeHelper.getArrowPoints)(this.lineWidth + 1, lastTwoPoints);
            }
            return (0, _assign2.default)({ arrowPoints: arrowPoints }, this.getTwoPointShapeCommonProperty({
                inProgress: inProgress
            }));
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            ctx.save();
            var data = snapshot.data;

            var _getStartEndPointFrom = this.getStartEndPointFromSnapshot(data),
                sp = _getStartEndPointFrom.sp,
                ep = _getStartEndPointFrom.ep;

            ctx.beginPath();
            ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(sp, data.dx, data.dy, data.scaleX, data.scaleY)));
            ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(ep, data.dx, data.dy, data.scaleX, data.scaleY)));
            ctx.strokeStyle = data.color;
            ctx.lineWidth = data.lineWidth;
            ctx.globalAlpha = data.opacity;
            ctx.stroke();
            var arrowPoints = data.arrowPoints;
            if (arrowPoints.length === 3) {
                ctx.beginPath();
                ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(arrowPoints[0], data.dx, data.dy, data.scaleX, data.scaleY)));
                ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(arrowPoints[1], data.dx, data.dy, data.scaleX, data.scaleY)));
                ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(arrowPoints[2], data.dx, data.dy, data.scaleX, data.scaleY)));
                ctx.fillStyle = data.color;
                ctx.fill();
            }
            ctx.restore();
        }
    }]);
    return LineArrowOp;
}(_LineOp3.default);

exports.default = LineArrowOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/LineOp.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/DrawOp/LineOp.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _MouseMoveDrawOp2 = __webpack_require__(/*! ./MouseMoveDrawOp */ "./new_src/core/ops/DrawOp/MouseMoveDrawOp.ts");

var _MouseMoveDrawOp3 = _interopRequireDefault(_MouseMoveDrawOp2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var LineOp = function (_MouseMoveDrawOp) {
    (0, _inherits3.default)(LineOp, _MouseMoveDrawOp);

    function LineOp() {
        (0, _classCallCheck3.default)(this, LineOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (LineOp.__proto__ || (0, _getPrototypeOf2.default)(LineOp)).apply(this, arguments));

        _this.type = 'line';
        _this.description = "绘制线段。\n首先使用op:line:activate设置画布为线段模式。" + "通过op:line:lineWidth, op:line:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(LineOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            return this.getTwoPointShapeCommonProperty({
                inProgress: inProgress
            });
        }
    }, {
        key: "getBoundaryRect",
        value: function getBoundaryRect() {
            return this.getBoundaryRectOfLine();
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            var data = snapshot.data;

            var _getStartEndPointFrom = this.getStartEndPointFromSnapshot(data),
                sp = _getStartEndPointFrom.sp,
                ep = _getStartEndPointFrom.ep;

            ctx.beginPath();
            ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(sp, data.dx, data.dy, data.scaleX, data.scaleY)));
            ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(ep, data.dx, data.dy, data.scaleX, data.scaleY)));
            this.strokeOrFill(ctx, {
                stroke: data.color,
                lineWidth: data.lineWidth,
                opacity: data.opacity
            });
        }
    }, {
        key: "ifMouseOnOp",
        value: function ifMouseOnOp(baseOp, mx, my) {
            var ctx = this.app.container.ctx;
            var data = baseOp.data;

            var _getStartEndPointFrom2 = this.getStartEndPointFromSnapshot(data),
                sp = _getStartEndPointFrom2.sp,
                ep = _getStartEndPointFrom2.ep;

            ctx.beginPath();
            ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(sp, data.dx, data.dy, data.scaleX, data.scaleY)));
            ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(ep, data.dx, data.dy, data.scaleX, data.scaleY)));
            ctx.strokeStyle = 'rgba(0,0,0,0)';
            ctx.lineWidth = data.lineWidth + 20;
            ctx.stroke();
            return ctx.isPointInStroke(mx, my);
        }
    }, {
        key: "getStartEndPointFromSnapshot",
        value: function getStartEndPointFromSnapshot(data) {
            var sp = void 0;
            var ep = void 0;
            if (Array.isArray(data.points)) {
                sp = data.points[0];
                ep = data.points[data.points.length - 1];
            } else {
                sp = data.sp;
                ep = data.ep;
            }
            return {
                sp: sp, ep: ep
            };
        }
    }]);
    return LineOp;
}(_MouseMoveDrawOp3.default);

exports.default = LineOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/MouseMoveDrawOp.ts":
/*!****************************************************!*\
  !*** ./new_src/core/ops/DrawOp/MouseMoveDrawOp.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _util = __webpack_require__(/*! ../../misc/util */ "./new_src/core/misc/util.ts");

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _drawConfig = __webpack_require__(/*! ./drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var MouseMoveDrawOp = function (_Operation) {
    (0, _inherits3.default)(MouseMoveDrawOp, _Operation);

    function MouseMoveDrawOp() {
        (0, _classCallCheck3.default)(this, MouseMoveDrawOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (MouseMoveDrawOp.__proto__ || (0, _getPrototypeOf2.default)(MouseMoveDrawOp)).apply(this, arguments));

        _this.type = '';
        /**
         * 是否需要清洗ep。使其距离sp的x，y距离至少为1。对于矩形来说，必须sanite ep，否则矩形会退化为线段或者点
         */
        _this.shouldSaniteEp = false;
        _this.movedDuringMouseDown = false;
        _this.points = [];
        /**
         * 连续动作只用采一半的点即可。用sampleSeq记录mousemove的序列号
         */
        _this.sampleSeq = 0;
        return _this;
    }

    (0, _createClass3.default)(MouseMoveDrawOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.pageChange.tap('PageChange', this.handlePageChange.bind(this));
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "handlePageChange",
        value: function handlePageChange() {
            this.beginBatch();
            this.sampleSeq = 0;
            this.points = [];
            this.movedDuringMouseDown = false;
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event, mx, my) {
            if (this.isMouseDown || this.app.container.isTargetOnContainer(event.target)) {
                document.body.style.cursor = "url(" + __webpack_require__(/*! ../../../assets/cursors/pen.svg */ "./new_src/assets/cursors/pen.svg") + ") -1 17, auto";
            } else {
                document.body.style.cursor = 'auto';
            }
            if (this.isMouseDown) {
                this.movedDuringMouseDown = true;
                mx = Number(mx.toFixed(1));
                my = Number(my.toFixed(1));
                this.points.push([mx, my]);
                this.dispatch(this.getSnapshot(true));
                this.sampleSeq += 1;
            }
        }
    }, {
        key: "handleMouseDown",
        value: function handleMouseDown(event, mx, my) {
            this.beginBatch();
            mx = Number(mx.toFixed(1));
            my = Number(my.toFixed(1));
            this.points = [[mx, my]];
            this.movedDuringMouseDown = false;
            this.sampleSeq = 0;
        }
    }, {
        key: "handleMouseUp",
        value: function handleMouseUp(event, mx, my) {
            if (this.isMouseDown && this.movedDuringMouseDown) {
                mx = Number(mx.toFixed(1));
                my = Number(my.toFixed(1));
                this.points.push([mx, my]);
                this.dispatch(this.getSnapshot(false));
                this.points = [];
            }
        }
    }, {
        key: "getTwoPointShapeCommonProperty",
        value: function getTwoPointShapeCommonProperty(opt) {
            var obj = {
                type: this.type,
                boundary: this.getBoundaryRectOfLine(),
                sp: this.sp,
                ep: this.ep,
                lineWidth: this.lineWidth,
                inProgress: opt.inProgress,
                opacity: this.opacity
            };
            if (opt.strokeOrFill === 'stroke') {
                obj.stroke = this.color;
            } else if (opt.strokeOrFill === 'fill') {
                obj.fill = this.color;
            } else {
                obj.color = this.color;
            }
            return obj;
        }
    }, {
        key: "getFreeDrawCommonProperty",
        value: function getFreeDrawCommonProperty(opt) {
            var obj = {
                type: this.type,
                boundary: this.getBoundaryRectOfFreeDraw(),
                lineWidth: this.lineWidth,
                inProgress: opt.inProgress,
                opacity: this.opacity
            };
            obj.color = this.color;
            return obj;
        }
    }, {
        key: "getBoundaryRectOfFreeDraw",
        value: function getBoundaryRectOfFreeDraw() {
            var points = this.points;
            if (points.length === 0) {
                throw new Error('涂鸦没有记录任何数据');
            } else {
                var sx = points[0][0];
                var sy = points[0][1];
                var ex = sx;
                var ey = sy;
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = (0, _getIterator3.default)(points), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var point = _step.value;

                        sx = (0, _util.min)(point[0], sx);
                        sy = (0, _util.min)(point[1], sy);
                        ex = (0, _util.max)(point[0], ex);
                        ey = (0, _util.max)(point[1], ey);
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }

                return {
                    sx: sx,
                    sy: sy,
                    w: ex - sx,
                    h: ey - sy
                };
            }
        }
    }, {
        key: "getBoundaryRectOfLine",
        value: function getBoundaryRectOfLine() {
            var sx = (0, _util.min)(this.sp[0], this.ep[0]);
            var sy = (0, _util.min)(this.sp[1], this.ep[1]);
            var ex = (0, _util.max)(this.sp[0], this.ep[0]);
            var ey = (0, _util.max)(this.sp[1], this.ep[1]);
            return {
                sx: sx,
                sy: sy,
                w: ex - sx,
                h: ey - sy
            };
        }
    }, {
        key: "strokeOrFill",
        value: function strokeOrFill(ctx, opt) {
            ctx.save();
            ctx.lineWidth = opt.lineWidth;
            if (opt.opacity) {
                ctx.globalAlpha = Number(opt.opacity);
            }
            if (opt.stroke) {
                ctx.strokeStyle = opt.stroke;
                ctx.stroke();
            } else if (opt.fill) {
                ctx.fillStyle = opt.fill;
                ctx.fill();
            }
            ctx.restore();
        }
        /**
         * 控制rect最小宽高为1
         * @param ep
         */

    }, {
        key: "sanityEp",
        value: function sanityEp(ep) {
            if (ep[0] - this.sp[0] >= 0 && ep[0] - this.sp[0] < 1) {
                ep[0] = this.sp[0] + 1;
            }
            if (ep[1] - this.sp[1] >= 0 && ep[1] - this.sp[1] < 1) {
                ep[1] = this.sp[1] + 1;
            }
            return ep;
        }
    }, {
        key: "lineWidth",
        get: function get() {
            return Number(_drawConfig2.default.strokeWidth);
        }
    }, {
        key: "opacity",
        get: function get() {
            return Number(_drawConfig2.default.opacity);
        }
    }, {
        key: "color",
        get: function get() {
            return _drawConfig2.default.strokeColor;
        }
    }, {
        key: "sp",
        get: function get() {
            return this.points[0];
        }
    }, {
        key: "ep",
        get: function get() {
            var point = this.points[this.points.length - 1];
            if (this.shouldSaniteEp) {
                point = this.sanityEp(point);
            }
            return point;
        }
    }]);
    return MouseMoveDrawOp;
}(_Operation3.default);

exports.default = MouseMoveDrawOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/PenArrowOp.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/DrawOp/PenArrowOp.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _PenOp2 = __webpack_require__(/*! ./PenOp */ "./new_src/core/ops/DrawOp/PenOp.ts");

var _PenOp3 = _interopRequireDefault(_PenOp2);

var _drawConfig = __webpack_require__(/*! ./drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var PenArrowOp = function (_PenOp) {
    (0, _inherits3.default)(PenArrowOp, _PenOp);

    function PenArrowOp() {
        (0, _classCallCheck3.default)(this, PenArrowOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PenArrowOp.__proto__ || (0, _getPrototypeOf2.default)(PenArrowOp)).apply(this, arguments));

        _this.type = 'pen-arrow';
        _this.description = "带箭头的涂鸦操作工具。\n首先使用op:pen-arrow:activate设置画布为涂鸦模式。" + "通过op:pen-arrow:lineWidth, op:pen-arrow:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(PenArrowOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        event: "op:" + this.type + ":activate",
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "getArrowPoints",
        value: function getArrowPoints(points, withArrow) {
            var arrowPoints = [];
            if (points.length > 1 && withArrow) {
                var lastTwoPoints = points.length > 2 ? [points[points.length - 3], points[points.length - 1]] : points.slice(points.length - 2),
                    lineCoef = (0, _shapeHelper.getLineCoef)(lastTwoPoints);
                // if we have last two points far apart, we want to add another point closer to the last one
                // so that the doesn't get cut by quadraticCurveTo and so that arrow is not disconnected from the line
                if ((0, _shapeHelper.dist)(lastTwoPoints[0], lastTwoPoints[1]) > 1) {
                    var lastPointX = lastTwoPoints[1][0] - lastTwoPoints[0][0] > 0 ? (0, _shapeHelper.getXFromCoefAndOffset)(lastTwoPoints[1], lineCoef, 1) : 2 * lastTwoPoints[1][0] - (0, _shapeHelper.getXFromCoefAndOffset)(lastTwoPoints[1], lineCoef, 1);
                    var lastPointY = lastTwoPoints[1][0] - lastTwoPoints[0][0] === 0 ? lastTwoPoints[1][1] + (lastTwoPoints[1][1] - lastTwoPoints[0][1] > 0 ? 1 : -1) : (0, _shapeHelper.getLineFromPointsY)(lastTwoPoints, lastPointX);
                    lastTwoPoints.push([lastPointX, lastPointY]);
                }
                arrowPoints = (0, _shapeHelper.getArrowPoints)(this.lineWidth + 1, lastTwoPoints);
            }
            return arrowPoints;
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            var points = this.points;
            var withArrow = !inProgress && points.length > 2;
            var arrowPoints = this.getArrowPoints(points, withArrow);
            var currOpId = this.opsManager.currPage.getOpId();
            var pkg = this.app.room.opIdSnapshotMap[currOpId];
            if (!pkg || !pkg.snapshot.hasOwnProperty('category')) {
                /**
                 * 保险措施，如果之前发送的opId是部分数据，则发送一份完整的数据出去
                 */
                return (0, _assign2.default)({ points: points.slice(), arrowPoints: arrowPoints, total: points.length }, this.getFreeDrawCommonProperty({
                    inProgress: inProgress
                }));
            }
            var boundaryRect = {
                boundary: this.getBoundaryRectOfFreeDraw()
            };
            if (this.sampleSeq > 0 && inProgress) {
                return (0, _assign2.default)((0, _assign2.default)({}, boundaryRect), { points: points.slice(points.length - _drawConfig2.default.pointsPerBatch), total: points.length });
            } else if (this.sampleSeq > 0) {
                return (0, _assign2.default)((0, _assign2.default)({}, boundaryRect), { points: points.slice(points.length - _drawConfig2.default.pointsPerBatch), arrowPoints: arrowPoints, inProgress: inProgress, total: points.length });
            } else {
                return (0, _assign2.default)({ points: points.slice(), arrowPoints: arrowPoints, total: points.length }, this.getFreeDrawCommonProperty({
                    inProgress: inProgress
                }));
            }
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            ctx.save();
            var data = snapshot.data;
            this._draw(snapshot, ctx);
            ctx.strokeStyle = data.color;
            ctx.lineWidth = data.lineWidth;
            ctx.globalAlpha = data.opacity;
            ctx.stroke();
            var arrowPoints = data.arrowPoints;
            if (arrowPoints.length === 3) {
                ctx.beginPath();
                ctx.moveTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(arrowPoints[0], data.dx, data.dy, data.scaleX, data.scaleY)));
                ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(arrowPoints[1], data.dx, data.dy, data.scaleX, data.scaleY)));
                ctx.lineTo.apply(ctx, (0, _toConsumableArray3.default)((0, _shapeHelper.getTransformedPoint)(arrowPoints[2], data.dx, data.dy, data.scaleX, data.scaleY)));
                ctx.fillStyle = data.color;
                ctx.fill();
            }
            ctx.restore();
        }
    }]);
    return PenArrowOp;
}(_PenOp3.default);

exports.default = PenArrowOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/PenOp.ts":
/*!******************************************!*\
  !*** ./new_src/core/ops/DrawOp/PenOp.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _MouseMoveDrawOp2 = __webpack_require__(/*! ./MouseMoveDrawOp */ "./new_src/core/ops/DrawOp/MouseMoveDrawOp.ts");

var _MouseMoveDrawOp3 = _interopRequireDefault(_MouseMoveDrawOp2);

var _drawConfig = __webpack_require__(/*! ./drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

var _drawCurve = __webpack_require__(/*! ../../misc/drawCurve */ "./new_src/core/misc/drawCurve.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var PenOp = function (_MouseMoveDrawOp) {
    (0, _inherits3.default)(PenOp, _MouseMoveDrawOp);

    function PenOp() {
        (0, _classCallCheck3.default)(this, PenOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PenOp.__proto__ || (0, _getPrototypeOf2.default)(PenOp)).apply(this, arguments));

        _this.type = 'pen';
        _this.description = "涂鸦操作工具。\n首先使用op:pen:activate设置画布为涂鸦模式。" + "通过op:pen:lineWidth, op:pen:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(PenOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            var points = this.points;
            var currOpId = this.opsManager.currPage.getOpId();
            var pkg = this.app.room.opIdSnapshotMap[currOpId];
            if (!pkg || !pkg.snapshot.hasOwnProperty('category')) {
                /**
                 * 保险措施，如果已经发送的是旧的数据，则发送一份完整的数据出去
                 */
                return (0, _assign2.default)({ points: points.slice(), total: points.length }, this.getFreeDrawCommonProperty({
                    inProgress: inProgress
                }));
            }
            var boundaryRect = {
                boundary: this.getBoundaryRectOfFreeDraw()
            };
            if (this.sampleSeq > 0 && inProgress) {
                return (0, _assign2.default)((0, _assign2.default)({}, boundaryRect), { points: points.slice(points.length - _drawConfig2.default.pointsPerBatch), total: points.length });
            } else if (this.sampleSeq > 0) {
                return (0, _assign2.default)((0, _assign2.default)({}, boundaryRect), { points: points.slice(points.length - _drawConfig2.default.pointsPerBatch), total: points.length, inProgress: inProgress });
            } else {
                return (0, _assign2.default)({ points: points.slice(), total: points.length }, this.getFreeDrawCommonProperty({
                    inProgress: inProgress
                }));
            }
        }
    }, {
        key: "_draw",
        value: function _draw(snapshot, ctx) {
            var data = snapshot.data;
            var points = data.points;
            var transformedPoints = points.map(function (p) {
                return (0, _shapeHelper.getTransformedPoint)(p, data.dx, data.dy, data.scaleX, data.scaleY);
            });
            (0, _drawCurve.drawCurve)(ctx, transformedPoints, 0.5);
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            var data = snapshot.data;
            this._draw(snapshot, ctx);
            this.strokeOrFill(ctx, {
                stroke: data.color,
                lineWidth: data.lineWidth,
                opacity: data.opacity
            });
        }
    }, {
        key: "ifMouseOnOp",
        value: function ifMouseOnOp(snapshot, mx, my) {
            var ctx = this.app.container.ctx;
            this._draw(snapshot, ctx);
            //稍微增大一些选择线段的宽度范围，否则线段很细时，判定可能过于灵敏
            ctx.lineWidth = snapshot.data.lineWidth + 20;
            ctx.strokeStyle = 'rgba(0,0,0,0)';
            ctx.stroke();
            return ctx.isPointInStroke(mx, my);
        }
    }, {
        key: "mergePartial",
        value: function mergePartial(snapshot, partial) {
            var sp = this._mergePartial(snapshot, partial);
            if (sp.data.points.length !== sp.data.total) {
                console.warn('merge ........', snapshot, partial);
            }
            return sp;
        }
    }, {
        key: "_mergePartial",
        value: function _mergePartial(snapshot, partial) {
            try {
                var ptrDiff = partial.data.total - snapshot.data.total;
                if (ptrDiff === 0) {
                    return (0, _assign2.default)((0, _assign2.default)({}, snapshot), { data: (0, _assign2.default)((0, _assign2.default)((0, _assign2.default)({}, snapshot.data), partial.data), { points: snapshot.data.points }) });
                } else if (ptrDiff < 0) {
                    return snapshot;
                } else if (ptrDiff <= partial.data.points.length) {
                    var startIndex = partial.data.points.length - ptrDiff;
                    return (0, _assign2.default)((0, _assign2.default)({}, snapshot), { data: (0, _assign2.default)((0, _assign2.default)((0, _assign2.default)({}, snapshot.data), partial.data), { points: snapshot.data.points.concat(partial.data.points.slice(startIndex)) }) });
                } else {
                    if (true) {
                        console.warn('白板--> mergePartial error', snapshot, partial);
                    }
                    return snapshot;
                }
            } catch (_a) {
                if (true) {
                    console.warn('白板--> mergePartial error', snapshot, partial);
                }
                return snapshot;
            }
        }
    }]);
    return PenOp;
}(_MouseMoveDrawOp3.default);

exports.default = PenOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/RectFillOp.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/DrawOp/RectFillOp.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _RectOp2 = __webpack_require__(/*! ./RectOp */ "./new_src/core/ops/DrawOp/RectOp.ts");

var _RectOp3 = _interopRequireDefault(_RectOp2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var RectFillOp = function (_RectOp) {
    (0, _inherits3.default)(RectFillOp, _RectOp);

    function RectFillOp() {
        (0, _classCallCheck3.default)(this, RectFillOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RectFillOp.__proto__ || (0, _getPrototypeOf2.default)(RectFillOp)).apply(this, arguments));

        _this.type = 'rect-fill';
        return _this;
    }
    /**
     * 这个是新版本的动作。由于需要和老版本互通，因此将type设置为rect，老版本没有rect-fill op，如果type为rect-fill, 则老版本无法理解如何绘制该图形
     */


    (0, _createClass3.default)(RectFillOp, [{
        key: 'getSnapshot',
        value: function getSnapshot(inProgress) {
            return this.getTwoPointShapeCommonProperty({
                strokeOrFill: 'fill',
                inProgress: inProgress
            });
        }
    }]);
    return RectFillOp;
}(_RectOp3.default);

exports.default = RectFillOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/RectOp.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/DrawOp/RectOp.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _MouseMoveDrawOp2 = __webpack_require__(/*! ./MouseMoveDrawOp */ "./new_src/core/ops/DrawOp/MouseMoveDrawOp.ts");

var _MouseMoveDrawOp3 = _interopRequireDefault(_MouseMoveDrawOp2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var RectOp = function (_MouseMoveDrawOp) {
    (0, _inherits3.default)(RectOp, _MouseMoveDrawOp);

    function RectOp() {
        (0, _classCallCheck3.default)(this, RectOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RectOp.__proto__ || (0, _getPrototypeOf2.default)(RectOp)).apply(this, arguments));

        _this.type = 'rect';
        _this.shouldSaniteEp = true;
        _this.description = "绘制矩形。\n首先使用op:rect:activate设置画布为矩形模式。" + "通过op:rect:lineWidth, op:rect:stroke, op:rect:fill设置矩形的宽度和颜色。然后画布会监听鼠标动作，生成矩形。具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(RectOp, [{
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            return this.getTwoPointShapeCommonProperty({
                strokeOrFill: 'stroke',
                inProgress: inProgress
            });
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            var data = snapshot.data;
            var sp = (0, _shapeHelper.getTransformedPoint)(data.sp, data.dx, data.dy, data.scaleX, data.scaleY);
            var ep = (0, _shapeHelper.getTransformedPoint)(data.ep, data.dx, data.dy, data.scaleX, data.scaleY);
            ctx.beginPath();
            ctx.rect(sp[0], sp[1], ep[0] - sp[0], ep[1] - sp[1]);
            this.strokeOrFill(ctx, {
                stroke: data.stroke,
                fill: data.fill,
                lineWidth: data.lineWidth,
                opacity: data.opacity
            });
        }
    }]);
    return RectOp;
}(_MouseMoveDrawOp3.default);

exports.default = RectOp;

/***/ }),

/***/ "./new_src/core/ops/DrawOp/drawConfig.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/DrawOp/drawConfig.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DrawConfig = function () {
    function DrawConfig() {
        (0, _classCallCheck3.default)(this, DrawConfig);

        this.strokeColor = 'rgb(0,0,0)';
        /**
         * 本来是每3-5次鼠标移动发送一次动作的。
         * 后来加上了增量发送数据，以及数据延迟发送，导致3-5次鼠标移动动作会被打到一个包中发送，且没有数据重复。
         * 又因为3-5次才发送会影响本地绘制，因此，将发送频次改回1次鼠标动作发送一个包（实际会延时批量发送)
         */
        this.pointsPerBatch = 1;
        this.strokeWidth = 5;
        this.opacity = 1;
    }
    // setStrokeColor(color: Array<number>) {
    //     if (color.length < 3 || color.length > 4) {
    //         console.error('白板--> setStrokeColor的参数必须为长度为3或者4的数组, 传入的参数为', color)
    //     } else {
    //         let hasError = false
    //         for (let i = 0; i < 3; i++) {
    //             if (color[i] < 0 || color[i] > 255) {
    //                 console.error('白板--> setStrokeColor的参数数组前三位必须为0-255之间的数值, 传入的参数为', color)
    //                 hasError = true
    //             }
    //         }
    //         if (color.length === 4 && (color[3] < 0 || color[3] > 1)) {
    //             console.error('白板--> setStrokeColor的参数数组第四位必须为0-1之间的数值, 传入的参数为', color)
    //             hasError = true
    //         }
    //         if (!hasError && color.length === 3) {
    //             this.strokeColor = `rgb(${color[0]},${color[1]},${color[2]})`
    //         } else if (!hasError) {
    //             this.strokeColor = `rgb(${color[0]},${color[1]},${color[2]},${color[3]})`
    //         }
    //     }
    // }


    (0, _createClass3.default)(DrawConfig, [{
        key: 'setStrokeColor',
        value: function setStrokeColor(color) {
            this.strokeColor = color;
        }
    }, {
        key: 'setStrokeWidth',
        value: function setStrokeWidth(width) {
            this.strokeWidth = width;
        }
    }, {
        key: 'setOpacity',
        value: function setOpacity(value) {
            this.opacity = value;
        }
    }]);
    return DrawConfig;
}();

var drawConfig = new DrawConfig();
exports.default = drawConfig;

/***/ }),

/***/ "./new_src/core/ops/EditOp/DeleteOp.ts":
/*!*********************************************!*\
  !*** ./new_src/core/ops/EditOp/DeleteOp.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DeleteOp = function (_Operation) {
    (0, _inherits3.default)(DeleteOp, _Operation);

    function DeleteOp() {
        (0, _classCallCheck3.default)(this, DeleteOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DeleteOp.__proto__ || (0, _getPrototypeOf2.default)(DeleteOp)).apply(this, arguments));

        _this.type = 'delete';
        _this.description = "删除元素。";
        return _this;
    }

    (0, _createClass3.default)(DeleteOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.keydown.tap("KeydownPlugin", this.handleKeyDown.bind(this));
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u5220\u9664\u5F53\u524D\u9009\u4E2D\u7684\u5143\u7D20"
                    }
                }
            };
        }
    }, {
        key: "handleKeyDown",
        value: function handleKeyDown(ev) {
            var key = ev.key.toLocaleLowerCase();
            if (['backspace', 'delete'].includes(key)) {
                this.execCommand();
                return true;
            }
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            if (this.opsManager.selectedOpIds.length > 0) {
                this.dispatch(this.getSnapshot());
            }
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot() {
            return {
                type: this.type,
                deleteOpIds: this.opsManager.selectedOpIds.slice(),
                dependOn: this.opsManager.selectedOpIds.slice()
            };
        }
        /**
         * 转换关联的绘制类Op的快照图
         */

    }, {
        key: "transformOp",
        value: function transformOp(baseOp, _transformOp) {
            var newData = (0, _assign2.default)({}, baseOp.data, {
                hidden: true
            });
            return (0, _assign2.default)({}, baseOp, {
                data: newData
            });
        }
    }]);
    return DeleteOp;
}(_Operation3.default); /**
                         * 删除操作，可通过ctrl-v还原
                         */


exports.default = DeleteOp;

/***/ }),

/***/ "./new_src/core/ops/EditOp/DupliateOp.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/EditOp/DupliateOp.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.COPY_PASTE_SHIFT = undefined;

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _lodash = __webpack_require__(/*! lodash.clonedeep */ "./node_modules/lodash.clonedeep/index.js");

var _lodash2 = _interopRequireDefault(_lodash);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 复制操作
 */
var COPY_PASTE_SHIFT = exports.COPY_PASTE_SHIFT = 50;

var DuplicateOp = function (_Operation) {
    (0, _inherits3.default)(DuplicateOp, _Operation);

    function DuplicateOp() {
        (0, _classCallCheck3.default)(this, DuplicateOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DuplicateOp.__proto__ || (0, _getPrototypeOf2.default)(DuplicateOp)).apply(this, arguments));

        _this.type = 'duplicate';
        _this.description = "拷贝drawable快照";
        _this.copiedSnapshotArray = [];
        return _this;
    }

    (0, _createClass3.default)(DuplicateOp, [{
        key: 'registerHooks',
        value: function registerHooks() {
            this.opsManager.hooks.keydown.tap("KeydownPlugin", this.handleKeyDown.bind(this));
        }
    }, {
        key: 'eventsToListen',
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: '\u590D\u5236\u5F53\u524D\u9009\u4E2D\u7684\u5143\u7D20'
                    }
                }
            };
        }
    }, {
        key: 'handleKeyDown',
        value: function handleKeyDown(ev) {
            var _this2 = this;

            var key = ev.key.toLocaleLowerCase();
            if (key === 'c' && (this.isKeyDown('control') || this.isKeyDown('command')) && this.opsManager.selectedOpIds.length > 0) {
                ev.preventDefault();
                var selectedOpIds = this.opsManager.selectedOpIds.filter(function (opId) {
                    return _this2.drawOpsOfPage.hasOwnProperty(opId);
                });
                this.copiedSnapshotArray = (0, _lodash2.default)(selectedOpIds.map(function (opId) {
                    return _this2.drawOpsOfPage[opId];
                }));
                return true;
            } else if (key === 'v' && (this.isKeyDown('control') || this.isKeyDown('command')) && this.copiedSnapshotArray.length > 0) {
                ev.preventDefault();
                this.execCommand(this.copiedSnapshotArray.slice());
                return true;
            }
        }
    }, {
        key: 'execCommand',
        value: function execCommand(snapshotsToCopy) {
            if (this.opsManager.selectedOpIds.length > 0 || snapshotsToCopy && snapshotsToCopy.length > 0) {
                var snapshot = this.getSnapshot(snapshotsToCopy);
                this.dispatch(snapshot);
                var newOpIds = snapshot.duplicates.map(function (dup) {
                    return dup.opId;
                });
                this.opsManager.selectOp.dispatch(this.opsManager.selectOp.getSnapshot(newOpIds));
            }
        }
    }, {
        key: 'getSnapshot',
        value: function getSnapshot(snapshotsToCopy) {
            var _this3 = this;

            var snapshotFromKeyboardCopy = snapshotsToCopy ? true : false;
            if (!snapshotsToCopy) {
                var selectedOpIds = this.opsManager.selectedOpIds;
                snapshotsToCopy = [];
                for (var i = 0; i < selectedOpIds.length; i++) {
                    var id = selectedOpIds[i];
                    if (this.drawOpsOfPage.hasOwnProperty(id)) {
                        var snapshot = this.drawOpsOfPage[id];
                        snapshotsToCopy.push(snapshot);
                    }
                }
            }
            snapshotsToCopy = snapshotsToCopy.map(function (snapshot) {
                snapshot = (0, _lodash2.default)(snapshot);
                snapshot.data.dx = (snapshot.data.dx ? snapshot.data.dx : 0) + COPY_PASTE_SHIFT;
                snapshot.data.dy = (snapshot.data.dy ? snapshot.data.dy : 0) + COPY_PASTE_SHIFT;
                snapshot.opId = _this3.opsManager.currPage.getNextOpId(true);
                return snapshot;
            });
            //ctrl-c, ctrl-v后更新copiedSnapshotArray， 若不更新，连续更新会复制在相同的位置
            if (snapshotFromKeyboardCopy) {
                this.copiedSnapshotArray = snapshotsToCopy.slice();
            }
            return {
                type: this.type,
                duplicates: snapshotsToCopy
            };
        }
    }]);
    return DuplicateOp;
}(_Operation3.default);

exports.default = DuplicateOp;

/***/ }),

/***/ "./new_src/core/ops/EditOp/MoveOp.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/EditOp/MoveOp.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _util = __webpack_require__(/*! ../util */ "./new_src/core/ops/util.ts");

var _SelectOp = __webpack_require__(/*! ../SelectOp */ "./new_src/core/ops/SelectOp/index.ts");

var _SelectOp2 = _interopRequireDefault(_SelectOp);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 移动操作。
 * 移动操作必须跟在选择操作之后
 */
var MoveOp = function (_Operation) {
    (0, _inherits3.default)(MoveOp, _Operation);

    function MoveOp() {
        (0, _classCallCheck3.default)(this, MoveOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (MoveOp.__proto__ || (0, _getPrototypeOf2.default)(MoveOp)).apply(this, arguments));

        _this.type = 'move';
        _this.points = [];
        _this.activate = false;
        _this.description = "移动操作工具。内部使用，不提供对外接口";
        _this.idsBeenMoved = [];
        return _this;
    }

    (0, _createClass3.default)(MoveOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.mousedown.tap("MousedownPlugin", this.handleMouseDown.bind(this));
            this.opsManager.hooks.mousemove.tap("MousemovePlugin", this.handleMouseMove.bind(this));
            this.opsManager.hooks.mouseup.tap("MouseupPlugin", this.handleMouseUp.bind(this));
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event, mx, my) {
            if (this.opsManager.currOp instanceof _SelectOp2.default) {
                if (this.activate) {
                    this.points.push([mx, my]);
                    this.dispatch(this.getSnapshot(true, this.idsBeenMoved));
                    return true;
                }
                if (!this.isMouseDown && document.body.style.cursor !== 'nwse-resize' && document.body.style.cursor !== 'nesw-resize') {
                    if (this.mouseInSelectedEleBoundary(mx, my, this.opsManager.selectedOpIds) || this.opsManager.inProgressSelectedOpIds.length > 0) {
                        //鼠标在已选中的图形上方
                        document.body.style.cursor = 'move';
                    } else {
                        var idsUnderMouse = (0, _util.findOpsUnderMouse)([[mx, my]], this.drawOpsOfPage, this.opsManager);
                        var idsBeenSelected = (0, _util.arrayDeduce)(idsUnderMouse, this.opsManager.selectedOpIds.concat(this.opsManager.inProgressSelectedOpIds));
                        if (idsBeenSelected.length > 0) {
                            //鼠标在尚未选中的图形上方
                            document.body.style.cursor = 'move';
                        } else {
                            document.body.style.cursor = 'default';
                        }
                    }
                }
            }
        }
    }, {
        key: "handleMouseDown",
        value: function handleMouseDown(event, mx, my) {
            if (this.opsManager.currOp instanceof _SelectOp2.default) {
                var mouseInProgressSelectedBoundary = this.mouseInSelectedEleBoundary(mx, my, this.opsManager.inProgressSelectedOpIds);
                var mouseInSelectedBoundary = this.mouseInSelectedEleBoundary(mx, my, this.opsManager.selectedOpIds);
                if (mouseInProgressSelectedBoundary) {
                    /**
                     * 拖动鼠标悬浮的元素
                     */
                    var idsUnderMouse = this.opsManager.inProgressSelectedOpIds.slice();
                    this.dispatch(this.opsManager.selectOp.getSnapshot(idsUnderMouse));
                    this.beginBatch();
                    document.body.style.cursor = 'move';
                    this.idsBeenMoved = idsUnderMouse.slice();
                    this.points = [[mx, my]];
                    this.activate = true;
                    return true;
                } else if (mouseInSelectedBoundary) {
                    /**
                     * 拖动早就被选中的元素
                     */
                    this.beginBatch();
                    document.body.style.cursor = 'move';
                    this.idsBeenMoved = this.opsManager.selectedOpIds;
                    this.points = [[mx, my]];
                    this.activate = true;
                    return true;
                } else {
                    /**
                     * 适配移动端触摸屏
                     * 支持移动端直接拖动未选中的图形移动
                     */
                    var _idsUnderMouse = (0, _util.findOpsUnderMouse)([[mx, my]], this.drawOpsOfPage, this.opsManager);
                    if (_idsUnderMouse.length > 0) {
                        //将拖动的元素转为被选择状态
                        this.dispatch(this.opsManager.selectOp.getSnapshot(_idsUnderMouse));
                        this.beginBatch();
                        document.body.style.cursor = 'move';
                        this.idsBeenMoved = _idsUnderMouse.slice();
                        this.points = [[mx, my]];
                        this.activate = true;
                        return true;
                    }
                }
            }
            this.activate = false;
        }
    }, {
        key: "handleMouseUp",
        value: function handleMouseUp(event, mx, my) {
            if (this.activate) {
                this.activate = false;
                this.points.push([mx, my]);
                this.dispatch(this.getSnapshot(false, this.idsBeenMoved));
                return true;
            }
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress, idsBeenMoved) {
            return {
                type: this.type,
                sp: this.points[0],
                ep: this.points[this.points.length - 1],
                selectedOpIds: idsBeenMoved.slice(),
                dependOn: idsBeenMoved.slice(),
                inProgress: inProgress
            };
        }
        /**
         * 鼠标位置是否在已选中元素的包含盒内
         */

    }, {
        key: "mouseInSelectedEleBoundary",
        value: function mouseInSelectedEleBoundary(mx, my, selectedOpIds) {
            var _this2 = this;

            selectedOpIds = selectedOpIds.filter(function (id) {
                return _this2.drawOpsOfPage.hasOwnProperty(id);
            });
            if (selectedOpIds.length === 0) return false;
            var padding = this.opsManager.selectOp.eleContainerPadding;
            var boundary = selectedOpIds.map(function (id) {
                var op = _this2.drawOpsOfPage[id];
                return (0, _shapeHelper.getTransformedBoundary)(op.data.boundary, op.data.dx, op.data.dy, op.data.scaleX, op.data.scaleY);
            }).reduce(function (b1, b2) {
                return (0, _shapeHelper.combineBoundary)(b1, b2);
            });
            return (0, _shapeHelper.pointInRect)({
                sx: boundary.sx - padding,
                sy: boundary.sy - padding,
                w: boundary.w + padding * 2,
                h: boundary.h + padding * 2
            }, [mx, my]);
        }
        /**
         * 转换关联的绘制类Op的快照图
         */

    }, {
        key: "transformOp",
        value: function transformOp(baseOp, _transformOp) {
            var moveOpSnapshot = _transformOp.data;
            var dx = void 0;
            var dy = void 0;
            if (Array.isArray(moveOpSnapshot.points)) {
                /**
                 * 3.0.2之前
                 */
                dx = moveOpSnapshot.points[moveOpSnapshot.points.length - 1][0] - moveOpSnapshot.points[0][0];
                dy = moveOpSnapshot.points[moveOpSnapshot.points.length - 1][1] - moveOpSnapshot.points[0][1];
            } else {
                dx = moveOpSnapshot.ep[0] - moveOpSnapshot.sp[0];
                dy = moveOpSnapshot.ep[1] - moveOpSnapshot.sp[1];
            }
            var newData = (0, _assign2.default)({}, baseOp.data, {
                dx: dx + (baseOp.data.dx || 0),
                dy: dy + (baseOp.data.dy || 0),
                inProgress: moveOpSnapshot.inProgress
            });
            var res = (0, _assign2.default)({}, baseOp, {
                data: newData
            });
            return res;
        }
    }]);
    return MoveOp;
}(_Operation3.default);

exports.default = MoveOp;

/***/ }),

/***/ "./new_src/core/ops/EditOp/ScaleOp.ts":
/*!********************************************!*\
  !*** ./new_src/core/ops/EditOp/ScaleOp.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _SelectOp = __webpack_require__(/*! ../SelectOp */ "./new_src/core/ops/SelectOp/index.ts");

var _SelectOp2 = _interopRequireDefault(_SelectOp);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _types = __webpack_require__(/*! ../../types */ "./new_src/core/types.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

//鼠标落下位置和包含盒角落要在SCALE_TEST_RADIUS之内
/**
 * 缩放操作
 *
 * 同选择操作一样，缩放操作也要跟在选择操作之后
 */
var SCALE_TEST_RADIUS = 15;
var KeepRatioSnapshotTypes = ['text', 'video'];

var ScaleOp = function (_Operation) {
    (0, _inherits3.default)(ScaleOp, _Operation);

    function ScaleOp() {
        (0, _classCallCheck3.default)(this, ScaleOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ScaleOp.__proto__ || (0, _getPrototypeOf2.default)(ScaleOp)).apply(this, arguments));

        _this.type = 'scale';
        /**
         * 选择操作选中的元素集合
         */
        /**
         * 若拉伸位置是包含盒的东北角，则coordinateX和coodinateY为包含盒的西南角
         */
        _this.coordinateX = 0;
        _this.coordinateY = 0;
        _this.boundaryW = 1;
        _this.boundaryH = 1;
        _this.activate = false;
        _this.idsBeenScaled = [];
        _this.description = "缩放操作工具。内部使用，不提供对外接口";
        return _this;
    }

    (0, _createClass3.default)(ScaleOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.mousemove.tap("MouseMovePlugin", this.handleMouseMove.bind(this));
            this.opsManager.hooks.mousedown.tap("MouseMovePlugin", this.handleMouseDown.bind(this));
            this.opsManager.hooks.mouseup.tap("MouseMovePlugin", this.handleMouseUp.bind(this));
        }
    }, {
        key: "handleMouseDown",
        value: function handleMouseDown(event, mx, my) {
            if (this.opsManager.currOp instanceof _SelectOp2.default) {
                var mouseInfo = this.mousePosTest(mx, my);
                document.body.style.cursor = mouseInfo.cursorSuggestion;
                if (mouseInfo.value === true) {
                    this.beginBatch();
                    this.activate = true;
                    this.coordinateX = mouseInfo.coordinateX;
                    this.coordinateY = mouseInfo.coordinateY;
                    this.boundaryW = mouseInfo.w === 0 ? 1 : mouseInfo.w;
                    this.boundaryH = mouseInfo.h === 0 ? 1 : mouseInfo.h;
                    this.idsBeenScaled = this.opsManager.selectedOpIds.slice();
                    return true;
                }
            }
            this.activate = false;
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event, mx, my) {
            if (this.opsManager.currOp instanceof _SelectOp2.default) {
                if (this.activate) {
                    this.scaleInfo = {
                        scaleX: {
                            coordinate: this.coordinateX,
                            factor: (mx - this.coordinateX) / this.boundaryW
                        },
                        scaleY: {
                            coordinate: this.coordinateY,
                            factor: (my - this.coordinateY) / this.boundaryH
                        }
                    };
                    this.dispatch(this.getSnapshot(true, this.idsBeenScaled));
                    /**
                     * 必须return true，否则会交替产生select和scale快照
                     */
                    return true;
                } else if (this.opsManager.currOp instanceof _SelectOp2.default && !this.isMouseDown && this.opsManager.currOp.selectedOpIds.length > 0) {
                    var mouseInfo = this.mousePosTest(mx, my);
                    document.body.style.cursor = mouseInfo.cursorSuggestion;
                } else {
                    document.body.style.cursor = 'default';
                }
            }
        }
    }, {
        key: "handleMouseUp",
        value: function handleMouseUp(event, mx, my) {
            if (this.activate && this.scaleInfo) {
                this.activate = false;
                this.dispatch(this.getSnapshot(false, this.idsBeenScaled));
                this.scaleInfo = undefined;
                return true;
            }
        }
        /**
         * 判断鼠标是否在被选择的包含盒的角落上。
         */

    }, {
        key: "mousePosTest",
        value: function mousePosTest(mx, my) {
            var _this2 = this;

            var selectedOpIds = this.opsManager.selectedOpIds;
            selectedOpIds = selectedOpIds.filter(function (id) {
                return _this2.drawOpsOfPage.hasOwnProperty(id);
            });
            if (selectedOpIds.length === 0) {
                return {
                    value: false,
                    cursorSuggestion: 'default',
                    coordinateX: 0,
                    coordinateY: 0,
                    w: 1,
                    h: 1
                };
            }
            var boundary = this.opsManager.selectedOpIds.map(function (id) {
                var op = _this2.drawOpsOfPage[id];
                return (0, _shapeHelper.getTransformedBoundary)(op.data.boundary, op.data.dx, op.data.dy, op.data.scaleX, op.data.scaleY);
            }).reduce(function (b1, b2) {
                return (0, _shapeHelper.combineBoundary)(b1, b2);
            });
            var radius = SCALE_TEST_RADIUS;
            if (_types.TouchPlatformArray.includes(this.app.platform)) {
                radius = radius * 2.2;
            }
            //如果视角有缩放，要反向缩放抵消，使得缩放的热点区域固定
            radius = radius * Math.max(1 / this.app.camera.zoomFactor, 1);
            if ((0, _shapeHelper.pointCollideWithPoint)([mx, my], [boundary.sx, boundary.sy], radius)) {
                //左上角
                return {
                    value: true,
                    cursorSuggestion: 'nwse-resize',
                    coordinateX: boundary.sx + boundary.w,
                    coordinateY: boundary.sy + boundary.h,
                    w: -boundary.w,
                    h: -boundary.h
                };
            } else if ((0, _shapeHelper.pointCollideWithPoint)([mx, my], [boundary.sx + boundary.w, boundary.sy], radius)) {
                //右上角
                return {
                    value: true,
                    cursorSuggestion: 'nesw-resize',
                    coordinateX: boundary.sx,
                    coordinateY: boundary.sy + boundary.h,
                    w: boundary.w,
                    h: -boundary.h
                };
            } else if ((0, _shapeHelper.pointCollideWithPoint)([mx, my], [boundary.sx, boundary.sy + boundary.h], radius)) {
                //左下角
                return {
                    value: true,
                    cursorSuggestion: 'nesw-resize',
                    coordinateX: boundary.sx + boundary.w,
                    coordinateY: boundary.sy,
                    w: -boundary.w,
                    h: boundary.h
                };
            } else if ((0, _shapeHelper.pointCollideWithPoint)([mx, my], [boundary.sx + boundary.w, boundary.sy + boundary.h], radius)) {
                //右下角
                return {
                    value: true,
                    cursorSuggestion: 'nwse-resize',
                    coordinateX: boundary.sx,
                    coordinateY: boundary.sy,
                    w: boundary.w,
                    h: boundary.h
                };
            } else {
                return {
                    value: false,
                    cursorSuggestion: 'default',
                    coordinateX: 0,
                    coordinateY: 0,
                    w: boundary.w,
                    h: boundary.h
                };
            }
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress, idsBeenScaled) {
            return {
                type: this.type,
                inProgress: inProgress,
                scaleInfo: this.scaleInfo,
                selectedOpIds: idsBeenScaled.slice(),
                dependOn: idsBeenScaled.slice()
            };
        }
        /**
         * 获取本次缩放的参数
         * @param transformOp
         */

    }, {
        key: "getScaleParameterBySnapshot",
        value: function getScaleParameterBySnapshot(transformOp) {
            var snaps = transformOp.data;
            var factorX = 1;
            var factorY = 1;
            var dx = 0;
            var dy = 0;
            var scroll = void 0;
            if (Array.isArray(snaps.scaleList)) {
                scroll = snaps.scaleList[snaps.scaleList.length - 1];
            } else {
                scroll = snaps.scaleInfo;
            }
            //本次快照缩放值
            var thisScaleX = scroll.scaleX.factor;
            var thisScaleY = scroll.scaleY.factor;
            factorX *= thisScaleX;
            factorY *= thisScaleY;
            dx = thisScaleX * (dx - scroll.scaleX.coordinate) + scroll.scaleX.coordinate;
            dy = thisScaleY * (dy - scroll.scaleY.coordinate) + scroll.scaleY.coordinate;
            return {
                dx: dx,
                dy: dy,
                factorX: factorX,
                factorY: factorY
            };
        }
        /**
         * 将scale应用到baseOp中，计算baseOp新的dx，dy和scaleFactor
         *
         * 新的scaleFactor就是baseOp.data.scaleFactor * 当前操作的缩放乘积
         * 新的scaleFactor的左上角
         */

    }, {
        key: "transformOp",
        value: function transformOp(baseOp, _transformOp) {
            var _a, _b;
            var snaps = _transformOp.data;
            //baseOp快照缩放值
            var baseScaleX = ((_a = baseOp.data.scaleX) === null || _a === void 0 ? void 0 : _a.factor) || 1;
            var baseScaleY = ((_b = baseOp.data.scaleY) === null || _b === void 0 ? void 0 : _b.factor) || 1;
            //结合了之前和这次Op快照的总体缩放值
            var totalScaleX = baseScaleX;
            var totalScaleY = baseScaleY;
            //baseOp的boundary的左上角。计算baseOp最终左上角位置来反推dx，dy
            var initX = baseOp.data.boundary.sx;
            var initY = baseOp.data.boundary.sy;

            var _getTransformedPoint = (0, _shapeHelper.getTransformedPoint)([initX, initY], baseOp.data.dx, baseOp.data.dy, baseOp.data.scaleX, baseOp.data.scaleY),
                _getTransformedPoint2 = (0, _slicedToArray3.default)(_getTransformedPoint, 2),
                left = _getTransformedPoint2[0],
                top = _getTransformedPoint2[1];

            var scroll = void 0;
            if (Array.isArray(snaps.scaleList)) {
                scroll = snaps.scaleList[snaps.scaleList.length - 1];
            } else {
                scroll = snaps.scaleInfo;
            }
            if (!scroll) {
                return baseOp;
            }
            //本次快照缩放值
            var thisScaleX = scroll.scaleX.factor;
            var thisScaleY = scroll.scaleY.factor;
            totalScaleX *= thisScaleX;
            totalScaleY *= thisScaleY;
            if (KeepRatioSnapshotTypes.includes(baseOp.data.type)) {
                /**
                 * 如果是文字的话，宽高要同比例缩放。
                 * 比如若为3，-6，则改为4.5, -4.5
                 */
                var baseFactor = Math.abs(totalScaleX) / 2 + Math.abs(totalScaleY) / 2;
                totalScaleX *= baseFactor / Math.abs(totalScaleX);
                totalScaleY *= baseFactor / Math.abs(totalScaleY);
                thisScaleX = totalScaleX / baseScaleX;
                thisScaleY = totalScaleY / baseScaleY;
            }
            left = thisScaleX * (left - scroll.scaleX.coordinate) + scroll.scaleX.coordinate;
            top = thisScaleY * (top - scroll.scaleY.coordinate) + scroll.scaleY.coordinate;
            var dx = left - totalScaleX * initX;
            var dy = top - totalScaleY * initY;
            var newData = (0, _assign2.default)({}, baseOp.data, {
                scaleX: {
                    factor: totalScaleX,
                    coordinate: 0
                },
                scaleY: {
                    factor: totalScaleY,
                    coordinate: 0
                },
                dx: dx,
                dy: dy
            });
            var res = void 0;
            if (baseOp.data.type !== 'text') {
                res = (0, _assign2.default)({}, baseOp, {
                    data: newData
                });
            } else {
                //处理文本。
                //文本宽高缩放必须等比例。且缩放会修改文本的fontSize
                newData.fontSize = Math.abs(baseOp.data.fontSize * totalScaleX / baseScaleX);
                res = (0, _assign2.default)({}, baseOp, {
                    data: newData
                });
            }
            return res;
        }
    }]);
    return ScaleOp;
}(_Operation3.default);

exports.default = ScaleOp;

/***/ }),

/***/ "./new_src/core/ops/EraserOp/ElementEraserOp.ts":
/*!******************************************************!*\
  !*** ./new_src/core/ops/EraserOp/ElementEraserOp.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _SelectBase2 = __webpack_require__(/*! ../SelectOp/SelectBase */ "./new_src/core/ops/SelectOp/SelectBase.ts");

var _SelectBase3 = _interopRequireDefault(_SelectBase2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ElementEraserOp = function (_SelectBase) {
    (0, _inherits3.default)(ElementEraserOp, _SelectBase);

    function ElementEraserOp() {
        (0, _classCallCheck3.default)(this, ElementEraserOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ElementEraserOp.__proto__ || (0, _getPrototypeOf2.default)(ElementEraserOp)).apply(this, arguments));

        _this.type = 'element-eraser';
        _this.description = "删除元素。";
        _this.lastSelectedOpIds = [];
        return _this;
    }

    (0, _createClass3.default)(ElementEraserOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "postMouseMove",
        value: function postMouseMove(event) {
            if (this.app.container.isTargetOnContainer(event.target)) {
                document.body.style.cursor = "url(" + __webpack_require__(/*! ../../../assets/cursors/element-eraser.svg */ "./new_src/assets/cursors/element-eraser.svg") + ") -1 17, auto";
            } else {
                document.body.style.cursor = 'auto';
            }
        }
    }, {
        key: "postMouseUp",
        value: function postMouseUp(idsBeenSelected) {
            this.postClick(idsBeenSelected);
        }
    }, {
        key: "postClick",
        value: function postClick(idsBeenSelected) {
            this.dispatch(this.getSelectionSnapshot(false, []));
            if (idsBeenSelected.length > 0) {
                this.dispatch(this.getSnapshot(idsBeenSelected));
            }
            this.lastSelectedOpIds = [];
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(idsBeenSelected) {
            var deleteOpIds = idsBeenSelected.slice();
            return {
                type: 'element-eraser',
                deleteOpIds: deleteOpIds,
                dependOn: deleteOpIds
            };
        }
        /**
         * 转换关联的绘制类Op的快照图
         */

    }, {
        key: "transformOp",
        value: function transformOp(baseOp, _transformOp) {
            var newData = (0, _assign2.default)({}, baseOp.data, {
                hidden: true
            });
            return (0, _assign2.default)({}, baseOp, {
                data: newData
            });
        }
    }]);
    return ElementEraserOp;
}(_SelectBase3.default);

exports.default = ElementEraserOp;

/***/ }),

/***/ "./new_src/core/ops/EraserOp/index.ts":
/*!********************************************!*\
  !*** ./new_src/core/ops/EraserOp/index.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var EraserOp = function (_Operation) {
    (0, _inherits3.default)(EraserOp, _Operation);

    function EraserOp() {
        (0, _classCallCheck3.default)(this, EraserOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (EraserOp.__proto__ || (0, _getPrototypeOf2.default)(EraserOp)).apply(this, arguments));

        _this.type = 'eraser';
        _this.eraserColor = 'rgba(230, 100, 100, .4)';
        _this.width = 20;
        _this.points = [];
        _this.description = "橡皮擦。\n首先使用op:eraser:activate设置画布为橡皮擦模式。" + "具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(EraserOp, [{
        key: 'eventsToListen',
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        event: 'op:' + this.type + ':activate',
                        args: '',
                        message: '\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A' + this.type
                    }
                },
                'eraser:width': {
                    value: this.setWidth.bind(this),
                    information: {
                        args: 'width: number',
                        message: '\u8BBE\u7F6E\u6A61\u76AE\u64E6\u5BBD\u5EA6'
                    }
                },
                'eraser:color': {
                    value: this.setColor.bind(this),
                    information: {
                        args: 'color: Color',
                        message: '\u8BBE\u7F6E\u6A61\u76AE\u64E6\u805A\u5149\u706F\u989C\u8272'
                    }
                }
            };
        }
    }, {
        key: 'handleMouseMove',
        value: function handleMouseMove(event, mx, my) {
            if (this.isMouseDown) {
                this.points.push([mx, my]);
                this.dispatch(this.getSnapshot());
            }
        }
    }, {
        key: 'handleMouseDown',
        value: function handleMouseDown(event, mx, my) {
            this.beginBatch();
            this.points = [];
            this.points.push([mx, my]);
        }
    }, {
        key: 'handleMouseUp',
        value: function handleMouseUp(event, mx, my) {
            if (this.isMouseDown) {
                this.dispatch(this.getSnapshot());
                this.points = [];
            }
        }
    }, {
        key: 'getSnapshot',
        value: function getSnapshot() {
            return {
                type: this.type,
                points: this.points.slice(),
                width: this.width
            };
        }
    }, {
        key: 'draw',
        value: function draw(snapshot, ctx) {
            ctx.save();
            //需要将透明度设置为1。否则可能会出错。
            ctx.fillStyle = 'rgb(0, 0, 0)';
            var data = snapshot.data;
            var points = data.points;
            ctx.beginPath();
            ctx.globalCompositeOperation = 'destination-out';
            for (var i = 1; i < points.length; i++) {
                ctx.moveTo(points[i][0], points[i][1]);
                ctx.arc(points[i][0], points[i][1], this.width, 0, Math.PI * 2, true);
            }
            ctx.fill();
            ctx.restore();
            this.drawEraserSignpost(ctx);
        }
        /**
         * 绘制橡皮擦聚光灯
         */

    }, {
        key: 'drawEraserSignpost',
        value: function drawEraserSignpost(ctx) {
            if (this.opsManager.currOp instanceof EraserOp && this.isMouseDown) {
                ctx.beginPath();
                ctx.arc(this.points[this.points.length - 1][0], this.points[this.points.length - 1][1], this.width, 0, Math.PI * 2, true);
                ctx.fillStyle = this.eraserColor;
                ctx.fill();
            }
        }
    }, {
        key: 'setWidth',
        value: function setWidth(width) {
            this.width = width;
        }
    }, {
        key: 'setColor',
        value: function setColor(color) {
            this.eraserColor = color;
        }
    }]);
    return EraserOp;
}(_Operation3.default);

exports.default = EraserOp;

/***/ }),

/***/ "./new_src/core/ops/HistoryOp/RedoOp.ts":
/*!**********************************************!*\
  !*** ./new_src/core/ops/HistoryOp/RedoOp.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _types = __webpack_require__(/*! ../types */ "./new_src/core/ops/types.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 重做操作。重做只能跟在撤销操作后面
 */
var RedoOp = function (_Operation) {
    (0, _inherits3.default)(RedoOp, _Operation);

    function RedoOp() {
        (0, _classCallCheck3.default)(this, RedoOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RedoOp.__proto__ || (0, _getPrototypeOf2.default)(RedoOp)).apply(this, arguments));

        _this.type = 'redo';
        _this.description = "重做操作";
        _this.idsCouldRedo = [];
        return _this;
    }

    (0, _createClass3.default)(RedoOp, [{
        key: "getCount",
        value: function getCount() {
            return this.idsCouldRedo.length;
        }
    }, {
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin", this.onOpAdded.bind(this));
            this.opsManager.hooks.keydown.tap("KeydownPlugin", this.handleKeyDown.bind(this));
        }
    }, {
        key: "handleKeyDown",
        value: function handleKeyDown(ev) {
            var key = ev.key.toLocaleLowerCase();
            if (key === 'y' && (this.isKeyDown('control') || this.isKeyDown('command'))) {
                ev.preventDefault();
                this.execCommand();
            }
        }
    }, {
        key: "resetCount",
        value: function resetCount() {
            this.idsCouldRedo = [];
            this.emit('event:appState:change', 'redoCount', 0);
        }
    }, {
        key: "onOpAdded",
        value: function onOpAdded(snapshot) {
            if (snapshot.category === 'pageOp' || snapshot.category === 'boardOp') {
                this.idsCouldRedo = [];
            } else if (snapshot.data.inProgress || snapshot.data.skipUndo || _types.snapshotOutOfNormalFlowTypes.includes(snapshot.data.type)) {
                return;
            } else if (snapshot.data.type === 'redo') {
                var index = this.idsCouldRedo.indexOf(snapshot.data.redoOpId);
                if (index !== -1) {
                    this.idsCouldRedo.splice(index, 1);
                }
            } else if (snapshot.data.type === 'undo') {
                if (!this.idsCouldRedo.includes(snapshot.opId)) {
                    this.idsCouldRedo.push(snapshot.opId);
                }
            } else {
                this.idsCouldRedo = [];
            }
            this.emit('event:appState:change', 'redoCount', this.idsCouldRedo.length);
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u6267\u884C" + this.type + "\u4E8B\u4EF6"
                    }
                }
            };
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            if (this.idsCouldRedo.length === 0) return;
            this.dispatch(this.getSnapshot());
        }
        /**
         * 每碰到一个redo计数+1，每碰到一个undo计数-1，当计数为0，且为undo时，就是要操作的对象。
         * 比如W1 W2 W3 W4 U4 U3 U2 R2 R3 R4对应的计数为1 2 1 0，此时遇到U4，即为要操作的对象
         */

    }, {
        key: "getSnapshot",
        value: function getSnapshot() {
            var opOfPage = this.opsOfPage;
            var redoOpId = '';
            var count = 0;
            for (var i = opOfPage.length - 1; i >= 0; i--) {
                var op = opOfPage[i];
                if (op.data.type === 'undo' && count === 0) {
                    redoOpId = op.opId;
                    break;
                } else if (op.data.type === 'undo') {
                    count--;
                } else if (op.data.type === 'redo') {
                    count++;
                } else if (!op.data.skipUndo && !_types.snapshotOutOfNormalFlowTypes.includes(op.data.type)) {
                    console.warn('DEV-->', 'redo操作之前有非undo操作。请查看具体细节', opOfPage);
                }
            }
            return {
                type: this.type,
                redoOpId: redoOpId
            };
        }
    }]);
    return RedoOp;
}(_Operation3.default);

exports.default = RedoOp;

/***/ }),

/***/ "./new_src/core/ops/HistoryOp/UndoOp.ts":
/*!**********************************************!*\
  !*** ./new_src/core/ops/HistoryOp/UndoOp.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _set = __webpack_require__(/*! babel-runtime/core-js/set */ "./node_modules/babel-runtime/core-js/set.js");

var _set2 = _interopRequireDefault(_set);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _types = __webpack_require__(/*! ../types */ "./new_src/core/ops/types.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 撤销操作
 */
var UndoOp = function (_Operation) {
    (0, _inherits3.default)(UndoOp, _Operation);

    function UndoOp() {
        (0, _classCallCheck3.default)(this, UndoOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (UndoOp.__proto__ || (0, _getPrototypeOf2.default)(UndoOp)).apply(this, arguments));

        _this.type = 'undo';
        _this.description = "撤销操作";
        _this.idsCouldUndo = [];
        return _this;
    }

    (0, _createClass3.default)(UndoOp, [{
        key: "getCount",
        value: function getCount() {
            return this.idsCouldUndo.length;
        }
    }, {
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin", this.onOpAdded.bind(this));
            this.opsManager.hooks.keydown.tap("KeydownPlugin", this.handleKeyDown.bind(this));
        }
    }, {
        key: "handleKeyDown",
        value: function handleKeyDown(ev) {
            var key = ev.key.toLocaleLowerCase();
            if (key === 'z' && (this.isKeyDown('control') || this.isKeyDown('command'))) {
                ev.preventDefault();
                this.execCommand();
            }
        }
    }, {
        key: "resetCount",
        value: function resetCount() {
            this.idsCouldUndo = [];
            this.emit('event:appState:change', 'undoCount', 0);
        }
    }, {
        key: "onOpAdded",
        value: function onOpAdded(snapshot) {
            if (snapshot.category === 'pageOp' || snapshot.category === 'boardOp') {
                this.idsCouldUndo = [];
            } else if (snapshot.data.skipUndo || snapshot.data.inProgress || _types.snapshotOutOfNormalFlowTypes.includes(snapshot.data.type)) {
                return;
            } else if (snapshot.data.type === 'undo') {
                var index = this.idsCouldUndo.indexOf(snapshot.data.undoOpId);
                if (index !== -1) {
                    this.idsCouldUndo.splice(index, 1);
                }
            } else if (snapshot.data.type !== 'undo') {
                if (!this.idsCouldUndo.includes(snapshot.opId)) {
                    this.idsCouldUndo.push(snapshot.opId);
                }
            }
            this.emit('event:appState:change', 'undoCount', this.idsCouldUndo.length);
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                exec: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u6267\u884C" + this.type + "\u4E8B\u4EF6"
                    }
                }
            };
        }
    }, {
        key: "execCommand",
        value: function execCommand() {
            if (this.idsCouldUndo.length === 0) return;
            this.dispatch(this.getSnapshot());
        }
        /**
         * select，以及过程中的快照不需要undo
         */

    }, {
        key: "getSnapshot",
        value: function getSnapshot() {
            var opOfPage = this.opsOfPage;
            var undoOpId = '';
            //记录每个快照当前是否可以被undo
            /**
             * 当处理到非undo，redo，非inProgress，非skipUndo的快照时，
             * 若该快照未被undo，redo处理过，则opUndoCount中不存在该快照的entry，则该快照可以被undo
             * 若该快照已经被undo了，则其opUndoCount[opId]应该为1
             * 若该快照已经被undo，然后又被redo，则处理redo后（逆向处理），它的opUndoCount[opId]应该为-1，处理undo后，它的opUndoCount[opId]应该为0。
              * 比如W1 U1 W2 W3 W4 W5 U5 U4 W6 U6 U3
             *
             * 若要寻找U3对应的撤销快照Id。从U6开始，每一步后opUndoCount的变化为：
             * {W6}             (U6 + W6)
             * {W6, W4}         (U4)
             * {W6, W4, W5}     (U5 + W5 + W4)
             * 处理到W3时，发现W3尚未被Undo，因此W3就是要撤销的快照
             */
            var opAlreadyBeenUndo = new _set2.default();
            for (var i = opOfPage.length - 1; i >= 0; i--) {
                //该快照应该被跳过
                var op = opOfPage[i];
                var opShouldBeSkiped = op.data.inProgress || op.data.skipUndo || _types.snapshotOutOfNormalFlowTypes.includes(op.data.type);
                if (op.data.type !== 'undo' && !opShouldBeSkiped && !opAlreadyBeenUndo.has(op.opId)) {
                    undoOpId = op.opId;
                    break;
                } else if (op.data.type === 'undo') {
                    opAlreadyBeenUndo.add(op.data.undoOpId);
                }
            }
            return {
                type: this.type,
                undoOpId: undoOpId
            };
        }
    }]);
    return UndoOp;
}(_Operation3.default);

exports.default = UndoOp;

/***/ }),

/***/ "./new_src/core/ops/ImageOp/BackgroundOp.ts":
/*!**************************************************!*\
  !*** ./new_src/core/ops/ImageOp/BackgroundOp.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/ImageOp/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 背景Op
 *
 * 背景Op和ImageOp类似。区别在于背景Op不会进入快照队列中被undo，redo，clear等操作处理
 */
/**
 * 图片相关操作
 */
var BackgroundOp = function (_Operation) {
    (0, _inherits3.default)(BackgroundOp, _Operation);

    function BackgroundOp() {
        (0, _classCallCheck3.default)(this, BackgroundOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (BackgroundOp.__proto__ || (0, _getPrototypeOf2.default)(BackgroundOp)).apply(this, arguments));

        _this.type = 'background';
        _this.description = "设置背景操作";
        _this.getBoundaryFromSnapshot = function (snapshot) {
            var boundary = void 0;
            if (snapshot.data.hasOwnProperty('imgWidth')) {
                //老版本：背景图片盛满canvas, 快照数据中包含imgWidth, imgHeight
                var _getImageProperPositi = (0, _util.getImageProperPosition)(_this, snapshot.data.imgWidth, snapshot.data.imgHeight),
                    sx = _getImageProperPositi.sx,
                    sy = _getImageProperPositi.sy,
                    width = _getImageProperPositi.width,
                    height = _getImageProperPositi.height;

                boundary = {
                    sx: sx, sy: sy, w: width, h: height
                };
            } else {
                //3.0.2之后的版本
                //背景快照和其他快照一样，使用世界坐标系，即无论容器大小如何，无论如何缩放，
                //背景快照和其他元素的相对位置不变
                boundary = snapshot.data.boundary;
            }
            return boundary;
        };
        _this.dispatchImage = function (url, imgWidth, imgHeight, page) {
            var _getBackgroundImagePo = (0, _util.getBackgroundImagePorperPosition)(_this, imgWidth, imgHeight),
                sx = _getBackgroundImagePo.sx,
                sy = _getBackgroundImagePo.sy,
                width = _getBackgroundImagePo.width,
                height = _getBackgroundImagePo.height;

            if (page) {
                _this.dispatchFromPage({
                    type: _this.type,
                    url: url,
                    boundary: {
                        sx: sx,
                        sy: sy,
                        w: width,
                        h: height
                    }
                }, page);
            } else {
                _this.dispatch({
                    type: _this.type,
                    url: url,
                    boundary: {
                        sx: sx,
                        sy: sy,
                        w: width,
                        h: height
                    }
                });
            }
        };
        return _this;
    }

    (0, _createClass3.default)(BackgroundOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'background:imageUpload': {
                    value: this.addImage.bind(this),
                    information: {
                        args: "url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageIndex?: number\n                    }",
                        message: "\u4E0A\u4F20\u80CC\u666F\u56FE\u7247"
                    }
                }
            };
        }
    }, {
        key: "addImage",
        value: function addImage(url, opts) {
            return (0, _util.addImage)(this, url, opts);
        }
    }, {
        key: "preview",
        value: function preview(snapshot, ctx, opts) {
            var data = snapshot.data;
            return (0, _util.draw)(ctx, data.url, this.getBoundaryFromSnapshot(snapshot), {
                page: opts.page,
                supportToDataUrl: opts.supportToDataUrl,
                preview: true
            });
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx, opts) {
            var data = snapshot.data;
            return (0, _util.draw)(ctx, data.url, this.getBoundaryFromSnapshot(snapshot), {
                page: opts.page,
                div: opts.div,
                id: snapshot.opId,
                type: 'background'
            });
        }
    }]);
    return BackgroundOp;
}(_Operation3.default);

exports.default = BackgroundOp;

/***/ }),

/***/ "./new_src/core/ops/ImageOp/index.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/ImageOp/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _util = __webpack_require__(/*! ./util */ "./new_src/core/ops/ImageOp/util.ts");

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ImageOp = function (_Operation) {
    (0, _inherits3.default)(ImageOp, _Operation);

    function ImageOp() {
        (0, _classCallCheck3.default)(this, ImageOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ImageOp.__proto__ || (0, _getPrototypeOf2.default)(ImageOp)).apply(this, arguments));

        _this.type = 'image';
        _this.description = "图片操作";
        /**
         * initWidth, initHeight可能是图片的固有宽高，也可以是用户指定的该图片的显示宽高
         *
         * ImageOp快照中的boundary完全决定了图片相对于其他快照的位置
         *
         * @param url
         * @param initWidth
         * @param initHeight
         * @param page
         */
        _this.dispatchImage = function (url, initWidth, initHeight, page) {
            var _getImageProperPositi = (0, _util.getImageProperPosition)(_this, initWidth, initHeight),
                sx = _getImageProperPositi.sx,
                sy = _getImageProperPositi.sy,
                width = _getImageProperPositi.width,
                height = _getImageProperPositi.height;

            if (page) {
                _this.dispatchFromPage({
                    type: _this.type,
                    url: url,
                    boundary: {
                        sx: sx,
                        sy: sy,
                        w: width,
                        h: height
                    }
                }, page);
            } else {
                _this.dispatch({
                    type: _this.type,
                    url: url,
                    boundary: {
                        sx: sx,
                        sy: sy,
                        w: width,
                        h: height
                    }
                });
            }
        };
        return _this;
    }

    (0, _createClass3.default)(ImageOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'image:upload': {
                    value: this.addImage.bind(this),
                    information: {
                        args: "url: string, opts?: {\n                        width?: number,\n                        height?: number\n                    }",
                        message: "\u4E0A\u4F20\u56FE\u7247"
                    }
                }
            };
        }
    }, {
        key: "addImage",
        value: function addImage(url, opts) {
            return (0, _util.addImage)(this, url, opts);
        }
    }, {
        key: "preview",
        value: function preview(snapshot, ctx, opts) {
            var data = snapshot.data;
            var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
            return (0, _util.draw)(ctx, data.url, boundary, {
                page: opts.page,
                supportToDataUrl: opts.supportToDataUrl,
                preview: true
            });
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx, opts) {
            /**
             * page是该图片的容器页面。this.opsManager.currPage是当前打开的页面。
             * 生成预览图时，currPage和图片的容器页面不是同一个页面
             */
            var data = snapshot.data;
            var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
            return (0, _util.draw)(ctx, data.url, boundary, {
                page: opts.page,
                div: opts.div,
                id: snapshot.opId,
                type: 'image'
            });
        }
    }, {
        key: "hide",
        value: function hide(snapshot, ctx, div) {
            var _a;
            //移除之前绘制的文本框
            var image = div.querySelector("[id='image-" + snapshot.opId + "']");
            (_a = image === null || image === void 0 ? void 0 : image.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(image);
        }
    }]);
    return ImageOp;
}(_Operation3.default); /**
                         * 图片相关操作
                         */


exports.default = ImageOp;

/***/ }),

/***/ "./new_src/core/ops/ImageOp/util.ts":
/*!******************************************!*\
  !*** ./new_src/core/ops/ImageOp/util.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getBackgroundImagePorperPosition = exports.getImageProperPosition = exports.draw = exports.addImage = undefined;

var _resourceCache = __webpack_require__(/*! ../../resource/resourceCache */ "./new_src/core/resource/resourceCache.ts");

var addImage = exports.addImage = function addImage(op, url, opts) {
    var currBoard = op.app.room.currBoard;
    var currPage = op.opsManager.currPage;
    if (opts && opts.hasOwnProperty('pageIndex')) {
        var pageName = currBoard.pageNames[opts.pageIndex];
        if (currBoard.pages.hasOwnProperty(pageName)) {
            currPage = currBoard.pages[pageName];
        }
    }
    if ((0, _resourceCache.resourceLoaded)(url)) {
        var img = (0, _resourceCache.getResource)(url);
        var width = (opts === null || opts === void 0 ? void 0 : opts.width) ? opts.width : img.width;
        var height = (opts === null || opts === void 0 ? void 0 : opts.height) ? opts.height : img.height;
        op.dispatchImage(url, width, height, currPage);
    } else if ((opts === null || opts === void 0 ? void 0 : opts.width) && (opts === null || opts === void 0 ? void 0 : opts.height)) {
        op.dispatchImage(url, opts === null || opts === void 0 ? void 0 : opts.width, opts === null || opts === void 0 ? void 0 : opts.height, currPage);
    } else {
        //TODO: 这里是错误的。dispatch调用时连接的boardIndex和pageIndex和addImage调用时不一样了。
        currPage.addWaitingResource(url);
        (0, _resourceCache.fetchResource)(url, function (img) {
            var width = (opts === null || opts === void 0 ? void 0 : opts.width) ? opts.width : img.width;
            var height = (opts === null || opts === void 0 ? void 0 : opts.height) ? opts.height : img.height;
            op.dispatchImage(url, width, height, currPage);
            currPage.removeWaitingResource(url);
        });
    }
};
/**
 * TODO：可能存在问题。初始化时，会同步房间的信息。目前的写法是接收每个快照时都会refresh一次。这可能会导致多个页面的图片不断被删除，再创建。
 * 从用户角度看，会有明显的闪烁效果。
 * @param ctx
 * @param url
 * @param boundary
 * @param opts
 */
var draw = exports.draw = function draw(ctx, url, boundary, opts) {
    /**
     * page是该图片的容器页面。this.opsManager.currPage是当前打开的页面。
     * 生成预览图时，currPage和图片的容器页面不是同一个页面
     */
    var page = opts.page,
        div = opts.div,
        preview = opts.preview,
        id = opts.id,
        supportToDataUrl = opts.supportToDataUrl;

    if ((0, _resourceCache.resourceLoaded)(url) && !preview && div && id) {
        var image = div.querySelector('[id=\'image-' + id + '\']');
        if (!image) {
            if (opts.type === 'background') {
                /**
                 * 背景图片的URL不会在同一page中出现两次，因此不需要cloneNode
                 */
                image = (0, _resourceCache.getResource)(url);
            } else {
                image = (0, _resourceCache.getResource)(url).cloneNode(true);
            }
            image.id = 'image-' + id;
            image.style.userSelect = 'none';
            image.style.pointerEvents = 'none';
            image.style.position = 'absolute';
            image.style.imageRendering = '-webkit-optimize-contrast';
            div.appendChild(image);
        }
        image.width = boundary.w;
        image.height = boundary.h;
        image.style.left = boundary.sx + 'px';
        image.style.top = boundary.sy + 'px';
        var pxOverBorder = getImagePartOutOfContainer(boundary, opts.page.app.camera);
        if (pxOverBorder) {
            image.style.clipPath = 'inset(' + pxOverBorder.top + 'px ' + pxOverBorder.right + 'px ' + pxOverBorder.bottom + 'px ' + pxOverBorder.left + 'px)';
        } else {
            image.style.clipPath = 'none';
        }
    } else if (supportToDataUrl && (0, _resourceCache.resourceLoaded)(url)) {
        ctx.drawImage((0, _resourceCache.getResource)(url, true), boundary.sx, boundary.sy, boundary.w, boundary.h);
    } else if (!supportToDataUrl && (0, _resourceCache.resourceLoaded)(url)) {
        ctx.drawImage((0, _resourceCache.getResource)(url, false), boundary.sx, boundary.sy, boundary.w, boundary.h);
    } else if ((0, _resourceCache.resourceLoaded)('imageLoading')) {
        /**
         * 图片还未下载下来时，先用图片正在加载中代替
         */
        ctx.drawImage((0, _resourceCache.getResource)('imageLoading'), boundary.sx + 5, boundary.sy + 5, Math.max(0, boundary.w - 10), Math.max(0, boundary.h - 10));
    }
    if (!(0, _resourceCache.resourceLoaded)(url)) {
        //回调函数中必须用变量currPage，而不是this.opsManager.currPage，否则被调用时引用的page可能不对
        page.addWaitingResource(url);
        (0, _resourceCache.fetchResource)(url, function () {
            page.removeWaitingResource(url);
        });
    }
};
/**
 * 返回图片boundary在container之外的部分。在container外面的部分要用clippath隐藏
 * @param boundary
 */
var getImagePartOutOfContainer = function getImagePartOutOfContainer(boundary, camera) {
    var sx = boundary.sx,
        sy = boundary.sy,
        w = boundary.w,
        h = boundary.h;

    var ex = sx + w;
    var ey = sy + h;
    var screenBound = camera.getContainerWorldRect();
    var left = Math.max(0, screenBound.centerX - screenBound.width / 2 - sx); //screen左侧 - boundary左侧
    var right = Math.max(0, ex - (screenBound.centerX + screenBound.width / 2)); //boundary右侧 - screen右侧
    var top = Math.max(0, screenBound.centerY - screenBound.height / 2 - sy); //screen顶部 - boundary顶部
    var bottom = Math.max(0, ey - (screenBound.centerY + screenBound.height / 2)); //boundary底部 - screen底部
    if (left > 0 || right > 0 || top > 0 || bottom > 0) {
        return {
            left: left, right: right, top: top, bottom: bottom
        };
    } else {
        return null;
    }
};
/**
 * 根据图片的宽高，容器的宽高，获得图片合适的宽高，及位置。
 *
 * 合适的宽高，位置应该使图片不被遮挡的情况下尽可能大，同时不超过图片本身的尺寸
 *
 * ImageOp的宽高在addImage时确定，所有用户那里ImageOp和其他快照的相对位置固定（不随容器宽高resize而变化）
 * BackgroundOp的宽高在draw时确定，图片位置总是相对于容器的最佳位置
 *
 * width, height可能是图片的固有宽高，用户也可以在上传图片时指定图片的初始宽高
 */
var getImageProperPosition = exports.getImageProperPosition = function getImageProperPosition(op, width, height) {
    var sanityWidth = op.app.container.width;
    var sanityHeight = op.app.container.height;
    var MAX_ALLOWED_WIDTH = sanityWidth;
    var MAX_ALLOWED_HEIGHT = sanityHeight;
    if (width > MAX_ALLOWED_WIDTH && height < MAX_ALLOWED_HEIGHT) {
        height = height * MAX_ALLOWED_WIDTH / width;
        width = MAX_ALLOWED_WIDTH;
    } else if (width < MAX_ALLOWED_WIDTH && height > MAX_ALLOWED_HEIGHT) {
        width = width * MAX_ALLOWED_HEIGHT / height;
        height = MAX_ALLOWED_HEIGHT;
    } else if (width > MAX_ALLOWED_WIDTH && height > MAX_ALLOWED_HEIGHT) {
        if (width / height > MAX_ALLOWED_WIDTH / MAX_ALLOWED_HEIGHT) {
            height = height * MAX_ALLOWED_WIDTH / width;
            width = MAX_ALLOWED_WIDTH;
        } else {
            width = width * MAX_ALLOWED_HEIGHT / height;
            height = MAX_ALLOWED_HEIGHT;
        }
    }
    width = width / op.app.camera.scale;
    height = height / op.app.camera.scale;
    var sx = op.app.camera.centerX - width / 2;
    var sy = op.app.camera.centerY - height / 2;
    return {
        sx: sx, sy: sy, width: width, height: height
    };
};
/**
 * 背景图应该是100%位置的时，大概撑满页面
 * @param op
 * @param width
 * @param height
 */
var getBackgroundImagePorperPosition = exports.getBackgroundImagePorperPosition = function getBackgroundImagePorperPosition(op, width, height) {
    var sx = -width / 2;
    var sy = -height / 2;
    return {
        sx: sx, sy: sy, width: width, height: height
    };
};

/***/ }),

/***/ "./new_src/core/ops/LaserOp/index.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/LaserOp/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _drawConfig = __webpack_require__(/*! ../DrawOp/drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

var _util = __webpack_require__(/*! ../util */ "./new_src/core/ops/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var LaserOp = function (_Operation) {
    (0, _inherits3.default)(LaserOp, _Operation);

    function LaserOp() {
        (0, _classCallCheck3.default)(this, LaserOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (LaserOp.__proto__ || (0, _getPrototypeOf2.default)(LaserOp)).apply(this, arguments));

        _this.type = 'laser';
        _this.description = "镭射灯";
        return _this;
    }

    (0, _createClass3.default)(LaserOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                }
            };
        }
    }, {
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.opChange.tap('OpChange', this.handleOpChange.bind(this));
        }
        /**
         * 当操作类型变化时，关闭镭射灯
         */

    }, {
        key: "handleOpChange",
        value: function handleOpChange(newType) {
            var _a;
            if (newType !== 'laser' && ((_a = this.opsManager.currOp) === null || _a === void 0 ? void 0 : _a.type) === 'laser') {
                document.body.style.cursor = 'default';
                this.dispatch(this.getSnapshot(false));
            }
        }
    }, {
        key: "handleMouseLeave",
        value: function handleMouseLeave(event, mx, my) {
            this.dispatch(this.getSnapshot(false));
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event, mx, my) {
            if (this.app.container.isTargetOnContainer(event.target)) {
                document.body.style.cursor = 'none';
            } else {
                document.body.style.cursor = 'auto';
            }
            this.dispatch(this.getSnapshot(true, [mx, my]));
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress, point) {
            return {
                type: 'laser',
                point: point,
                inProgress: inProgress,
                skipUndo: true,
                reuseOpType: 'laser',
                color: _drawConfig2.default.strokeColor
            };
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            var data = snapshot.data;
            /**
             * 激光笔大小固定为12 * 12的红色圆形
             */
            var r = 6 / this.app.camera.scale;
            if (snapshot.data.inProgress && data.point) {
                ctx.save();
                ctx.beginPath();
                ctx.arc(data.point[0], data.point[1], r, 0, Math.PI * 2, true);
                ctx.shadowColor = 'rgba(255, 0, 0, 0.5)';
                ctx.shadowBlur = 8;
                ctx.fillStyle = '#ff0000';
                ctx.fill();
                ctx.restore();
                if (snapshot.uid !== this.app.account && this.app.appConfig.showLaserNickname) {
                    (0, _util.drawUserName)({
                        ctx: ctx,
                        account: snapshot.uid,
                        scale: this.app.camera.scale,
                        px: data.point[0],
                        py: data.point[1],
                        bgColor: data.color
                    });
                }
            }
        }
    }]);
    return LaserOp;
}(_Operation3.default);

exports.default = LaserOp;

/***/ }),

/***/ "./new_src/core/ops/LockOp/index.ts":
/*!******************************************!*\
  !*** ./new_src/core/ops/LockOp/index.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var LockOp = function (_Operation) {
    (0, _inherits3.default)(LockOp, _Operation);

    function LockOp() {
        (0, _classCallCheck3.default)(this, LockOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (LockOp.__proto__ || (0, _getPrototypeOf2.default)(LockOp)).apply(this, arguments));

        _this.type = 'lock';
        _this.description = "锁定元素。";
        return _this;
    }

    (0, _createClass3.default)(LockOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'lock': {
                    value: this.lockOps.bind(this),
                    information: {
                        args: 'opIds',
                        message: "\u9501\u5B9A\u5143\u7D20"
                    }
                },
                'unlock': {
                    value: this.unlockOps.bind(this),
                    information: {
                        args: 'opIds',
                        message: "\u89E3\u9501\u5143\u7D20"
                    }
                }
            };
        }
    }, {
        key: "lockOps",
        value: function lockOps(opIds) {
            this.dispatch(this.getSnapshot(opIds, 'lock'));
        }
    }, {
        key: "unlockOps",
        value: function unlockOps(opIds) {
            this.dispatch(this.getSnapshot(opIds, 'unlock'));
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(opIds, action) {
            return {
                type: this.type,
                action: action,
                dependOn: opIds.slice()
            };
        }
        /**
         * 锁定，或者解锁元素
         */

    }, {
        key: "transformOp",
        value: function transformOp(baseOp, _transformOp) {
            var newData = (0, _assign2.default)({}, baseOp.data, {
                locked: _transformOp.data.action === 'lock' ? true : false
            });
            return (0, _assign2.default)({}, baseOp, {
                data: newData
            });
        }
    }]);
    return LockOp;
}(_Operation3.default); /**
                         * 删除操作，可通过ctrl-v还原
                         */


exports.default = LockOp;

/***/ }),

/***/ "./new_src/core/ops/MousePointerOp/index.ts":
/*!**************************************************!*\
  !*** ./new_src/core/ops/MousePointerOp/index.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _pen = __webpack_require__(/*! ../../../assets/cursors/pen.svg */ "./new_src/assets/cursors/pen.svg");

var _pen2 = _interopRequireDefault(_pen);

var _elementEraser = __webpack_require__(/*! ../../../assets/cursors/element-eraser.svg */ "./new_src/assets/cursors/element-eraser.svg");

var _elementEraser2 = _interopRequireDefault(_elementEraser);

var _cursor = __webpack_require__(/*! ../../../assets/cursors/cursor.svg */ "./new_src/assets/cursors/cursor.svg");

var _cursor2 = _interopRequireDefault(_cursor);

var _drawConfig = __webpack_require__(/*! ../DrawOp/drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

var _util = __webpack_require__(/*! ../util */ "./new_src/core/ops/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 移动操作。
 * 移动操作必须跟在选择操作之后
 */
var penImg = new Image();
var elementEraserImg = new Image();
var cursorImg = new Image();
penImg.src = _pen2.default;
elementEraserImg.src = _elementEraser2.default;
cursorImg.src = _cursor2.default;

var MousePointerOp = function (_Operation) {
    (0, _inherits3.default)(MousePointerOp, _Operation);

    function MousePointerOp() {
        (0, _classCallCheck3.default)(this, MousePointerOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (MousePointerOp.__proto__ || (0, _getPrototypeOf2.default)(MousePointerOp)).apply(this, arguments));

        _this.type = 'mouse-pointer';
        _this.description = "展示鼠标位置";
        _this.sampleSeq = 0;
        return _this;
    }

    (0, _createClass3.default)(MousePointerOp, [{
        key: 'registerHooks',
        value: function registerHooks() {
            this.opsManager.hooks.mousemove.tap("MousemovePlugin", this.handleMouseMove.bind(this));
            this.opsManager.hooks.mouseleave.tap("MousemovePlugin", this.handleMouseLeave.bind(this));
        }
    }, {
        key: 'handleMouseMove',
        value: function handleMouseMove(event, mx, my) {
            var _a;
            if (!this.app.showCursor || ((_a = this.opsManager.currOp) === null || _a === void 0 ? void 0 : _a.type) === 'laser') return;
            var inContainer = this.app.container.isTargetOnContainer(event.target);
            /**
             * 减少网络传输数据量。每pointsPerBatch才传输一次数据
             */
            if (this.sampleSeq % 6 === 0) {
                this.dispatch(this.getSnapshot([mx, my], inContainer));
            }
            this.sampleSeq += 1;
        }
    }, {
        key: 'handleMouseLeave',
        value: function handleMouseLeave(event, mx, my) {
            var _a;
            if (!this.app.showCursor || ((_a = this.opsManager.currOp) === null || _a === void 0 ? void 0 : _a.type) === 'laser') return;
            this.dispatch(this.getSnapshot([mx, my], false));
            this.sampleSeq = 0;
        }
    }, {
        key: 'getSnapshot',
        value: function getSnapshot(point, inContainer) {
            return {
                type: 'mouse-pointer',
                point: [Number(point[0].toFixed(1)), Number(point[1].toFixed(1))],
                c: _drawConfig2.default.strokeColor,
                show: inContainer ? 1 : 0,
                op: this.opsManager.currOp ? this.opsManager.currOp.type : '',
                reuseOpType: 'mouse-pointer',
                nickname: this.app.nickname
            };
        }
    }, {
        key: 'preview',
        value: function preview() {
            return;
        }
    }, {
        key: 'draw',
        value: function draw(snapshot, ctx) {
            var now = new Date().valueOf();
            if (now - snapshot.time > 5000) {
                return;
            }
            var data = snapshot.data;
            if (snapshot.uid === this.app.account || !data.show || !data.point) {
                return;
            }
            var img = this.getImageByOpType(data.op);

            var _mapPointInsideContai = this.mapPointInsideContainer(data.point[0], data.point[1]),
                _mapPointInsideContai2 = (0, _slicedToArray3.default)(_mapPointInsideContai, 2),
                px = _mapPointInsideContai2[0],
                py = _mapPointInsideContai2[1];

            if (this.opsManager.drawOpTypes.includes(data.op)) {
                /**
                 * 画笔的图片位置需要微调
                 */
                px = px - 1 / this.app.camera.scale;
                py = py - 27 / this.app.camera.scale;
            }
            var cursorSize = 32 / this.app.camera.scale;
            ctx.drawImage(img, px, py, cursorSize, cursorSize);
            if (!this.app.appConfig.showCursorNickname) return;
            (0, _util.drawUserName)({
                ctx: ctx,
                account: data.nickname || snapshot.uid,
                scale: this.app.camera.scale,
                px: px,
                py: py,
                bgColor: data.c
            });
        }
        /**
         * 另一个用户的鼠标位置可能超出屏幕，若超出屏幕，找到屏幕边缘位置绘制
         * @param point
         */

    }, {
        key: 'mapPointInsideContainer',
        value: function mapPointInsideContainer(px, py) {
            var _app$camera$convertTo = this.app.camera.convertToPointInWorld(0, 0),
                _app$camera$convertTo2 = (0, _slicedToArray3.default)(_app$camera$convertTo, 2),
                worldSx = _app$camera$convertTo2[0],
                worldSy = _app$camera$convertTo2[1];

            var _app$camera$convertTo3 = this.app.camera.convertToPointInWorld(this.app.container.width, this.app.container.height),
                _app$camera$convertTo4 = (0, _slicedToArray3.default)(_app$camera$convertTo3, 2),
                worldEx = _app$camera$convertTo4[0],
                worldEy = _app$camera$convertTo4[1];

            if (px < worldSx + 30) {
                px = worldSx + 30;
            } else if (px > worldEx - 25) {
                px = worldEx - 25;
            }
            if (py < worldSy + 30) {
                py = worldSy + 30;
            } else if (py > worldEy - 15) {
                py = worldEy - 15;
            }
            return [px, py];
        }
    }, {
        key: 'getImageByOpType',
        value: function getImageByOpType(opType) {
            if (opType === 'element-eraser') {
                return elementEraserImg;
            } else if (this.opsManager.drawOpTypes.includes(opType)) {
                return penImg;
            } else {
                return cursorImg;
            }
        }
    }]);
    return MousePointerOp;
}(_Operation3.default);

exports.default = MousePointerOp;

/***/ }),

/***/ "./new_src/core/ops/Operation.ts":
/*!***************************************!*\
  !*** ./new_src/core/ops/Operation.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ "./node_modules/babel-runtime/helpers/typeof.js");

var _typeof3 = _interopRequireDefault(_typeof2);

var _types = __webpack_require__(/*! ./types */ "./new_src/core/ops/types.ts");

var _uuid = __webpack_require__(/*! uuid */ "./node_modules/uuid/dist/esm-browser/index.js");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var lastGlobalOpId = void 0;
var lastSnapshotInfo = {
    type: '',
    boardName: 'whiteboard',
    pageIndex: '0',
    dependOn: undefined,
    timestamp: 0
};
var newOpFlag = false;
/**
 * 下面情况会生成新的opId。
 * 1. 操作类型和上一次dispatch的快照类型不同
 * 2. 操作的dependOn和上一次dispatch的dependOn不同
 * 3. 有用beginBatch明确标识为下一个opId
 *
 * 4. 命令型操作，如undo，redo，image等等
 */
function genNewOpId(type, dependOn, pageIndex, boardName) {
    var gen = false;
    if (lastSnapshotInfo.pageIndex !== pageIndex) {
        gen = true;
    } else if (lastSnapshotInfo.boardName !== boardName) {
        gen = true;
    } else if (!lastSnapshotInfo.inProgress) {
        //上一个快照已经结束，不需要新的快照
        gen = true;
    } else if (type !== lastSnapshotInfo.type) {
        gen = true;
    } else if ((typeof dependOn === 'undefined' ? 'undefined' : (0, _typeof3.default)(dependOn)) !== (0, _typeof3.default)(lastSnapshotInfo.dependOn)) {
        gen = true;
    } else if (typeof dependOn === 'string' && dependOn !== lastSnapshotInfo.dependOn) {
        gen = true;
    } else if (Array.isArray(dependOn) && Array.isArray(lastSnapshotInfo.dependOn) && dependOn.join(',') !== lastSnapshotInfo.dependOn.join(',')) {
        gen = true;
    } else if (newOpFlag) {
        gen = true;
    } else if (['undo', 'redo', 'image'].includes(type)) {
        gen = true;
    }
    return gen;
}

var Operation = function () {
    function Operation(app) {
        (0, _classCallCheck3.default)(this, Operation);

        this.type = 'base';
        this.app = app;
        this.opsManager = app.opsManager;
        this.registerHooks();
    }

    (0, _createClass3.default)(Operation, [{
        key: 'registerHooks',

        /**
         * 可以添加生命周期钩子。
         */
        value: function registerHooks() {}
        /**
         * 注册监听事件及响应方式
         * key: 事件名称
         * value：响应方式
         *
         * 最基本的有两类事件，建议使用下面名字命名：
         * exec: 当设置为true时，会调用this.execCommand()
         * activate: 当设置为true时，OpsManager会拦截该请求，并设置活跃操作
         * 接到其他事件时，会直接调用键值对应的value。
         *
         * UI层派发事件名称应该为：'op:${type}:{eventName}'。manager拦截事件后，会调用execCommand或者设置OpsManager中激活的Op。
         */

    }, {
        key: 'eventsToListen',
        value: function eventsToListen() {
            return {
                exec: {
                    value: false,
                    information: {
                        args: '',
                        message: '\u6267\u884C' + this.type + '\u4E8B\u4EF6'
                    }
                },
                activate: {
                    value: false,
                    information: {
                        args: '',
                        message: '\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A' + this.type
                    }
                }
            };
        }
    }, {
        key: 'execCommand',
        value: function execCommand() {
            console.warn('DEV-->', '\u82E5\u8BBE\u7F6E\u4E86exec\u4E3Atrue\uFF0C\u8BF7\u7EE7\u627FexecCommand\u51FD\u6570\uFF0C\u5E76\u4F5C\u51FA\u5BF9\u5E94\u7684\u5904\u7406\u3002');
        }
    }, {
        key: 'afterActivate',
        value: function afterActivate() {}
        //如果operation激活后有后续事情处理，在该函数中可以处理

        /**
         * 返回操作快照
         */

    }, {
        key: 'getSnapshot',
        value: function getSnapshot() {
            return {
                type: this.type
            };
        }
        /**
         * op可以通过此函数查询如果它发送快照，它的快照id是什么?
         * @param type
         * @param dependOn
         */

    }, {
        key: 'opIdForseen',
        value: function opIdForseen(type, dependOn) {
            var newId = genNewOpId(type, dependOn, this.opsManager.currPage.pageIndex, this.opsManager.currPage.boardName);
            if (newId) {
                return this.opsManager.currPage.getNextOpId();
            } else {
                return this.opsManager.currPage.getOpId();
            }
        }
        /**
         * 将操作快照发送给远程服务器，以及本地对应的操作队列
         *
         * @param snapshot
         */

    }, {
        key: 'dispatch',
        value: function dispatch(data) {
            if (!data.hasOwnProperty('type')) {
                /**
                 * 发送部分数据
                 */
                var snapshot = {
                    opId: this.opsManager.currPage.getOpId(),
                    data: data
                };
                this.app.room.dispatch(snapshot);
            } else if (_types.globalSnapshotTypes.indexOf(data.type) > -1) {
                this.dispatchGlobalAction(data);
            } else if (data.type === 'page') {
                this.dispatchPageAction(data);
            } else if (data.type === 'board') {
                this.dispatchBoardAction(data);
            } else {
                /**
                 * 处理当前页面的操作
                 */
                var currBoard = this.app.room.boards[this.app.room.currIndex];
                var now = new Date().valueOf();
                var opId = void 0;
                if (data.reuseOpType) {
                    /**
                     * 激光笔，鼠标位置等类型可以一直不改变opId
                     */
                    opId = this.app.account + '-' + data.reuseOpType;
                    delete data['reuseOpType'];
                } else {
                    var newId = genNewOpId(data.type, data.dependOn, this.opsManager.currPage.pageIndex, this.opsManager.currPage.boardName);
                    newOpFlag = false;
                    lastSnapshotInfo = {
                        type: data.type,
                        dependOn: data.dependOn,
                        timestamp: now,
                        pageIndex: this.opsManager.currPage.pageIndex,
                        boardName: this.opsManager.currPage.boardName,
                        inProgress: data.inProgress
                    };
                    if (newId) {
                        this.opsManager.currPage.prepareNewOpId();
                    }
                    opId = this.opsManager.currPage.getOpId();
                }
                var _snapshot = {
                    category: 'inPageOp',
                    board: this.app.room.currIndex,
                    page: currBoard.currIndex,
                    time: now,
                    uid: this.app.account,
                    opId: opId,
                    data: data
                };
                this.app.room.dispatch(_snapshot);
            }
        }
        /**
         * 某些异步快照发送的时候，currBoard和currPage可能发生了变化。
         * 为了处理这些场景，需要说明快照是从哪个page中发出的。
         * 这一类场景只可能是page里面的快照，因此不用处理PageAction和BoardAction
         * @param data
         * @param page
         */

    }, {
        key: 'dispatchFromPage',
        value: function dispatchFromPage(data, page) {
            /**
             * 处理当前页面的操作
             */
            var now = new Date().valueOf();
            //保险起见，准备新的opId
            page.prepareNewOpId();
            var snapshot = {
                category: 'inPageOp',
                board: page.boardName,
                page: Number(page.pageIndex),
                time: now,
                uid: this.app.account,
                opId: page.getOpId(),
                data: data
            };
            lastSnapshotInfo = {
                type: data.type,
                dependOn: data.dependOn,
                timestamp: now,
                pageIndex: page.pageIndex,
                boardName: page.boardName,
                inProgress: data.inProgress
            };
            this.app.room.dispatch(snapshot);
        }
        /**
         * 处理页面相关操作，包括goto和delete两类page操作。
         * @param data
         */

    }, {
        key: 'dispatchPageAction',
        value: function dispatchPageAction(data) {
            var now = new Date().valueOf();
            var snapshot = {
                category: 'pageOp',
                board: this.app.room.currIndex,
                time: now,
                uid: this.app.account,
                opId: (0, _uuid.v4)(),
                data: data
            };
            this.app.room.dispatch(snapshot);
        }
        /**
         * 处理页面相关操作，包括goto和delete两类page操作。
         * @param data
         */

    }, {
        key: 'dispatchBoardAction',
        value: function dispatchBoardAction(data) {
            var now = new Date().valueOf();
            var snapshot = {
                category: 'boardOp',
                time: now,
                uid: this.app.account,
                opId: (0, _uuid.v4)(),
                data: data
            };
            this.app.room.dispatch(snapshot);
        }
    }, {
        key: 'dispatchGlobalAction',
        value: function dispatchGlobalAction(data) {
            var opId = void 0;
            var now = new Date().valueOf();
            if (data.reuseOpType) {
                opId = this.app.account + '-' + data.reuseOpType;
                delete data['reuseOpType'];
            } else {
                if (!lastGlobalOpId || newOpFlag) {
                    lastGlobalOpId = (0, _uuid.v4)();
                    newOpFlag = false;
                }
                opId = lastGlobalOpId;
            }
            var snapshot = {
                category: 'globalOp',
                time: now,
                uid: this.app.account,
                opId: opId,
                data: data
            };
            this.app.room.dispatch(snapshot);
        }
    }, {
        key: 'emit',
        value: function emit(event) {
            var _app$dispatcher;

            for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                args[_key - 1] = arguments[_key];
            }

            (_app$dispatcher = this.app.dispatcher).emit.apply(_app$dispatcher, [event].concat(args));
        }
    }, {
        key: 'draw',
        value: function draw(snapshot, ctx, opts) {
            console.warn('DEV-->', '\u8BF7\u5B9E\u73B0' + this.type + '\u5B50\u7C7B\u4E2Ddraw\u51FD\u6570\u3002');
        }
        //文本本来是绘制在dom上。由于preview需要绘制在图片上，因此使用preview方法重写
        //TextOp需要重写此函数，其他Op不需要

    }, {
        key: 'preview',
        value: function preview(snapshot, ctx, opts) {
            this.draw(snapshot, ctx, opts);
        }
    }, {
        key: 'hide',
        value: function hide(snapshot, ctx, div) {
            //如有需要，继承此函数清除被清空的图形
        }
    }, {
        key: 'mergePartial',
        value: function mergePartial(snapshot, partial) {
            if (partial.hasOwnProperty('category')) {
                return partial;
            } else {
                return snapshot;
            }
        }
        /**
         * 连续动作开始，之后的快照会使用新的opId。
         */

    }, {
        key: 'beginBatch',
        value: function beginBatch() {
            newOpFlag = true;
        }
        /**
         * 判断某个按键是否按下，按键状态存储在container中
         */

    }, {
        key: 'isKeyDown',
        value: function isKeyDown(key) {
            return this.app.container.isKeyDown(key);
        }
        /**
         * 同一页面的所有操作快照
         */

    }, {
        key: 'getOpTypeByOpId',
        value: function getOpTypeByOpId(opId) {
            if (this.opsManager.drawOpsOfPage.hasOwnProperty(opId)) {
                return this.opsManager.drawOpsOfPage[opId].data.type;
            } else {
                return undefined;
            }
        }
    }, {
        key: 'isMouseDown',
        get: function get() {
            return this.app.container.isMouseDown;
        }
    }, {
        key: 'opsOfPage',
        get: function get() {
            return this.opsManager.currPage.opQueue;
        }
        /**
         * 同一页面所有可直接绘制的操作快照
         * TODO: 需要修改
         */

    }, {
        key: 'drawOpsOfPage',
        get: function get() {
            return this.opsManager.drawOpsOfPage;
        }
    }]);
    return Operation;
}();

exports.default = Operation;

/***/ }),

/***/ "./new_src/core/ops/OpsManager.ts":
/*!****************************************!*\
  !*** ./new_src/core/ops/OpsManager.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _types = __webpack_require__(/*! ./types */ "./new_src/core/ops/types.ts");

var _tapable = __webpack_require__(/*! tapable */ "./node_modules/tapable/lib/index.js");

var _PenOp = __webpack_require__(/*! ./DrawOp/PenOp */ "./new_src/core/ops/DrawOp/PenOp.ts");

var _PenOp2 = _interopRequireDefault(_PenOp);

var _LineOp = __webpack_require__(/*! ./DrawOp/LineOp */ "./new_src/core/ops/DrawOp/LineOp.ts");

var _LineOp2 = _interopRequireDefault(_LineOp);

var _SelectOp = __webpack_require__(/*! ./SelectOp */ "./new_src/core/ops/SelectOp/index.ts");

var _SelectOp2 = _interopRequireDefault(_SelectOp);

var _MoveOp = __webpack_require__(/*! ./EditOp/MoveOp */ "./new_src/core/ops/EditOp/MoveOp.ts");

var _MoveOp2 = _interopRequireDefault(_MoveOp);

var _ScaleOp = __webpack_require__(/*! ./EditOp/ScaleOp */ "./new_src/core/ops/EditOp/ScaleOp.ts");

var _ScaleOp2 = _interopRequireDefault(_ScaleOp);

var _DeleteOp = __webpack_require__(/*! ./EditOp/DeleteOp */ "./new_src/core/ops/EditOp/DeleteOp.ts");

var _DeleteOp2 = _interopRequireDefault(_DeleteOp);

var _UndoOp = __webpack_require__(/*! ./HistoryOp/UndoOp */ "./new_src/core/ops/HistoryOp/UndoOp.ts");

var _UndoOp2 = _interopRequireDefault(_UndoOp);

var _RedoOp = __webpack_require__(/*! ./HistoryOp/RedoOp */ "./new_src/core/ops/HistoryOp/RedoOp.ts");

var _RedoOp2 = _interopRequireDefault(_RedoOp);

var _ClearOp = __webpack_require__(/*! ./ClearOp */ "./new_src/core/ops/ClearOp/index.ts");

var _ClearOp2 = _interopRequireDefault(_ClearOp);

var _EraserOp = __webpack_require__(/*! ./EraserOp */ "./new_src/core/ops/EraserOp/index.ts");

var _EraserOp2 = _interopRequireDefault(_EraserOp);

var _RectOp = __webpack_require__(/*! ./DrawOp/RectOp */ "./new_src/core/ops/DrawOp/RectOp.ts");

var _RectOp2 = _interopRequireDefault(_RectOp);

var _EllipseOp = __webpack_require__(/*! ./DrawOp/EllipseOp */ "./new_src/core/ops/DrawOp/EllipseOp.ts");

var _EllipseOp2 = _interopRequireDefault(_EllipseOp);

var _TextOp = __webpack_require__(/*! ./TextOp */ "./new_src/core/ops/TextOp/index.ts");

var _TextOp2 = _interopRequireDefault(_TextOp);

var _PageOp = __webpack_require__(/*! ./PageOp */ "./new_src/core/ops/PageOp/index.ts");

var _PageOp2 = _interopRequireDefault(_PageOp);

var _ImageOp = __webpack_require__(/*! ./ImageOp */ "./new_src/core/ops/ImageOp/index.ts");

var _ImageOp2 = _interopRequireDefault(_ImageOp);

var _BoardOp = __webpack_require__(/*! ./BoardOp */ "./new_src/core/ops/BoardOp/index.ts");

var _BoardOp2 = _interopRequireDefault(_BoardOp);

var _DupliateOp = __webpack_require__(/*! ./EditOp/DupliateOp */ "./new_src/core/ops/EditOp/DupliateOp.ts");

var _DupliateOp2 = _interopRequireDefault(_DupliateOp);

var _PenArrowOp = __webpack_require__(/*! ./DrawOp/PenArrowOp */ "./new_src/core/ops/DrawOp/PenArrowOp.ts");

var _PenArrowOp2 = _interopRequireDefault(_PenArrowOp);

var _LineArrowOp = __webpack_require__(/*! ./DrawOp/LineArrowOp */ "./new_src/core/ops/DrawOp/LineArrowOp.ts");

var _LineArrowOp2 = _interopRequireDefault(_LineArrowOp);

var _ElementEraserOp = __webpack_require__(/*! ./EraserOp/ElementEraserOp */ "./new_src/core/ops/EraserOp/ElementEraserOp.ts");

var _ElementEraserOp2 = _interopRequireDefault(_ElementEraserOp);

var _LaserOp = __webpack_require__(/*! ./LaserOp */ "./new_src/core/ops/LaserOp/index.ts");

var _LaserOp2 = _interopRequireDefault(_LaserOp);

var _LockOp = __webpack_require__(/*! ./LockOp */ "./new_src/core/ops/LockOp/index.ts");

var _LockOp2 = _interopRequireDefault(_LockOp);

var _BackgroundOp = __webpack_require__(/*! ./ImageOp/BackgroundOp */ "./new_src/core/ops/ImageOp/BackgroundOp.ts");

var _BackgroundOp2 = _interopRequireDefault(_BackgroundOp);

var _PanOp = __webpack_require__(/*! ./CameraOp/PanOp */ "./new_src/core/ops/CameraOp/PanOp.ts");

var _PanOp2 = _interopRequireDefault(_PanOp);

var _ZoomOp = __webpack_require__(/*! ./CameraOp/ZoomOp */ "./new_src/core/ops/CameraOp/ZoomOp.ts");

var _ZoomOp2 = _interopRequireDefault(_ZoomOp);

var _ResetCameraOp = __webpack_require__(/*! ./CameraOp/ResetCameraOp */ "./new_src/core/ops/CameraOp/ResetCameraOp.ts");

var _ResetCameraOp2 = _interopRequireDefault(_ResetCameraOp);

var _MousePointerOp = __webpack_require__(/*! ./MousePointerOp */ "./new_src/core/ops/MousePointerOp/index.ts");

var _MousePointerOp2 = _interopRequireDefault(_MousePointerOp);

var _ResizeOp = __webpack_require__(/*! ./CameraOp/ResizeOp */ "./new_src/core/ops/CameraOp/ResizeOp.ts");

var _ResizeOp2 = _interopRequireDefault(_ResizeOp);

var _FitToContent = __webpack_require__(/*! ./CameraOp/FitToContent */ "./new_src/core/ops/CameraOp/FitToContent.ts");

var _FitToContent2 = _interopRequireDefault(_FitToContent);

var _FitToDoc = __webpack_require__(/*! ./CameraOp/FitToDoc */ "./new_src/core/ops/CameraOp/FitToDoc.ts");

var _FitToDoc2 = _interopRequireDefault(_FitToDoc);

var _CameraBoundOp = __webpack_require__(/*! ./CameraOp/CameraBoundOp */ "./new_src/core/ops/CameraOp/CameraBoundOp.ts");

var _CameraBoundOp2 = _interopRequireDefault(_CameraBoundOp);

var _RectFillOp = __webpack_require__(/*! ./DrawOp/RectFillOp */ "./new_src/core/ops/DrawOp/RectFillOp.ts");

var _RectFillOp2 = _interopRequireDefault(_RectFillOp);

var _EllipseFillOp = __webpack_require__(/*! ./DrawOp/EllipseFillOp */ "./new_src/core/ops/DrawOp/EllipseFillOp.ts");

var _EllipseFillOp2 = _interopRequireDefault(_EllipseFillOp);

var _VideoOp = __webpack_require__(/*! ./VideoOp */ "./new_src/core/ops/VideoOp/index.ts");

var _VideoOp2 = _interopRequireDefault(_VideoOp);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * OpsManager将UI组件中的动作，canvas中的鼠标动作，键盘动作等等路由给对应的操作处理。
 *
 * 同时它还保存了当前Page的操作快照集合。
 */
var OpsManager = function () {
    function OpsManager(app) {
        (0, _classCallCheck3.default)(this, OpsManager);

        this.currOp = null;
        this.opMap = {};
        this.drawOpTypes = [];
        this.app = app;
        this.dispatcher = app.dispatcher;
        /**
         * ***********************侵入生命周期函数************************
         *
         * 目前可以侵入mousedown, mousemove, mouseup等函数。
         * 钩子设置方式可以查看EditOp/MoveOp.ts
         *
         * 如果操作只在激活时监听鼠标动作，则不需要侵入生命周期函数。鼠标动作默认调用被激活操作（currOp）的鼠标处理函数。
         * 如果非激活操作需要处理鼠标动作，比如移动操作，则需要添加hooks
         *
         * 当指定的处理函数返回任何值时，鼠标处理函数不再处理别的bailHook，并且不再处理激活操作的鼠标处理函数。
         *
         * **************************************************************
         */
        this.hooks = {
            mousedown: new _tapable.SyncBailHook(['event', 'mx', 'my', 'clientX', 'clientY']),
            mouseup: new _tapable.SyncBailHook(['event', 'mx', 'my', 'clientX', 'clientY']),
            mousemove: new _tapable.SyncBailHook(['event', 'mx', 'my', 'clientX', 'clientY']),
            mouseleave: new _tapable.SyncBailHook(['event', 'mx', 'my', 'clientX', 'clientY']),
            mousewheel: new _tapable.SyncBailHook(['event', 'mx', 'my', 'clientX', 'clientY']),
            resize: new _tapable.SyncBailHook(['event', 'width', 'height']),
            click: new _tapable.SyncBailHook(['event', 'mx', 'my', 'clientX', 'clientY']),
            keyup: new _tapable.SyncBailHook(['event']),
            keydown: new _tapable.SyncBailHook(['event']),
            /**
             * 添加操作时触发
             */
            addOpHook: new _tapable.SyncHook(['snapshot', 'isNew']),
            refresh: new _tapable.SyncHook([]),
            /**
             * Op类型改变时触发
             */
            opChange: new _tapable.SyncHook(['type']),
            selectChange: new _tapable.SyncHook(['prevSelectedOpIds', 'selectedOpIds']),
            /**
             * 页面信息变化时触发
             */
            prePageChange: new _tapable.SyncHook(['snapshot']),
            pageChange: new _tapable.SyncHook(['snapshot']),
            boardChange: new _tapable.SyncHook([]),
            /**
             * 页面中资源加载完毕时触发
             */
            pageReady: new _tapable.SyncHook(['boardName, pageIndex']),
            /**
             * enableDraw
             */
            enableDrawChange: new _tapable.SyncHook(['enable'])
        };
    }

    (0, _createClass3.default)(OpsManager, [{
        key: "extendDefaultOps",
        value: function extendDefaultOps() {
            this.extendOp(_MousePointerOp2.default);
            this.extendDrawOp(_PenOp2.default);
            this.extendDrawOp(_PenArrowOp2.default);
            this.extendDrawOp(_LineArrowOp2.default);
            this.extendDrawOp(_LineOp2.default);
            this.extendDrawOp(_RectOp2.default);
            this.extendDrawOp(_RectFillOp2.default);
            this.extendDrawOp(_EllipseFillOp2.default);
            this.extendDrawOp(_EllipseOp2.default);
            this.extendOp(_TextOp2.default);
            /** Laser的opChange函数应该在select之前处理 */
            this.extendOp(_LaserOp2.default);
            this.extendOp(_SelectOp2.default);
            this.extendOp(_ScaleOp2.default);
            this.extendOp(_MoveOp2.default);
            this.extendOp(_DeleteOp2.default);
            this.extendOp(_DupliateOp2.default);
            this.extendOp(_UndoOp2.default);
            this.extendOp(_RedoOp2.default);
            this.extendOp(_ClearOp2.default);
            this.extendOp(_EraserOp2.default);
            this.extendOp(_ElementEraserOp2.default);
            this.extendOp(_PageOp2.default);
            this.extendOp(_BoardOp2.default);
            this.extendOp(_ImageOp2.default);
            this.extendOp(_VideoOp2.default);
            this.extendOp(_BackgroundOp2.default);
            this.extendOp(_LockOp2.default);
            this.extendOp(_PanOp2.default);
            this.extendOp(_ZoomOp2.default);
            this.extendOp(_ResetCameraOp2.default);
            this.extendOp(_ResizeOp2.default);
            this.extendOp(_CameraBoundOp2.default);
            this.extendOp(_FitToContent2.default);
            this.extendOp(_FitToDoc2.default);
            this.setCurrOp('pen');
        }
    }, {
        key: "addContainer",
        value: function addContainer(container) {
            this.container = container;
        }
    }, {
        key: "extendDrawOp",
        value: function extendDrawOp(OpConstructor) {
            var op = this.extendOp(OpConstructor);
            this.drawOpTypes.push(op.type);
        }
        /**
         * 注册Op。
         *
         * OpConstructor的类型应该为Operation Constructor。但是typescript设置为Operation Constrctor之后，印象中会有些奇怪的地方。
         * 因此，这里用any定义，然后创建之后转为Operation类型。
         *
         */

    }, {
        key: "extendOp",
        value: function extendOp(OpConstructor) {
            var _this = this;

            var _a, _b;
            var op = new OpConstructor(this.app);
            this.opMap[op.type] = op;
            /**
             * ***********************注册监听事件****************************
             *
             * 比如eventsToListen中返回事件key为pen:color, 会在app上注册op:pen:color事件。
             * 用户通过app.on('op:pen:color', color)设置线段颜色。
             *
             * activate和exec是特殊事件。activate若设置为true，会在app上注册op:${type}:activate事件，
             * 用户发送该事件会使此工具处于激活状态。比如可以设置当前操作为涂鸦。
             *
             * exec若设置为true，会在app上注册op:${type}:exec事件，
             * 用户发送该事件会调用此操作的execCommand方法。通过发送该事件可以执行命令，如撤销，重做。
             *
             * **************************************************************
             */
            var eventsToListen = op.eventsToListen();
            if (((_a = eventsToListen.activate) === null || _a === void 0 ? void 0 : _a.value) && ((_b = eventsToListen.exec) === null || _b === void 0 ? void 0 : _b.value)) {
                throw new Error('DEV--> 操作不能同时设置activate和exec为true。操作不同同时为命令类操作，及状态类操作');
            } else if (eventsToListen.activate && eventsToListen.activate.value) {
                this.dispatcher.on("op:" + op.type + ":activate", function () {
                    var isOpSet = _this.setCurrOp(op.type);
                    if (isOpSet) {
                        _this.currOp.afterActivate();
                    }
                });
            } else if (eventsToListen.exec && eventsToListen.exec.value) {
                this.dispatcher.on("op:" + op.type + ":exec", op.execCommand.bind(op));
            }
            for (var key in eventsToListen) {
                if (key !== 'activate' && key !== 'exec') {
                    this.dispatcher.on("op:" + key, eventsToListen[key].value);
                }
            }
            return op;
        }
    }, {
        key: "getOpDoc",
        value: function getOpDoc(type) {
            var strArr = [];
            if (type !== undefined) {
                strArr = this._getOpDoc(type);
            } else {
                for (var _type in this.opMap) {
                    strArr = strArr.concat(this._getOpDoc(_type));
                    strArr.push('*************************************');
                }
                strArr.push("全局事件\n\n" + "用法：app.on('event:add:snapshot', (data: {local: boolean, snapshot: IOPSnapshot}) => {})\n" + "作用： 接收到新的快照时发送此事件\n");
                strArr.push('*************************************');
            }
            return strArr.join('\n\n');
        }
        /**
         * 获取op和外界的接口。包括从外界接收的消息，以及发送给外界的消息两部分
         * @param type
         */

    }, {
        key: "_getOpDoc",
        value: function _getOpDoc(type) {
            var strArr = [];
            if (!this.opMap.hasOwnProperty(type)) {
                console.log('DEV-->', "op:" + type + "\u4E0D\u5B58\u5728!!!!!!");
            } else {
                var op = this.opMap[type];
                if (op.description) {
                    strArr.push(op.description);
                }
                var eventsToListen = op.eventsToListen();
                for (var key in eventsToListen) {
                    var info = eventsToListen[key].information;
                    var event = "op:" + key;
                    if (key === 'activate' || key === 'exec') {
                        event = "op:" + op.type + ":" + key;
                    }
                    strArr.push("\u7528\u6CD5\uFF1Aapp.emit('" + event + "'" + (info.args.length > 0 ? ', ' + info.args : '') + ")\n\u4F5C\u7528\uFF1A" + info.message);
                }
            }
            return strArr;
        }
    }, {
        key: "setCurrOp",
        value: function setCurrOp(type) {
            var _a;
            if (true) {
                console.log('白板-->', "\u8BBE\u7F6E\u5F53\u524Dop\u4E3A\uFF1A" + type);
            }
            if (((_a = this.currOp) === null || _a === void 0 ? void 0 : _a.type) !== type) {
                document.body.style.cursor = 'default';
                this.hooks.opChange.call(type);
                this.currOp = this.opMap[type];
                this.app.emit('event:appState:change', 'currTool', type);
                return true;
            }
            return false;
        }
    }, {
        key: "currOpIsCamera",
        value: function currOpIsCamera() {
            var _a;
            return this.currOp && _types.cameraSnapshotTypes.indexOf((_a = this.currOp) === null || _a === void 0 ? void 0 : _a.type) !== -1;
        }
    }, {
        key: "resize",
        value: function resize(event, width, height) {
            // if (!this.app.editable && !this.currOpIsCamera()) return
            var bailed = this.hooks.resize.call(event, width, height);
            if (bailed) return;
            if (this.currOp && 'handleResize' in this.currOp) {
                this.currOp.handleResize(event, width, height);
            }
        }
    }, {
        key: "mousedown",
        value: function mousedown(event, mx, my, clientX, clientY) {
            if (!this.app.editable && !this.currOpIsCamera()) return;
            var bailed = this.hooks.mousedown.call(event, mx, my, clientX, clientY);
            if (bailed) return;
            if (this.currOp && 'handleMouseDown' in this.currOp) {
                this.currOp.handleMouseDown(event, mx, my, clientX, clientY);
            }
        }
    }, {
        key: "mouseup",
        value: function mouseup(event, mx, my, clientX, clientY) {
            if (!this.app.editable && !this.currOpIsCamera()) return;
            var bailed = this.hooks.mouseup.call(event, mx, my, clientX, clientY);
            if (bailed) return;
            if (this.currOp && 'handleMouseUp' in this.currOp) {
                this.currOp.handleMouseUp(event, mx, my, clientX, clientY);
            }
        }
    }, {
        key: "mouseleave",
        value: function mouseleave(event, mx, my, clientX, clientY) {
            if (!this.app.editable && !this.currOpIsCamera()) return;
            var bailed = this.hooks.mouseleave.call(event, mx, my, clientX, clientY);
            if (bailed) return;
            if (this.currOp && 'handleMouseLeave' in this.currOp) {
                this.currOp.handleMouseLeave(event, mx, my, clientX, clientY);
            }
        }
    }, {
        key: "mousewheel",
        value: function mousewheel(event, mx, my, clientX, clientY) {
            if (!this.app.editable && !this.currOpIsCamera()) return;
            var bailed = this.hooks.mousewheel.call(event, mx, my, clientX, clientY);
            if (bailed) return;
            if (this.currOp && 'handleMouseWheel' in this.currOp) {
                this.currOp.handleMouseWheel(event, mx, my, clientX, clientY);
            }
        }
    }, {
        key: "mousemove",
        value: function mousemove(event, mx, my, clientX, clientY) {
            if (!this.app.editable && !this.currOpIsCamera()) return;
            var bailed = this.hooks.mousemove.call(event, mx, my, clientX, clientY);
            if (bailed) return;
            if (this.currOp && 'handleMouseMove' in this.currOp) {
                this.currOp.handleMouseMove(event, mx, my, clientX, clientY);
            }
        }
    }, {
        key: "click",
        value: function click(event, mx, my, clientX, clientY) {
            if (!this.app.editable) return;
            var bailed = this.hooks.click.call(event, mx, my, clientX, clientY);
            if (bailed) return;
            if (this.currOp && 'handleClick' in this.currOp) {
                this.currOp.handleClick(event, mx, my, clientX, clientY);
            }
        }
    }, {
        key: "keyup",
        value: function keyup(event) {
            if (!this.app.editable) return;
            var bailed = this.hooks.keyup.call(event);
            if (bailed) return;
            if (this.currOp && 'handleKeyUp' in this.currOp) {
                this.currOp.handleKeyUp(event);
            }
        }
    }, {
        key: "keydown",
        value: function keydown(event) {
            if (!this.app.editable) return;
            var bailed = this.hooks.keydown.call(event);
            if (bailed) return;
            if (this.currOp && 'handleKeyDown' in this.currOp) {
                this.currOp.handleKeyDown(event);
            }
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx, opts) {
            try {
                var type = snapshot.data.type;
                if (this.opMap[type]) {
                    this.opMap[type].draw(snapshot, ctx, opts);
                }
            } catch (err) {
                console.error('opsManager.draw error', err);
            }
        }
    }, {
        key: "preview",
        value: function preview(snapshot, ctx, opts) {
            try {
                var type = snapshot.data.type;
                this.opMap[type].preview(snapshot, ctx, opts);
            } catch (err) {
                console.error('opsManager.preview error', err);
            }
        }
    }, {
        key: "hide",
        value: function hide(snapshot, ctx, div) {
            try {
                var type = snapshot.data.type;
                if (this.opMap[type]) {
                    this.opMap[type].hide(snapshot, ctx, div);
                }
            } catch (err) {
                console.error('opsManager.hide error', err);
            }
        }
        /**
         * 将快照及它的一部分合并
         */

    }, {
        key: "mergePartial",
        value: function mergePartial(snapshot, partial) {
            var type = snapshot.data.type;
            if (this.opMap[type]) {
                return this.opMap[type].mergePartial(snapshot, partial);
            } else {
                console.error("\u627E\u4E0D\u5230type\u4E3A" + type + "\u7684\u6559\u5177\u7C7B\u578B", (0, _stringify2.default)(snapshot));
                return snapshot;
            }
        }
        /**
         * 合并两个增量数据，覆盖式合并。数组会累加在一起
         * @param partial1
         * @param partial2
         * @returns
         */

    }, {
        key: "mergeTwoPartial",
        value: function mergeTwoPartial(partial1, partial2) {
            var res = {
                opId: partial1.opId,
                data: partial1.data
            };
            for (var key in partial2.data) {
                if (Array.isArray(partial2.data[key])) {
                    if (Array.isArray(res.data[key])) {
                        res.data[key] = res.data[key].concat(partial2.data[key]);
                    } else {
                        res.data[key] = partial2.data[key];
                    }
                } else {
                    res.data[key] = partial2.data[key];
                }
            }
            return res;
        }
        /**
         * 重置undo，redo次数
         * 当主播从localStorage中恢复后，需要重置undo，redo的可用次数
         */

    }, {
        key: "resetUndoRedoCount",
        value: function resetUndoRedoCount() {
            this.opMap['undo'].resetCount();
            this.opMap['redo'].resetCount();
        }
    }, {
        key: "currPage",
        get: function get() {
            return this.currBoard.pages[this.currBoard.currIndex];
        }
    }, {
        key: "currBoard",
        get: function get() {
            return this.app.room.boards[this.app.room.currIndex];
        }
    }, {
        key: "drawOpsOfPage",
        get: function get() {
            return this.currPage.drawOpQueue || {};
        }
    }, {
        key: "selectOp",
        get: function get() {
            return this.opMap['select'];
        }
    }, {
        key: "selectedOpIds",
        get: function get() {
            if (this.currOp !== this.opMap['select']) {
                return [];
            } else {
                return this.selectOp.selectedOpIds;
            }
        }
    }, {
        key: "inProgressSelectedOpIds",
        get: function get() {
            if (this.currOp !== this.opMap['select']) {
                return [];
            } else {
                return this.selectOp.inProgressSelectedOpIds;
            }
        }
    }]);
    return OpsManager;
}();

exports.default = OpsManager;

/***/ }),

/***/ "./new_src/core/ops/PageOp/index.ts":
/*!******************************************!*\
  !*** ./new_src/core/ops/PageOp/index.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var PageOp = function (_Operation) {
    (0, _inherits3.default)(PageOp, _Operation);

    function PageOp() {
        (0, _classCallCheck3.default)(this, PageOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PageOp.__proto__ || (0, _getPrototypeOf2.default)(PageOp)).apply(this, arguments));

        _this.type = 'page';
        _this.description = "页面相关操作";
        return _this;
    }

    (0, _createClass3.default)(PageOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.pageChange.tap("pageChangePlugin", this.onPageChange.bind(this));
        }
    }, {
        key: "onPageChange",
        value: function onPageChange() {
            return this.emit('event:appState:change', 'page', {
                activeIndex: this.opsManager.currBoard.getCurrPageIndex(),
                pageNames: this.opsManager.currBoard.pageNames.slice(),
                currPage: this.opsManager.currBoard.currIndex,
                pagePayloads: this.opsManager.currBoard.payloadOfPages
            });
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'page:goto': {
                    value: this.goto.bind(this),
                    information: {
                        args: 'page: number',
                        message: "\u8DF3\u8F6C\u81F3\u9875\u9762"
                    }
                },
                'page:add': {
                    value: this.add.bind(this),
                    information: {
                        args: 'opt: {insertAfter?: number, payload?: any}',
                        message: "\u6DFB\u52A0\u9875\u9762\u3002\u9ED8\u8BA4\u6DFB\u52A0\u81F3\u5F53\u524Dboard\u6700\u540E"
                    }
                },
                'page:delete': {
                    value: this.delete.bind(this),
                    information: {
                        args: 'page: number',
                        message: '删除页面。只有当页面数量大于1时可以删除页面'
                    }
                }
            };
        }
    }, {
        key: "add",
        value: function add(opt) {
            this.dispatch({
                type: this.type,
                action: 'add',
                insertAfter: opt.insertAfter,
                payload: opt.payload
            });
        }
    }, {
        key: "goto",
        value: function goto(page) {
            //跳转至页面
            if (page !== this.opsManager.currBoard.currIndex && this.opsManager.currBoard.pageNames.includes(page.toString())) {
                this.dispatch({
                    type: this.type,
                    action: 'goto',
                    page: page
                });
            }
        }
    }, {
        key: "delete",
        value: function _delete(page) {
            var pages = this.opsManager.currBoard.pages;
            if (page in pages && (0, _keys2.default)(pages).length > 1) {
                this.dispatch({
                    type: this.type,
                    action: 'delete',
                    page: page
                });
            }
        }
    }]);
    return PageOp;
}(_Operation3.default); /**
                         * 页面操作
                         */


exports.default = PageOp;

/***/ }),

/***/ "./new_src/core/ops/SelectOp/SelectBase.ts":
/*!*************************************************!*\
  !*** ./new_src/core/ops/SelectOp/SelectBase.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _util = __webpack_require__(/*! ../util */ "./new_src/core/ops/util.ts");

var _drawConfig = __webpack_require__(/*! ../DrawOp/drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var SelectBase = function (_Operation) {
    (0, _inherits3.default)(SelectBase, _Operation);

    function SelectBase() {
        (0, _classCallCheck3.default)(this, SelectBase);

        var _this = (0, _possibleConstructorReturn3.default)(this, (SelectBase.__proto__ || (0, _getPrototypeOf2.default)(SelectBase)).apply(this, arguments));

        _this.points = [];
        _this.lastSelectedOpIds = [];
        return _this;
    }

    (0, _createClass3.default)(SelectBase, [{
        key: "postMouseUp",
        value: function postMouseUp(idsBeenSelected) {}
    }, {
        key: "postClick",
        value: function postClick(idsBeenSelected) {}
    }, {
        key: "postMouseMove",
        value: function postMouseMove(event, idsBeenSelected) {}
    }, {
        key: "handleMouseDown",
        value: function handleMouseDown(event, mx, my) {
            //鼠标按下时，先清空已有的选择元素
            this.dispatch(this.getSelectionSnapshot(false, []));
            this.points = [[mx, my]];
            var idsBeenSelected = (0, _util.findOpsUnderMouse)(this.points, this.drawOpsOfPage, this.opsManager);
            this.dispatch(this.getSelectionSnapshot(true, idsBeenSelected));
            this.lastSelectedOpIds = idsBeenSelected;
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event, mx, my) {
            if (this.isMouseDown) {
                this.points.push([mx, my]);
            } else {
                this.points = [[mx, my]];
            }
            var idsBeenSelected = void 0;
            if (this.isMouseDown) {
                //鼠标按下时，搜索鼠标选择区域内的元素
                idsBeenSelected = (0, _util.findOpsUnderRect)(this.points, this.drawOpsOfPage);
                this.dispatch(this.getSelectionSnapshot(true, idsBeenSelected));
            } else {
                //若鼠标松开，只有当选中的点发生变化时，才有必要发送事件来触发重绘
                //鼠标松开时，当且仅当
                var idsUnderMouse = (0, _util.findOpsUnderMouse)(this.points, this.drawOpsOfPage, this.opsManager);
                idsBeenSelected = (0, _util.arrayDeduce)(idsUnderMouse, this.opsManager.selectedOpIds);
                if ((0, _util.idsChanged)(idsBeenSelected, this.lastSelectedOpIds)) {
                    this.dispatch(this.getSelectionSnapshot(true, idsBeenSelected, true));
                }
            }
            this.lastSelectedOpIds = idsBeenSelected;
            this.postMouseMove(event, idsBeenSelected);
        }
    }, {
        key: "handleMouseUp",
        value: function handleMouseUp(event, mx, my) {
            if (this.isMouseDown) {
                var idsBeenSelected = this.isMouseDown ? (0, _util.findOpsUnderRect)(this.points, this.drawOpsOfPage) : (0, _util.findOpsUnderMouse)(this.points, this.drawOpsOfPage, this.opsManager);
                this.postMouseUp(idsBeenSelected);
            }
        }
        /**
         * container中如果判断是click，就不会发送mousedown, mousemove和mouseup事件
         * 因此需要额外判断是不是click事件
         * @param event
         * @param mx
         * @param my
         */

    }, {
        key: "handleClick",
        value: function handleClick(event, mx, my) {
            this.points = [[mx, my]];
            var idsBeenSelected = (0, _util.findOpsUnderMouse)(this.points, this.drawOpsOfPage, this.opsManager);
            this.postClick(idsBeenSelected);
        }
    }, {
        key: "getSelectionSnapshot",
        value: function getSelectionSnapshot() {
            var inProgress = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
            var selectedOpIds = arguments[1];
            var isHover = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

            return {
                type: 'select',
                sp: this.sp,
                ep: this.ep,
                inProgress: inProgress,
                selectedOpIds: selectedOpIds.slice(),
                reuseOpType: isHover ? 'select-hover' : 'select',
                skipUndo: true,
                color: _drawConfig2.default.strokeColor,
                nickname: this.app.nickname
            };
        }
    }, {
        key: "sp",
        get: function get() {
            return this.points.length > 0 ? this.points[0] : undefined;
        }
    }, {
        key: "ep",
        get: function get() {
            return this.points.length > 0 ? this.points[this.points.length - 1] : undefined;
        }
    }]);
    return SelectBase;
}(_Operation3.default); /**
                         * 移动鼠标删除元素
                         */


exports.default = SelectBase;

/***/ }),

/***/ "./new_src/core/ops/SelectOp/index.ts":
/*!********************************************!*\
  !*** ./new_src/core/ops/SelectOp/index.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _SelectBase2 = __webpack_require__(/*! ./SelectBase */ "./new_src/core/ops/SelectOp/SelectBase.ts");

var _SelectBase3 = _interopRequireDefault(_SelectBase2);

var _drawConfig = __webpack_require__(/*! ../DrawOp/drawConfig */ "./new_src/core/ops/DrawOp/drawConfig.ts");

var _drawConfig2 = _interopRequireDefault(_drawConfig);

var _util = __webpack_require__(/*! ../util */ "./new_src/core/ops/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 选择操作。支持区域选中
 *
 * 如果已经选中一些对象，然后点击选中的区域进行拖拽，此时不会产生新的选择操作，否则选中元素的包含盒无法显示
 */
var SelectOp = function (_SelectBase) {
    (0, _inherits3.default)(SelectOp, _SelectBase);

    function SelectOp() {
        (0, _classCallCheck3.default)(this, SelectOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (SelectOp.__proto__ || (0, _getPrototypeOf2.default)(SelectOp)).apply(this, arguments));

        _this.type = 'select';
        _this.lineWidth = 0;
        _this.fillColor = 'rgba(230, 100, 100, 0.4)';
        _this.eleContainerColor = 'rgb(0, 0, 0)';
        _this.eleContainerWidth = 2;
        _this.eleContainerPadding = 3;
        _this.activate = false;
        _this.selectedOpIds = [];
        _this.inProgressSelectedOpIds = [];
        _this.description = "选择操作工具。\n首先使用op:select:activate设置画布为选择模式。" + "通过。然后画布会监听鼠标动作，生成选择框。具体用法如下：";
        return _this;
    }

    (0, _createClass3.default)(SelectOp, [{
        key: "getSelectedIds",
        value: function getSelectedIds() {
            return this.selectedOpIds.slice();
        }
    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                },
                'select:width': {
                    value: this.setLineWidth.bind(this),
                    information: {
                        args: 'width: number',
                        message: "\u8BBE\u7F6E\u9009\u62E9\u6846\u7EBF\u6BB5\u5BBD\u5EA6"
                    }
                },
                'select:fill:color': {
                    value: this.setFillColor.bind(this),
                    information: {
                        args: 'color: ColorString',
                        message: "\u8BBE\u7F6E\u9009\u62E9\u6846\u586B\u5145\u8272"
                    }
                },
                'select:stroke:color': {
                    value: this.setStrokeColor.bind(this),
                    information: {
                        args: 'color: ColorString',
                        message: "\u8BBE\u7F6E\u9009\u62E9\u6846\u586B\u5145\u8272"
                    }
                },
                'select:eleContainer:color': {
                    value: this.setEleContainerColor.bind(this),
                    information: {
                        args: 'color: ColorString',
                        message: "\u8BBE\u7F6E\u88AB\u9009\u4E2D\u5143\u7D20\u5305\u542B\u76D2\u989C\u8272"
                    }
                },
                'select:eleContainer:width': {
                    value: this.setEleContainerWidth.bind(this),
                    information: {
                        args: 'width: number',
                        message: "\u8BBE\u7F6E\u88AB\u9009\u4E2D\u5143\u7D20\u5305\u542B\u76D2\u7EBF\u6BB5\u5BBD\u5EA6"
                    }
                },
                'select:eleContainerPadding': {
                    value: this.setEleContainerPadding.bind(this),
                    information: {
                        args: 'width: number',
                        message: "\u8BBE\u7F6E\u88AB\u9009\u4E2D\u5143\u7D20\u5305\u542B\u76D2\u7684padding"
                    }
                }
            };
        }
    }, {
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.opChange.tap('OpChange', this.handleOpChange.bind(this));
            this.opsManager.hooks.pageChange.tap('pageChange', this.handlePageChange.bind(this));
        }
        /**
         * 页面变化时，先清空选择的元素，否则可能会造成元素找不到的缺陷
         */

    }, {
        key: "handlePageChange",
        value: function handlePageChange(snapshot) {
            if (snapshot.uid === this.app.account && this.selectedOpIds.length > 0) {
                //当page change是由当前用户操作引起的，清空select元素
                //如果没有该判断，每个可编辑用户都会发送该快照
                this.dispatch(this.getSnapshot([]));
            }
        }
        /**
         * 当操作类型变化时，清空选择的元素
         */

    }, {
        key: "handleOpChange",
        value: function handleOpChange(newType) {
            var _a;
            if (newType !== 'select' && ((_a = this.opsManager.currOp) === null || _a === void 0 ? void 0 : _a.type) === 'select') {
                this.dispatch(this.getSnapshot([]));
            }
            this.beginBatch();
        }
    }, {
        key: "postMouseUp",
        value: function postMouseUp(idsBeenSelected) {
            this.dispatch(this.getSnapshot(idsBeenSelected));
            this.lastSelectedOpIds = idsBeenSelected;
        }
    }, {
        key: "postClick",
        value: function postClick(idsBeenSelected) {
            if (idsBeenSelected.length === 0) {
                var curr = new Date().valueOf();
                if (curr - this.opsManager.opMap['text'].blurAt < 100) {
                    //点击发生在失焦之后，忽略这次点击
                    return;
                }
            }
            this.dispatch(this.getSnapshot(idsBeenSelected));
        }
        /**
         * 选择操作可能是个连续的过程
         * 连续过程中产生的快照在selectbase中被处理了。
         * getSnapshot产生的是连续过程结束时产生的快照
         * @param idsBeenSelected
         */

    }, {
        key: "getSnapshot",
        value: function getSnapshot(idsBeenSelected) {
            return {
                type: 'select',
                sp: this.sp,
                ep: this.ep,
                inProgress: false,
                selectedOpIds: idsBeenSelected.slice(),
                reuseOpType: 'select',
                skipUndo: true,
                color: _drawConfig2.default.strokeColor,
                nickname: this.app.nickname
            };
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx) {
            // log('draw', snapshot)
            var color = snapshot.data.color ? snapshot.data.color : 'rgb(0,0,0)';
            this.drawSelectBox(snapshot, ctx);
            var boundaryArr = this.drawSelectedElementBox(snapshot, ctx, color);
            if (!snapshot.data.inProgress && snapshot.uid !== this.app.account && Array.isArray(boundaryArr) && boundaryArr.length === 1) {
                var px = boundaryArr[0].sx + boundaryArr[0].w / 2;
                var py = boundaryArr[0].sy;
                if (!this.app.appConfig.showSelectNickname) return;
                (0, _util.drawUserName)({
                    ctx: ctx,
                    account: snapshot.data.nickname ? snapshot.data.nickname : snapshot.uid,
                    scale: this.app.camera.scale,
                    px: px,
                    py: py,
                    bgColor: color,
                    fontSize: 16,
                    textPadding: 8,
                    radius: 6
                });
            }
        }
        /**
         * 绘制选择框
         */

    }, {
        key: "drawSelectBox",
        value: function drawSelectBox(snapshot, ctx) {
            var data = snapshot.data;
            var sp = void 0;
            var ep = void 0;
            if (Array.isArray(data.points) && data.points.length >= 2) {
                sp = data.points[0];
                ep = data.points[data.points.length - 1];
            } else if (data.sp && data.ep) {
                if (data.sp[0] !== data.ep[0] || data.sp[1] !== data.ep[1]) {
                    sp = data.sp;
                    ep = data.ep;
                }
            }
            if (data.inProgress && sp && ep) {
                var _getBoundaryBoxFromTw = (0, _shapeHelper.getBoundaryBoxFromTwoPoints)(sp, ep),
                    sx = _getBoundaryBoxFromTw.sx,
                    sy = _getBoundaryBoxFromTw.sy,
                    w = _getBoundaryBoxFromTw.w,
                    h = _getBoundaryBoxFromTw.h;

                ctx.beginPath();
                if (this.strokeColor && this.lineWidth) {
                    ctx.strokeStyle = this.strokeColor;
                    ctx.lineWidth = this.lineWidth;
                    ctx.strokeRect(sx, sy, w, h);
                }
                if (this.fillColor) {
                    ctx.fillStyle = this.fillColor;
                    ctx.fillRect(sx, sy, w, h);
                }
            }
        }
        /**
         * 绘制选中元素的包含盒
         * @param snapshot
         * @param ctx
         * @param div
         */

    }, {
        key: "drawSelectedElementBox",
        value: function drawSelectedElementBox(snapshot, ctx, color) {
            var _this2 = this;

            var data = snapshot.data;
            var selectedOpIds = data.selectedOpIds.filter(function (opId) {
                return _this2.drawOpsOfPage[opId];
            });
            var padding = this.eleContainerPadding;
            if (selectedOpIds.length === 0) return;
            var boundaryArr = selectedOpIds.map(function (id) {
                var op = _this2.drawOpsOfPage[id];
                return (0, _shapeHelper.getTransformedBoundary)(op.data.boundary, op.data.dx, op.data.dy, op.data.scaleX, op.data.scaleY);
            });
            /**
             * 若已经松开，则只绘制整体的包含盒
             */
            if (!data.inProgress) {
                boundaryArr = [boundaryArr.reduce(function (b1, b2) {
                    return (0, _shapeHelper.combineBoundary)(b1, b2);
                })];
            }
            //绘制包含盒
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = this.eleContainerWidth;
            var dotSize = 5 / this.app.camera.scale;
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = (0, _getIterator3.default)(boundaryArr), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var boundary = _step.value;

                    ctx.beginPath();
                    ctx.strokeRect(boundary.sx - padding, boundary.sy - padding, boundary.w + padding * 2, boundary.h + padding * 2);
                    //点击包含盒上四个角上的点拉伸图形
                    if (!data.inProgress && this.opsManager.currOp instanceof SelectOp) {
                        ctx.fillRect(boundary.sx - padding - dotSize / 2, boundary.sy - padding - dotSize / 2, dotSize, dotSize);
                        ctx.fillRect(boundary.sx + boundary.w + padding - dotSize / 2, boundary.sy + boundary.h + padding - dotSize / 2, dotSize, dotSize);
                        ctx.fillRect(boundary.sx + boundary.w + padding - dotSize / 2, boundary.sy - padding - dotSize / 2, dotSize, dotSize);
                        ctx.fillRect(boundary.sx - padding - dotSize / 2, boundary.sy + boundary.h + padding - dotSize / 2, dotSize, dotSize);
                    }
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }

            return boundaryArr;
        }
    }, {
        key: "setSelectedOpIds",
        value: function setSelectedOpIds(ids) {
            if (this.selectedOpIds.join(',') !== ids.join(',')) {
                this.emit('event:appState:change', 'selectChange', this.selectedOpIds.slice(), ids.slice());
                this.opsManager.hooks.selectChange.call(this.selectedOpIds.slice(), ids.slice());
                this.selectedOpIds = ids;
                this.dispatch(this.getSnapshot(ids.slice()));
            }
        }
    }, {
        key: "setInProgressSelectedOpIds",
        value: function setInProgressSelectedOpIds(ids) {
            this.inProgressSelectedOpIds = ids.slice();
        }
    }, {
        key: "setLineWidth",
        value: function setLineWidth(width) {
            this.lineWidth = width;
        }
    }, {
        key: "setFillColor",
        value: function setFillColor(color) {
            this.fillColor = color;
        }
    }, {
        key: "setStrokeColor",
        value: function setStrokeColor(color) {
            this.strokeColor = color;
        }
    }, {
        key: "setEleContainerColor",
        value: function setEleContainerColor(color) {
            this.eleContainerColor = color;
        }
    }, {
        key: "setEleContainerWidth",
        value: function setEleContainerWidth(width) {
            this.eleContainerWidth = width;
        }
    }, {
        key: "setEleContainerPadding",
        value: function setEleContainerPadding(padding) {
            this.eleContainerPadding = padding;
        }
    }]);
    return SelectOp;
}(_SelectBase3.default);

exports.default = SelectOp;

/***/ }),

/***/ "./new_src/core/ops/TextOp/TextToolbar.less":
/*!**************************************************!*\
  !*** ./new_src/core/ops/TextOp/TextToolbar.less ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {


var content = __webpack_require__(/*! !../../../../node_modules/css-loader/dist/cjs.js??ref--7-1!../../../../node_modules/postcss-loader/src??postcss!./TextToolbar.less */ "./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/src/index.js?!./new_src/core/ops/TextOp/TextToolbar.less");

if(typeof content === 'string') content = [[module.i, content, '']];

var transform;
var insertInto;



var options = {"hmr":true}

options.transform = transform
options.insertInto = undefined;

var update = __webpack_require__(/*! ../../../../node_modules/style-loader/lib/addStyles.js */ "./node_modules/style-loader/lib/addStyles.js")(content, options);

if(content.locals) module.exports = content.locals;

if(false) {}

/***/ }),

/***/ "./new_src/core/ops/TextOp/TextToolbar.ts":
/*!************************************************!*\
  !*** ./new_src/core/ops/TextOp/TextToolbar.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _config = __webpack_require__(/*! ../../config */ "./new_src/core/config.ts");

var _text = __webpack_require__(/*! ../../misc/text */ "./new_src/core/misc/text.ts");

__webpack_require__(/*! ./TextToolbar.less */ "./new_src/core/ops/TextOp/TextToolbar.less");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ID = 'iower-23nsdf090sd'; /**
                               * 文本编辑框工具栏
                               */

var TextToolbar = function () {
    function TextToolbar() {
        (0, _classCallCheck3.default)(this, TextToolbar);

        this.fontSize = _config.DEFAULT_FONTSIZE;
        this.color = 'black';
        //powerpoint中的字体大小表
        this.fonts = [8, 9, 10, 11, 12, 14, 16, 18, 20, 24, 28, 32, 36, 40, 44, 48, 54, 60, 66, 72, 80, 88];
        this.colors = ['rgb(224,32,32)', 'rgb(250,100,0)', 'rgb(247,181,0)', 'rgb(109,212,0)', 'rgb(68,215,182)', 'rgb(50,197,255)', 'rgb(0,145,255)', 'rgb(98,54,255)', 'rgb(182,32,224)', 'rgb(109,114,120)', 'rgb(0,0,0)', 'rgb(255,255,255)'];
        this.fontInputPrevValue = '';
        this.colorCells = [];
        this.colorPlatteOpen = false;
        this.toolbarContainer = document.createElement('div');
        this.toolbarContainer.className = 'text-toolbar';
        this.toolbarContainer.id = ID;
        //颜色按钮，点击弹出颜色选择弹窗
        this.colorBtn = document.createElement('div');
        this.colorBtn.innerText = '';
        this.colorBtn.className = 'color flex-cell';
        var colorDot = document.createElement('span');
        this.colorBtn.appendChild(colorDot);
        //颜色选择弹窗及弹窗内的元素
        this.colorPlatteContainer = document.createElement('div');
        this.colorPlatteContainer.className = 'platte-container';
        this.colorPlatteContainer.onmousemove = function (ev) {
            ev.stopPropagation();
        };
        for (var i = 0; i < this.colors.length; i++) {
            var colorCell = document.createElement('div');
            colorCell.className = 'color-cell';
            colorCell.style.backgroundColor = this.colors[i];
            var isWhite = this.colors[i] === 'rgb(255,255,255)';
            if (isWhite) {
                colorCell.style.border = '1px solid #D9D9DB';
            }
            this.colorPlatteContainer.appendChild(colorCell);
            this.colorCells.push(colorCell);
        }
        //字体输入框
        this.fontInput = document.createElement('input');
        this.fontInput.className = 'fontsize input';
        //字体增加按钮
        this.fontIncBtn = document.createElement('div');
        this.fontIncBtn.className = 'fontsize inc flex-cell';
        var incText = document.createElement('span');
        incText.innerText = '+';
        this.fontIncBtn.appendChild(incText);
        //字体减小按钮
        this.fontDecBtn = document.createElement('div');
        this.fontDecBtn.className = 'fontsize dec flex-cell';
        var decText = document.createElement('span');
        decText.innerText = '-';
        this.fontDecBtn.appendChild(decText);
        this.toolbarContainer.appendChild(this.fontInput);
        this.toolbarContainer.appendChild(this.fontIncBtn);
        this.toolbarContainer.appendChild(this.fontDecBtn);
        this.toolbarContainer.appendChild(this.colorBtn);
        this.toolbarContainer.appendChild(this.colorPlatteContainer);
        this._registerEvents();
        this._stopPropagation();
    }

    (0, _createClass3.default)(TextToolbar, [{
        key: "show",
        value: function show(args) {
            var left = args.left,
                top = args.top,
                container = args.container,
                fontSize = args.fontSize,
                color = args.color,
                scale = args.scale;

            this.setFontsize(fontSize);
            this.setColor(color);
            if (!document.getElementById(ID)) {
                container.appendChild(this.toolbarContainer);
            }
            this.toolbarContainer.style.display = 'flex';
            this.toolbarContainer.style.transformOrigin = 'left bottom';
            this.toolbarContainer.style.transform = "scale(" + scale + ")";
            this.colorPlatteContainer.style.display = 'none';
            this.updatePosition({
                left: left, top: top
            });
        }
    }, {
        key: "resize",
        value: function resize(scale) {
            this.toolbarContainer.style.transform = "scale(" + scale + ")";
        }
    }, {
        key: "updatePosition",
        value: function updatePosition(args) {
            var left = args.left,
                top = args.top;

            this.toolbarContainer.style.left = left - 23 + "px";
            this.toolbarContainer.style.top = top - 78 + "px";
        }
    }, {
        key: "hide",
        value: function hide() {
            this.toolbarContainer.style.display = 'none';
        }
    }, {
        key: "setFontsize",
        value: function setFontsize(fontSize) {
            this.fontSize = fontSize;
            this.fontInputPrevValue = Math.round(fontSize).toString();
            this.fontInput.value = this.fontInputPrevValue;
        }
    }, {
        key: "setColor",
        value: function setColor(color) {
            this.color = color;
            this.colorBtn.firstChild.style.backgroundColor = this.color;
            this.setColorPlatteState(false);
        }
    }, {
        key: "setColorPlatteState",
        value: function setColorPlatteState(open) {
            this.colorPlatteOpen = open;
            if (open) {
                this.colorPlatteContainer.style.display = 'flex';
            } else {
                this.colorPlatteContainer.style.display = 'none';
            }
        }
        /**
         * 修改字体大小时，调用外界注册的回调函数
         */

    }, {
        key: "onFontSizeChange",
        value: function onFontSizeChange(func) {
            this.fontSizeCb = func;
        }
        /**
         * 修改颜色时，调用外界注册的回调函数
         */

    }, {
        key: "onColorChange",
        value: function onColorChange(func) {
            this.colorCb = func;
        }
    }, {
        key: "_registerEvents",
        value: function _registerEvents() {
            var _this = this;

            var _loop = function _loop(i) {
                _this.colorCells[i].onclick = function (event) {
                    _this.setColor(_this.colors[i]);
                    if (_this.colorCb) {
                        _this.colorCb(_this.color);
                    }
                };
            };

            for (var i = 0; i < this.colorCells.length; i++) {
                _loop(i);
            }
            this.colorBtn.onclick = function (event) {
                _this.setColorPlatteState(!_this.colorPlatteOpen);
            };
            this.fontIncBtn.onclick = function (event) {
                if (_this.fontSize < _text.MAX_FONT_SIZE) {
                    _this._sendFontChangeCommand(Math.min(_this.fontSize + 8, _text.MAX_FONT_SIZE));
                }
            };
            this.fontDecBtn.onclick = function (event) {
                if (_this.fontSize > _text.MIN_FONT_SIZE) {
                    _this._sendFontChangeCommand(Math.max(_this.fontSize - 8, _text.MIN_FONT_SIZE));
                }
            };
            var setFontSizeByInput = function setFontSizeByInput(blurAfterSet) {
                var fontSizeStr = _this.fontInput.value;
                if (fontSizeStr === '') {
                    return;
                } else {
                    var textType = (0, _text.testFontSizeText)(fontSizeStr);
                    var fontSize = void 0;
                    if (textType === 'exceed_max') {
                        fontSize = _text.MAX_FONT_SIZE;
                    } else if (textType === 'exceed_min') {
                        fontSize = _text.MIN_FONT_SIZE;
                    } else {
                        fontSize = Number(fontSizeStr);
                    }
                    _this.fontInput.value = fontSize;
                    _this.fontInputPrevValue = fontSize.toString();
                    _this._sendFontChangeCommand(_this.fontInput.value);
                    if (blurAfterSet) {
                        _this.fontInput.blur();
                    }
                }
            };
            this.fontInput.onkeydown = function (event) {
                event.stopPropagation();
                if (event.key === 'Enter') {
                    setFontSizeByInput(true);
                }
            };
            this.fontInput.onblur = function () {
                setFontSizeByInput(false);
            };
            this.fontInput.oninput = function (event) {
                var text = event.target.value;
                text = text.replace(/\D/g, '');
                _this.fontInput.value = text;
            };
        }
        /**
         * 通过文本框工具栏发送字体变化事件
         * @param text
         */

    }, {
        key: "_sendFontChangeCommand",
        value: function _sendFontChangeCommand(text) {
            var fontSize = typeof text === 'string' ? Number(text) : text;
            this.setFontsize(fontSize);
            if (this.fontSizeCb) {
                this.fontSizeCb(this.fontSize);
            }
        }
        /**
         * 点击文本框按钮的操作不应该传递给上层容器
         */

    }, {
        key: "_stopPropagation",
        value: function _stopPropagation() {
            this.toolbarContainer.onmousedown = function (event) {
                event.stopPropagation();
            };
            this.toolbarContainer.ontouchstart = function (event) {
                event.stopPropagation();
            };
            //mouseup还是往上传，否则如果鼠标在文本框工具栏上松开，应用会以为鼠标一直处于按下状态
            // this.toolbarContainer.onmouseup = (event) => {
            //     event.stopPropagation()
            // }
        }
    }]);
    return TextToolbar;
}();

exports.default = TextToolbar;

/***/ }),

/***/ "./new_src/core/ops/TextOp/UIHelper.ts":
/*!*********************************************!*\
  !*** ./new_src/core/ops/TextOp/UIHelper.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.DEFAULT_LINEHEIGHT = exports.PADDING = exports.MIN_WIDTH = undefined;
exports.createElements = createElements;
exports.setElementsStyle = setElementsStyle;
exports.setElementsSize = setElementsSize;
exports.drawTextSnapshot = drawTextSnapshot;
exports.clearTextArea = clearTextArea;

var _config = __webpack_require__(/*! ../../config */ "./new_src/core/config.ts");

var _textConfig = __webpack_require__(/*! ./textConfig */ "./new_src/core/ops/TextOp/textConfig.ts");

var _textConfig2 = _interopRequireDefault(_textConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var MIN_WIDTH = exports.MIN_WIDTH = 20;
var PADDING = exports.PADDING = 4;
var DEFAULT_LINEHEIGHT = exports.DEFAULT_LINEHEIGHT = 1.2;
//创建一个textArea用于编辑文字
//创建pre用于辅助textArea确定文字的宽，高
function createElements() {
    var textArea = document.createElement('textarea');
    var pre = document.createElement('pre');
    var textAreaContainer = document.createElement('div');
    textAreaContainer.style.position = 'absolute';
    textAreaContainer.style.display = 'none';
    textAreaContainer.style.outline = '1px dashed black';
    // textArea.style.position = 'absolute'
    textArea.style.resize = 'none';
    textArea.style.overflow = 'hidden';
    textArea.style['white-space'] = 'nowrap';
    textArea.style.background = 'transparent';
    //进入编辑模式时才显示textArea
    // textArea.style.display = 'none'
    textArea.style.fontFamily = _textConfig2.default.getFontFamily();
    textArea.style.fontSize = _config.DEFAULT_FONTSIZE + "px";
    textArea.style.transformOrigin = 'left top';
    textArea.style.padding = PADDING + "px";
    textArea.style.border = 'none';
    textArea.style.outline = 'none';
    textArea.style.boxSizing = 'content-box';
    textArea.style.lineHeight = "" + DEFAULT_LINEHEIGHT;
    pre.style.width = 'fit-content';
    pre.style.position = 'absolute';
    pre.style.userSelect = 'none';
    pre.style.pointerEvents = 'none';
    pre.style.visibility = 'hidden';
    pre.style.fontFamily = _textConfig2.default.getFontFamily();
    pre.style.fontSize = _config.DEFAULT_FONTSIZE + "px";
    pre.style.transformOrigin = 'left top';
    pre.style.padding = PADDING + "px";
    pre.style.margin = '0';
    pre.style.lineHeight = "" + DEFAULT_LINEHEIGHT;
    //设置为border-box时，getBoundingClientRect返回pre内容的宽高
    pre.style.boxSizing = 'border-box';
    textAreaContainer.appendChild(textArea);
    return {
        textAreaContainer: textAreaContainer,
        textArea: textArea,
        pre: pre
    };
}
function setElementsStyle(textAreaContainer, textArea, pre, opts) {
    textAreaContainer.style.display = 'block';
    textAreaContainer.style.left = opts.sx + "px";
    textAreaContainer.style.top = opts.sy + "px";
    pre.style.left = opts.sx + "px";
    pre.style.top = opts.sy + "px";
    textArea.style.color = opts.color;
    textArea.style.width = (opts.w || MIN_WIDTH) * _config.DEFAULT_FONTSIZE / opts.fontSize - PADDING * 2 + "px";
    textArea.style.height = (opts.h || opts.fontSize + 12) * _config.DEFAULT_FONTSIZE / opts.fontSize - PADDING * 2 + "px";
    setElementsSize(textAreaContainer, textArea, pre, opts.fontSize);
}
/**
 * 根据fontSize，设置缩放量
 * 由于浏览器有最小字体大小限制，因此textAera使用transform修改字体大小，而不是改变fontSize。
 *
 *
 * 设置文本框，文本框包含盒，以及pre的宽高，及缩放值
 * 先设置pre缩放值和textArea的缩放值。
 * 然后根据pre的宽高，设置textArea的宽高, 以及textAreaContainer的宽高
 * @param textAreaContainer
 * @param textArea
 * @param pre
 * @param fontSize
 */
function setElementsSize(textAreaContainer, textArea, pre, fontSize) {
    pre.style.transform = "scale(" + fontSize / _config.DEFAULT_FONTSIZE + ")";
    textArea.style.transform = "scale(" + fontSize / _config.DEFAULT_FONTSIZE + ")";
    //clientWidth，clientHeight包含了padding
    textArea.style.width = pre.clientWidth - PADDING * 2 + "px";
    textArea.style.height = pre.clientHeight - PADDING * 2 + "px";
    textAreaContainer.style.width = pre.clientWidth * fontSize / _config.DEFAULT_FONTSIZE + "px";
    textAreaContainer.style.height = pre.clientHeight * fontSize / _config.DEFAULT_FONTSIZE + "px";
}
/**
 * 绘制快照
 */
function drawTextSnapshot(pre, opts) {
    pre.innerText = opts.text;
    pre.style.color = opts.color;
    pre.style.left = opts.sx + "px";
    pre.style.top = opts.sy + "px";
    pre.style.position = 'absolute';
    pre.style.fontFamily = _textConfig2.default.getFontFamily();
    pre.style.fontSize = _config.DEFAULT_FONTSIZE + "px";
    pre.style.margin = '0';
    pre.style.transform = "scale(" + opts.fontSize / _config.DEFAULT_FONTSIZE + ")";
    pre.style.userSelect = 'none';
    pre.style.transformOrigin = 'left top';
    pre.style.padding = PADDING + "px";
    pre.style.pointerEvents = 'none';
}
function clearTextArea(textAreaContainer, textArea) {
    textArea.value = '';
    textAreaContainer.style.display = 'none';
}

/***/ }),

/***/ "./new_src/core/ops/TextOp/index.ts":
/*!******************************************!*\
  !*** ./new_src/core/ops/TextOp/index.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _SelectOp = __webpack_require__(/*! ../SelectOp */ "./new_src/core/ops/SelectOp/index.ts");

var _SelectOp2 = _interopRequireDefault(_SelectOp);

var _UIHelper = __webpack_require__(/*! ./UIHelper */ "./new_src/core/ops/TextOp/UIHelper.ts");

var _TextToolbar = __webpack_require__(/*! ./TextToolbar */ "./new_src/core/ops/TextOp/TextToolbar.ts");

var _TextToolbar2 = _interopRequireDefault(_TextToolbar);

var _config = __webpack_require__(/*! ../../config */ "./new_src/core/config.ts");

var _textConfig = __webpack_require__(/*! ./textConfig */ "./new_src/core/ops/TextOp/textConfig.ts");

var _textConfig2 = _interopRequireDefault(_textConfig);

var _text = __webpack_require__(/*! ../../misc/text */ "./new_src/core/misc/text.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 文本操作。
 *
 * 文本有两类模式：
 * 一是判断文本框是否是新的文本框: isNewText
 * 二是判断文本框是否聚焦：isFocus
 *
 * isNewText为false时，快照会包含dependOn，dependOn指向被编辑的文本框opId
 * isFocus为true时，快照的boundary使用this.pre以及鼠标落下的位置计算。为false时，boundary使用快照对应的pre计算。
 *
 * TextOp有两种pre。一种是isFocus时，和textArea内容一一对应的pre，这个pre用于辅助计算内容的宽高。另一种pre是快照pre。文本不处于focus时，使用快照pre绘制。
 *
 *
 *                  点击画布
 * 激活文本模式   -------->>>>>   文本框聚焦(创建模式+正在编辑)  -----
 *                                                                 \     失焦
 *                                                                  -------------> 文本框选中（编辑模式）
 *              点击文本框                                          /
 * 选择模式   --------->>>>>>   文本框聚焦（编辑模式+正在编辑） -----
 *              单选文本框
 *           ---------->>>>>   文本框选中（编辑模式）
 *
 *
 */
var TextOp = function (_Operation) {
    (0, _inherits3.default)(TextOp, _Operation);

    function TextOp(app) {
        (0, _classCallCheck3.default)(this, TextOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (TextOp.__proto__ || (0, _getPrototypeOf2.default)(TextOp)).call(this, app));

        _this.type = 'text';
        _this.dependOn = undefined;
        /**
         * 失焦时间。失焦之后的点击事件会被selectOp忽略。如果不忽略，点击空白区域时，失焦会导致文本框不被选中。
         */
        _this.blurAt = 0;
        _this.color = 'black';
        _this.text = '';
        _this.textBeforeEdit = '';
        _this.fontSize = _config.DEFAULT_FONTSIZE;
        _this.isFocus = false;
        _this.isNewText = true;
        _this.description = "绘制文字\n首先使用op:text:activate设置画布为文字模式。" + "通过op:text:color, op:text:fontSize, 设置文字的颜色和字体大小。然后画布会监听鼠标动作，生成文本框。具体用法如下：";
        /**
         * 文本修改时，利用pre计算textArea的宽，高
         */
        _this.handleTextAreaChange = function (event) {
            var text = event.target.value;
            if (text.endsWith("\n")) {
                text += "\n";
            }
            _this.text = text;
            _this.pre.innerText = text || ' ';
            /**
             * 这里不需要设置scale。因为pre.clientWidth * pre.scale === textArea.width * textArea.scale
             */
            (0, _UIHelper.setElementsSize)(_this.textAreaContainer, _this.textArea, _this.pre, _this.fontSize);
            _this.dispatch(_this.getSnapshot(true));
        };
        _this.handleTextAreaBlur = function (event) {
            setTimeout(function () {
                /**
                 * 失焦函数处理时，如果页面和聚焦时的页面不同，则无需进一步处理
                 */
                if (_this.opsManager.currPage !== _this.textFocusAtPage) {
                    return;
                }
                _this._handleTextAreaBlur();
            }, 0);
        };
        _this._handleTextAreaBlur = function () {
            /**
             * 重置文本
             */
            var opId = _this.opIdToDraw;
            /**
             * 如果这次编辑未修改文本，则视为无效编辑，undo操作不会对其做出反应
             */
            _this.dispatch(_this.getSnapshot(false, _this.text === _this.textBeforeEdit));
            _this.isFocus = false;
            _this.text = ' ';
            (0, _UIHelper.clearTextArea)(_this.textAreaContainer, _this.textArea);
            /**
             * 若文本框为空，则不选中任何图形
             * 若文本框不为空，则选中该文本框
             *
             * 若blur是由click事件引发的，设置currOp为selectOp后，blur之后selectOp会接收click事件
             * 而点击空白区域的click事件会导致选中元素清空。
             *
             * 为了点击空白区域仍旧会选中文本框，记录blur的时间点，然后再selectlOp中会判断是不是这次点击是在blur事件之后，
             * 如果是在之后，且点击处空白，则忽略这次点击事件
             */
            _this.blurAt = new Date().valueOf();
            _this.opsManager.setCurrOp('select');
            _this.opsManager.selectOp.dispatch(_this.opsManager.selectOp.getSnapshot([opId]));
        };
        _this.registerToolbar(new _TextToolbar2.default());

        var _createElements = (0, _UIHelper.createElements)(),
            textAreaContainer = _createElements.textAreaContainer,
            textArea = _createElements.textArea,
            pre = _createElements.pre;

        _this.textAreaContainer = textAreaContainer;
        _this.textArea = textArea;
        _this.pre = pre;
        _this.app.on('container:set', function () {
            _this.app.container.textAreaEl.appendChild(textAreaContainer);
            _this.app.container.textAreaEl.appendChild(pre);
        });
        _this.app.on('container:resize', function () {
            var _a;
            (_a = _this.toolbar) === null || _a === void 0 ? void 0 : _a.resize(1 / _this.app.camera.scale);
        });
        _this.textArea.oninput = _this.handleTextAreaChange;
        _this.textArea.onblur = _this.handleTextAreaBlur;
        //TODO: 统一textArea，pre宽高更新的函数
        (0, _UIHelper.setElementsSize)(_this.textAreaContainer, _this.textArea, _this.pre, _this.fontSize);
        return _this;
    }

    (0, _createClass3.default)(TextOp, [{
        key: "registerHooks",
        value: function registerHooks() {
            this.opsManager.hooks.prePageChange.tap('PrePageChange', this.handlePrePageChange.bind(this));
            this.opsManager.hooks.click.tap("ClickPlugin", this.handleClickExistText.bind(this));
            this.opsManager.hooks.selectChange.tap('SelectChangePlugin', this.handleSelectChange.bind(this));
            this.opsManager.hooks.enableDrawChange.tap('EnableDrawChange', this.handleEnableDrawChange.bind(this));
        }
        /**
         * 根据board id, page id得到id前缀
         */

    }, {
        key: "getIdPrefix",
        value: function getIdPrefix(boardName, pageIndex) {
            return (boardName + "-" + pageIndex).replace(/[\W_]+/g, '-');
        }
        /**
         * 返回当前编辑的文本框对应的opId。
         * 若状态为新建，则直接返回opId
         * 若状态为编辑旧文本框，返回旧文本框的opId
         */

    }, {
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                activate: {
                    value: true,
                    information: {
                        event: "op:" + this.type + ":activate",
                        args: '',
                        message: "\u8BBE\u7F6E\u5DE5\u5177\u680F\u72B6\u6001\u4E3A\uFF1A" + this.type
                    }
                },
                'register:toolbar': {
                    value: this.registerToolbar.bind(this),
                    information: {
                        args: 'toolbar: IToolbar',
                        message: '自定义工具栏'
                    }
                },
                'text:color': {
                    value: this.setColor.bind(this),
                    information: {
                        args: 'color: string',
                        message: "\u8BBE\u7F6E\u6587\u672C\u989C\u8272"
                    }
                },
                'text:fontsize': {
                    value: this.setFontSize.bind(this),
                    information: {
                        args: 'size: number',
                        message: "\u8BBE\u7F6E\u77E9\u5F62\u8FB9\u6846\u989C\u8272"
                    }
                }
            };
        }
        /**
         * 页面切换时，如果文本处于聚焦状态，先使其失焦
         */

    }, {
        key: "handlePrePageChange",
        value: function handlePrePageChange() {
            if (this.isFocus) {
                this._handleTextAreaBlur();
            }
        }
    }, {
        key: "handleEnableDrawChange",
        value: function handleEnableDrawChange(editEnabled) {
            var _a, _b;
            if (!editEnabled) {
                (_a = this.toolbar) === null || _a === void 0 ? void 0 : _a.hide();
            } else {
                var selectedOpIds = this.opsManager.selectedOpIds;
                var currSelectTextId = selectedOpIds.length === 1 && this.getOpTypeByOpId(selectedOpIds[0]) === 'text' ? selectedOpIds[0] : undefined;
                if (currSelectTextId && this.opsManager.currOp instanceof _SelectOp2.default) {
                    return this._handleSelectTextOp(currSelectTextId);
                } else {
                    (_b = this.toolbar) === null || _b === void 0 ? void 0 : _b.hide();
                }
            }
        }
        /**
         * 文本框单独被选中时，弹出工具栏
         */

    }, {
        key: "handleSelectChange",
        value: function handleSelectChange(preSelectedOpIds, selectedOpIds) {
            var _a;
            var preSelectTextId = preSelectedOpIds.length === 1 && this.getOpTypeByOpId(preSelectedOpIds[0]) === 'text' ? preSelectedOpIds[0] : undefined;
            var currSelectTextId = selectedOpIds.length === 1 && this.getOpTypeByOpId(selectedOpIds[0]) === 'text' ? selectedOpIds[0] : undefined;
            if (preSelectTextId !== currSelectTextId) {
                if (currSelectTextId && this.opsManager.currOp instanceof _SelectOp2.default) {
                    return this._handleSelectTextOp(currSelectTextId);
                }
            }
            (_a = this.toolbar) === null || _a === void 0 ? void 0 : _a.hide();
        }
    }, {
        key: "_handleSelectTextOp",
        value: function _handleSelectTextOp(currSelectTextId) {
            var _a;
            //选中文本框
            var data = this.drawOpsOfPage[currSelectTextId].data;
            var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
            this.color = data.color, this.fontSize = data.fontSize;
            this.text = data.text;
            this.isFocus = false;
            (0, _UIHelper.clearTextArea)(this.textAreaContainer, this.textArea);
            this.isNewText = false;
            this.lastSnapshotData = data;
            this.dependOn = currSelectTextId;
            return (_a = this.toolbar) === null || _a === void 0 ? void 0 : _a.show({
                left: boundary.sx,
                top: boundary.sy,
                container: this.app.container.textAreaEl,
                fontSize: data.fontSize,
                scale: 1 / this.app.camera.scale,
                color: data.color
            });
        }
        /**
         * 处于选择模式下，点击已有文本，开始编辑模式。
         */

    }, {
        key: "handleClickExistText",
        value: function handleClickExistText(event, mx, my) {
            var _a, _b;
            if (this.opsManager.currOp instanceof _SelectOp2.default) {
                var lastSnapshot = this.detectIfClickOnText(mx, my);
                //点击已有文本
                if (lastSnapshot) {
                    //编辑文本框时，没有任何元素被应该被选中
                    if (this.opsManager.selectedOpIds.length > 0) {
                        this.opsManager.currOp.dispatch(this.opsManager.currOp.getSnapshot([]));
                    }
                    this.opsManager.setCurrOp('text');
                    //移除之前绘制的文本框
                    var tempPre = document.getElementById(this.getIdPrefix(lastSnapshot.board, lastSnapshot.page.toString()) + "-" + lastSnapshot.opId + "-pre");
                    (_a = tempPre === null || tempPre === void 0 ? void 0 : tempPre.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(tempPre);
                    var data = lastSnapshot.data;
                    this.isFocus = true;
                    this.textFocusAtPage = this.opsManager.currPage;
                    this.isNewText = false;
                    this.lastSnapshotData = data;
                    this.dependOn = lastSnapshot.opId;
                    this.text = data.text;
                    this.textBeforeEdit = this.text;
                    this.textArea.value = this.text;
                    this.pre.innerText = this.text;
                    this.fontSize = data.fontSize;
                    this.color = data.color;
                    var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
                    (0, _UIHelper.setElementsStyle)(this.textAreaContainer, this.textArea, this.pre, (0, _assign2.default)({ fontSize: data.fontSize, color: data.color }, boundary));
                    (_b = this.toolbar) === null || _b === void 0 ? void 0 : _b.show({
                        left: boundary.sx,
                        top: boundary.sy,
                        container: this.app.container.textAreaEl,
                        fontSize: data.fontSize,
                        scale: 1 / this.app.camera.scale,
                        color: data.color
                    });
                    this.textArea.focus();
                    this.beginBatch();
                    return true;
                }
            }
        }
        /**
         * 当用户点击速度很慢时，会触发mouseup来创建文本
         */

    }, {
        key: "handleMouseUp",
        value: function handleMouseUp(event, mx, my) {
            if (this.isMouseDown) {
                this.handleClick(event, mx, my);
            }
        }
    }, {
        key: "handleMouseMove",
        value: function handleMouseMove(event) {
            if (!this.isFocus) {
                if (this.app.container.isTargetOnContainer(event.target)) {
                    document.body.style.cursor = 'text';
                } else {
                    document.body.style.cursor = 'auto';
                }
            } else {
                document.body.style.cursor = 'auto';
            }
        }
        /**
         * 点击空白处创建一个空白版
         */

    }, {
        key: "handleClick",
        value: function handleClick(event, mx, my) {
            var _a;
            if (!this.isFocus) {
                //创建新文本
                this.isNewText = true;
                this.isFocus = true;
                this.textFocusAtPage = this.opsManager.currPage;
                this.dependOn = undefined;
                this.text = ' ';
                this.textBeforeEdit = this.text;
                this.pre.innerText = this.text;
                (0, _UIHelper.setElementsStyle)(this.textAreaContainer, this.textArea, this.pre, {
                    fontSize: this.fontSize,
                    color: this.color,
                    sx: mx,
                    sy: my
                });
                this.beginBatch();
                (_a = this.toolbar) === null || _a === void 0 ? void 0 : _a.show({
                    left: mx,
                    top: my,
                    container: this.app.container.textAreaEl,
                    fontSize: this.fontSize,
                    scale: 1 / this.app.camera.scale,
                    color: this.color
                });
                this.textArea.focus();
            }
        }
    }, {
        key: "getSnapshot",
        value: function getSnapshot(inProgress) {
            var skipUndo = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

            if (this.isNewText) {
                return {
                    boundary: this.getBoundaryRect(this.isNewText),
                    type: this.type,
                    color: this.color,
                    text: this.text,
                    fontSize: this.fontSize,
                    inProgress: inProgress,
                    skipUndo: inProgress || skipUndo
                };
            } else {
                /**
                 * EditText中得到的boundary已经包含了之前操作的转换结果。
                 */
                return {
                    type: this.type,
                    color: this.color,
                    text: this.text,
                    fontSize: this.fontSize,
                    boundary: this.getBoundaryRect(this.isNewText),
                    dependOn: this.dependOn,
                    inProgress: inProgress,
                    skipUndo: inProgress || skipUndo
                };
            }
        }
        /**
         * 若处于编辑状态，使用this.pre，否则使用被选择的pre
         */

    }, {
        key: "getBoundaryRect",
        value: function getBoundaryRect(isNewText) {
            var rect = this.workingPre.getBoundingClientRect();
            var w = rect.width;
            var h = rect.height;
            w = w / this.app.camera.scale;
            h = h / this.app.camera.scale;
            var ptsInWord = void 0;
            if (isNewText) {
                var sx = rect.x - this.app.container.left;
                var sy = rect.y - this.app.container.top;
                ptsInWord = this.app.camera.convertToPointInWorld(sx, sy);
            } else {
                /**
                 * ios上不能用rect.y - this.app.container.top确定sy。
                 * https://openradar.appspot.com/radar?id=6668472289329152
                 *
                 * ios上如果容器有fixed，且键盘将webview向上推时，getBoundingClientRect的top值是错误的。
                 *
                 * 由于ios上暂时不支持创建文本。编辑旧文本时，文本的sx，sy又不会变化，因此，可以用之前快照的
                 * sx，sy来确定位置。
                 */
                var data = this.lastSnapshotData;
                var _rect = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
                ptsInWord = [_rect.sx, _rect.sy];
            }
            return {
                sx: ptsInWord[0],
                sy: ptsInWord[1],
                w: w, h: h
            };
        }
    }, {
        key: "draw",
        value: function draw(snapshot, ctx, opts) {
            var div = opts.div;
            /**
             * 只有当文本模式下正在编辑，且该快照是正被编辑的快照，才跳过绘制。
             */
            var snapshotIsEditing = snapshot.opId === this.dependOn || snapshot.opId === this.opIdToDraw;
            if (!this.isFocus || !snapshotIsEditing) {
                var boardName = this.app.room.currIndex;
                var pageIndex = this.app.room.currBoard.currIndex;
                var preId = this.getIdPrefix(boardName, pageIndex.toString()) + "-" + snapshot.opId + "-pre";
                if (!div.querySelector("[id='" + preId + "']")) {
                    var temp = document.createElement('pre');
                    temp.style.lineHeight = "" + _UIHelper.DEFAULT_LINEHEIGHT;
                    temp.id = preId;
                    div.appendChild(temp);
                }
                var pre = div.querySelector("[id='" + preId + "']");
                if (pre) {
                    this.drawSnapshot(snapshot.data, pre, snapshot.opId);
                } else {
                    console.error('DEV-->', "\u627E\u4E0D\u5230id\u4E3A: " + preId + " \u7684pre");
                }
            }
        }
        //在预览中绘制，不能依赖于pre

    }, {
        key: "preview",
        value: function preview(snapshot, ctx) {
            var data = snapshot.data;
            var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
            var sx = boundary.sx,
                sy = boundary.sy;

            var paddingScale = _UIHelper.PADDING * data.fontSize / _config.DEFAULT_FONTSIZE;
            ctx.save();
            ctx.fillStyle = data.color;
            ctx.font = data.fontSize + "px " + _textConfig2.default.getFontFamily();
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            (0, _text.printTextInMultiLine)(ctx, data.text, sx + paddingScale, sy + paddingScale * 2, data.fontSize * _UIHelper.DEFAULT_LINEHEIGHT);
            // ctx.fillText(data.text, sx + paddingScale, sy + paddingScale)
            ctx.restore();
        }
    }, {
        key: "hide",
        value: function hide(snapshot, ctx, div) {
            var _a;
            //移除之前绘制的文本框
            var tempPre = document.getElementById(this.getIdPrefix(snapshot.board, snapshot.page.toString()) + "-" + snapshot.opId + "-pre");
            (_a = tempPre === null || tempPre === void 0 ? void 0 : tempPre.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(tempPre);
        }
    }, {
        key: "drawSnapshot",
        value: function drawSnapshot(data, pre, opId) {
            var _a, _b, _c;
            var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
            var sx = boundary.sx,
                sy = boundary.sy;

            (0, _UIHelper.drawTextSnapshot)(pre, {
                text: data.text,
                sx: sx,
                sy: sy,
                fontSize: data.fontSize,
                color: data.color
            });
            //选中的文本框位置更新时，更新工具栏位置
            if (this.opsManager.selectedOpIds.length === 1 && this.opsManager.selectedOpIds[0] === opId) {
                this.fontSize = data.fontSize;
                this.color = data.color;
                (_a = this.toolbar) === null || _a === void 0 ? void 0 : _a.setFontsize(data.fontSize);
                (_b = this.toolbar) === null || _b === void 0 ? void 0 : _b.setColor(data.color);
                (_c = this.toolbar) === null || _c === void 0 ? void 0 : _c.updatePosition({
                    left: sx,
                    top: sy
                });
            }
        }
    }, {
        key: "detectIfClickOnText",
        value: function detectIfClickOnText(mx, my) {
            for (var opId in this.drawOpsOfPage) {
                if (this.drawOpsOfPage[opId].data.type !== 'text') {
                    continue;
                } else {
                    var data = this.drawOpsOfPage[opId].data;
                    var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
                    if ((0, _shapeHelper.pointInRect)(boundary, [mx, my])) {
                        return this.drawOpsOfPage[opId];
                    }
                }
            }
            return undefined;
        }
    }, {
        key: "setFontSize",
        value: function setFontSize(fontSize) {
            if (this.fontSize !== fontSize) {
                this.fontSize = fontSize;
                this.isNewText = false;
                this.lastSnapshotData = this.drawOpsOfPage[this.dependOn].data;
                this.text = this.lastSnapshotData.text;
                (0, _UIHelper.setElementsSize)(this.textAreaContainer, this.textArea, this.workingPre, this.fontSize);
                this.dispatch(this.getSnapshot(false));
            }
        }
    }, {
        key: "setColor",
        value: function setColor(color) {
            if (this.color !== color) {
                this.color = color;
                this.isNewText = false;
                this.lastSnapshotData = this.drawOpsOfPage[this.dependOn].data;
                this.text = this.lastSnapshotData.text;
                this.dispatch(this.getSnapshot(false));
            }
        }
    }, {
        key: "registerToolbar",
        value: function registerToolbar(toolbar) {
            this.toolbar = toolbar;
            this.toolbar.onFontSizeChange(this.setFontSize.bind(this));
            this.toolbar.onColorChange(this.setColor.bind(this));
        }
        /**
         * 转换关联的绘制类Op的快照图
         */

    }, {
        key: "transformOp",
        value: function transformOp(baseOp, _transformOp) {
            var textOpSnapshot = _transformOp.data;
            var newData = (0, _assign2.default)({}, baseOp.data);
            for (var key in textOpSnapshot) {
                if (key !== 'dependOn') {
                    newData[key] = textOpSnapshot[key];
                }
            }
            /**
             * EditText的boundary已经将之前编辑操作的结果包含进去了。
             */
            newData.dx = 0;
            newData.dy = 0;
            newData.scaleX = {
                coordinate: 0,
                factor: 1
            };
            newData.scaleY = {
                coordinate: 0,
                factor: 1
            };
            var res = (0, _assign2.default)({}, baseOp, {
                data: newData
            });
            return res;
        }
        /**
         * 更新textArea和pre的字体
         */

    }, {
        key: "updateFontFamily",
        value: function updateFontFamily() {
            var txts = this.app.container.el.getElementsByTagName('textarea');
            var pres = this.app.container.el.getElementsByTagName('pre');
            for (var i = 0; i < txts.length; i++) {
                txts[i].style.fontFamily = _textConfig2.default.getFontFamily();
            }
            for (var _i = 0; _i < pres.length; _i++) {
                pres[_i].style.fontFamily = _textConfig2.default.getFontFamily();
            }
        }
    }, {
        key: "opIdToDraw",
        get: function get() {
            if (this.isNewText) {
                return this.opIdForseen(this.type, this.dependOn);
            } else {
                return this.dependOn;
            }
        }
        /**
         * 当前编辑是作用于哪个pre上面
         */

    }, {
        key: "workingPre",
        get: function get() {
            if (this.isFocus) {
                //编辑模式
                return this.pre;
            } else {
                var boardName = this.app.room.currIndex;
                var pageIndex = this.app.room.currBoard.currIndex.toString();
                return document.getElementById(this.getIdPrefix(boardName, pageIndex) + "-" + this.dependOn + "-pre");
            }
        }
    }]);
    return TextOp;
}(_Operation3.default);

exports.default = TextOp;

/***/ }),

/***/ "./new_src/core/ops/TextOp/textConfig.ts":
/*!***********************************************!*\
  !*** ./new_src/core/ops/TextOp/textConfig.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.DefaultFontName = exports.CustomFontName = undefined;

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var CustomFontName = exports.CustomFontName = "customWBFont";
var DefaultFontName = exports.DefaultFontName = "defaultWBFont";
var ValidTypes = ['embedded-opentype', 'woff', 'truetype', 'svg', 'opentype', 'woff2'];

var TextConfig = function () {
    function TextConfig() {
        (0, _classCallCheck3.default)(this, TextConfig);

        this.fontFamily = '';
        this.fontFaceSet = false;
        this.appendFontFaceStyle([{
            url: 'https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.ttf',
            format: 'truetype'
        }, {
            url: 'https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.woff',
            format: 'woff'
        }, {
            url: 'https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.woff2',
            format: 'woff2'
        }], DefaultFontName);
    }

    (0, _createClass3.default)(TextConfig, [{
        key: "getFontFamily",
        value: function getFontFamily() {
            if (this.fontFamily && this.fontFaceSet) {
                return "\"" + this.fontFamily + "\", \"" + CustomFontName + "\"";
            } else if (this.fontFamily) {
                return this.fontFamily;
            } else if (this.fontFaceSet) {
                return CustomFontName;
            } else {
                return "\"Helvetica\", \"" + DefaultFontName + "\"";
            }
        }
    }, {
        key: "setFontFamily",
        value: function setFontFamily(fontFamily) {
            this.fontFamily = fontFamily;
        }
    }, {
        key: "setFontFace",
        value: function setFontFace(fontFace) {
            this.fontFaceSet = true;
            this.appendFontFaceStyle(fontFace, CustomFontName);
        }
    }, {
        key: "appendFontFaceStyle",
        value: function appendFontFaceStyle(fontFace, fontName) {
            var fontFaceStr = fontFace.map(function (opt) {
                if (opt.format && !ValidTypes.includes(opt.format)) {
                    console.error("\u5B57\u4F53format\u5E94\u8BE5\u4E3A\u4EE5\u4E0B\u503C\u4E2D\u7684\u4E00\u4E2A: " + ValidTypes.join(',') + ", \u6216\u8005\u4E0D\u8BBE\u7F6Eformat");
                    return "url(\"" + opt.url + "\")";
                } else if (opt.format) {
                    return "url(\"" + opt.url + "\") format(\"" + opt.format + "\")";
                } else {
                    return "url(\"" + opt.url + "\")";
                }
            }).join(',\n');
            var newStyle = document.createElement('style');
            newStyle.setAttribute('type', 'text/css');
            newStyle.appendChild(document.createTextNode("\n@font-face {\n    font-family: \"" + fontName + "\";\n    src: " + fontFaceStr + ";\n}\n"));
            document.head.appendChild(newStyle);
        }
    }]);
    return TextConfig;
}();

var textConfig = new TextConfig();
exports.default = textConfig;

/***/ }),

/***/ "./new_src/core/ops/VideoOp/index.ts":
/*!*******************************************!*\
  !*** ./new_src/core/ops/VideoOp/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Operation2 = __webpack_require__(/*! ../Operation */ "./new_src/core/ops/Operation.ts");

var _Operation3 = _interopRequireDefault(_Operation2);

var _shapeHelper = __webpack_require__(/*! ../../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

var _resourceCache = __webpack_require__(/*! ../../resource/resourceCache */ "./new_src/core/resource/resourceCache.ts");

var _util = __webpack_require__(/*! ../ImageOp/util */ "./new_src/core/ops/ImageOp/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 视频
 */
var VideoOp = function (_Operation) {
    (0, _inherits3.default)(VideoOp, _Operation);

    function VideoOp() {
        (0, _classCallCheck3.default)(this, VideoOp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (VideoOp.__proto__ || (0, _getPrototypeOf2.default)(VideoOp)).apply(this, arguments));

        _this.type = 'video';
        _this.description = "视频操作";
        return _this;
    }

    (0, _createClass3.default)(VideoOp, [{
        key: "eventsToListen",
        value: function eventsToListen() {
            return {
                'video:insert': {
                    value: this.addVideo.bind(this),
                    information: {
                        args: "url: string, opts: {\n                         width: number,\n                         pageIndex?: number\n                     }",
                        message: "\u4E0A\u4F20\u89C6\u9891"
                    }
                }
            };
        }
    }, {
        key: "addVideo",
        value: function addVideo(url, opts) {
            var _this2 = this;

            var currBoard = this.app.room.currBoard;
            var currPage = this.opsManager.currPage;
            if (opts && opts.hasOwnProperty('pageIndex')) {
                var pageName = currBoard.pageNames[opts.pageIndex];
                if (currBoard.pages.hasOwnProperty(pageName)) {
                    currPage = currBoard.pages[pageName];
                }
            }
            if ((0, _resourceCache.videoResourceLoaded)(url)) {
                var video = (0, _resourceCache.getVideoResource)(url);
                var width = (opts === null || opts === void 0 ? void 0 : opts.width) ? opts.width : video.videoWidth;
                var height = width / video.videoWidth * video.videoHeight;
                this.dispatchVideo({ url: url, width: width, height: height, page: currPage });
            } else {
                currPage.addWaitingResource(url);
                (0, _resourceCache.fetchVideoResource)(url, function (video) {
                    var width = (opts === null || opts === void 0 ? void 0 : opts.width) ? opts.width : video.videoWidth;
                    var height = width / video.videoWidth * video.videoHeight;
                    _this2.dispatchVideo({ url: url, width: width, height: height, page: currPage });
                    currPage.removeWaitingResource(url);
                });
            }
        }
    }, {
        key: "dispatchVideo",
        value: function dispatchVideo(opt) {
            var _getImageProperPositi = (0, _util.getImageProperPosition)(this, opt.width, opt.height),
                sx = _getImageProperPositi.sx,
                sy = _getImageProperPositi.sy,
                width = _getImageProperPositi.width,
                height = _getImageProperPositi.height;

            this.dispatch({
                type: this.type,
                url: opt.url,
                boundary: {
                    w: width,
                    h: height,
                    sx: sx,
                    sy: sy
                }
            });
        }
    }, {
        key: "preview",
        value: function preview() {}
    }, {
        key: "draw",
        value: function draw(snapshot, ctx, opts) {
            /**
             * page是该图片的容器页面。this.opsManager.currPage是当前打开的页面。
             * 生成预览图时，currPage和图片的容器页面不是同一个页面
             */
            var data = snapshot.data;
            var boundary = (0, _shapeHelper.getTransformedBoundary)(data.boundary, data.dx, data.dy, data.scaleX, data.scaleY);
            var div = this.app.container.el;
            var url = data.url;
            if ((0, _resourceCache.videoResourceLoaded)(url) && div) {
                var video = div.querySelector("[id='video-" + snapshot.opId + "']");
                if (!video) {
                    video = (0, _resourceCache.getVideoResource)(url).cloneNode(true);
                    video.id = "video-" + snapshot.opId;
                    video.style.userSelect = 'none';
                    video.style.position = 'absolute';
                    video.controls = true;
                    video.controlsList.value = "nodownload nofullscreen";
                    video.playsInline = true;
                    video.disablePictureInPicture = true;
                    div.appendChild(video);
                }
                /**
                 * 将视频加载在container顶层容器中。顶层容器没有用scale。不会影响video控制按钮的功能
                 */

                var _app$camera$convertWo = this.app.camera.convertWorldPointInContainer(boundary.sx, boundary.sy),
                    _app$camera$convertWo2 = (0, _slicedToArray3.default)(_app$camera$convertWo, 2),
                    sx = _app$camera$convertWo2[0],
                    sy = _app$camera$convertWo2[1];

                var _app$camera$convertWo3 = this.app.camera.convertWorldPointInContainer(boundary.sx + boundary.w, boundary.sy + boundary.h),
                    _app$camera$convertWo4 = (0, _slicedToArray3.default)(_app$camera$convertWo3, 2),
                    ex = _app$camera$convertWo4[0],
                    ey = _app$camera$convertWo4[1];

                video.style.width = ex - sx + "px";
                video.style.height = ey - sy + "px";
                video.style.left = sx + "px";
                video.style.top = sy + "px";
            }
            if (!(0, _resourceCache.videoResourceLoaded)(url)) {
                //回调函数中必须用变量currPage，而不是this.opsManager.currPage，否则被调用时引用的page可能不对
                opts.page.addWaitingResource(url);
                (0, _resourceCache.fetchVideoResource)(url, function () {
                    opts.page.removeWaitingResource(url);
                });
            }
        }
    }, {
        key: "hide",
        value: function hide(snapshot, ctx, div) {
            var _a;
            //移除之前绘制的文本框
            div = this.app.container.el;
            var video = div.querySelector("[id='video-" + snapshot.opId + "']");
            (_a = video === null || video === void 0 ? void 0 : video.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(video);
        }
    }]);
    return VideoOp;
}(_Operation3.default);

exports.default = VideoOp;

/***/ }),

/***/ "./new_src/core/ops/types.ts":
/*!***********************************!*\
  !*** ./new_src/core/ops/types.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});
/**
 * 不处于常规处理流程的快照类型，即该快照不会被撤销，重做，清空等等
 *
 * 主要包括ppt转码的图片，h5, video等等
 */
var snapshotOutOfNormalFlowTypes = exports.snapshotOutOfNormalFlowTypes = ['background', 'pan', 'zoom', 'mouse-pointer', 'select', 'laser', 'camera-bound'];
/**
 * 会影响房间内所有白板的动作
 */
var globalSnapshotTypes = exports.globalSnapshotTypes = ['camera-bound'];
var cameraSnapshotTypes = exports.cameraSnapshotTypes = ['pan', 'zoom', 'camera-bound', 'reset-camera', 'fit-to-content', 'fit-to-doc', 'resize-camera'];

/***/ }),

/***/ "./new_src/core/ops/util.ts":
/*!**********************************!*\
  !*** ./new_src/core/ops/util.ts ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.drawUserName = exports.roundRect = exports.arrayDeduce = exports.idsChanged = exports.snapshotSelectable = exports.findOpsUnderMouse = exports.findOpsUnderRect = undefined;

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _shapeHelper = __webpack_require__(/*! ../misc/shapeHelper */ "./new_src/core/misc/shapeHelper.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
* 返回起始点到终点围成的矩形中的快照id数组
*/
var findOpsUnderRect = exports.findOpsUnderRect = function findOpsUnderRect(points, drawOps) {
    if (points.length === 0) return [];
    var mouseBoundary = (0, _shapeHelper.getBoundaryBoxFromTwoPoints)(points[0], points[points.length - 1]);
    var res = [];
    for (var opId in drawOps) {
        var snapshot = drawOps[opId];
        if (snapshot.data.boundary && snapshotSelectable(snapshot)) {
            var boundary = (0, _shapeHelper.getTransformedBoundary)(snapshot.data.boundary, snapshot.data.dx, snapshot.data.dy, snapshot.data.scaleX, snapshot.data.scaleY);
            if ((0, _shapeHelper.rectCollide)(boundary, mouseBoundary)) {
                res.push(opId);
            }
        }
    }
    return res;
};
/**
 * 返回在终点下面的快照id。仅返回一个就好了。否则相互重叠元素永远分不开
 */
var findOpsUnderMouse = exports.findOpsUnderMouse = function findOpsUnderMouse(points, drawOps, opsManager) {
    if (points.length === 0) return [];
    var mouseBoundary = (0, _shapeHelper.getBoundaryBoxFromTwoPoints)(points[0], points[points.length - 1]);

    var _points = (0, _slicedToArray3.default)(points[points.length - 1], 2),
        mx = _points[0],
        my = _points[1];

    var opIds = (0, _keys2.default)(drawOps);
    for (var i = opIds.length - 1; i >= 0; i--) {
        /**
         * 最后画的元素最先进行判定
         */
        var snapshot = drawOps[opIds[i]];
        var op = opsManager.opMap[snapshot.data.type];
        if (snapshot.data.boundary && snapshotSelectable(snapshot)) {
            var boundary = (0, _shapeHelper.getTransformedBoundary)(snapshot.data.boundary, snapshot.data.dx, snapshot.data.dy, snapshot.data.scaleX, snapshot.data.scaleY);
            if ((0, _shapeHelper.rectCollide)(boundary, mouseBoundary)) {
                if (op && 'ifMouseOnOp' in op) {
                    //先检测矩阵是否碰撞，如果碰撞，再进一步检查鼠标是否再图形上
                    if (op.ifMouseOnOp(snapshot, mx, my)) {
                        return [opIds[i]];
                    }
                } else {
                    return [opIds[i]];
                }
            }
        }
    }
    return [];
};
var nonSelectableOpTypes = ['mouse-pointer', 'eraser'];
var snapshotSelectable = exports.snapshotSelectable = function snapshotSelectable(snapshot) {
    return !nonSelectableOpTypes.includes(snapshot.data.type) && !snapshot.data.locked;
};
/**
 * 判断数组是否变化
 * @param currIds
 * @param lastIds
 */
var idsChanged = exports.idsChanged = function idsChanged(currIds, lastIds) {
    if (currIds.length !== lastIds.length) return true;
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = (0, _getIterator3.default)(currIds), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var id = _step.value;

            if (lastIds.indexOf(id) === -1) return true;
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }

    return false;
};
/**
 * 返回currIds - lastIds
 * @param currIds
 * @param lastIds
 */
var arrayDeduce = exports.arrayDeduce = function arrayDeduce(currIds, lastIds) {
    var res = [];
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
        for (var _iterator2 = (0, _getIterator3.default)(currIds), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var id = _step2.value;

            if (lastIds.indexOf(id) === -1) {
                res.push(id);
            }
        }
    } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
                _iterator2.return();
            }
        } finally {
            if (_didIteratorError2) {
                throw _iteratorError2;
            }
        }
    }

    return res;
};
/**
 * Draws a rounded rectangle using the current state of the canvas.
 * If you omit the last three params, it will draw a rectangle
 * outline with a 5 pixel border radius
 * @param {CanvasRenderingContext2D} ctx
 * @param {Number} x The top left x coordinate
 * @param {Number} y The top left y coordinate
 * @param {Number} width The width of the rectangle
 * @param {Number} height The height of the rectangle
 * @param {Number} [radius = 5] The corner radius; It can also be an object
 *                 to specify different radii for corners
 * @param {Number} [radius.tl = 0] Top left
 * @param {Number} [radius.tr = 0] Top right
 * @param {Number} [radius.br = 0] Bottom right
 * @param {Number} [radius.bl = 0] Bottom left
 * @param {Boolean} [fill = false] Whether to fill the rectangle.
 * @param {Boolean} [stroke = true] Whether to stroke the rectangle.
 */
var roundRect = exports.roundRect = function roundRect(ctx, x, y, width, height, radius, type) {
    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + width - radius, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
    ctx.lineTo(x + width, y + height - radius);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
    ctx.lineTo(x + radius, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
    ctx.lineTo(x, y + radius);
    ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();
    if (type === 'stroke') {
        ctx.stroke();
    } else {
        ctx.fill();
    }
};
var drawUserName = exports.drawUserName = function drawUserName(opt) {
    var ctx = opt.ctx,
        account = opt.account,
        scale = opt.scale,
        px = opt.px,
        py = opt.py,
        bgColor = opt.bgColor,
        _opt$fontSize = opt.fontSize,
        fontSize = _opt$fontSize === undefined ? 24 : _opt$fontSize,
        _opt$textPadding = opt.textPadding,
        textPadding = _opt$textPadding === undefined ? 15 : _opt$textPadding,
        _opt$rectMarginBottom = opt.rectMarginBottom,
        rectMarginBottom = _opt$rectMarginBottom === undefined ? 15 : _opt$rectMarginBottom,
        _opt$radius = opt.radius,
        radius = _opt$radius === undefined ? 10 : _opt$radius;

    var rectHeight = (fontSize + 12) / scale;
    textPadding = textPadding / scale;
    rectMarginBottom = rectMarginBottom / scale;
    fontSize = fontSize / scale;
    radius = radius / scale;
    var textFillColor = bgColor === 'white' || bgColor === 'rgb(255,255,255)' ? 'black' : 'white';
    ctx.beginPath();
    ctx.font = fontSize + 'px Arial';
    var textWidth = ctx.measureText(account).width;
    ctx.fillStyle = bgColor;
    roundRect(ctx, px - textWidth / 2 - textPadding, py - rectMarginBottom - rectHeight, textWidth + textPadding * 2, rectHeight, radius, 'fill');
    ctx.fillStyle = textFillColor;
    ctx.textAlign = 'left';
    ctx.textBaseline = 'middle';
    ctx.fillText(account, px - textWidth / 2, py - rectMarginBottom - rectHeight / 2);
};

/***/ }),

/***/ "./new_src/core/page/completeFlow.ts":
/*!*******************************************!*\
  !*** ./new_src/core/page/completeFlow.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.calcDrawOpQueue = undefined;

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _set = __webpack_require__(/*! babel-runtime/core-js/set */ "./node_modules/babel-runtime/core-js/set.js");

var _set2 = _interopRequireDefault(_set);

var _types = __webpack_require__(/*! ../ops/types */ "./new_src/core/ops/types.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/page/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 将opQueue转化为drawOpQueue和hiddenOpQueue的流程
 *
 * opQueue为当前页面所有快照的集合，drawOpQueue和hiddenOpQueue为该页面需要被绘制（隐藏）的快照集合
 */
var missOpSet = new _set2.default();
var calcDrawOpQueue = exports.calcDrawOpQueue = function calcDrawOpQueue(page) {
    var isReceivingBatchSnapshots = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

    page.drawOpQueue = {};
    page.hiddenOpQueue = {};

    var _separateNormalQueue = separateNormalQueue(page, page.opQueue),
        normalQueue = _separateNormalQueue.normalQueue,
        abNormalQueue = _separateNormalQueue.abNormalQueue;

    var noHistOpQueue = removeHistoryOpQueue(page, normalQueue);
    var noClearQueue = removeClearOpQueue(page, noHistOpQueue);
    var simpleQueue = removeDuplicateOpQueue(page, noClearQueue);
    handleAbNormalQueue(page, abNormalQueue);
    handleNormalQueue(page, simpleQueue);
    if (!isReceivingBatchSnapshots) {
        filterSelectedOpIds(page);
    }
};
var handleAbNormalQueue = function handleAbNormalQueue(page, abNormalQueue) {
    page.backgroundSnapshot = undefined;
    for (var i = 0; i < abNormalQueue.length; i++) {
        var snapshot = abNormalQueue[i];
        if (snapshot.data.type === 'background') {
            page.backgroundSnapshot = snapshot;
        } else if (snapshot.data.type === 'select') {
            if (snapshot.data.inProgress) {
                page.lastInProgressSelectOfUser[snapshot.uid] = snapshot;
            } else {
                //如果选择快照在“正在选择”快照之后，则“正在选择”快照内容无效
                delete page.lastInProgressSelectOfUser[snapshot.uid];
                page.lastSelectOfUser[snapshot.uid] = snapshot;
            }
        } else if (snapshot.data.type === 'mouse-pointer') {
            page.lastMousePointerOfUser[snapshot.uid] = snapshot;
        } else if (snapshot.data.type === 'laser') {
            //跳过激光笔，激光笔绘制都是增量绘制，均使用addSnapshotAndDrawOnlyIt绘制
        }
    }
};
var handleNormalQueue = function handleNormalQueue(page, simpleQueue) {
    /**
     * 将快照按照绘制快照分成多个数组。每个数组第一个元素为绘制快照，后面的元素为对绘制快照的修改
     */
    var opQueueMap = {};
    var dependOnIdArr = [];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = (0, _getIterator3.default)(simpleQueue), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var snapshot = _step.value;

            //只有最后一个inProgressSelectSnapshot才有效
            page.lastInProgressSelectOfUser = {};
            if (Array.isArray(snapshot.data.dependOn)) {
                var _iteratorNormalCompletion2 = true;
                var _didIteratorError2 = false;
                var _iteratorError2 = undefined;

                try {
                    for (var _iterator2 = (0, _getIterator3.default)(snapshot.data.dependOn), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                        var dependOpId = _step2.value;

                        if (!opQueueMap.hasOwnProperty(dependOpId)) {
                            if ( true && !missOpSet.has(dependOpId)) {
                                missOpSet.add(dependOpId);
                                console.error('DEV-->', 'miss op', opQueueMap, snapshot, dependOpId, simpleQueue);
                            }
                        } else {
                            dependOnIdArr.push(dependOpId);
                            opQueueMap[dependOpId].push(snapshot);
                        }
                    }
                } catch (err) {
                    _didIteratorError2 = true;
                    _iteratorError2 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion2 && _iterator2.return) {
                            _iterator2.return();
                        }
                    } finally {
                        if (_didIteratorError2) {
                            throw _iteratorError2;
                        }
                    }
                }
            } else if (typeof snapshot.data.dependOn === 'string') {
                if (!opQueueMap.hasOwnProperty(snapshot.data.dependOn)) {
                    if ( true && !missOpSet.has(snapshot.data.dependOn)) {
                        missOpSet.add(snapshot.data.dependOn);
                        console.error('DEV-->', 'miss op', opQueueMap, snapshot, snapshot.data.dependOn, simpleQueue);
                    }
                } else {
                    dependOnIdArr.push(snapshot.data.dependOn);
                    opQueueMap[snapshot.data.dependOn].push(snapshot);
                }
            } else {
                //新的图形类快照
                opQueueMap[snapshot.opId] = [snapshot];
            }
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }

    removeInprogressSnapshotIfBeenDepended(page, dependOnIdArr);
    for (var key in opQueueMap) {
        var drawOp = getDrawOpFromSnapshotQueue(page, key, opQueueMap);
        if (!drawOp.data.hidden) {
            page.drawOpQueue[key] = drawOp;
        } else {
            page.hiddenOpQueue[key] = drawOp;
        }
    }
};
/*
 * 找出当前用户选择的图形。首先选择当前用户最后一个选择操作，然后减去其他用户之后选择操作中重复的图形，再删除画布中已经不存在的图形
 */
var filterSelectedOpIds = function filterSelectedOpIds(page) {
    //注意下面语句顺序必须在drawOpQueue设置完成之后，因为selectids变化会触发textOp显示工具栏的判断逻辑，该逻辑又依赖于drawOpQueue
    if (page.app.room.currBoard.currPage !== page) {
        //非当前页面（通常在预览时被调用，直接跳过对selectOp的修改)
        return;
    }
    var selectedOpIds = (0, _util.getSelectedOpIds)(page);
    page.opsManager.selectOp.setSelectedOpIds(selectedOpIds);
    var inProgressSelectOfCurrUser = page.lastInProgressSelectOfUser[page.app.account];
    if (inProgressSelectOfCurrUser) {
        page.opsManager.selectOp.setInProgressSelectedOpIds(inProgressSelectOfCurrUser.data.selectedOpIds);
    } else {
        page.opsManager.selectOp.setInProgressSelectedOpIds([]);
    }
};
/**
 * 根据opIntermediateMap[dependOpId]: Array<IOpSnapshot>，生成一个绘制快照
 */
var getDrawOpFromSnapshotQueue = function getDrawOpFromSnapshotQueue(page, opId, opQueueMap) {
    var drawOp = opQueueMap[opId][0];
    for (var i = 1; i < opQueueMap[opId].length; i++) {
        drawOp = (0, _util.transformOp)(page, drawOp, opQueueMap[opId][i]);
    }
    return drawOp;
};
/**
 * 将正常的快照和非正常快照分离
 * 非正常快照包括：背景快照，h5快照，video快照等等，这些快照不受clear，undo，redo影响
 */
var separateNormalQueue = function separateNormalQueue(page, opQueue) {
    //normalQueue, abNormalQueue
    var normalQueue = [];
    var abNormalQueue = [];
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
        for (var _iterator3 = (0, _getIterator3.default)(opQueue), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
            var op = _step3.value;

            if (_types.snapshotOutOfNormalFlowTypes.includes(op.data.type)) {
                abNormalQueue.push(op);
            } else {
                normalQueue.push(op);
            }
        }
    } catch (err) {
        _didIteratorError3 = true;
        _iteratorError3 = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion3 && _iterator3.return) {
                _iterator3.return();
            }
        } finally {
            if (_didIteratorError3) {
                throw _iteratorError3;
            }
        }
    }

    return {
        normalQueue: normalQueue,
        abNormalQueue: abNormalQueue
    };
};
/**
 * 移除历史类操作
 */
var removeHistoryOpQueue = function removeHistoryOpQueue(page, opQueue) {
    var res = opQueue.slice();
    for (var i = res.length - 1; i >= 0; i--) {
        var snapshot = res[i];
        if (snapshot.data.type === 'undo' || snapshot.data.type === 'redo') {
            var histSnapshotId = snapshot.data.undoOpId || snapshot.data.redoOpId;
            for (var k = i - 1; k >= 0; k--) {
                if (res[k].opId === histSnapshotId) {
                    //找到要撤销的操作，删除该操作，以及撤销操作
                    res.splice(i, 1);
                    res.splice(k, 1);
                    i--;
                }
            }
        }
    }
    return res;
};
/**
 * 移除清空操作，以及其之前的所有操作
 * @param opQueue
 */
var removeClearOpQueue = function removeClearOpQueue(page, opQueue) {
    var res = opQueue.slice();
    for (var i = res.length - 1; i >= 0; i--) {
        var snapshot = res[i];
        if (snapshot.data.type === 'clear') {
            /**
             * 删除clear之前的inProgress的动作
             */
            removeInprogressSnapshotIfBeenDepended(page, res.slice(0, i + 1).map(function (_) {
                return _.opId;
            }));
            res = res.slice(i + 1);
            return res;
        }
    }
    return res;
};
/**
 * 将复制类操作复制的图形插入到队列中
 * @param opQueue
 */
var removeDuplicateOpQueue = function removeDuplicateOpQueue(page, opQueue) {
    var res = [];
    for (var i = 0; i < opQueue.length; i++) {
        var snapshot = opQueue[i];
        if (snapshot.data.type === 'duplicate') {
            res = res.concat(snapshot.data.duplicates);
        } else {
            res.push(opQueue[i]);
        }
    }
    return res;
};
/**
 * 如果快照被依赖，且该快照为未完成的快照，则该快照不应该在inProgressSnapshotOfUser中。
 * 否则，refresh时会绘制依赖后计算出来的快照，增量绘制则会绘制inProgressSnapshotOfUser中未完成快照的原始模样
 *
 * 这个函数主要是为了修复部分涂鸦，因为网络等原因，没有发送已完成的数据快照，导致该涂鸦永远处于未完成的状态。此时，任何对该涂鸦的修改都可能会造成画面闪烁
 * @param page
 * @param dependOn
 */
var removeInprogressSnapshotIfBeenDepended = function removeInprogressSnapshotIfBeenDepended(page, dependOnIds) {
    for (var uid in page.lastInProgressSnapshotOfUser) {
        var sp = page.lastInProgressSnapshotOfUser[uid];
        if (dependOnIds.includes(sp.snapshot.opId)) {
            delete page.lastInProgressSnapshotOfUser[uid];
        }
    }
};

/***/ }),

/***/ "./new_src/core/page/incrementFlow.ts":
/*!********************************************!*\
  !*** ./new_src/core/page/incrementFlow.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.addIncrementSnapshot = undefined;

var _util = __webpack_require__(/*! ./util */ "./new_src/core/page/util.ts");

/**
 * 增加增量式快照到页面中，然后绘制
 * @param page
 * @param snapshot
 */
var addIncrementSnapshot = exports.addIncrementSnapshot = function addIncrementSnapshot(page, snapshot) {
    if (snapshot.data.type === 'text') {
        addTextSnapshot(page, snapshot);
    } else {
        addSnapshotAndDrawOnlyIt(page, snapshot);
    }
};
/**
* 添加文本。重绘文本相关内容
*/
/**
 * 增量绘制时的一些帮助函数
 */
var addTextSnapshot = function addTextSnapshot(page, snapshot) {
    /**
     * 只有Page是当前Page才重绘
     * 重绘文本，需要重绘文本本身，以及文本的select包含盒。
     * 如果是修改之前的文本，需要在drawOpQueue中覆盖之前的文本
     */
    if (page.boardName === page.app.room.currIndex && page.pageIndex === page.app.room.currBoard.currIndex.toString()) {
        if (snapshot.data.dependOn) {
            //修改已有文本
            var dependOnId = snapshot.data.dependOn;
            var drawOp = page.drawOpQueue[dependOnId];
            if (drawOp) {
                drawOp = (0, _util.transformOp)(page, drawOp, snapshot);
                page.drawOpQueue[dependOnId] = drawOp;
                setInprogressSnapshot(page, drawOp);
            }
        } else {
            //新文本，不需要修改选择框，因为文本focus时，不用重复绘制选择框
            page.drawOpQueue[snapshot.opId] = snapshot;
            setInprogressSnapshot(page, snapshot);
        }
        page.app.room.pageToIncRefresh = page;
        // drawInProgressSnapshots(page)
    }
};
/**
* 增量绘制快照
* @param snapshot
*/
var addSnapshotAndDrawOnlyIt = function addSnapshotAndDrawOnlyIt(page, snapshot) {
    /**
     * 只有Page是当前Page才重绘
     */
    setInprogressSnapshot(page, snapshot);
    if (page.boardName === page.app.room.currIndex && page.pageIndex === page.app.room.currBoard.currIndex.toString()) {
        if (snapshot.data.type !== 'laser' && snapshot.data.type !== 'mouse-pointer') {
            page.drawOpQueue[snapshot.opId] = snapshot;
        }
        page.app.room.pageToIncRefresh = page;
        // drawInProgressSnapshots(page)
    }
};
/**
 * 设置inProgress快照。如果是已有快照，不更新时间
 * @param snapshot
 */
var setInprogressSnapshot = function setInprogressSnapshot(page, snapshot) {
    if (snapshot.data.type === 'select') {
        if (snapshot.data.inProgress) {
            page.lastInProgressSelectOfUser[snapshot.uid] = snapshot;
        }
    } else if (snapshot.data.type === 'mouse-pointer') {
        page.lastMousePointerOfUser[snapshot.uid] = snapshot;
    } else if (page.lastInProgressSnapshotOfUser.hasOwnProperty(snapshot.uid) && page.lastInProgressSnapshotOfUser[snapshot.uid].snapshot.opId === snapshot.opId) {
        page.lastInProgressSnapshotOfUser[snapshot.uid] = {
            snapshot: snapshot,
            beginAt: page.lastInProgressSnapshotOfUser[snapshot.uid].beginAt
        };
    } else {
        page.lastInProgressSnapshotOfUser[snapshot.uid] = {
            snapshot: snapshot,
            beginAt: Date.now()
        };
    }
};

/***/ }),

/***/ "./new_src/core/page/index.ts":
/*!************************************!*\
  !*** ./new_src/core/page/index.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _resourceCache = __webpack_require__(/*! ../resource/resourceCache */ "./new_src/core/resource/resourceCache.ts");

var _uuid = __webpack_require__(/*! uuid */ "./node_modules/uuid/dist/esm-browser/index.js");

var _render = __webpack_require__(/*! ./render */ "./new_src/core/page/render.ts");

var _completeFlow = __webpack_require__(/*! ./completeFlow */ "./new_src/core/page/completeFlow.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/page/util.ts");

var _incrementFlow = __webpack_require__(/*! ./incrementFlow */ "./new_src/core/page/incrementFlow.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 同一时间只会显示一个Page。显示的Page由{board = room.boards[room.currIndex]; page = board.pages[board.currIndex]}确定
 *
 * 每个Page中有Op快照队列。快照内容和协议传输内容一致，是Json对象。Op快照队列描述了Page该如何渲染。
 */
var Page = function () {
    function Page(app, boardName, pageIndex) {
        (0, _classCallCheck3.default)(this, Page);

        //只保留拥有draw方法的Op
        this.drawOpQueue = {};
        this.hiddenOpQueue = {};
        /*
         * 每个用户的快照队列中最后一个选择快照。选择快照只需要绘制最新的即可。注意selectOp和element-eraser Op都可以发送选择快照
         */
        this.lastSelectOfUser = {};
        // lastSelectSnapshot: IDrawOpSnapshot | undefined
        /**
         * 当前用户正在选择中的select快照
         */
        this.lastInProgressSelectOfUser = {};
        this.lastInProgressSnapshotOfUser = {};
        /**
         * 鼠标位置和其他连续动作可以共存，因此不放在lastInProgressSnapshotOfUser中
         */
        this.lastMousePointerOfUser = {};
        /**
         * 对于preview页面，若当前页面因为资源未下载而阻塞，则不渲染预览。
         * 对于正常页面，仍渲染页面，但是不渲染未下载的资源
         *
         * 当资源全部下载好了，会发送event:page:ready事件，预览工厂及board根据此事件刷新相应的canvas
         */
        this.blockedResourceList = [];
        this._currOpId = (0, _uuid.v4)();
        this._nextOpId = (0, _uuid.v4)();
        this.app = app;
        this.opsManager = app.opsManager;
        this.boardName = boardName;
        this.pageIndex = pageIndex;
        window.page = this;
    }

    (0, _createClass3.default)(Page, [{
        key: "prepareNewOpId",
        value: function prepareNewOpId() {
            this._currOpId = this._nextOpId;
            this._nextOpId = (0, _uuid.v4)();
        }
    }, {
        key: "getOpId",
        value: function getOpId() {
            return this.app.account + '-' + this._currOpId;
        }
        /**
         * 如果nextOpInc为false，那只是看一看下一个opId是什么
         * 如果为true，则将opId递增，并返回
         */

    }, {
        key: "getNextOpId",
        value: function getNextOpId() {
            var nextOpInc = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

            if (nextOpInc) {
                this.prepareNewOpId();
                return this.getOpId();
            } else {
                return this.app.account + '-' + this._nextOpId;
            }
        }
    }, {
        key: "setPayload",
        value: function setPayload(payload) {
            this.payload = payload;
        }
    }, {
        key: "addWaitingResource",
        value: function addWaitingResource(resUrl) {
            if (!this.blockedResourceList.includes(resUrl) && !(0, _resourceCache.resourceLoaded)(resUrl)) {
                this.blockedResourceList.push(resUrl);
            }
        }
    }, {
        key: "removeWaitingResource",
        value: function removeWaitingResource(resUrl) {
            var index = this.blockedResourceList.indexOf(resUrl);
            if (index > -1) {
                this.blockedResourceList.splice(index, 1);
                if (!this.blocked) {
                    //通知外界页面已经准备好了。
                    this.app.opsManager.hooks.pageReady.call(this.boardName, this.pageIndex);
                    if (this.isCurrPage) {
                        this.app.room.pageToRefresh = this;
                        // return this.refresh()
                    }
                }
            }
        }
        /**
         * 将snapshot加入队列中
         *
         * @param snapshot
         */

    }, {
        key: "addOpInPage",
        value: function addOpInPage(snapshot) {
            var doRefresh = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            if (snapshot.opId === 'none') {
                console.error('DEV-->', 'snapshot no opid', snapshot);
                return false;
            }
            /**
             * 用户(uid)有新的快照，或者快照已完成，删除他/她之前的进行中的快照，否则会重复绘制
             *
             * 排查mouse-pointer是因为进行中的快照可能和鼠标位置快照同时产生
             */
            if (this.lastInProgressSnapshotOfUser.hasOwnProperty(snapshot.uid) && !['mouse-pointer'].includes(snapshot.data.type)) {
                if (!snapshot.data.inProgress || snapshot.opId !== this.lastInProgressSnapshotOfUser[snapshot.uid].snapshot.opId) {
                    delete this.lastInProgressSnapshotOfUser[snapshot.uid];
                }
            }
            // if (lastOp === null && snapshot.data.type !== 'select') {
            //     console.warn('DEV-->', 'New Op created', snapshot)
            // }
            // if (!snapshot.data.inProgress && snapshot.data.type !== 'select') {
            //     console.warn('DEV-->', 'New op finished', snapshot)
            // }
            /**
             * 批量接收快照时，也要调用calcDrawOpQueue,
             * 否则recovery模块缓存时，backgroundOp可能未被设置，导致刷新时丢失所有文档背景图
             */
            if ((0, _util.opNeedRefresh)(this, snapshot)) {
                this.calcDrawOpQueue();
            }
            if (!this.app.room.isReceivingBatchSnapshots) {
                if ((0, _util.opNeedRefresh)(this, snapshot)) {
                    if (['undo', 'redo', 'clear'].includes(snapshot.data.type)) {
                        this.cleanNonCanvasElements(false);
                    }
                    if (doRefresh) {
                        /**
                         * 只有Page是当前Page才重绘
                         */
                        if (this.boardName === this.app.room.currIndex && this.pageIndex === this.app.room.currBoard.currIndex.toString()) {
                            this.app.room.pageToRefresh = this;
                            // this.refresh()
                        }
                    }
                } else {
                    (0, _incrementFlow.addIncrementSnapshot)(this, snapshot);
                }
            }
            /**
             * 埋入钩子。
             * undo, redo可以使用该钩子更新可撤销，可重做操作数量
             */
            this.opsManager.hooks.addOpHook.call(snapshot);
            return (0, _util.opNeedRefresh)(this, snapshot);
        }
        /**
         * 将完整操作队列转为绘制操作队列
         * 选择也会输出DrawOpSnapshot。因为它也有绘制方式。但是只有最后一个，且激活的选择操作会显示内容
         *
         * 步骤一：建立依赖链表队列，比如说
         * {
         *  [涂鸦1，移动1，缩放1，移动1]，
         *  [矩形2，移动1]，
         *  [最后一次选择]
         * }
         * 步骤二：计算图形变形后的结果。然后输出图形队列
         */

    }, {
        key: "calcDrawOpQueue",
        value: function calcDrawOpQueue() {
            (0, _completeFlow.calcDrawOpQueue)(this, this.app.room.isReceivingBatchSnapshots);
        }
        /**
         * 切换页面时，以及撤销，回退，清空时，应该清空container中属于切换前页面的dom元素
         *
         * 撤销，回退不要清空背景元素。清空背景元素会造成背景图闪烁。只在绝对必要时清空背景图（换页）
         */

    }, {
        key: "cleanNonCanvasElements",
        value: function cleanNonCanvasElements() {
            var includeBackground = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

            (0, _render.cleanNonCanvasElements)(this, includeBackground);
        }
    }, {
        key: "refresh",
        value: function refresh() {
            var opt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

            (0, _render.refresh)(this, opt);
        }
    }, {
        key: "incRefresh",
        value: function incRefresh() {
            (0, _render.drawInProgressSnapshots)(this);
        }
    }, {
        key: "opQueue",
        get: function get() {
            var room = this.app.room;
            try {
                return room.boardOps[this.boardName].pages[this.pageIndex].inPageSnapshotIds.map(function (id) {
                    return room.opIdSnapshotMap[id].snapshot;
                });
            } catch (_a) {
                return [];
            }
        }
        /**
         * 是否为当前文档的当前页面
         */

    }, {
        key: "isCurrPage",
        get: function get() {
            return this.app.room.currBoard.currPage === this;
        }
    }, {
        key: "ctx",
        get: function get() {
            return this.app.container.ctx;
        }
    }, {
        key: "frontCtx",
        get: function get() {
            return this.app.container.frontCtx;
        }
    }, {
        key: "laserCtx",
        get: function get() {
            return this.app.container.laserCtx;
        }
    }, {
        key: "width",
        get: function get() {
            return this.app.container.width;
        }
    }, {
        key: "height",
        get: function get() {
            return this.app.container.height;
        }
    }, {
        key: "blocked",
        get: function get() {
            return this.blockedResourceList.length > 0;
        }
    }]);
    return Page;
}();

exports.default = Page;

/***/ }),

/***/ "./new_src/core/page/render.ts":
/*!*************************************!*\
  !*** ./new_src/core/page/render.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.drawInProgressSnapshots = exports.refresh = exports.cleanNonCanvasElements = undefined;

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _container = __webpack_require__(/*! ../container */ "./new_src/core/container/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 切换页面时，以及撤销，回退，清空时，应该清空container中属于切换前页面的dom元素
 *
 * 撤销，回退不要清空背景元素。清空背景元素会造成背景图闪烁。只在绝对必要时清空背景图（换页）
 */
var cleanNonCanvasElements = exports.cleanNonCanvasElements = function cleanNonCanvasElements(page) {
    var includeBackground = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

    var _a;
    if (page.app.container && page.app.container.imageEl) {
        page.app.container.imageEl.innerHTML = '';
    }
    if (page.app.container && page.app.container.domEl) {
        page.app.container.domEl.innerHTML = '';
    }
    if (includeBackground && page.app.container && page.app.container.backgroundEl) {
        page.app.container.backgroundEl.innerHTML = '';
    }
    var videos = page.app.container.el.getElementsByTagName('video');
    for (var i = 0; i < videos.length; i++) {
        (_a = videos[i].parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(videos[i]);
    }
};
var refresh = exports.refresh = function refresh(page) {
    var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var ctx = opt.ctx,
        preview = opt.preview;

    if (!ctx) ctx = page.ctx;
    var frontCtx = preview ? ctx : page.frontCtx;
    page.opsManager.hooks.refresh.call();
    ctx.save();
    ctx.clearRect(0, 0, page.width * _container.DPI, page.height * _container.DPI);
    if (opt.supportToDataUrl) {
        ctx.fillStyle = page.app.appConfig.canvas_bg_color;
        ctx.fillRect(0, 0, page.width * _container.DPI, page.height * _container.DPI);
    }
    if (!preview) {
        page.app.camera.convertCanvas(ctx);
    } else {
        page.app.camera.convertPreviewCanvas(ctx);
    }
    if (!preview) {
        frontCtx.save();
        page.laserCtx.save();
        frontCtx.clearRect(0, 0, page.width * _container.DPI, page.height * _container.DPI);
        page.laserCtx.clearRect(0, 0, page.width * _container.DPI, page.height * _container.DPI);
        page.app.camera.convertCanvas(frontCtx);
        page.app.camera.convertCanvas(page.laserCtx);
    }
    if (page.backgroundSnapshot && !preview) {
        page.opsManager.draw(page.backgroundSnapshot, ctx, {
            div: page.app.container.backgroundEl,
            page: page
        });
    } else if (page.backgroundSnapshot) {
        page.opsManager.preview(page.backgroundSnapshot, ctx, {
            page: page,
            supportToDataUrl: opt.supportToDataUrl
        });
    }
    drawSelectBox(page, frontCtx);
    if (!preview) {
        drawMousePointer(page, page.laserCtx);
    }
    if (!preview) {
        for (var key in page.drawOpQueue) {
            var div = page.drawOpQueue[key].data.type === 'image' ? page.app.container.imageEl : page.app.container.domEl;
            page.opsManager.draw(page.drawOpQueue[key], ctx, {
                div: div,
                page: page
            });
        }
        for (var _key in page.hiddenOpQueue) {
            var _div = page.hiddenOpQueue[_key].data.type === 'image' ? page.app.container.imageEl : page.app.container.domEl;
            page.opsManager.hide(page.hiddenOpQueue[_key], ctx, _div);
        }
    } else {
        /**
         * 预览模式下图片在canvas上绘制，需要将图片排到最下层
         */
        var keys = (0, _keys2.default)(page.drawOpQueue);
        keys = keys.sort(function (k1, k2) {
            if (page.drawOpQueue[k1].data.type === 'image' && page.drawOpQueue[k2].data.type !== 'image') {
                return -1;
            } else if (page.drawOpQueue[k1].data.type !== 'image' && page.drawOpQueue[k2].data.type === 'image') {
                return 1;
            } else {
                return 0;
            }
        });
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
            for (var _iterator = (0, _getIterator3.default)(keys), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var _key2 = _step.value;

                page.opsManager.preview(page.drawOpQueue[_key2], ctx, {
                    page: page,
                    supportToDataUrl: opt.supportToDataUrl
                });
            }
        } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
        } finally {
            try {
                if (!_iteratorNormalCompletion && _iterator.return) {
                    _iterator.return();
                }
            } finally {
                if (_didIteratorError) {
                    throw _iteratorError;
                }
            }
        }
    }
    ctx.restore();
    page.frontCtx.restore();
    if (!preview) {
        page.laserCtx.restore();
    }
};
var drawInProgressSnapshots = exports.drawInProgressSnapshots = function drawInProgressSnapshots(page) {
    page.laserCtx.save();
    page.frontCtx.save();
    page.laserCtx.clearRect(0, 0, page.width * _container.DPI, page.height * _container.DPI);
    page.frontCtx.clearRect(0, 0, page.width * _container.DPI, page.height * _container.DPI);
    page.app.camera.convertCanvas(page.laserCtx);
    page.app.camera.convertCanvas(page.frontCtx);
    var snapshots = (0, _keys2.default)(page.lastInProgressSnapshotOfUser).map(function (key) {
        return page.lastInProgressSnapshotOfUser[key];
    }).sort(function (sp1, sp2) {
        /**
         * 根据时间固定图层关系，避免连续绘制时由于相对图层变化导致的闪烁
         */
        return sp1.beginAt - sp2.beginAt;
    });
    snapshots.forEach(function (sp) {
        page.opsManager.draw(sp.snapshot, page.frontCtx, {
            div: page.app.container.domEl,
            page: page
        });
    });
    drawSelectBox(page, page.frontCtx);
    drawMousePointer(page, page.laserCtx);
    page.laserCtx.restore();
    page.frontCtx.restore();
};
var drawSelectBox = function drawSelectBox(page, ctx) {
    for (var userId in page.lastSelectOfUser) {
        /**
         * select，即选择时的框选框，需要放到frontCanvas上绘制
         * 绘制文本时，选择框需要重绘。如果放到背景canvas上，选择框无法被清空，会导致多重选择框的出现
         */
        page.opsManager.draw(page.lastSelectOfUser[userId], ctx);
    }
    for (var _userId in page.lastInProgressSelectOfUser) {
        /**
         * select，即选择时的框选框，需要放到frontCanvas上绘制
         * 绘制文本时，选择框需要重绘。如果放到背景canvas上，选择框无法被清空，会导致多重选择框的出现
         */
        page.opsManager.draw(page.lastInProgressSelectOfUser[_userId], ctx);
    }
};
/**
 * 绘制鼠标位置
 * @param ctx
 */
var drawMousePointer = function drawMousePointer(page, ctx) {
    for (var key in page.lastMousePointerOfUser) {
        var snapshot = page.lastMousePointerOfUser[key];
        page.opsManager.draw(snapshot, ctx);
    }
};

/***/ }),

/***/ "./new_src/core/page/util.ts":
/*!***********************************!*\
  !*** ./new_src/core/page/util.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
/**
 * 使用trasformOp对drawOp进行转换
 * @param drawOp
 * @param opSnapshot
 */
var transformOp = exports.transformOp = function transformOp(page, drawOp, trasformOp) {
    var op = page.opsManager.opMap[trasformOp.data.type];
    try {
        if ("transformOp" in op) {
            return op.transformOp(drawOp, trasformOp);
        } else {
            return drawOp;
        }
    } catch (err) {
        console.warn('transform op error');
        console.warn(drawOp);
        console.warn(err);
        return drawOp;
    }
};
/**
 * 若快照需要白板完全重绘，返回true
 * @param snapshot
 */
var opNeedRefresh = exports.opNeedRefresh = function opNeedRefresh(page, snapshot) {
    //文本永远是增量绘制
    // if (snapshot.data.type === 'text') {
    //     return false
    // }
    //下面的快照操作为增量绘制
    var isIncrementOp = ['select', 'laser', 'text'].includes(snapshot.data.type) || page.opsManager.drawOpTypes.includes(snapshot.data.type);
    if (isIncrementOp && snapshot.data.inProgress) {
        return false;
    } else if (snapshot.data.type === 'mouse-pointer') {
        return false;
    }
    return true;
};
/**
 * 根据lastSelectOfUser推导出当前用户选中了哪些元素
 *
 * 应该是当前用户select - 之后的select快照的包含了当前的元素
 * @param page
 */
var getSelectedOpIds = exports.getSelectedOpIds = function getSelectedOpIds(page) {
    var selectedOpIds = [];
    var currSelect = page.lastSelectOfUser[page.app.account];
    if (currSelect) {
        selectedOpIds = currSelect.data.selectedOpIds.slice();
        // for (let userId in page.lastSelectOfUser) {
        //     if (page.lastSelectOfUser[userId].time > currSelect.time) {
        //         const otherSelect = page.lastSelectOfUser[userId].data.selectedOpIds.slice() as string[]
        //         for (let id of otherSelect) {
        //             const index = selectedOpIds.indexOf(id as string)
        //             if (index !== -1) {
        //                 selectedOpIds.splice(index, 1)
        //             }
        //         }
        //     }
        // }
    }
    selectedOpIds = selectedOpIds.filter(function (id) {
        return page.drawOpQueue.hasOwnProperty(id) && !page.drawOpQueue[id].data.locked;
    });
    return selectedOpIds;
};

/***/ }),

/***/ "./new_src/core/player/index.ts":
/*!**************************************!*\
  !*** ./new_src/core/player/index.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 录像回放控制器
 */
var Player = function () {
    function Player(app) {
        (0, _classCallCheck3.default)(this, Player);

        this.records = [];
        this.nextRecordIndex = 0;
        this.lastTime = 0;
        this.offsetBegin = 0;
        this.pkgId = 0;
        this.app = app;
    }

    (0, _createClass3.default)(Player, [{
        key: 'addRecordData',
        value: function addRecordData(records) {
            this.records = records.slice();
            this.app.resetState();
            this.nextRecordIndex = 0;
        }
        /**
         * 切换时，vision.mode变化比较复杂。为了避免麻烦，重置account，然后重算一遍
         * @param viewer
         */

    }, {
        key: 'setViewer',
        value: function setViewer(viewer) {
            this.app.account = viewer;
            /**
             * 重算一遍
             */
            var _lastTime = this.lastTime;
            this.lastTime = Infinity;
            this.seekTo(_lastTime);
        }
    }, {
        key: 'seekTo',
        value: function seekTo(time) {
            var forward = time > this.lastTime ? true : false;
            this.lastTime = time;
            var nextRecordIndex = forward ? this.nextRecordIndex : 0;
            var endIndex = nextRecordIndex;
            for (; endIndex < this.records.length; endIndex++) {
                var record = this.records[endIndex];
                if (record.time + this.offsetBegin > time) {
                    break;
                }
            }
            var recordsToEmit = this.records.slice(nextRecordIndex, endIndex);
            this.nextRecordIndex = endIndex;
            if (!forward) {
                this.app.resetState();
                this.pkgId = 0;
            }
            var snapshotsToEmit = [];
            var broadcasterData = void 0;
            var observeModeData = void 0;
            for (var i = 0; i < recordsToEmit.length; i++) {
                if (recordsToEmit[i].record.type === 'snapshot') {
                    snapshotsToEmit.push({
                        snapshot: recordsToEmit[i].record.value,
                        pkgId: this.pkgId
                    });
                    this.pkgId += 1;
                } else if (recordsToEmit[i].record.type === 'snapshotArr') {
                    var _iteratorNormalCompletion = true;
                    var _didIteratorError = false;
                    var _iteratorError = undefined;

                    try {
                        for (var _iterator = (0, _getIterator3.default)(recordsToEmit[i].record.value), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                            var snapshot = _step.value;

                            snapshotsToEmit.push({
                                snapshot: snapshot,
                                pkgId: this.pkgId
                            });
                            this.pkgId += 1;
                        }
                    } catch (err) {
                        _didIteratorError = true;
                        _iteratorError = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion && _iterator.return) {
                                _iterator.return();
                            }
                        } finally {
                            if (_didIteratorError) {
                                throw _iteratorError;
                            }
                        }
                    }
                } else if (recordsToEmit[i].record.type === 'broadcaster') {
                    broadcasterData = recordsToEmit[i].record.value;
                } else if (recordsToEmit[i].record.type === 'observeMode') {
                    if (recordsToEmit[i].record.value.account === this.app.account) {
                        observeModeData = recordsToEmit[i].record.value;
                    }
                }
            }
            if (broadcasterData) {
                this.app.vision.receiveBroadcasterAfterSync(broadcasterData);
            }
            if (observeModeData) {
                this.app.vision.receiveObserveModeAfterSync(observeModeData);
            }
            this.app.room.execBatchSnapshots(snapshotsToEmit);
        }
    }]);
    return Player;
}();

exports.default = Player;

/***/ }),

/***/ "./new_src/core/previewFactory/index.ts":
/*!**********************************************!*\
  !*** ./new_src/core/previewFactory/index.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ "./node_modules/babel-runtime/core-js/array/from.js");

var _from2 = _interopRequireDefault(_from);

var _map = __webpack_require__(/*! babel-runtime/core-js/map */ "./node_modules/babel-runtime/core-js/map.js");

var _map2 = _interopRequireDefault(_map);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _container = __webpack_require__(/*! ../container */ "./new_src/core/container/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 预览生成工厂
 *
 * 当接到生产任务时，会压入任务堆栈
 *
 * 任务堆栈会一个一个的渲染白板，并生成base64字符串。只有当白板以来的资源文件准备好了，才会开始渲染任务。
 *
 * 每有一个preview准备好了，会发送事件通知外界。
 * 当page加入新的快照时，该page的preview缓存会丢失。
 */
var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

var PreviewFactory = function () {
    function PreviewFactory(app) {
        (0, _classCallCheck3.default)(this, PreviewFactory);

        /**
         * key是boardName129*&^ljdfh893pageIndex
         * 只有在previewContainerMap中的boardName和pageIndex，才会去生成preview task
         *
         * 通过bindPreviewContainer设置previewContainerMap
         */
        this.previewContainerMap = new _map2.default();
        this.task = [];
        this.isLoopBusy = false;
        this.container = document.createElement('div');
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        this.app = app;
        this.app.opsManager.hooks.pageReady.tap('PageReadyPlugin', this.onPageReady.bind(this));
        this.app.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin", this.onOpAdded.bind(this));
        this.setupExportToImgContainer();
        this.resizeElements();
    }
    /**
     * 用户将容器传给preview factory, preview factory直接在容器中渲染
     */


    (0, _createClass3.default)(PreviewFactory, [{
        key: "bindPreviewContainer",
        value: function bindPreviewContainer(opts) {
            var _this = this;

            var reset = opts.hasOwnProperty('reset') ? opts.reset : true;
            var keepPrevContainer = opts.hasOwnProperty('keepPrevContainer') ? opts.keepPrevContainer : true;
            var newKeys = opts.previewContainerSettings.map(function (opt) {
                return _this.getContainerKey(opt);
            });
            var oldKeys = (0, _from2.default)(this.previewContainerMap.keys());
            if (reset) {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = (0, _getIterator3.default)(oldKeys), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var key = _step.value;

                        if (!newKeys.includes(key) || !keepPrevContainer) {
                            this.previewContainerMap.delete(key);
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }

                this.task = [];
            }
            var previewTasks = [];
            opts.previewContainerSettings.forEach(function (opt) {
                var key = _this.getContainerKey(opt);
                /**
                 * 如果不替换原有容器，且容器存在，则不要重新设置该容器，也不要设置task
                 */
                if (oldKeys.includes(key) && keepPrevContainer) {
                    return;
                }

                var _setupPreviewElements = _this.setupPreviewElements(opt.container),
                    ctx = _setupPreviewElements.ctx,
                    canvasContainer = _setupPreviewElements.canvasContainer;

                var rect = opt.container.getBoundingClientRect();
                previewTasks.push({
                    pageIndex: opt.pageIndex,
                    boardName: opt.boardName
                });
                _this.previewContainerMap.set(key, {
                    container: canvasContainer,
                    ctx: ctx,
                    width: rect.width,
                    height: rect.height
                });
            });
            this.addPreviewTask(previewTasks);
        }
    }, {
        key: "generatePreviewToDataUrl",
        value: function generatePreviewToDataUrl(task) {
            var page = this.app.room.getPage(task.boardName, task.pageIndex);
            page.calcDrawOpQueue();
            page.refresh({
                ctx: this.ctx,
                preview: true,
                supportToDataUrl: true
            });
            var preview = this.canvas.toDataURL();
            return preview;
        }
    }, {
        key: "setBackgroundColor",
        value: function setBackgroundColor() {
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = (0, _getIterator3.default)(this.previewContainerMap.values()), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var obj = _step2.value;

                    obj.container.style.backgroundColor = this.app.appConfig.canvas_bg_color;
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }

            this.container.style.backgroundColor = this.app.appConfig.canvas_bg_color;
        }
        /**
         * 更新视角位置后，要当前文档所有预览页面的绘制
         */

    }, {
        key: "refreshPreviewsOfCurrBoard",
        value: function refreshPreviewsOfCurrBoard() {
            if (this.app.room.isReceivingBatchSnapshots) {
                return;
            }
            this.task = [];
            var board = this.app.room.currBoard;
            var pages = board.pageNames;
            var _iteratorNormalCompletion3 = true;
            var _didIteratorError3 = false;
            var _iteratorError3 = undefined;

            try {
                for (var _iterator3 = (0, _getIterator3.default)(pages), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                    var page = _step3.value;

                    this.invalidatePreview(page, board.boardName);
                }
                /**
                 * 优先启动当前白板的task
                 */
            } catch (err) {
                _didIteratorError3 = true;
                _iteratorError3 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion3 && _iterator3.return) {
                        _iterator3.return();
                    }
                } finally {
                    if (_didIteratorError3) {
                        throw _iteratorError3;
                    }
                }
            }

            var taskList = [{
                boardName: board.boardName,
                pageIndex: board.currIndex.toString()
            }].concat(pages.map(function (page) {
                return {
                    boardName: board.boardName,
                    pageIndex: page.toString()
                };
            }));
            this.addPreviewTask(taskList);
        }
    }, {
        key: "refreshPreviewsOfCurrPage",
        value: function refreshPreviewsOfCurrPage() {
            if (this.app.room.isReceivingBatchSnapshots) {
                return;
            }
            var board = this.app.room.currBoard;
            this.invalidatePreview(board.currPage.pageIndex, board.boardName);
            /**
             * 优先启动当前白板的task
             */
            var taskList = [{
                boardName: board.boardName,
                pageIndex: board.currIndex.toString()
            }];
            this.addPreviewTask(taskList);
        }
    }, {
        key: "resizeElements",
        value: function resizeElements() {
            this.container.style.width = this.app.container.width + "px";
            this.container.style.height = this.app.container.height + "px";
            var rect = this.container.getBoundingClientRect();
            this.canvas.width = rect.width;
            this.canvas.height = rect.height;
        }
        /**
         * 将task.boardName + task.pageIndex页面白板内容输出为string，并缓存在previewCache中
         * @param task
         */

    }, {
        key: "generatePreview",
        value: function generatePreview(task) {
            var key = this.getContainerKey(task);
            if (this.previewContainerMap.has(key)) {
                var obj = this.previewContainerMap.get(key);
                var page = this.app.room.getPage(task.boardName, task.pageIndex);
                page.calcDrawOpQueue();
                page.refresh({
                    ctx: obj === null || obj === void 0 ? void 0 : obj.ctx,
                    preview: true
                });
            }
        }
    }, {
        key: "invalidatePreview",
        value: function invalidatePreview(pageIndex, boardName) {
            var key = this.getContainerKey({ pageIndex: pageIndex, boardName: boardName });
            var obj = this.previewContainerMap.get(key);
            obj === null || obj === void 0 ? void 0 : obj.ctx.clearRect(0, 0, obj.width, obj.height);
        }
        /**
         * 添加预览生成任务
         * @param taskArray
         */

    }, {
        key: "addPreviewTask",
        value: function addPreviewTask(taskArray) {
            var _this2 = this;

            /**
             * 必须要异步执行。
             * 因为page.blocked需要在page.refresh调用后才知道是否阻塞。
             * 为了保证该函数执行顺序晚于page.refresh，因此将其放入setTimeout中异步执行
             *
             * 越晚加入的task应该放在队列越前面。因为执行task的顺序是从队列前面往后面，越晚加入的
             * 应该越早执行
             */
            setTimeout(function () {
                taskArray.reverse().forEach(function (taskInfo) {
                    var taskIndexOfSamePage = _this2.getTaskIndexOfPage(taskInfo.pageIndex, taskInfo.boardName);
                    if (taskIndexOfSamePage !== -1) {
                        //将之前的任务删掉。如果预览图没有准备好，插入的新任务会移动到队列头部
                        //这样能够使得最新刷新的页面的预览图能够优先生成
                        //如果预览图已经准备好了，那么任务队列里该页面的任务直接删除就好了
                        _this2.task.splice(taskIndexOfSamePage, 1);
                    }
                    var board = _this2.app.room.boards[taskInfo.boardName];
                    if (board) {
                        var page = board.pages[taskInfo.pageIndex];
                        if (page) {
                            var key = _this2.getContainerKey(taskInfo);
                            /**
                             * 只有绑定了container的时候，才计算preview
                             */
                            if (_this2.previewContainerMap.has(key)) {
                                _this2.task.unshift({
                                    pageIndex: taskInfo.pageIndex,
                                    boardName: taskInfo.boardName,
                                    state: page.blocked ? 'waiting' : 'ready'
                                });
                            }
                        }
                    }
                });
                _this2.startLoop();
            }, 0);
        }
        /**
         * 任务队列中是否已经存在同一页面的任务
         * @param pageIndex
         * @param boardName
         */

    }, {
        key: "getTaskIndexOfPage",
        value: function getTaskIndexOfPage(pageIndex, boardName) {
            for (var i = 0; i < this.task.length; i++) {
                if (this.task[i].pageIndex === pageIndex && this.task[i].boardName === boardName) {
                    return i;
                }
            }
            return -1;
        }
    }, {
        key: "getContainerKey",
        value: function getContainerKey(opt) {
            return opt.boardName + '129*&^ljdfh893' + opt.pageIndex.toString();
        }
    }, {
        key: "setupPreviewElements",
        value: function setupPreviewElements(container) {
            var canvasContainerArr = container.getElementsByClassName('preview-canvas-container');
            if (canvasContainerArr.length === 0) {
                var el = document.createElement('div');
                el.className = 'preview-canvas-container';
                el.style.backgroundColor = this.app.appConfig.canvas_bg_color;
                el.style.position = 'absolute';
                el.style.left = '0';
                el.style.right = '0';
                el.style.top = '0';
                el.style.bottom = '0';
                container.appendChild(el);
                var canvas = document.createElement('canvas');
                var rect = el.getBoundingClientRect();
                canvas.width = rect.width * _container.DPI;
                canvas.height = rect.height * _container.DPI;
                canvas.style.width = rect.width + "px";
                canvas.style.height = rect.height + "px";
                canvas.style.imageRendering = 'optimize-contrast';
                el.appendChild(canvas);
                var ctx = canvas.getContext('2d');
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                return {
                    ctx: ctx,
                    canvasContainer: el
                };
            } else {
                var _canvas = canvasContainerArr[0].getElementsByTagName('canvas')[0];
                var _ctx = _canvas.getContext('2d');
                return {
                    ctx: _ctx,
                    canvasContainer: canvasContainerArr[0]
                };
            }
        }
        /**
         * 页面快照变化时，刷新其页面预览缓存。
         * TODO: 这个函数实际上存在缺陷，它没有考虑非当前页面快照可能变化
         */

    }, {
        key: "onOpAdded",
        value: function onOpAdded(snapshot) {
            if (snapshot.category !== 'inPageOp') {
                return;
            } else if (snapshot.data.inProgress) {
                return;
            } else if (snapshot.data.type === 'laser') {
                return;
            } else if (snapshot.data.type === 'mouse-pointer') {
                return;
            } else if (this.app.room.isReceivingBatchSnapshots) {
                return;
            }
            var boardName = snapshot.board;
            var pageIndex = snapshot.page;
            this.invalidatePreview(pageIndex.toString(), boardName);
            this.addPreviewTask([{
                pageIndex: pageIndex.toString(),
                boardName: boardName
            }]);
        }
        /**
         * 页面资源获取好了，清空之前绘制的内容，并重新生成预览图
         * @param boardName
         * @param pageIndex
         */

    }, {
        key: "onPageReady",
        value: function onPageReady(boardName, pageIndex) {
            this.invalidatePreview(pageIndex.toString(), boardName);
            this.addPreviewTask([{
                pageIndex: pageIndex.toString(),
                boardName: boardName
            }]);
        }
        /**
         * 异步生成预览图。异步生成是为了防止长时间连续任务造成卡顿。
         */

    }, {
        key: "startLoop",
        value: function startLoop() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _this3 = this;

                var _loop, _ret;

                return _regenerator2.default.wrap(function _callee$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                if (!this.isLoopBusy) {
                                    _context2.next = 2;
                                    break;
                                }

                                return _context2.abrupt("return");

                            case 2:
                                this.isLoopBusy = true;
                                //第一个task需要是异步事件，否则可能会造成事件依赖关系存在问题
                                _context2.next = 5;
                                return new _promise2.default(function (res) {
                                    setTimeout(res, 0);
                                });

                            case 5:
                                _loop = /*#__PURE__*/_regenerator2.default.mark(function _loop() {
                                    var task, key;
                                    return _regenerator2.default.wrap(function _loop$(_context) {
                                        while (1) {
                                            switch (_context.prev = _context.next) {
                                                case 0:
                                                    _context.next = 2;
                                                    return _this3.shiftNextReadyTask();

                                                case 2:
                                                    task = _context.sent;

                                                case 3:
                                                    if (!(task === null)) {
                                                        _context.next = 11;
                                                        break;
                                                    }

                                                    _context.next = 6;
                                                    return _this3.delay(30);

                                                case 6:
                                                    _context.next = 8;
                                                    return _this3.shiftNextReadyTask();

                                                case 8:
                                                    task = _context.sent;
                                                    _context.next = 3;
                                                    break;

                                                case 11:
                                                    key = _this3.getContainerKey(task);

                                                    if (_this3.previewContainerMap.has(key)) {
                                                        _context.next = 14;
                                                        break;
                                                    }

                                                    return _context.abrupt("return", "continue");

                                                case 14:
                                                    _context.next = 16;
                                                    return new _promise2.default(function (res) {
                                                        try {
                                                            _this3.generatePreview(task);
                                                        } catch (err) {
                                                            console.error(err);
                                                        } finally {
                                                            //继续下一个task
                                                            res();
                                                        }
                                                    });

                                                case 16:
                                                    _context.next = 18;
                                                    return _this3.delay(100);

                                                case 18:
                                                case "end":
                                                    return _context.stop();
                                            }
                                        }
                                    }, _loop, _this3);
                                });

                            case 6:
                                if (!(this.task.length > 0)) {
                                    _context2.next = 13;
                                    break;
                                }

                                return _context2.delegateYield(_loop(), "t0", 8);

                            case 8:
                                _ret = _context2.t0;

                                if (!(_ret === "continue")) {
                                    _context2.next = 11;
                                    break;
                                }

                                return _context2.abrupt("continue", 6);

                            case 11:
                                _context2.next = 6;
                                break;

                            case 13:
                                this.isLoopBusy = false;

                            case 14:
                            case "end":
                                return _context2.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
        /**
         * 移除下一个ready的task
         */

    }, {
        key: "shiftNextReadyTask",
        value: function shiftNextReadyTask() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                var i, _task, page;

                return _regenerator2.default.wrap(function _callee2$(_context3) {
                    while (1) {
                        switch (_context3.prev = _context3.next) {
                            case 0:
                                i = 0;

                            case 1:
                                if (!(i < this.task.length)) {
                                    _context3.next = 22;
                                    break;
                                }

                                if (!(this.task[i].state === 'ready')) {
                                    _context3.next = 19;
                                    break;
                                }

                                _task = this.task[i];

                                this.task.splice(i, 1);
                                _context3.prev = 5;

                                /**
                                 * 若页面不存在，则跳到下一个任务
                                 */
                                page = this.app.room.getPage(_task.boardName, _task.pageIndex);

                                if (!page) {
                                    _context3.next = 11;
                                    break;
                                }

                                return _context3.abrupt("return", _task);

                            case 11:
                                i--;
                                return _context3.abrupt("continue", 19);

                            case 13:
                                _context3.next = 19;
                                break;

                            case 15:
                                _context3.prev = 15;
                                _context3.t0 = _context3["catch"](5);

                                i--;
                                return _context3.abrupt("continue", 19);

                            case 19:
                                i++;
                                _context3.next = 1;
                                break;

                            case 22:
                                return _context3.abrupt("return", null);

                            case 23:
                            case "end":
                                return _context3.stop();
                        }
                    }
                }, _callee2, this, [[5, 15]]);
            }));
        }
    }, {
        key: "delay",
        value: function delay(ms) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
                return _regenerator2.default.wrap(function _callee3$(_context4) {
                    while (1) {
                        switch (_context4.prev = _context4.next) {
                            case 0:
                                return _context4.abrupt("return", new _promise2.default(function (res) {
                                    setTimeout(function () {
                                        res();
                                    }, ms);
                                }));

                            case 1:
                            case "end":
                                return _context4.stop();
                        }
                    }
                }, _callee3, this);
            }));
        }
    }, {
        key: "setupExportToImgContainer",
        value: function setupExportToImgContainer() {
            var el = document.createElement('div');
            el.style.position = 'relative';
            el.style.visibility = 'hidden';
            document.body.appendChild(el);
            this.container = el;
            this.setBackgroundColor();
            this.canvas = document.createElement('canvas');
            el.appendChild(this.canvas);
            this.ctx = this.canvas.getContext('2d');
            this.ctx.lineCap = 'round';
            this.ctx.lineJoin = 'round';
        }
    }]);
    return PreviewFactory;
}();

exports.default = PreviewFactory;

/***/ }),

/***/ "./new_src/core/resource/resourceCache.ts":
/*!************************************************!*\
  !*** ./new_src/core/resource/resourceCache.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getVideoResource = exports.videoResourceLoaded = exports.getResource = exports.resourceLoaded = exports.fetchVideoResource = exports.fetchResource = undefined;

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _imageIsLoading = __webpack_require__(/*! ../../assets/image/imageIsLoading.svg */ "./new_src/assets/image/imageIsLoading.svg");

var _imageIsLoading2 = _interopRequireDefault(_imageIsLoading);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var resourceCache = {};
var videoResourceCache = {};
/**
 * 跨域图片。设置了crossOrigin属性的图片。配置了crossOrigin之后，才能够使用导出图片功能
 */
var crossOriginResourceCache = {};
var resourceReadyListeners = {};
var retryCount = {};
var RETRY_LIMIT = 10;
var fetchResource = exports.fetchResource = function fetchResource(url, cb) {
    if (!resourceCache.hasOwnProperty(url)) {
        resourceCache[url] = new Image();
        crossOriginResourceCache[url] = new Image();
        //https://stackoverflow.com/questions/22710627/tainted-canvases-may-not-be-exported
        // resourceCache[url].crossOrigin = "anonymous";
        crossOriginResourceCache[url].crossOrigin = "anonymous";
        resourceCache[url].src = url;
        crossOriginResourceCache[url].src = url;
    }
    if (typeof cb === 'function') {
        setResourceLoadedCallback(url, cb);
    }
};
var fetchVideoResource = exports.fetchVideoResource = function fetchVideoResource(url, cb) {
    if (!videoResourceCache.hasOwnProperty(url)) {
        videoResourceCache[url] = document.createElement("video");
        videoResourceCache[url].src = url;
    }
    if (typeof cb === 'function') {
        setResourceLoadedCallback(url, cb, true);
    }
};
var setResourceLoadedCallback = function setResourceLoadedCallback(url, cb) {
    var isVideo = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

    resourceReadyListeners[url] = resourceReadyListeners[url] || [];
    resourceReadyListeners[url].push(cb);
    var resource = isVideo ? videoResourceCache[url] : resourceCache[url];
    if (isVideo) {
        resource.onloadedmetadata = function () {
            var arr = resourceReadyListeners[url] || [];
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = (0, _getIterator3.default)(arr), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var _cb = _step.value;

                    _cb(resource);
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }
        };
    } else {
        resource.onload = function () {
            var arr = resourceReadyListeners[url] || [];
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = (0, _getIterator3.default)(arr), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var _cb2 = _step2.value;

                    _cb2(resource);
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }
        };
    }
    resource.onerror = function () {
        retryCount[url] || (retryCount[url] = 0);
        if (retryCount[url] < RETRY_LIMIT) {
            /**
             * 图片加载失败，尝试重新加载
             * 间隔时间为2s, 4s, 6s, 8s, .... 20s
             */
            delete resourceCache[url];
            delete resourceReadyListeners[url];
            var delay = (retryCount[url] + 1) * 2000;
            setTimeout(function () {
                if (true) {
                    console.warn('\u767D\u677F--> ' + (isVideo ? '视频' : '图片') + '\u52A0\u8F7D\u5931\u8D25\uFF0C\u7B2C' + retryCount[url] + '\u6B21\u91CD\u65B0\u52A0\u8F7D: ' + url);
                }
                if (isVideo) {
                    fetchVideoResource(url, cb);
                } else {
                    fetchResource(url, cb);
                }
            }, delay);
        }
        retryCount[url] += 1;
    };
};
var resourceLoaded = exports.resourceLoaded = function resourceLoaded(url) {
    var crossOrigin = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

    var img = crossOrigin ? crossOriginResourceCache[url] : resourceCache[url];
    return img && img.complete && img.width > 0 && img.height > 0;
};
var getResource = exports.getResource = function getResource(url) {
    var crossOrigin = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

    return crossOrigin ? crossOriginResourceCache[url] : resourceCache[url];
};
var videoResourceLoaded = exports.videoResourceLoaded = function videoResourceLoaded(url) {
    var video = videoResourceCache[url];
    return video && video.videoWidth > 0 && video.videoHeight > 0;
};
var getVideoResource = exports.getVideoResource = function getVideoResource(url) {
    return videoResourceCache[url];
};
/**
 * 加载图片正在加载中的图片
 */
resourceCache['imageLoading'] = new Image();
resourceCache['imageLoading'].src = _imageIsLoading2.default;
//https://stackoverflow.com/questions/22710627/tainted-canvases-may-not-be-exported
crossOriginResourceCache['imageLoading'] = new Image();
crossOriginResourceCache['imageLoading'].src = _imageIsLoading2.default;
crossOriginResourceCache['imageLoading'].setAttribute('crossorigin', 'anonymous');

/***/ }),

/***/ "./new_src/core/room/actions.ts":
/*!**************************************!*\
  !*** ./new_src/core/room/actions.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.gotoBoard = exports.addBoard = exports.deleteBoard = exports.addOpInRoom = exports.addGlobalOp = undefined;

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _animation = __webpack_require__(/*! ../animation */ "./new_src/core/animation/index.ts");

var _board = __webpack_require__(/*! ../board */ "./new_src/core/board/index.ts");

var _board2 = _interopRequireDefault(_board);

var _actions = __webpack_require__(/*! ../board/actions */ "./new_src/core/board/actions.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/room/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var fitToContentTimer = void 0;
/**
 * 添加全局快照，目前属于整个房间的快照仅包含视角快照
 *
 * 该函数仅在非批量场景中使用。批量场景需要在dispatchBatch中处理camera的逻辑
 *
 * @param snapshot
 */
var addGlobalOp = exports.addGlobalOp = function addGlobalOp(room, snapshot) {
    var _a;
    var camera = room.app.camera;
    /**
     * 以下情况下不会返回null
     * 1. 自由视角 + 当前用户快照
     * 2. 主播视角 + 当前用户快照
     * 3. 跟随视角 + 主播快照
     * 4. 跟随视角 + 当前用户快照（resize时发射）
     */
    var boundary = (0, _util.getCameraBoundFromGlobalOp)(room, snapshot);
    if (boundary) {
        if (snapshot.data.animate) {
            (0, _animation.transitionToCameraBound)(camera, boundary, function () {
                var _a;
                (_a = room.app.previewFactory) === null || _a === void 0 ? void 0 : _a.refreshPreviewsOfCurrBoard();
            });
        } else {
            room.app.camera.setCameraBound(boundary);
            (_a = room.app.previewFactory) === null || _a === void 0 ? void 0 : _a.refreshPreviewsOfCurrBoard();
        }
    }
};
var addOpInRoom = exports.addOpInRoom = function addOpInRoom(room, snapshot) {
    var _a;
    var _snapshot$data = snapshot.data,
        action = _snapshot$data.action,
        boardName = _snapshot$data.boardName;

    if (action === 'goto') {
        gotoBoard(room, boardName, snapshot);
    }
    if (action === 'delete') {
        deleteBoard(room, boardName, snapshot);
    }
    if (action === 'add') {
        addBoard(room, boardName, snapshot);
    }
    room.app.opsManager.hooks.addOpHook.call(snapshot, true);
    (_a = room.app.previewFactory) === null || _a === void 0 ? void 0 : _a.refreshPreviewsOfCurrBoard();
};
var deleteBoard = exports.deleteBoard = function deleteBoard(room, boardName, snapshot) {
    if (!room.boards.hasOwnProperty(boardName)) {
        if (true) {
            console.error('白板-->', "\u5220\u9664board:" + boardName + ", \u4F46\u662Fboard\u4E0D\u5B58\u5728");
        }
    } else if ((0, _keys2.default)(room.boards).length === 1) {
        if (true) {
            console.error('白板-->', "\u4E0D\u80FD\u5220\u9664\u6700\u540E\u4E00\u4E2Aboard");
        }
    } else {
        var boardNames = (0, _keys2.default)(room.boards);
        //boardName在this.boards中是第几个
        var selectBoardIndex = boardNames.indexOf(boardName);
        delete room.boards[boardName];
        //选中被删除的board的下一个board
        var nextBoardIndex = selectBoardIndex;
        if (selectBoardIndex === boardNames.length - 1) {
            //被删除的是最后一个board
            nextBoardIndex = selectBoardIndex - 1;
        }
        room.currIndex = (0, _keys2.default)(room.boards)[nextBoardIndex];
        var currBoard = room.boards[room.currIndex];
        room.app.opsManager.hooks.boardChange.call();
        (0, _actions.gotoPage)(currBoard, currBoard.currIndex, snapshot);
        clearTimeout(fitToContentTimer);
        if (!room.isReceivingBatchSnapshots) {
            fitToContentTimer = setTimeout(function () {
                if (room.app.hasBackground()) {
                    room.app.fitToContent(false);
                }
            }, 0);
        }
    }
};
/**
 * 添加新board，snapshot中包含了该board的页数
 * @param boardName
 * @param snapshot
 */
var addBoard = exports.addBoard = function addBoard(room, boardName, snapshot) {
    var displayName = snapshot.data.displayName ? snapshot.data.displayName : boardName;
    room.boards[boardName] = new _board2.default(room.app, boardName, displayName);
    room.currIndex = boardName;
    var currBoard = room.boards[room.currIndex];
    room.app.opsManager.hooks.boardChange.call();
    for (var i = 1; i < snapshot.data.pageCount; i++) {
        (0, _actions.addPage)(currBoard, undefined, snapshot);
    }
    (0, _actions.gotoPage)(currBoard, 0, snapshot);
    clearTimeout(fitToContentTimer);
    if (!room.isReceivingBatchSnapshots) {
        fitToContentTimer = setTimeout(function () {
            if (room.app.hasBackground()) {
                room.app.fitToContent(false);
            }
        }, 0);
    }
};
var gotoBoard = exports.gotoBoard = function gotoBoard(room, boardName, snapshot) {
    if (!room.boards.hasOwnProperty(boardName)) {
        room.boards[boardName] = new _board2.default(room.app, boardName, boardName);
    }
    room.currIndex = boardName;
    var currBoard = room.boards[room.currIndex];
    room.app.opsManager.hooks.boardChange.call();
    (0, _actions.gotoPage)(currBoard, currBoard.currIndex, snapshot);
    if (room.app.hasBackground() && !room.isReceivingBatchSnapshots) {
        room.app.fitToContent(false);
    }
};

/***/ }),

/***/ "./new_src/core/room/index.ts":
/*!************************************!*\
  !*** ./new_src/core/room/index.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _board2 = __webpack_require__(/*! ../board */ "./new_src/core/board/index.ts");

var _board3 = _interopRequireDefault(_board2);

var _types = __webpack_require__(/*! ../ops/types */ "./new_src/core/ops/types.ts");

var _animation = __webpack_require__(/*! ../animation */ "./new_src/core/animation/index.ts");

var _actions = __webpack_require__(/*! ./actions */ "./new_src/core/room/actions.ts");

var _util = __webpack_require__(/*! ./util */ "./new_src/core/room/util.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Room = function () {
    function Room(app, dataHub) {
        var _this = this;

        (0, _classCallCheck3.default)(this, Room);

        this.currIndex = 'whiteboard';
        this.isReceivingBatchSnapshots = false;
        this.boards = {};
        this.pkgIdOpIdMap = {};
        this.pageToRefresh = undefined;
        this.pageToIncRefresh = undefined;
        /**
         * 所有快照的数据之源
         */
        this.opIdSnapshotMap = {};
        //文档类快照的opId
        this.boardsSnapshotIds = [];
        //全局快照的opId
        this.globalSnapshotIds = [];
        this.boardOps = {};
        this._startRefreshLoop2 = function () {
            cancelAnimationFrame(_this.refreshAnimationTimer);
            _this.refreshAnimationTimer = requestAnimationFrame(_this._startRefreshLoop2);
            if (_this.pageToRefresh && _this.pageToRefresh === _this.currBoard.currPage) {
                _this.currBoard.currPage.refresh();
                _this.pageToRefresh = undefined;
            }
            if (_this.pageToIncRefresh && _this.pageToIncRefresh === _this.currBoard.currPage) {
                _this.currBoard.currPage.incRefresh();
                _this.pageToIncRefresh = undefined;
            }
        };
        this.app = app;
        this.dataHub = dataHub;
        this._init();
    }

    (0, _createClass3.default)(Room, [{
        key: "getBoardDisplayNames",
        value: function getBoardDisplayNames() {
            var _this2 = this;

            return (0, _keys2.default)(this.boards).map(function (boardName) {
                return _this2.boards[boardName].displayName;
            });
        }
    }, {
        key: "getPage",
        value: function getPage(boardName, pageIndex) {
            var board = this.boards[boardName];
            if (!board) {
                throw new Error("\u627E\u4E0D\u5230\u540D\u5B57\u4E3A" + boardName + "\u7684\u767D\u677F\uFF0C\u5F53\u524D\u623F\u95F4\u767D\u677F\u5217\u8868\u4E3A: " + (0, _keys2.default)(this.app.room.boards).join(","));
            }
            var page = board.pages[pageIndex];
            if (!page) {
                throw new Error("\u627E\u4E0D\u5230\u7D22\u5F15\u4E3A" + pageIndex + "\u7684\u767D\u677F\u9875\uFF0C\u5F53\u524D\u623F\u95F4\u767D\u677F\u9875\u7801\u4E3A: " + board.pageNames.join(","));
            }
            return page;
        }
        /**
         * @param partial
         * @returns
         */

    }, {
        key: "recoverFullSnapshot",
        value: function recoverFullSnapshot(partial) {
            if (!this.opIdSnapshotMap.hasOwnProperty(partial.opId)) {
                return partial;
            }
            var baseOp = this.opIdSnapshotMap[partial.opId].snapshot;
            return this.app.opsManager.mergePartial(baseOp, partial);
        }
        /**
         * 清空当前会话周期中所有的快照信息。
         * 连接云信白板2.0服务器时使用该函数，在主播重新连接时，主播和听众使用该函数清空所有白板状态
         */

    }, {
        key: "reset",
        value: function reset() {
            var _a, _b, _c;
            if (true) {
                console.log('白板-->', 'room.reset');
            }
            this._init();
            (_b = (_a = this.currBoard) === null || _a === void 0 ? void 0 : _a.currPage) === null || _b === void 0 ? void 0 : _b.cleanNonCanvasElements();
            // this.currBoard?.currPage?.refresh()
            this.pageToRefresh = (_c = this.currBoard) === null || _c === void 0 ? void 0 : _c.currPage;
        }
        /**
         * 开启批量接收快照
         * 批量接收期间，中间的许多快照的refresh可以省略
         */

    }, {
        key: "beginReceiveBatchSnapshots",
        value: function beginReceiveBatchSnapshots() {
            this.isReceivingBatchSnapshots = true;
        }
        /**
         * 结束批量接收快照
         * 批量接收结束时，refresh应该被refresh的部分
         */

    }, {
        key: "endReceiveBatchSnapshots",
        value: function endReceiveBatchSnapshots(boundaries, hasBoardAction, cb) {
            var _this3 = this;

            var _a, _b, _c;
            this.isReceivingBatchSnapshots = false;
            this.currBoard.currPage.calcDrawOpQueue();
            if (boundaries.length > 0) {
                var lastBoundaryData = boundaries[boundaries.length - 1];
                if (lastBoundaryData.boundary.width > 0 && lastBoundaryData.boundary.height > 0) {
                    if (lastBoundaryData.animate) {
                        (0, _animation.transitionToCameraBound)(this.app.camera, lastBoundaryData.boundary, function () {
                            var _a;
                            (_a = _this3.app.previewFactory) === null || _a === void 0 ? void 0 : _a.refreshPreviewsOfCurrBoard();
                            if (typeof cb === 'function') {
                                cb(true);
                            }
                        });
                    } else {
                        this.app.camera.setCameraBound(lastBoundaryData.boundary);
                        (_a = this.app.previewFactory) === null || _a === void 0 ? void 0 : _a.refreshPreviewsOfCurrBoard();
                        if (typeof cb === 'function') {
                            cb(true);
                        }
                    }
                } else if (typeof cb === 'function') {
                    cb(false);
                }
            } else {
                // this.currBoard.currPage.refresh()
                this.pageToRefresh = this.currBoard.currPage;
                /**
                 * 有文档新增，删除，跳转等操作时，整个文档都需要重新制作
                 */
                if (hasBoardAction) {
                    (_b = this.app.previewFactory) === null || _b === void 0 ? void 0 : _b.refreshPreviewsOfCurrBoard();
                } else {
                    (_c = this.app.previewFactory) === null || _c === void 0 ? void 0 : _c.refreshPreviewsOfCurrPage();
                }
                if (typeof cb === 'function') {
                    cb(false);
                }
            }
        }
        /**
         * 发送本地动作快照给远程服务器
         * @param snapshot
         */

    }, {
        key: "dispatch",
        value: function dispatch(snapshot) {
            // if (snapshot.data.type !== 'mouse-pointer') {
            //     console.warn('dispatch', snapshot)
            // }
            /**
             * 本地动作，且当前属于不可编辑状态，且动作不是camera动作时，返回
             */
            var isCameraSnapshot = _types.cameraSnapshotTypes.indexOf(snapshot.data.type) !== -1;
            //如果camera-bound的宽高设置为0，则出现了一些意外
            if (snapshot.data.type === 'camera-bound' && (snapshot.data.boundary.width === 0 || snapshot.data.boundary.height === 0)) {
                console.error('白板--> error, camera-bound的宽高为0', snapshot);
                return;
            }
            if (!this.app.editable && !isCameraSnapshot) {
                // return this.editEnabled && !this.dataHub.isSynchronizing && this.isConnected
                if (this.app.isRecordPlayer) {
                    return;
                }
                if (!this.app.editEnabled) {
                    console.warn('白板--> 请先开启编辑再修改白板');
                } else if (!this.app.isConnected) {
                    console.warn('白板--> 网络未连接，请等待网络恢复再修改白板');
                } else if (!this.dataHub.isSynchronizing) {
                    console.warn('白板--> 请等待同步完成再修改白板');
                }
                return;
            }
            if (this.dataHub.isSynchronizing) {
                return;
            }
            var fakeServerId = this.dataHub.sendSnapshot(snapshot);
            this.execSnapshot({
                snapshot: snapshot,
                //TODO
                pkgId: fakeServerId
            });
        }
    }, {
        key: "execSnapshot",
        value: function execSnapshot(_pkg) {
            var pkg = {
                pkgId: _pkg.pkgId,
                snapshot: this.recoverFullSnapshot(_pkg.snapshot)
            };
            this.cacheSnapshot(pkg);
            this.pushSnapshotToQueue(pkg);
            var snapshot = pkg.snapshot;
            if (snapshot.category === 'inPageOp') {
                //页面内操作
                var page = this.getPage(snapshot.board, snapshot.page.toString());
                page.addOpInPage(snapshot);
            } else if (snapshot.category === 'pageOp') {
                //页面操作: add/goto/delete
                var board = this.boards[snapshot.board];
                if (board) {
                    board.addOpInBoard(snapshot);
                }
            } else if (snapshot.category === 'globalOp') {
                //全局操作： pan/zoom
                (0, _actions.addGlobalOp)(this, snapshot);
            } else {
                //文档操作
                (0, _actions.addOpInRoom)(this, snapshot);
            }
        }
        /**
         * 从远程批量接收快照
         * 同步或者录像回放的seekTo时触发
         * @param snapshots
         */

    }, {
        key: "execBatchSnapshots",
        value: function execBatchSnapshots(_pkgArr, cb) {
            var _this4 = this;

            var pkgArr = _pkgArr.map(function (_pkg) {
                var pkg = {
                    pkgId: _pkg.pkgId,
                    snapshot: _this4.recoverFullSnapshot(_pkg.snapshot)
                };
                _this4.cacheSnapshot(pkg);
                return pkg;
            });
            /**
             * allInPage: 同一个批次里的数据都是页面内数据
             */
            var allInPage = pkgArr.filter(function (pkg) {
                return pkg.snapshot.category !== 'inPageOp';
            }).length === 0;
            var hasBoardAction = pkgArr.filter(function (pkg) {
                return pkg.snapshot.category === 'boardOp';
            }).length > 0;
            var boundaryData = pkgArr.filter(function (pkg) {
                return pkg.snapshot.category === 'globalOp' && pkg.snapshot.data.type === 'camera-bound';
            }).map(function (pkg) {
                return {
                    animate: pkg.snapshot.data.animate,
                    boundary: (0, _util.getCameraBoundFromGlobalOp)(_this4, pkg.snapshot)
                };
            }).filter(function (boundary) {
                return boundary.boundary;
            });
            var nonCameraPkg = pkgArr.filter(function (pkg) {
                return pkg.snapshot.category !== 'globalOp' || pkg.snapshot.data.type !== 'camera-bound';
            });
            if (allInPage) {
                /**
                 * 都是页面内数据，将快照一个个加到页面中(addInPage)处理。
                 * 如果需要refresh，则记录下来，统一处理完之后再refresh。
                 * 如果不需要refresh，则每次调用addOpSnapshot会增量绘制
                 */
                var needRefresh = false;
                nonCameraPkg.forEach(function (pkg) {
                    _this4.pushSnapshotToQueue(pkg);
                    var snapshot = pkg.snapshot;
                    var page = _this4.getPage(snapshot.board, snapshot.page.toString());
                    needRefresh = page.addOpInPage(snapshot, false) || needRefresh;
                });
                /**
                 * 之所以和含有非inPageOp分开处理，是因为allInPage可能不需要refresh
                 * 比如说连续的涂鸦操作，在addOpInPage时会绘制增量部分，不会全部refresh
                 */
                if (needRefresh) {
                    this.endReceiveBatchSnapshots([], false, cb);
                } else if (typeof cb === 'function') {
                    cb(false);
                }
            } else {
                this.beginReceiveBatchSnapshots();
                try {
                    var _iteratorNormalCompletion = true;
                    var _didIteratorError = false;
                    var _iteratorError = undefined;

                    try {
                        for (var _iterator = (0, _getIterator3.default)(nonCameraPkg), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                            var pkg = _step.value;

                            this.execSnapshot(pkg);
                        }
                    } catch (err) {
                        _didIteratorError = true;
                        _iteratorError = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion && _iterator.return) {
                                _iterator.return();
                            }
                        } finally {
                            if (_didIteratorError) {
                                throw _iteratorError;
                            }
                        }
                    }
                } finally {
                    this.endReceiveBatchSnapshots(boundaryData, hasBoardAction, cb);
                }
            }
        }
        /**
         * 将快照缓存起来
         * @param pkg
         */

    }, {
        key: "cacheSnapshot",
        value: function cacheSnapshot(pkg) {
            var _a;
            var opId = pkg.snapshot.opId;
            var pkgId = pkg.pkgId;
            if (this.opIdSnapshotMap[opId]) {
                pkg.snapshot = this.recoverFullSnapshot(pkg.snapshot);
                /**
                 * 该快照之前已经存在, 从pkgIdOpIdMap中删除原来pkg对应的入口
                 */
                var oldPkgId = this.opIdSnapshotMap[opId].pkgId;
                var index = this.pkgIdOpIdMap[oldPkgId].indexOf(opId);
                this.pkgIdOpIdMap[oldPkgId].splice(index, 1);
                if (this.pkgIdOpIdMap[oldPkgId].length === 0) {
                    delete this.pkgIdOpIdMap[oldPkgId];
                }
            }
            this.opIdSnapshotMap[opId] = pkg;
            (_a = this.pkgIdOpIdMap)[pkgId] || (_a[pkgId] = []);
            this.pkgIdOpIdMap[pkgId].push(opId);
        }
    }, {
        key: "pushSnapshotToQueue",
        value: function pushSnapshotToQueue(pkg) {
            var _a, _b;
            var category = pkg.snapshot.category;
            var opId = pkg.snapshot.opId;
            var pkgId = pkg.pkgId;
            if (category === 'globalOp') {
                this._pushSnapshotInArray(opId, pkgId, this.globalSnapshotIds);
            } else if (category === 'boardOp') {
                this._pushSnapshotInArray(opId, pkgId, this.boardsSnapshotIds);
            } else if (pkg.snapshot.category === 'pageOp') {
                var board = pkg.snapshot.board;
                if (!this.boardOps.hasOwnProperty(board)) {
                    this.boardOps[board] = {
                        pageSnapshotIds: [],
                        pages: {}
                    };
                }
                (_a = this.boardOps[board]).pageSnapshotIds || (_a.pageSnapshotIds = []);
                this._pushSnapshotInArray(opId, pkgId, this.boardOps[board].pageSnapshotIds);
            } else if (pkg.snapshot.category === 'inPageOp') {
                var _board = pkg.snapshot.board;
                var page = pkg.snapshot.page;
                if (!this.boardOps.hasOwnProperty(_board)) {
                    this.boardOps[_board] = {
                        pageSnapshotIds: [],
                        pages: {}
                    };
                }
                if (!this.boardOps[_board].pages.hasOwnProperty(page)) {
                    this.boardOps[_board].pages[page] = {
                        inPageSnapshotIds: []
                    };
                }
                (_b = this.boardOps[_board].pages[page]).inPageSnapshotIds || (_b.inPageSnapshotIds = []);
                this._pushSnapshotInArray(opId, pkgId, this.boardOps[_board].pages[page].inPageSnapshotIds);
            }
        }
        /**
         * 将opId push到arr中，要求如果：
         * 1. arr中不能有重复的opId
         * 2. arr中每一个opId代表的包都递增。包可以通过snapshotMap查询
         *
         * 若opId不存在于arr中，则找到合适的位置插入
         * 若opId存在，则先将原来的元素删除，然后找到合适的位置插入
         * @param opId
         * @param arr
         */

    }, {
        key: "_pushSnapshotInArray",
        value: function _pushSnapshotInArray(opId, pkgId, arr) {
            var index = arr.indexOf(opId);
            if (index !== -1) {
                arr.splice(index, 1);
            }
            for (var i = arr.length; i >= 0; i--) {
                if (i === 0) {
                    arr.splice(i, 0, opId);
                    break;
                } else {
                    var pkgIdInArr = this.opIdSnapshotMap[arr[i - 1]].pkgId;
                    if (pkgIdInArr <= pkgId) {
                        arr.splice(i, 0, opId);
                        break;
                    }
                }
            }
        }
        /**
         * 合并延迟发送的数据
         *
         * 从第一个到最后一个遍历：
         * 1. 没有相同的opId，加到队列中
         * 2. 有相同的opId，自己是partial，如果之前有完整的，则合并到完整的，如果之前是partial，则合并到partial
         *    有相同的opId，自己是完整，则覆盖之前的快照
         * @param data
         */

    }, {
        key: "mergeDebouncedData",
        value: function mergeDebouncedData(dataArr, dataType) {
            if (dataType !== 'snapshot' && dataArr.length > 0) {
                return dataArr[dataArr.length - 1];
            } else if (dataType !== 'snapshot') {
                throw new Error('白板--> mergeDebounceData, dataArr is empty!!');
            }
            var map = {};
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = (0, _getIterator3.default)(dataArr), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var entry = _step2.value;

                    if (entry.type === 'vision') {
                        map['vision'] = entry;
                    } else if (!map.hasOwnProperty(entry.value.opId)) {
                        map[entry.value.opId] = entry.value;
                    } else if (!entry.value.hasOwnProperty('category')) {
                        //之前有数据存在, 当前数据是部分数据
                        if (map[entry.value.opId].hasOwnProperty('category')) {
                            map[entry.value.opId] = this.app.opsManager.mergePartial(map[entry.value.opId], entry.value);
                        } else {
                            map[entry.value.opId] = this.app.opsManager.mergeTwoPartial(map[entry.value.opId], entry.value);
                        }
                    } else {
                        //之前有数据存在，但新数据是完整数据，直接覆盖旧数据就好
                        map[entry.value.opId] = entry.value;
                    }
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }

            if ((0, _keys2.default)(map).length === 1) {
                return {
                    type: 'snapshot',
                    value: (0, _keys2.default)(map).map(function (id) {
                        return map[id];
                    })[0]
                };
            } else {
                return {
                    type: 'snapshotArr',
                    value: (0, _keys2.default)(map).map(function (id) {
                        return map[id];
                    })
                };
            }
        }
    }, {
        key: "_init",
        value: function _init() {
            var whiteboard = new _board3.default(this.app, 'whiteboard', 'whiteboard');
            this.boards = {
                'whiteboard': whiteboard
            };
            this.currIndex = 'whiteboard';
            this.pkgIdOpIdMap = {};
            this.opIdSnapshotMap = {};
            this.boardsSnapshotIds = [];
            this.globalSnapshotIds = [];
            this.boardOps = {};
            this._startRefreshLoop();
        }
    }, {
        key: "_startRefreshLoop",
        value: function _startRefreshLoop() {
            cancelAnimationFrame(this.refreshAnimationTimer);
            this._startRefreshLoop2();
        }
    }, {
        key: "currBoard",
        get: function get() {
            return this.boards[this.currIndex];
        }
    }]);
    return Room;
}(); /**
      * 一个白板应用中含有一个房间。房间在通信中和频道一一对应
      *
      * 一个房间包含一个白板(WhiteBoard)，以及0到N个文件白板(FileBoard)。
      *
      * 每个白板包含1到N个子页面
      */


exports.default = Room;

/***/ }),

/***/ "./new_src/core/room/util.ts":
/*!***********************************!*\
  !*** ./new_src/core/room/util.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
/**
* 返回非null时，才需要更新本地视角
* @param snapshot
*/
var getCameraBoundFromGlobalOp = exports.getCameraBoundFromGlobalOp = function getCameraBoundFromGlobalOp(room, snapshot) {
    var camera = room.app.camera;
    var vision = room.app.vision;
    if (snapshot.data.type === 'camera-bound') {
        camera.cameraBoundByUser[snapshot.uid] = snapshot.data.boundary;
        if (vision.mode === 'freeObserver' && snapshot.uid === room.app.account) {
            return snapshot.data.boundary;
        } else if (vision.mode === 'broadcaster' && snapshot.uid === room.app.account) {
            return snapshot.data.boundary;
        } else if (vision.mode === 'follower' && snapshot.uid === vision.broadcaster) {
            return snapshot.data.boundary;
        } else if (vision.mode === 'follower' && snapshot.uid === room.app.account) {
            /**
             * 本地窗口resize时，设置cameraBound调整canvas缩放值
             */
            return snapshot.data.boundary;
        }
    }
    return null;
};

/***/ }),

/***/ "./new_src/core/simulator/index.ts":
/*!*****************************************!*\
  !*** ./new_src/core/simulator/index.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Simulator = function () {
    function Simulator(app) {
        (0, _classCallCheck3.default)(this, Simulator);

        this._lastDirection = 0;
        this._interruptFreeDraw = false;
        this.app = app;
    }

    (0, _createClass3.default)(Simulator, [{
        key: 'reconnect',
        value: function reconnect() {
            var rebuildSocket = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
            var resetApp = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

            console.log('DEV--> \u6A21\u62DF\u91CD\u8FDE\uFF0C \u662F\u5426\u6E05\u7A7A\u6570\u636E: ' + resetApp + ', \u662F\u5426\u91CD\u65B0\u521B\u5EFAsocket\u8FDE\u63A5: ' + rebuildSocket);
            if (resetApp) {
                this.app.resetState();
            }
            if (rebuildSocket) {
                this.app.dataHub.handler._simulateReconnect();
            } else {
                /**
                 * 不断开socket，重新请求同步数据
                 */
                this.app.readyToSyncData();
            }
        }
    }, {
        key: 'generateRandomLines',
        value: function generateRandomLines(points, repeat) {
            var intervalBtwPoints = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 15;
            var intervalBtwLines = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1000;

            this._interruptFreeDraw = false;
            this._generateRandomLines(points, repeat, intervalBtwPoints, intervalBtwLines);
        }
    }, {
        key: 'interruptRandomLines',
        value: function interruptRandomLines() {
            this._interruptFreeDraw = true;
        }
    }, {
        key: '_generateRandomLines',
        value: function _generateRandomLines(points, repeat) {
            var _this = this;

            var intervalBtwPoints = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 15;
            var intervalBtwLines = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1000;

            console.log('\u6B63\u5728\u751F\u6210\u968F\u673A\u7EBF\u6BB5\uFF0C\u8FD8\u5269\u4F59' + repeat + '\u6B21');
            if (this._interruptFreeDraw) {
                return console.log('随机涂鸦被打断');
            }
            if (repeat <= 0) {
                return;
            }
            setTimeout(function () {
                _this._generateRandomLines2(points, intervalBtwPoints).then(function () {
                    return _this._generateRandomLines(points, repeat - 1, intervalBtwPoints, intervalBtwLines);
                });
            }, intervalBtwLines);
        }
    }, {
        key: '_generateRandomLines2',
        value: function _generateRandomLines2(total, intervalBtwPoints) {
            var _this2 = this;

            var el = this.app.container.el;
            var width = el.offsetWidth;
            var height = el.offsetHeight;
            var x = Math.random() * width;
            var y = Math.random() * height;
            var event = new MouseEvent('mousedown', {
                clientX: x,
                clientY: y
            });
            this.app.container.el.dispatchEvent(event);
            var promise = this._simulateMouseMove(x, y, 0);

            var _loop = function _loop(i) {
                promise = promise.then(function (lastXY) {
                    if (intervalBtwPoints > 0) {
                        return new _promise2.default(function (res) {
                            setTimeout(function () {
                                res(lastXY);
                            }, intervalBtwPoints);
                        });
                    } else {
                        return lastXY;
                    }
                }).then(function (res) {
                    if (_this2._interruptFreeDraw) {
                        return _promise2.default.reject(res);
                    }
                    return _this2._simulateMouseMove(res.x, res.y, i);
                });
            };

            for (var i = 0; i < total; i++) {
                _loop(i);
            }
            return promise.catch(function (res) {
                return res;
            }).then(function (res) {
                event = new MouseEvent('mouseup', {
                    clientX: res.x,
                    clientY: res.y
                });
                document.dispatchEvent(event);
            });
        }
    }, {
        key: '_simulateMouseMove',
        value: function _simulateMouseMove(x, y, currIndex) {
            var _this3 = this;

            return new _promise2.default(function (res) {
                setTimeout(function () {
                    var _getDxDy2 = _this3._getDxDy(currIndex),
                        _getDxDy3 = (0, _slicedToArray3.default)(_getDxDy2, 2),
                        dx = _getDxDy3[0],
                        dy = _getDxDy3[1];

                    x += dx;
                    y += dy;
                    var event = new MouseEvent('mousemove', {
                        clientX: x,
                        clientY: y
                    });
                    document.dispatchEvent(event);
                    res({
                        x: x, y: y
                    });
                }, 0);
            });
        }
    }, {
        key: '_getDxDy',
        value: function _getDxDy(currIndex) {
            var RANDOM_BASE = 10;
            var TURN_AFTER = 30;
            if (currIndex % TURN_AFTER === 0) {
                this._lastDirection = Math.floor(Math.random() * 4);
            }
            if (this._lastDirection === 0) {
                return [Math.random() * RANDOM_BASE, Math.random() * RANDOM_BASE];
            } else if (this._lastDirection === 1) {
                return [Math.random() * RANDOM_BASE, Math.random() * -RANDOM_BASE];
            } else if (this._lastDirection === 2) {
                return [Math.random() * -RANDOM_BASE, Math.random() * RANDOM_BASE];
            } else {
                return [Math.random() * -RANDOM_BASE, Math.random() * -RANDOM_BASE];
            }
        }
    }]);
    return Simulator;
}();

exports.default = Simulator;

/***/ }),

/***/ "./new_src/core/types.ts":
/*!*******************************!*\
  !*** ./new_src/core/types.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});
var PlatformArray = exports.PlatformArray = ['android', 'ios', 'pc', 'mac', 'pad', 'web'];
var TouchPlatformArray = exports.TouchPlatformArray = ['android', 'ios', 'pad'];

/***/ }),

/***/ "./new_src/recordPlayer/TickTick.ts":
/*!******************************************!*\
  !*** ./new_src/recordPlayer/TickTick.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.DEFAULT_INTERVAL = undefined;

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DEFAULT_INTERVAL = exports.DEFAULT_INTERVAL = 10; /**
                                                       * 滴答滴答报时器。
                                                       *
                                                       * 处于play状态时，每隔一段时间会向外发送tick事件。
                                                       */

var TickTick = function (_EventEmitter) {
    (0, _inherits3.default)(TickTick, _EventEmitter);

    function TickTick() {
        (0, _classCallCheck3.default)(this, TickTick);

        var _this = (0, _possibleConstructorReturn3.default)(this, (TickTick.__proto__ || (0, _getPrototypeOf2.default)(TickTick)).apply(this, arguments));

        _this.state = 'pause';
        //currTimeStamp是相对于最早Track的起始时间偏移量
        _this.currTimeStamp = 0;
        //lastRealTime是上一次记录的真实时间
        _this.lastRealTime = undefined;
        _this.rate = 1;
        _this.microTask = function () {
            if (_this.state === 'play') {
                _this.tick();
            }
        };
        return _this;
    }

    (0, _createClass3.default)(TickTick, [{
        key: 'destory',
        value: function destory() {
            var _this2 = this;

            this.pause();
            this.eventNames().forEach(function (name) {
                return _this2.off(name);
            });
        }
    }, {
        key: 'tick',
        value: function tick() {
            var now = Date.now();
            if (this.lastRealTime === undefined) {
                this.lastRealTime = now;
                return;
            } else {
                var passedGap = (now - this.lastRealTime) * this.rate;
                this.currTimeStamp = this.currTimeStamp + passedGap;
                this.lastRealTime = now;
                this.emit('tick', this.currTimeStamp);
            }
        }
    }, {
        key: 'pause',
        value: function pause() {
            if (this.timer) {
                window.clearInterval(this.timer);
            }
            this.timer = undefined;
            this.lastRealTime = undefined;
            this.state = 'pause';
            this.emit('pause');
        }
    }, {
        key: 'play',
        value: function play() {
            if (!this.timer) {
                this.timer = setInterval(this.microTask, DEFAULT_INTERVAL);
            }
            this.state = 'play';
            this.emit('play');
        }
    }, {
        key: 'setCurrentTime',
        value: function setCurrentTime() {
            var timeStamp = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;

            this.currTimeStamp = timeStamp;
            this.lastRealTime = undefined;
        }
    }]);
    return TickTick;
}(_eventemitter.EventEmitter);

exports.default = TickTick;

/***/ }),

/***/ "./new_src/recordPlayer/Timeline.ts":
/*!******************************************!*\
  !*** ./new_src/recordPlayer/Timeline.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

var _TickTick = __webpack_require__(/*! ./TickTick */ "./new_src/recordPlayer/TickTick.ts");

var _TickTick2 = _interopRequireDefault(_TickTick);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

var Timeline = function (_EventEmitter) {
    (0, _inherits3.default)(Timeline, _EventEmitter);

    function Timeline(tracks) {
        (0, _classCallCheck3.default)(this, Timeline);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Timeline.__proto__ || (0, _getPrototypeOf2.default)(Timeline)).call(this));

        _this.tracks = tracks;
        _this.ticker = new _TickTick2.default();
        _this.endTimeStamp = 0;
        /**
         * waitingToPlay表示部分Track暂时无法播放。
         * 一旦所有Track准备好了(canplay), timeline将自动开始播放
         */
        _this.state = 'pause';
        _this.busy = false; // 主要是用于异步操作时，防止多次调用导致的状态不统一
        _this.handleTrackVisibleChange = function (type, params, callback) {
            _this.emit('visibleChange', type, params, callback);
        };
        /**
         * ticktick发送tick事件，将track播放至ticktick发送的时间(time)
         * @param time
         */
        _this.update = function (time) {
            return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _this2 = this;

                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                if (this.state !== 'play') {
                                    console.error('update应该处于play状态下才调用');
                                }
                                _context.next = 3;
                                return _promise2.default.all(this.tracks.map(function (track) {
                                    return track.update(time);
                                }));

                            case 3:
                                if (this.tracks.every(function (track) {
                                    return track.state === 'finished';
                                })) {
                                    setTimeout(function () {
                                        _this2._doPause();
                                        _this2.state = 'finished';
                                        _this2.emit('finished');
                                    });
                                }

                            case 4:
                            case "end":
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        };
        _this.initTrack(tracks);
        _this.bindTickerEvents();
        return _this;
    }

    (0, _createClass3.default)(Timeline, [{
        key: "initTrack",
        value: function initTrack(tracks) {
            var _this3 = this;

            this.tracks = tracks.slice();
            // 计算出轨道的起始时间戳
            var minTimestamp = getMinTimeStamp(tracks);
            var readyQueue = getInitQueue(tracks, minTimestamp);
            console.log('init every track');
            // 先初始化白板的录制文件
            _promise2.default.all(readyQueue).then(function (list) {
                console.log('every track inited');
                var badTracks = _this3.tracks.filter(function (t, index) {
                    return list[index] === 'error';
                });
                _this3.tracks = _this3.tracks.filter(function (t, index) {
                    return list[index] === 'ready';
                });
                if (badTracks.length > 0) {
                    _this3.emit('error', 'bad track');
                }
                _this3.endTimeStamp = getMaxTimeStamp(tracks);
                _this3.bindTrackEvents();
                console.log('timeline ready');
                var viewerArr = [];
                _this3.tracks.forEach(function (track) {
                    if (Array.isArray(track['viewerArr'])) {
                        track['viewerArr'].forEach(function (viewer) {
                            if (!viewerArr.includes(viewer)) {
                                viewerArr.push(viewer);
                            }
                        });
                    }
                });
                if (viewerArr.length === 0) {
                    viewerArr.push('unknown');
                }
                _this3.emit('ready', {
                    beginTimeStamp: minTimestamp,
                    endTimeStamp: _this3.endTimeStamp + minTimestamp,
                    duration: _this3.endTimeStamp,
                    viewerArr: viewerArr
                });
            });
        }
    }, {
        key: "bindTrackEvents",
        value: function bindTrackEvents() {
            var _this4 = this;

            this.tracks.forEach(function (track) {
                // 给每个轨道绑定事件
                track.on('visibleChange', _this4.handleTrackVisibleChange);
                track.on('waitingToPlay', function () {
                    return _this4.handleTrackWaitingToPlay();
                });
                track.on('canplay', function () {
                    return _this4.handleTrackCanPlay();
                });
            });
        }
    }, {
        key: "bindTickerEvents",
        value: function bindTickerEvents() {
            var _this5 = this;

            this.ticker.on('tick', function (time) {
                _this5.emit('tick', time);
                _this5.update(time);
            });
            this.ticker.on('pause', function () {
                _this5.emit('pause');
            });
            this.ticker.on('play', function () {
                _this5.emit('play');
            });
        }
        /**
         * Track发送waitingToPlay消息，表示Track目前阻塞中。
         * 如果Timeline状态为播放中，改为等待播放。如果为暂停，或者结束，则不用额外处理
         */

    }, {
        key: "handleTrackWaitingToPlay",
        value: function handleTrackWaitingToPlay() {
            if (this.state === 'play' && this.hasTrackWaiting()) {
                this.state = 'waitingToPlay';
                this._doPause();
            }
        }
        /**
         * 某个Track转为非阻塞状态。
         * 如果当前状态为等待播放，且没有track阻塞，则开始播放轨道
         */

    }, {
        key: "handleTrackCanPlay",
        value: function handleTrackCanPlay() {
            if (this.state === 'waitingToPlay' && !this.hasTrackWaiting()) {
                this.state = 'play';
                this._doPlay();
            }
        }
        /**
         * 某些track在currTimeStamp这个时间点上还没准备好数据或者容器
         */

    }, {
        key: "hasTrackWaiting",
        value: function hasTrackWaiting() {
            var _this6 = this;

            return this.tracks.find(function (track) {
                return track.isWaiting(_this6.ticker.currTimeStamp);
            }) !== undefined;
        }
        /**
         * 暂停播放。
         * 停止ticker，ticker会停止tick事件，这会阻止白板播放
         * 停止track, 会暂停音视频Track播放
         */

    }, {
        key: "pause",
        value: function pause() {
            if (this.busy) {
                //  繁忙状态下，不允许二次操作
                console.warn('busy pause');
                return;
            }
            if (this.state === 'play') {
                this._doPause();
            }
            if (this.state !== 'finished') {
                this.state = 'pause';
            }
        }
        /**
         * 播放。要每段track都能够播放，才能够继续播放
         * 如果处于waitingToPlay，则还有资源被阻塞
         */

    }, {
        key: "play",
        value: function play() {
            if (this.busy) {
                //  繁忙状态下，不允许二次操作
                console.warn('busy play');
                return;
            }
            if (this.state !== 'finished') {
                if (!this.hasTrackWaiting()) {
                    this.state = 'play';
                    this._doPlay();
                } else {
                    this.state = 'waitingToPlay';
                }
            } else {
                //重新开始播放
                this.state = 'play';
                this.seekTo(0);
            }
        }
    }, {
        key: "setPlaySpeed",
        value: function setPlaySpeed(speed) {
            this.ticker.rate = speed;
            this.tracks.forEach(function (track) {
                track.setPlaySpeed(speed);
            });
        }
    }, {
        key: "setViewer",
        value: function setViewer(viewer) {
            this.tracks.forEach(function (track) {
                return track.setViewer(viewer);
            });
        }
        /**
         * 跳转track至time
         * @param time
         */

    }, {
        key: "seekTo",
        value: function seekTo(time) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                if (!this.busy) {
                                    _context2.next = 2;
                                    break;
                                }

                                return _context2.abrupt("return");

                            case 2:
                                //时间范围不能超出录像时间范围
                                time = Math.min(Math.max(time, 0), this.endTimeStamp);
                                //  如果在下两个时钟周期内，那么这个跳转就丢弃

                                if (!(this.ticker.currTimeStamp < time && time < this.ticker.currTimeStamp + _TickTick.DEFAULT_INTERVAL * 2)) {
                                    _context2.next = 5;
                                    break;
                                }

                                return _context2.abrupt("return");

                            case 5:
                                if (!(time < this.ticker.currTimeStamp)) {
                                    _context2.next = 20;
                                    break;
                                }

                                // 往回退
                                if (this.state === 'finished') {
                                    this.state = 'pause';
                                }
                                this.busy = true;
                                this.ticker.setCurrentTime(time);
                                _context2.prev = 9;
                                _context2.next = 12;
                                return _promise2.default.all(this.tracks.map(function (track) {
                                    return track.seekTo(time, false);
                                }));

                            case 12:
                                _context2.next = 17;
                                break;

                            case 14:
                                _context2.prev = 14;
                                _context2.t0 = _context2["catch"](9);

                                console.error(_context2.t0);

                            case 17:
                                this.busy = false;
                                _context2.next = 31;
                                break;

                            case 20:
                                // 往前进
                                this.busy = true;
                                this.ticker.setCurrentTime(time);
                                _context2.prev = 22;
                                _context2.next = 25;
                                return _promise2.default.all(this.tracks.map(function (track) {
                                    return track.seekTo(time, true);
                                }));

                            case 25:
                                _context2.next = 30;
                                break;

                            case 27:
                                _context2.prev = 27;
                                _context2.t1 = _context2["catch"](22);

                                console.error(_context2.t1);

                            case 30:
                                this.busy = false;

                            case 31:
                                //seekTo前后，一些视频的启动，暂停状态可能有转换。下面根据timeline的状态重设所有Track的状态
                                if (this.state === 'play') {
                                    this._doPlay();
                                } else {
                                    this._doPause();
                                }

                            case 32:
                            case "end":
                                return _context2.stop();
                        }
                    }
                }, _callee2, this, [[9, 14], [22, 27]]);
            }));
        }
    }, {
        key: "_doPause",
        value: function _doPause() {
            this.ticker.pause();
            this.tracks.forEach(function (track) {
                return track.pause();
            });
        }
        /**
         * ticker.play会开启ticker定时tick事件。白板Track依赖于tick事件更新
         */

    }, {
        key: "_doPlay",
        value: function _doPlay() {
            this.ticker.play();
            this.tracks.forEach(function (track) {
                return track.play();
            });
        }
    }, {
        key: "destroy",
        value: function destroy() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
                var _this7 = this;

                return _regenerator2.default.wrap(function _callee3$(_context3) {
                    while (1) {
                        switch (_context3.prev = _context3.next) {
                            case 0:
                                this.ticker.destory();
                                _context3.next = 3;
                                return _promise2.default.all(this.tracks.map(function (track) {
                                    return track.destroy();
                                }));

                            case 3:
                                this.eventNames().forEach(function (name) {
                                    return _this7.off(name);
                                });

                            case 4:
                            case "end":
                                return _context3.stop();
                        }
                    }
                }, _callee3, this);
            }));
        }
    }]);
    return Timeline;
}(_eventemitter2.default);
/**
 * 返回多个track的起始时间戳
 * @param tracks
 */


exports.default = Timeline;
var getMinTimeStamp = function getMinTimeStamp(tracks) {
    var minTimestamp = Number.POSITIVE_INFINITY;
    tracks.forEach(function (track) {
        if (minTimestamp > track.timestamp) {
            minTimestamp = track.timestamp;
        }
    });
    return minTimestamp;
};
/**
 * 返回多个track的结束时间戳
 * @param tracks
 */
var getMaxTimeStamp = function getMaxTimeStamp(tracks) {
    var maxTimestamp = Number.NEGATIVE_INFINITY;
    tracks.forEach(function (track) {
        // 计算出轨道的结束时间戳
        if (maxTimestamp < track.offsetEnd) {
            maxTimestamp = track.offsetEnd;
        }
    });
    return maxTimestamp;
};
/**
 * 获取track异步初始化Promise Array
 * @param tracks
 * @param minTimestamp
 */
var getInitQueue = function getInitQueue(tracks, minTimestamp) {
    var isIPhone = /iphone/i.test(navigator.userAgent);
    var pPipeline = _promise2.default.resolve('got lucky ~');
    // 判断是否是iPhone,如果是iPhone,video轨道需要一个一个的初始化
    var readyQueue = tracks.map(function (track) {
        // 计算开始时间
        track.offsetBegin = track.timestamp - minTimestamp;
        if (isIPhone) {
            if (track.type === 'mp4' || track.type === 'flv' || track.type === 'aac') {
                // 如果是视频轨道，需要一个接一个的初始化
                var result = track.init(pPipeline);
                pPipeline = result;
                return result; // 提前返回
            }
        }
        return track.init();
    });
    return readyQueue;
};

/***/ }),

/***/ "./new_src/recordPlayer/ToolUI.less":
/*!******************************************!*\
  !*** ./new_src/recordPlayer/ToolUI.less ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {


var content = __webpack_require__(/*! !../../node_modules/css-loader/dist/cjs.js??ref--7-1!../../node_modules/postcss-loader/src??postcss!./ToolUI.less */ "./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/src/index.js?!./new_src/recordPlayer/ToolUI.less");

if(typeof content === 'string') content = [[module.i, content, '']];

var transform;
var insertInto;



var options = {"hmr":true}

options.transform = transform
options.insertInto = undefined;

var update = __webpack_require__(/*! ../../node_modules/style-loader/lib/addStyles.js */ "./node_modules/style-loader/lib/addStyles.js")(content, options);

if(content.locals) module.exports = content.locals;

if(false) {}

/***/ }),

/***/ "./new_src/recordPlayer/ToolUI.tsx":
/*!*****************************************!*\
  !*** ./new_src/recordPlayer/ToolUI.tsx ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

exports.mount = mount;

var _preact = __webpack_require__(/*! preact */ "./node_modules/preact/dist/preact.min.js");

var _preact2 = _interopRequireDefault(_preact);

var _utils = __webpack_require__(/*! ./utils */ "./new_src/recordPlayer/utils.ts");

var _pause = __webpack_require__(/*! ./assets/pause.svg */ "./new_src/recordPlayer/assets/pause.svg");

var _pause2 = _interopRequireDefault(_pause);

var _play = __webpack_require__(/*! ./assets/play.svg */ "./new_src/recordPlayer/assets/play.svg");

var _play2 = _interopRequireDefault(_play);

__webpack_require__(/*! ./ToolUI.less */ "./new_src/recordPlayer/ToolUI.less");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Tell Babel to transform JSX into preact.h() calls:
/** @jsx preact.h */
var isPhone = /iphone|android/i.test(navigator.userAgent);

var ToolUI = function (_React$Component) {
    (0, _inherits3.default)(ToolUI, _React$Component);

    function ToolUI(props) {
        (0, _classCallCheck3.default)(this, ToolUI);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ToolUI.__proto__ || (0, _getPrototypeOf2.default)(ToolUI)).call(this, props));

        _this.toolUIEl = (0, _preact.createRef)();
        _this.onMouseMove = function (e) {
            var _this$getCurrentXAndT = _this.getCurrentXAndTime(e),
                currentX = _this$getCurrentXAndT.currentX,
                currentTime = _this$getCurrentXAndT.currentTime;

            var _getTime = (0, _utils.getTime)(currentTime),
                _getTime2 = (0, _slicedToArray3.default)(_getTime, 1),
                labelText = _getTime2[0];

            _this.setState({
                labelLeft: currentX,
                labelText: labelText
            });
        };
        _this.pauseOrPlay = function (e) {
            var paused = _this.state.paused;

            if (paused) {
                _this.props.player.play();
            } else {
                _this.props.player.pause();
            }
            _this.setState({ paused: !paused });
        };
        _this.onMouseDown = function (e) {
            var role = e.target.getAttribute('role');
            if (role === 'slider') {
                _this.setState({
                    showLabel: true,
                    drag: true
                });
                _this.onMouseMove(e);
            }
        };
        _this.onMouseUp = function (e) {
            if (_this.state.drag) {
                _this.seekTo(e);
            }
            _this.hidePosition(e);
        };
        _this.handleClickSpeed = function (e) {
            _this.setState({
                speedOptionShow: !_this.state.speedOptionShow
            });
        };
        _this.handleClickSpeedOption = function (ev, speed) {
            ev.stopPropagation();
            _this.setState({
                speedOptionShow: false
            });
            _this.props.player.setPlaySpeed(speed);
        };
        _this.showPosition = function (e) {
            _this.setState({
                showLabel: true
            });
            _this.onMouseMove(e);
        };
        _this.hidePosition = function (e) {
            _this.setState({
                showLabel: false
            });
        };
        _this.seekTo = function (e) {
            var _this$getCurrentXAndT2 = _this.getCurrentXAndTime(e),
                currentX = _this$getCurrentXAndT2.currentX,
                currentTime = _this$getCurrentXAndT2.currentTime;

            _this.props.player.seekTo(currentTime);
            var updator = {
                labelLeft: currentX,
                time: currentTime,
                drag: false
            };
            // 如果是鼠标事件，不隐藏光标
            if (isPhone) {
                updator.showLabel = false;
            }
            _this.setState(updator);
        };
        _this.getCurrentXAndTime = function (e) {
            var currentX = 0;
            var left = _this.toolUIEl.current.getBoundingClientRect().left;
            if (e.type.search(/mouse|click/) > -1) {
                currentX = e.clientX - left;
            } else {
                currentX = e.touches[0].clientX - left;
            }
            var fullWidth = _this.toolUIEl.current.offsetWidth;
            // 防止越界
            if (currentX < 0) {
                currentX = 0;
            }
            if (currentX > fullWidth) {
                currentX = fullWidth;
            }
            var currentTime = _this.state.duration * (currentX / fullWidth);
            return {
                currentX: currentX,
                currentTime: currentTime
            };
        };
        _this.renderTimeline = function (widthPercent) {
            var _this$state = _this.state,
                showLabel = _this$state.showLabel,
                labelLeft = _this$state.labelLeft,
                labelText = _this$state.labelText,
                drag = _this$state.drag;

            return _preact2.default.createElement("div", { ref: _this.toolUIEl, className: 'player-timeline', onClick: _this.seekTo, onMouseEnter: _this.showPosition, onMouseLeave: _this.hidePosition, onMouseDown: _this.onMouseDown, onMouseMove: _this.onMouseMove, onTouchStart: _this.onMouseDown, onTouchMove: _this.onMouseMove, onTouchEnd: _this.onMouseUp, role: "timeline" }, _preact2.default.createElement("span", { role: "currentLabel", className: 'player-timeline-label', style: {
                    display: showLabel ? 'inline-block' : 'none',
                    left: labelLeft + 'px'
                } }, labelText), _preact2.default.createElement("span", { role: "label-background", className: 'player-timeline-bg', style: {
                    display: showLabel ? 'inline-block' : 'none',
                    height: 20,
                    left: labelLeft + 'px'
                } }), _preact2.default.createElement("div", { role: "blue-line", className: 'player-timeline-blueline', style: {
                    width: '' + (widthPercent + '%')
                } }), _preact2.default.createElement("div", { role: "slider", className: 'player-timeline-slider', style: {
                    left: '' + (drag ? labelLeft + 'px' : widthPercent + '%'),
                    backgroundClip: '' + (drag ? 'border-box' : 'content-box')
                } }));
        };
        _this.renderPlayOrPause = function () {
            var paused = _this.state.paused;

            return _preact2.default.createElement("div", { className: 'player-play-icon-wrapper', role: "icon", onClick: _this.pauseOrPlay }, _preact2.default.createElement("span", { className: 'player-play-icon', style: {
                    backgroundImage: 'url(' + (paused ? _play2.default : _pause2.default) + ')'
                } }));
        };
        var player = props.player;

        _this.state = {
            time: player.timeline.ticker.currTimeStamp,
            duration: player.timeline.endTimeStamp,
            showLabel: false,
            labelLeft: 0,
            labelText: '',
            paused: player.timeline.ticker.state === 'pause',
            currSpeed: player.speed,
            speedOptionShow: false,
            drag: false
        };
        player.on('tick', function (time) {
            _this.setState({ time: time });
        });
        player.on('play', function () {
            _this.setState({ paused: false });
        });
        player.on('pause', function () {
            _this.setState({ paused: true });
        });
        player.on('speedChange', function (speed) {
            _this.setState({ currSpeed: speed });
        });
        return _this;
    }

    (0, _createClass3.default)(ToolUI, [{
        key: 'renderSpeed',
        value: function renderSpeed() {
            var _this2 = this;

            var speedText = this.state.currSpeed === 1 ? '倍数' : this.state.currSpeed + 'x';
            var speedArr = [2, 1.5, 1.25, 1, 0.75, 0.5];
            return _preact2.default.createElement("div", { className: 'player-speed', onClick: this.handleClickSpeed }, _preact2.default.createElement("div", { className: 'player-speed-text' }, speedText), this.state.speedOptionShow && _preact2.default.createElement("div", { className: 'player-speed-options' }, speedArr.map(function (speed) {
                return _preact2.default.createElement("div", { className: 'option', key: speed, onClick: function onClick(ev) {
                        return _this2.handleClickSpeedOption(ev, speed);
                    } }, speed, "x");
            })));
        }
    }, {
        key: 'render',
        value: function render(props, state) {
            var time = state.time,
                duration = state.duration;

            var widthPercent = 0;
            if (time >= duration) {
                widthPercent = 100;
            } else if (time <= 0) {
                widthPercent = 0;
            } else {
                widthPercent = time / duration * 100;
            }
            var timeDuration = void 0;
            if (time > duration) {
                var _getTime3 = (0, _utils.getTime)(duration),
                    _getTime4 = (0, _slicedToArray3.default)(_getTime3, 1),
                    durationStr = _getTime4[0];

                timeDuration = durationStr + '/' + durationStr;
            } else {
                var _getTime5 = (0, _utils.getTime)(duration),
                    _getTime6 = (0, _slicedToArray3.default)(_getTime5, 2),
                    _durationStr = _getTime6[0],
                    durationHour = _getTime6[1];

                var _getTime7 = (0, _utils.getTime)(time, durationHour > 0),
                    _getTime8 = (0, _slicedToArray3.default)(_getTime7, 1),
                    currentStr = _getTime8[0];

                timeDuration = currentStr + '/' + _durationStr;
            }
            return _preact2.default.createElement("div", { className: "player-container" }, this.renderPlayOrPause(), this.renderTimeline(widthPercent), this.renderSpeed(), _preact2.default.createElement("div", { role: "duration", className: 'player-duration' }, timeDuration));
        }
    }]);
    return ToolUI;
}(_preact2.default.Component);

exports.default = ToolUI;

var Nothing = function Nothing() {
    return null;
};
function mount(dom, player) {
    if (!dom) {
        throw new Error('RecordPlayer mount传入的容器不能为空');
    }
    if (!player) {
        throw new Error('请传入录制回放实例');
    }
    var root = (0, _preact.render)(_preact2.default.createElement(ToolUI, { player: player }), dom);
    function unmount() {
        (0, _preact.render)(_preact2.default.createElement(Nothing, null), dom, root);
    }
    return unmount;
}

/***/ }),

/***/ "./new_src/recordPlayer/Track/Record.ts":
/*!**********************************************!*\
  !*** ./new_src/recordPlayer/Track/Record.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _Itypes = __webpack_require__(/*! ../../../src/core/Itypes */ "./src/core/Itypes.ts");

var _ActionUtils = __webpack_require__(/*! ../../../src/core/ActionUtils.old */ "./src/core/ActionUtils.old.ts");

var ActionUtilsOld = _interopRequireWildcard(_ActionUtils);

var _ActionUtils2 = __webpack_require__(/*! ../../../src/core/ActionUtils */ "./src/core/ActionUtils.ts");

var ActionUtils = _interopRequireWildcard(_ActionUtils2);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Record = function () {
    function Record(time, data, isCompatible) {
        (0, _classCallCheck3.default)(this, Record);

        this.time = time;
        this.isCompatible = isCompatible;
        if (typeof data === 'string') {
            this.data = data;
            if (isCompatible) {
                this.actions = ActionUtilsOld.unpackBulk(data);
            } else {
                this.actions = ActionUtils.unpackBulk(data);
            }
        } else {
            this.data = '';
            this.actions = data;
        }
        this.clearIndex = [];
        this.isClearFrame = false;
        this.updateIndex();
    }

    (0, _createClass3.default)(Record, [{
        key: 'updateIndex',
        value: function updateIndex() {
            this.clearIndex = this.actions.reduce(function (ret, action, curIndex) {
                if (action.TYPE === _Itypes.WActions.CLEAR) {
                    ret.push(curIndex);
                }
                return ret;
            }, []);
            this.isClearFrame = this.clearIndex.length !== 0;
        }
    }, {
        key: 'getStateRelatedActions',
        value: function getStateRelatedActions() {
            return this.actions.filter(function (action) {
                return _Itypes.StateRelatedActions.indexOf(action.TYPE) > -1;
            });
        }
    }, {
        key: 'toStateRelatedRecord',
        value: function toStateRelatedRecord() {
            return new Record(this.time, this.getStateRelatedActions(), this.isCompatible);
        }
    }]);
    return Record;
}();

exports.default = Record;

/***/ }),

/***/ "./new_src/recordPlayer/Track/Track.ts":
/*!*********************************************!*\
  !*** ./new_src/recordPlayer/Track/Track.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Track，轨道，代表音视频数据，或者白板数据。数据是一系列带时间戳的数组。
 * 音视频轨道由浏览器的<video />组件播放，白板由sdk控制播放。
 *
 * 音视频播放由video.play, video.pause控制。白板播放由ticktick发送tick事件，然后白板轨道根据此事件绘制截至到某个时间戳的所有动作。
 *
 * 音视频轨道数据量较大，不一定完全载入就会播放，播放过程中可能存在数据延时。白板播放过程中，可能会加载文档/图片，加载过程与音视频加载类似，也是异步过程。
 *
 * 在多人会议场景中，随着演讲人的切换，可能音视频的位置会变化，显示状态会变化。所以需要轨道将当前可见的音视频告诉开发者，开发者根据此信息调整容器位置
 * 当音视频/白板容器准备好之前，应该暂停音视频/白板的播放
 *
 *
 *
 *
 * Track有很多维度的状态
 * init:            Track还未抓取轨道数据
 * ready:           Track已抓取轨道metadata（如轨道长度等数据）
 * show / hide:     Track是否显示。默认为隐藏，需要开发者提供容器显示
 * play / pause:    是否正在播放。video有这个属性。白板的播放需要TickTick来主动调用，因此它永远处于pause状态
 * waitingForData:  是否正在等待数据。video track触发onwaiting时，需要等待track数据。onloadeddata触发时，waitingForData为false。
 *
 *
 * Track的几个方法：
 *
 * play/pause:      开始/暂停当前播放的Track。只对video，audio有效。白板永远处于暂停状态
 * seekTo:          跳转到目前位置。Track更新时间戳，且更新自己的状态
 * tick：           更新下一帧。video无需处理该函数，因为播放中的视频会自己调整自己的状态。白板Track需要更新自己的状态
 *
 * Track的几个事件：
 * notifyPause：
 * notifyPlay：
 *
 */
var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

var Track = function (_EventEmitter) {
    (0, _inherits3.default)(Track, _EventEmitter);

    function Track() {
        (0, _classCallCheck3.default)(this, Track);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Track.__proto__ || (0, _getPrototypeOf2.default)(Track)).apply(this, arguments));

        _this.offsetBegin = 0;
        _this.offsetEnd = 0;
        return _this;
    }

    (0, _createClass3.default)(Track, [{
        key: "playUtilBtwTimeAndReady",
        value: function playUtilBtwTimeAndReady(time) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                _context.next = 2;
                                return this.showTrack();

                            case 2:
                            case "end":
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
    }, {
        key: "isWaiting",
        value: function isWaiting(time) {
            if (time < this.offsetBegin || time > this.offsetEnd) {
                return false;
            }
            return false;
        }
    }, {
        key: "setViewer",
        value: function setViewer(viewer) {}
    }, {
        key: "setPlaySpeed",
        value: function setPlaySpeed(speed) {}
    }, {
        key: "showTrack",
        value: function showTrack() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                var _this2 = this;

                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                this.state = 'beforeshow';
                                _context2.next = 3;
                                return new _promise2.default(function (resolve) {
                                    _this2.emit('visibleChange', 'show', _this2.params, function (el) {
                                        _this2.showTrackCb(el);
                                        resolve();
                                    });
                                });

                            case 3:
                                this.state = 'playing';
                                setTimeout(function () {
                                    _this2.emit('showTrack');
                                });

                            case 5:
                            case "end":
                                return _context2.stop();
                        }
                    }
                }, _callee2, this);
            }));
        }
    }, {
        key: "hideTrack",
        value: function hideTrack() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
                var _this3 = this;

                return _regenerator2.default.wrap(function _callee3$(_context3) {
                    while (1) {
                        switch (_context3.prev = _context3.next) {
                            case 0:
                                this.state = 'beforefinish';
                                _context3.next = 3;
                                return new _promise2.default(function (resolve) {
                                    _this3.emit('visibleChange', 'hide', _this3.params, function () {
                                        _this3.hideTrackCb();
                                        resolve();
                                    });
                                });

                            case 3:
                                setTimeout(function () {
                                    _this3.emit('hideTrack');
                                });
                                this.state = 'finished';

                            case 5:
                            case "end":
                                return _context3.stop();
                        }
                    }
                }, _callee3, this);
            }));
        }
    }, {
        key: "destroy",
        value: function destroy() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee4() {
                var _this4 = this;

                return _regenerator2.default.wrap(function _callee4$(_context4) {
                    while (1) {
                        switch (_context4.prev = _context4.next) {
                            case 0:
                                _context4.next = 2;
                                return this._awaitTrackHandler();

                            case 2:
                                if (!(this.state === 'playing')) {
                                    _context4.next = 5;
                                    break;
                                }

                                _context4.next = 5;
                                return this.hideTrack();

                            case 5:
                                this.eventNames().forEach(function (name) {
                                    return _this4.off(name);
                                });

                            case 6:
                            case "end":
                                return _context4.stop();
                        }
                    }
                }, _callee4, this);
            }));
        }
    }, {
        key: "update",
        value: function update(time) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee5() {
                return _regenerator2.default.wrap(function _callee5$(_context5) {
                    while (1) {
                        switch (_context5.prev = _context5.next) {
                            case 0:
                                _context5.next = 2;
                                return this.seekTo(time, true, false);

                            case 2:
                                //update是通过ticker.tick方法调用的。
                                //update后track应该处于播放状态
                                //timeline.play并不会启动ready状态的视频tag，也不应该启动ready状态的tag。
                                //因为一些ready状态的tag在play被调用时并不在时间范围内。
                                //所以需要在update时启动。
                                this.play();

                            case 3:
                            case "end":
                                return _context5.stop();
                        }
                    }
                }, _callee5, this);
            }));
        }
    }, {
        key: "seekTo",
        value: function seekTo(time, forward) {
            var jumpTo = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee6() {
                return _regenerator2.default.wrap(function _callee6$(_context6) {
                    while (1) {
                        switch (_context6.prev = _context6.next) {
                            case 0:
                                if (!(this.state === 'init' || this.state === 'error')) {
                                    _context6.next = 2;
                                    break;
                                }

                                return _context6.abrupt("return");

                            case 2:
                                _context6.next = 4;
                                return this._awaitTrackHandler();

                            case 4:
                                if (!(time < this.offsetBegin)) {
                                    _context6.next = 11;
                                    break;
                                }

                                if (!(this.state === 'playing')) {
                                    _context6.next = 8;
                                    break;
                                }

                                _context6.next = 8;
                                return this.hideTrack();

                            case 8:
                                return _context6.abrupt("return", this.state = 'ready');

                            case 11:
                                if (!(time > this.offsetEnd)) {
                                    _context6.next = 18;
                                    break;
                                }

                                if (!(this.state === 'playing')) {
                                    _context6.next = 15;
                                    break;
                                }

                                _context6.next = 15;
                                return this.hideTrack();

                            case 15:
                                return _context6.abrupt("return", this.state = 'finished');

                            case 18:
                                if (!(this.state === 'ready' || this.state === 'finished')) {
                                    _context6.next = 21;
                                    break;
                                }

                                _context6.next = 21;
                                return this.showTrack();

                            case 21:
                                this.state = 'playing';
                                _context6.next = 24;
                                return this.doSetTrack(time, forward, jumpTo);

                            case 24:
                            case "end":
                                return _context6.stop();
                        }
                    }
                }, _callee6, this);
            }));
        }
    }, {
        key: "_awaitTrackHandler",
        value: function _awaitTrackHandler() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee7() {
                var _this5 = this;

                return _regenerator2.default.wrap(function _callee7$(_context7) {
                    while (1) {
                        switch (_context7.prev = _context7.next) {
                            case 0:
                                if (!(this.state === 'beforeshow')) {
                                    _context7.next = 4;
                                    break;
                                }

                                _context7.next = 3;
                                return new _promise2.default(function (resolve) {
                                    _this5.once('showTrack', resolve);
                                });

                            case 3:
                                this.state = 'playing';

                            case 4:
                                if (!(this.state === 'beforefinish')) {
                                    _context7.next = 8;
                                    break;
                                }

                                _context7.next = 7;
                                return new _promise2.default(function (resolve) {
                                    _this5.once('hideTrack', resolve);
                                });

                            case 7:
                                this.state = 'finished';

                            case 8:
                            case "end":
                                return _context7.stop();
                        }
                    }
                }, _callee7, this);
            }));
        }
    }, {
        key: "duration",
        get: function get() {
            return this.offsetEnd - this.offsetBegin;
        }
    }]);
    return Track;
}(_eventemitter2.default);

exports.default = Track;

/***/ }),

/***/ "./new_src/recordPlayer/Track/VideoTrack.ts":
/*!**************************************************!*\
  !*** ./new_src/recordPlayer/Track/VideoTrack.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _Track2 = __webpack_require__(/*! ./Track */ "./new_src/recordPlayer/Track/Track.ts");

var _Track3 = _interopRequireDefault(_Track2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

var VTrack = function (_Track) {
    (0, _inherits3.default)(VTrack, _Track);

    // 2550102203-51349077821394-1567049495368-0.mp4
    function VTrack(params) {
        (0, _classCallCheck3.default)(this, VTrack);

        var _this = (0, _possibleConstructorReturn3.default)(this, (VTrack.__proto__ || (0, _getPrototypeOf2.default)(VTrack)).call(this));

        _this.params = params;
        _this.offsetBegin = 0;
        _this.offsetEnd = 0;
        _this.waitingForData = true;
        var type = params.type,
            url = params.url,
            timestamp = params.timestamp;

        _this.type = type;
        _this.timestamp = timestamp;
        _this.url = url;
        _this.state = 'init';
        _this.videoRef = document.createElement('video');
        _this.videoRef.oncanplay = function () {
            _this.waitingForData = false;
            _this.emit('canplay');
        };
        _this.videoRef.onwaiting = function () {
            _this.waitingForData = true;
            _this.emit('waitingToPlay');
        };
        return _this;
    }

    (0, _createClass3.default)(VTrack, [{
        key: 'init',
        value: function init(pipe) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _this2 = this;

                var result;
                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                if (!pipe) {
                                    _context.next = 3;
                                    break;
                                }

                                _context.next = 3;
                                return pipe;

                            case 3:
                                console.log('init video track');
                                _context.next = 6;
                                return new _promise2.default(function (res) {
                                    var videoRef = _this2.videoRef;
                                    videoRef.src = _this2.url;
                                    setSpecialCheck(videoRef);
                                    videoRef.preload = 'metadata';
                                    videoRef.onloadeddata = function (ev) {
                                        var duration = videoRef.duration;
                                        if (duration !== duration) {
                                            duration = Number.NEGATIVE_INFINITY;
                                        } else {
                                            duration = duration * 1000;
                                        }
                                        _this2.offsetEnd = _this2.offsetBegin + duration;
                                        videoRef.pause();
                                        _this2.state = 'ready';
                                        console.log('init video ready');
                                        res('ready');
                                    };
                                    videoRef.onerror = function (ev) {
                                        console.error(ev);
                                        res('error');
                                    };
                                });

                            case 6:
                                result = _context.sent;
                                return _context.abrupt('return', result);

                            case 8:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
    }, {
        key: 'doSetTrack',
        value: function doSetTrack(time, forward, jumpTo) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                if (jumpTo) {
                                    this.setVideoTime(time);
                                }

                            case 1:
                            case 'end':
                                return _context2.stop();
                        }
                    }
                }, _callee2, this);
            }));
        }
    }, {
        key: 'showTrackCb',
        value: function showTrackCb(dom) {
            if (!dom) return;
            if (!findVideoRefInContainer(dom)) {
                dom.appendChild(this.videoRef);
            }
        }
    }, {
        key: 'hideTrackCb',
        value: function hideTrackCb() {
            if (this.videoRef) {
                this.videoRef.pause();
            }
        }
    }, {
        key: 'setPlaySpeed',
        value: function setPlaySpeed(speed) {
            if (this.videoRef) {
                this.videoRef.playbackRate = speed;
            }
        }
    }, {
        key: 'pause',
        value: function pause() {
            if (this.videoRef) {
                this.videoRef.pause();
            }
        }
    }, {
        key: 'play',
        value: function play() {
            if (this.videoRef && this.state === 'playing') {
                this.videoRef.play();
            } else {
                this.videoRef.pause();
            }
        }
    }, {
        key: 'setVideoTime',
        value: function setVideoTime(time) {
            this.videoRef.currentTime = (time - this.offsetBegin) / 1000;
        }
    }, {
        key: 'isWaiting',
        value: function isWaiting(time) {
            if (time < this.offsetBegin || time > this.offsetEnd) {
                return false;
            } else {
                return this.waitingForData;
            }
        }
    }]);
    return VTrack;
}(_Track3.default);

exports.default = VTrack;

var setSpecialCheck = function setSpecialCheck(el) {
    el.setAttribute('data-x-4wb', 'true');
    el.setAttribute('playsinline', 'playsinline');
    el.setAttribute('webkit-playsinline', 'webkit-playsinline');
};
var specialCheck = function specialCheck(el) {
    return el.getAttribute('data-x-4wb') === 'true';
};
var findVideoRefInContainer = function findVideoRefInContainer(dom) {
    if (dom.children.length > 0) {
        for (var i = 0, len = dom.children.length; i < len; i++) {
            var el = dom.children[i];
            if (el.tagName.toLowerCase() === 'video' && specialCheck(el)) {
                return true;
            }
        }
    }
    return false;
};

/***/ }),

/***/ "./new_src/recordPlayer/Track/Wb_V1V2.ts":
/*!***********************************************!*\
  !*** ./new_src/recordPlayer/Track/Wb_V1V2.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _symbol = __webpack_require__(/*! babel-runtime/core-js/symbol */ "./node_modules/babel-runtime/core-js/symbol.js");

var _symbol2 = _interopRequireDefault(_symbol);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _Record = __webpack_require__(/*! ./Record */ "./new_src/recordPlayer/Track/Record.ts");

var _Record2 = _interopRequireDefault(_Record);

var _Actions = __webpack_require__(/*! ../../../src/core/Actions */ "./src/core/Actions/index.ts");

var _Itypes = __webpack_require__(/*! ../../../src/core/Itypes */ "./src/core/Itypes.ts");

var _core = __webpack_require__(/*! ../../../src/core */ "./src/core/index.ts");

var _core2 = _interopRequireDefault(_core);

var _WhiteboardTrack = __webpack_require__(/*! ./WhiteboardTrack */ "./new_src/recordPlayer/Track/WhiteboardTrack.ts");

var _WhiteboardTrack2 = _interopRequireDefault(_WhiteboardTrack);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __asyncValues = undefined && undefined.__asyncValues || function (o) {
    if (!_symbol2.default.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[_symbol2.default.asyncIterator],
        i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : (0, _getIterator3.default)(o), i = {}, verb("next"), verb("throw"), verb("return"), i[_symbol2.default.asyncIterator] = function () {
        return this;
    }, i);
    function verb(n) {
        i[n] = o[n] && function (v) {
            return new _promise2.default(function (resolve, reject) {
                v = o[n](v), settle(resolve, reject, v.done, v.value);
            });
        };
    }
    function settle(resolve, reject, d, v) {
        _promise2.default.resolve(v).then(function (v) {
            resolve({ value: v, done: d });
        }, reject);
    }
};

/**
 * 白板1.0， 2.0
 */
var V1V2Track = function (_WTrack) {
    (0, _inherits3.default)(V1V2Track, _WTrack);

    function V1V2Track(params, opt) {
        (0, _classCallCheck3.default)(this, V1V2Track);

        var _this = (0, _possibleConstructorReturn3.default)(this, (V1V2Track.__proto__ || (0, _getPrototypeOf2.default)(V1V2Track)).call(this, params, opt));

        _this.params = params;
        _this.drawManager = null;
        _this.records = [];
        return _this;
    }

    (0, _createClass3.default)(V1V2Track, [{
        key: "init",
        value: function init() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _this2 = this;

                var _ref, _ref2, state, dataList, result;

                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                _context.next = 2;
                                return this.fetchData();

                            case 2:
                                _ref = _context.sent;
                                _ref2 = (0, _slicedToArray3.default)(_ref, 2);
                                state = _ref2[0];
                                dataList = _ref2[1];

                                console.log('init ', state, dataList);

                                if (!(state === 'error')) {
                                    _context.next = 12;
                                    break;
                                }

                                this.state = 'error';
                                return _context.abrupt("return", 'error');

                            case 12:
                                result = [];

                                if (this.isCompatible) {
                                    /**
                                     * 紧急修复：修复白板1.0由于缺少画布设置同步的命令，导致无法绘制的缺陷
                                     */
                                    result.push(new _Record2.default(10, '16:{"mode"¦"draw"，"tool"¦"flag"，"size"¦1，"color"¦"#000000"，"fontsize"¦24};', false));
                                    result.push(new _Record2.default(20, '16:{"color"¦"#000"};16:{"size"¦1};', false));
                                    result.push(new _Record2.default(30, '16:{"ownerCanvasHeight"¦1000，"ownerCanvasWidth"¦1300};', false));
                                }
                                dataList.forEach(function (data) {
                                    result.push(new _Record2.default(data.time, data.str, _this2.isCompatible));
                                });
                                if (this.isCompatible) {
                                    if (result.length) {
                                        optimizeOldRecordList(result);
                                    }
                                }
                                this.records = result;
                                this.state = 'ready';
                                return _context.abrupt("return", 'ready');

                            case 19:
                            case "end":
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
    }, {
        key: "doSetTrack",
        value: function doSetTrack(time, forward, jumpTo) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                var nextRecordIndex, needSkipFirstCleanFrame, endIndex, recordsToExecute, res, account;
                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                nextRecordIndex = forward ? this.nextRecordIndex : 0;

                                if (nextRecordIndex === 0) {
                                    console.warn('seek back', time, jumpTo, nextRecordIndex);
                                }

                                if (!(this.records.length && this.drawManager)) {
                                    _context2.next = 14;
                                    break;
                                }

                                needSkipFirstCleanFrame = false; // 第一次的动作是否需要跳过
                                // 先取出中间所有的动作

                                endIndex = findIndexBeyondTime(this.records, time, this.offsetBegin, nextRecordIndex);
                                recordsToExecute = this.records.slice(nextRecordIndex, endIndex);
                                // 在执行前更新索引，防止executeAction出错后，卡死在这里

                                this.nextRecordIndex = endIndex;
                                if (jumpTo) {
                                    res = mangleRecords(recordsToExecute);

                                    recordsToExecute = res.recordsToExecute;
                                    needSkipFirstCleanFrame = res.needSkipFirstCleanFrame;
                                }
                                if (recordsToExecute.length) {
                                    //等于0时，是向后seekTo，需要清空画布重新绘制
                                    if (nextRecordIndex === 0) {
                                        account = this.params.account;

                                        this.drawManager.clear(account);
                                        this.drawManager.clearImage();
                                        this.drawManager.clearHtmlFile();
                                        this.drawManager.resetState();
                                    }
                                    executeActions(recordsToExecute, needSkipFirstCleanFrame, this.drawManager, this.params.account);
                                }

                                if (!(this.nextRecordIndex === this.records.length)) {
                                    _context2.next = 12;
                                    break;
                                }

                                _context2.next = 12;
                                return this.hideTrack();

                            case 12:
                                _context2.next = 16;
                                break;

                            case 14:
                                _context2.next = 16;
                                return this.hideTrack();

                            case 16:
                            case "end":
                                return _context2.stop();
                        }
                    }
                }, _callee2, this);
            }));
        }
    }, {
        key: "showTrackCb",
        value: function showTrackCb(el) {
            if (el && !this.drawManager) {
                this.drawManager = new _core2.default(el);
            }
        }
    }, {
        key: "isCompatible",
        get: function get() {
            return this.opt.version === '1.0';
        }
    }]);
    return V1V2Track;
}(_WhiteboardTrack2.default);

exports.default = V1V2Track;

function optimizeOldRecordList(list) {
    if (!list) return [];
    if (list.length === 0) return list;
    // 状态机标记位有，
    var lastColor = void 0;
    var lastTool = 'flag';
    for (var i = 0, leng = list.length; i < leng; i++) {
        var curRecord = list[i];
        var actions = curRecord.actions;
        for (var j = 0; j < actions.length;) {
            var action = actions[j];
            switch (action.TYPE) {
                case _Itypes.WActions.CALIBRATE:
                    {
                        var color = action.color;

                        if (color) {
                            if (color === lastColor) {
                                actions.splice(j, 1);
                                continue;
                            } else {
                                lastColor = color;
                            }
                        }
                        j++;
                        continue;
                    }
                case _Itypes.WActions.START:
                    {
                        if (lastTool === 'flag') {
                            lastTool = 'free';
                            console.log('deleted');
                            actions.splice(j, 0, new _Actions.CalibrateAction({ tool: 'free' }));
                            ++j;
                        }
                        ++j;
                        continue;
                    }
                case _Itypes.WActions.LASER_PEN:
                    {
                        if (lastTool === 'free') {
                            lastTool = 'flag';
                            console.log('insert flage');
                            actions.splice(j, 0, new _Actions.CalibrateAction({ tool: 'flag' }));
                            ++j;
                        }
                        ++j;
                        continue;
                    }
                case _Itypes.WActions.LASER_PEN_END:
                    {
                        ++j;
                    }
                default:
                    {
                        ++j;
                    }
            }
        }
    }
    list.forEach(function (r) {
        return r.updateIndex();
    });
}
/**
 * records按时间升序排列。
 * 从startIndex开始，寻找第一个时间大于time的Record的索引
 * 若records中时间都小于time，则返回records的长度
 * @param records
 * @param time
 * @param startIndex
 */
function findIndexBeyondTime(records, time, offsetBeing) {
    var startIndex = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

    var endIndex = startIndex;
    for (; endIndex < records.length; endIndex++) {
        var record = records[endIndex];
        if (record.time + offsetBeing > time) {
            return endIndex;
        }
    }
    return endIndex;
}
function mangleRecords(recordsToExecute) {
    var needSkipFirstCleanFrame = false;
    // 如果是快进的播放流程，需要对中间的动作进行处理
    // 如果有关键帧,需要将关键帧之前的其他动作全部清除，只保留状态相关的动作
    var lastClearFrameIndex = recordsToExecute.length;
    while (lastClearFrameIndex--) {
        var record = recordsToExecute[lastClearFrameIndex];
        if (record.isClearFrame) {
            break;
        }
    }
    if (lastClearFrameIndex !== -1) {
        //找到关键帧， 对关键帧之前的Record进行清洗
        for (var i = 0; i < lastClearFrameIndex; i++) {
            var recordToClean = recordsToExecute[i];
            recordsToExecute[i] = recordToClean.toStateRelatedRecord();
        }
        needSkipFirstCleanFrame = true;
        // 过滤掉没有任何数据的记录
        recordsToExecute = recordsToExecute.filter(function (record) {
            return record.actions.length !== 0;
        });
    }
    return {
        needSkipFirstCleanFrame: needSkipFirstCleanFrame,
        recordsToExecute: recordsToExecute
    };
}
function executeActions(recordsToExecute, needSkipFirstCleanFrame, drawManager, account) {
    var recordsToExecute_1, recordsToExecute_1_1;
    var e_1, _a;
    return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
        var record, actions, clearIndex;
        return _regenerator2.default.wrap(function _callee3$(_context3) {
            while (1) {
                switch (_context3.prev = _context3.next) {
                    case 0:
                        _context3.prev = 0;
                        _context3.prev = 1;
                        recordsToExecute_1 = __asyncValues(recordsToExecute);

                    case 3:
                        _context3.next = 5;
                        return recordsToExecute_1.next();

                    case 5:
                        recordsToExecute_1_1 = _context3.sent;

                        if (recordsToExecute_1_1.done) {
                            _context3.next = 19;
                            break;
                        }

                        record = recordsToExecute_1_1.value;

                        if (!(record.isClearFrame && needSkipFirstCleanFrame)) {
                            _context3.next = 15;
                            break;
                        }

                        // 跳过其他的动作，直接执行到第一个清除
                        actions = record.actions, clearIndex = record.clearIndex;
                        _context3.next = 12;
                        return drawManager.executeActions(account, actions.slice(clearIndex[0]));

                    case 12:
                        needSkipFirstCleanFrame = false;
                        _context3.next = 17;
                        break;

                    case 15:
                        _context3.next = 17;
                        return drawManager.executeActions(account, record.actions);

                    case 17:
                        _context3.next = 3;
                        break;

                    case 19:
                        _context3.next = 24;
                        break;

                    case 21:
                        _context3.prev = 21;
                        _context3.t0 = _context3["catch"](1);
                        e_1 = { error: _context3.t0 };

                    case 24:
                        _context3.prev = 24;
                        _context3.prev = 25;

                        if (!(recordsToExecute_1_1 && !recordsToExecute_1_1.done && (_a = recordsToExecute_1.return))) {
                            _context3.next = 29;
                            break;
                        }

                        _context3.next = 29;
                        return _a.call(recordsToExecute_1);

                    case 29:
                        _context3.prev = 29;

                        if (!e_1) {
                            _context3.next = 32;
                            break;
                        }

                        throw e_1.error;

                    case 32:
                        return _context3.finish(29);

                    case 33:
                        return _context3.finish(24);

                    case 34:
                        _context3.next = 39;
                        break;

                    case 36:
                        _context3.prev = 36;
                        _context3.t1 = _context3["catch"](0);

                        console.error(_context3.t1);

                    case 39:
                    case "end":
                        return _context3.stop();
                }
            }
        }, _callee3, this, [[0, 36], [1, 21, 24, 34], [25,, 29, 33]]);
    }));
}

/***/ }),

/***/ "./new_src/recordPlayer/Track/Wb_V3.ts":
/*!*********************************************!*\
  !*** ./new_src/recordPlayer/Track/Wb_V3.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ "./node_modules/babel-runtime/core-js/array/from.js");

var _from2 = _interopRequireDefault(_from);

var _set = __webpack_require__(/*! babel-runtime/core-js/set */ "./node_modules/babel-runtime/core-js/set.js");

var _set2 = _interopRequireDefault(_set);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _WhiteboardTrack = __webpack_require__(/*! ./WhiteboardTrack */ "./new_src/recordPlayer/Track/WhiteboardTrack.ts");

var _WhiteboardTrack2 = _interopRequireDefault(_WhiteboardTrack);

var _core = __webpack_require__(/*! ../../core */ "./new_src/core/index.ts");

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

/**
 * 白板3.0
 */
var V3Track = function (_WTrack) {
    (0, _inherits3.default)(V3Track, _WTrack);

    function V3Track(params, opt) {
        (0, _classCallCheck3.default)(this, V3Track);

        var _this = (0, _possibleConstructorReturn3.default)(this, (V3Track.__proto__ || (0, _getPrototypeOf2.default)(V3Track)).call(this, params, opt));

        _this.records = [];
        _this.connector = new Connector();
        if (Array.isArray(params)) {
            //白板3.0多个录像文件要合并到一起创建一个DrawManager来处理。
            _this.params = params[0];
        }
        var container = _this.params['container'];
        var drawPluginParams = _this.params.drawPluginParams || {};
        _this.drawManager = new _core.App((0, _assign2.default)((0, _assign2.default)({ account: _this.viewer, container: container, connector: _this.connector, isRecordPlayer: true, platform: 'web' }, drawPluginParams), { nim: {} }));
        window.drawPlugin = _this.drawManager;
        return _this;
    }

    (0, _createClass3.default)(V3Track, [{
        key: 'init',
        value: function init() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _ref, _ref2, state, listOfDataList, accountSet;

                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                _context.next = 2;
                                return this.fetchMultiData();

                            case 2:
                                _ref = _context.sent;
                                _ref2 = (0, _slicedToArray3.default)(_ref, 2);
                                state = _ref2[0];
                                listOfDataList = _ref2[1];

                                if (!(state === 'error')) {
                                    _context.next = 11;
                                    break;
                                }

                                this.state = 'error';
                                return _context.abrupt('return', 'error');

                            case 11:
                                this.records = listOfDataList.map(function (dataList) {
                                    return (0, _assign2.default)((0, _assign2.default)({}, dataList), { records: dataList.records.map(function (data) {
                                            return {
                                                record: JSON.parse(data.str),
                                                time: data.time
                                            };
                                        }) });
                                });
                                accountSet = new _set2.default();

                                this.records.forEach(function (data) {
                                    data.records.forEach(function (res) {
                                        if (res.record.type === 'snapshot' && res.record.value.uid) {
                                            accountSet.add(res.record.value.uid);
                                        }
                                        if (res.record.type === 'snapshotArr' && Array.isArray(res.record.value) && res.record.value.length > 0) {
                                            if (res.record.value[0].uid) {
                                                accountSet.add(res.record.value[0].uid);
                                            }
                                        }
                                    });
                                });
                                this.viewerArr = (0, _from2.default)(accountSet);
                                if (this.viewerArr.length > 0) {
                                    this.setViewer(this.viewerArr[0]);
                                }
                                this.state = 'ready';
                                return _context.abrupt('return', 'ready');

                            case 18:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
    }, {
        key: 'setViewer',
        value: function setViewer(viewer) {
            var _a;
            this.viewer = viewer;
            (_a = this.drawManager) === null || _a === void 0 ? void 0 : _a.setViewer(viewer);
        }
    }, {
        key: 'doSetTrack',
        value: function doSetTrack(time, forward, jumpTo) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                this._seekTo(time);

                            case 1:
                            case 'end':
                                return _context2.stop();
                        }
                    }
                }, _callee2, this);
            }));
        }
        /**
         * 跳转到正确的channel对应的录像。如果cid发生变化，则使用addRecordData重置录像
         * @param time
         */

    }, {
        key: '_seekTo',
        value: function _seekTo(time) {
            var recordListToPlay = void 0;
            for (var i = 0; i < this.records.length - 1; i++) {
                if (time < this.records[i + 1].beginAt) {
                    recordListToPlay = this.records[i];
                    break;
                }
            }
            if (recordListToPlay === undefined) {
                recordListToPlay = this.records[this.records.length - 1];
            }
            if (recordListToPlay.cid !== this.currCid) {
                this.drawManager.addRecordData(recordListToPlay.records);
            }
            this.currCid = recordListToPlay.cid;
            this.drawManager.seekTo(time - recordListToPlay.beginAt);
        }
    }, {
        key: 'showTrackCb',
        value: function showTrackCb(el) {
            // this.drawManager.addRecordData(this.records)
        }
    }]);
    return V3Track;
}(_WhiteboardTrack2.default);

exports.default = V3Track;

var Connector = function (_EventEmitter) {
    (0, _inherits3.default)(Connector, _EventEmitter);

    function Connector() {
        (0, _classCallCheck3.default)(this, Connector);
        return (0, _possibleConstructorReturn3.default)(this, (Connector.__proto__ || (0, _getPrototypeOf2.default)(Connector)).apply(this, arguments));
    }

    (0, _createClass3.default)(Connector, [{
        key: 'sendData',
        value: function sendData() {}
    }, {
        key: 'broadcastData',
        value: function broadcastData() {}
    }, {
        key: 'sendSyncRequest',
        value: function sendSyncRequest() {}
    }]);
    return Connector;
}(_eventemitter2.default);

/***/ }),

/***/ "./new_src/recordPlayer/Track/WhiteboardTrack.ts":
/*!*******************************************************!*\
  !*** ./new_src/recordPlayer/Track/WhiteboardTrack.ts ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _Track2 = __webpack_require__(/*! ./Track */ "./new_src/recordPlayer/Track/Track.ts");

var _Track3 = _interopRequireDefault(_Track2);

var _utils = __webpack_require__(/*! ../../../src/core/utils */ "./src/core/utils.ts");

var _utils2 = __webpack_require__(/*! ../utils */ "./new_src/recordPlayer/utils.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

var WTrack = function (_Track) {
    (0, _inherits3.default)(WTrack, _Track);

    function WTrack(params, opt) {
        (0, _classCallCheck3.default)(this, WTrack);

        var _this = (0, _possibleConstructorReturn3.default)(this, (WTrack.__proto__ || (0, _getPrototypeOf2.default)(WTrack)).call(this));

        _this.params = params;
        _this.viewerArr = [];
        _this.urlArray = [];
        _this.type = 'gz';
        _this.offsetBegin = 0;
        _this.offsetEnd = 0;
        var timestamp = void 0;
        if (Array.isArray(params)) {
            _this.originalParams = params.slice();
            timestamp = params[0].timestamp;
            _this.urlArray = params.map(function (param) {
                return param.url;
            });
        } else {
            _this.originalParams = [params];
            timestamp = params.timestamp;
            _this.url = params.url;
        }
        _this.timestamp = timestamp;
        _this.opt = opt;
        _this.state = 'init';
        _this.nextRecordIndex = 0;
        _this.viewer = 'unknown';
        return _this;
    }
    /**
     * 白板1.0，2.0版本的处理
     */


    (0, _createClass3.default)(WTrack, [{
        key: 'fetchData',
        value: function fetchData() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var blob, rawRecordsList;
                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                console.log('init wb track ');
                                blob = void 0;
                                _context.prev = 2;
                                _context.next = 5;
                                return (0, _utils2.fetchBlob)(this.url);

                            case 5:
                                blob = _context.sent;
                                _context.next = 11;
                                break;

                            case 8:
                                _context.prev = 8;
                                _context.t0 = _context['catch'](2);
                                return _context.abrupt('return', ['error', []]);

                            case 11:
                                _context.next = 13;
                                return this.getRawRecordFromBlob(blob);

                            case 13:
                                rawRecordsList = _context.sent;

                                if (rawRecordsList.length) {
                                    this.offsetEnd = Math.max(this.offsetBegin + rawRecordsList[rawRecordsList.length - 1].time + 1000, this.offsetEnd);
                                }
                                return _context.abrupt('return', ['ready', rawRecordsList]);

                            case 16:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this, [[2, 8]]);
            }));
        }
    }, {
        key: 'fetchMultiData',
        value: function fetchMultiData() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
                var _this2 = this;

                var blobArray, i, listOfRawRecordList, rawDataByChannel;
                return _regenerator2.default.wrap(function _callee3$(_context3) {
                    while (1) {
                        switch (_context3.prev = _context3.next) {
                            case 0:
                                blobArray = [];
                                _context3.prev = 1;
                                i = 0;

                            case 3:
                                if (!(i < this.urlArray.length)) {
                                    _context3.next = 10;
                                    break;
                                }

                                _context3.next = 6;
                                return (0, _utils2.fetchBlob)(this.urlArray[i]);

                            case 6:
                                blobArray[i] = _context3.sent;

                            case 7:
                                i++;
                                _context3.next = 3;
                                break;

                            case 10:
                                _context3.next = 15;
                                break;

                            case 12:
                                _context3.prev = 12;
                                _context3.t0 = _context3['catch'](1);
                                return _context3.abrupt('return', ['error', []]);

                            case 15:
                                _context3.next = 17;
                                return _promise2.default.all(blobArray.map(function (blob, index) {
                                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                                        var rawRecordsList, params, offsetBegin, endAt;
                                        return _regenerator2.default.wrap(function _callee2$(_context2) {
                                            while (1) {
                                                switch (_context2.prev = _context2.next) {
                                                    case 0:
                                                        _context2.next = 2;
                                                        return this.getRawRecordFromBlob(blob);

                                                    case 2:
                                                        rawRecordsList = _context2.sent;
                                                        params = this.originalParams[index];
                                                        offsetBegin = params.timestamp - this.timestamp;
                                                        endAt = 0;

                                                        if (rawRecordsList.length) {
                                                            endAt = rawRecordsList[rawRecordsList.length - 1].time;
                                                            this.offsetEnd = Math.max(offsetBegin + endAt + 1000, this.offsetEnd);
                                                        }
                                                        return _context2.abrupt('return', {
                                                            cid: params.cid,
                                                            beginAt: offsetBegin,
                                                            endAt: offsetBegin + endAt,
                                                            records: rawRecordsList
                                                        });

                                                    case 8:
                                                    case 'end':
                                                        return _context2.stop();
                                                }
                                            }
                                        }, _callee2, this);
                                    }));
                                }));

                            case 17:
                                listOfRawRecordList = _context3.sent;

                                /**
                                 * 将同一个channel的多个录像文件合并到一起
                                 */
                                rawDataByChannel = this.mergeRawDataByChannel(listOfRawRecordList);
                                /**
                                 * 如果不同channel之间的时间有重叠，则返回error
                                 */

                                if (!this.isChannelOverlapping(rawDataByChannel)) {
                                    _context3.next = 21;
                                    break;
                                }

                                return _context3.abrupt('return', ['error', []]);

                            case 21:
                                return _context3.abrupt('return', ['ready', rawDataByChannel]);

                            case 22:
                            case 'end':
                                return _context3.stop();
                        }
                    }
                }, _callee3, this, [[1, 12]]);
            }));
        }
    }, {
        key: 'getRawRecordFromBlob',
        value: function getRawRecordFromBlob(blob) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee5() {
                var _this3 = this;

                var rawRecordsList;
                return _regenerator2.default.wrap(function _callee5$(_context5) {
                    while (1) {
                        switch (_context5.prev = _context5.next) {
                            case 0:
                                _context5.next = 2;
                                return new _promise2.default(function (resolve) {
                                    var result = [];
                                    var reader = new FileReader();
                                    reader.readAsBinaryString(blob);
                                    reader.onload = function () {
                                        return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee4() {
                                            var rawBuffer, dv, length, current, cLen, time, contentLen, offset, subb, str;
                                            return _regenerator2.default.wrap(function _callee4$(_context4) {
                                                while (1) {
                                                    switch (_context4.prev = _context4.next) {
                                                        case 0:
                                                            rawBuffer = _utils.pako.ungzip(reader.result);
                                                            dv = new DataView(rawBuffer.buffer);
                                                            length = dv.byteLength;
                                                            current = 0;

                                                        case 4:
                                                            if (!(current < length)) {
                                                                _context4.next = 17;
                                                                break;
                                                            }

                                                            cLen = dv.getInt32(current, true);
                                                            time = dv.getInt32(current + 4, true);
                                                            contentLen = cLen - 8;
                                                            offset = current + 8;
                                                            subb = rawBuffer.slice(offset, offset + contentLen);
                                                            // console.log(subb)

                                                            _context4.next = 12;
                                                            return (0, _utils2.ab2str)(subb);

                                                        case 12:
                                                            str = _context4.sent;

                                                            result.push({
                                                                time: time,
                                                                str: str
                                                            });
                                                            current = current + cLen;
                                                            _context4.next = 4;
                                                            break;

                                                        case 17:
                                                            //@ts-ignore
                                                            dv = null; // window.rawstring = rawBuffer = null;
                                                            resolve(result);

                                                        case 19:
                                                        case 'end':
                                                            return _context4.stop();
                                                    }
                                                }
                                            }, _callee4, this);
                                        }));
                                    };
                                });

                            case 2:
                                rawRecordsList = _context5.sent;
                                return _context5.abrupt('return', rawRecordsList);

                            case 4:
                            case 'end':
                                return _context5.stop();
                        }
                    }
                }, _callee5, this);
            }));
        }
        /**
         * 将数据按照cid合并
         */

    }, {
        key: 'mergeRawDataByChannel',
        value: function mergeRawDataByChannel(listOfRawRecordList) {
            var rawDataByCid = {};
            for (var i = 0; i < listOfRawRecordList.length; i++) {
                var rawData = listOfRawRecordList[i];
                if (rawDataByCid.hasOwnProperty(rawData.cid)) {
                    //合并
                    var oldRawData = rawDataByCid[rawData.cid];
                    rawDataByCid[rawData.cid] = {
                        cid: rawData.cid,
                        beginAt: Math.min(oldRawData.beginAt, rawData.beginAt),
                        endAt: Math.max(oldRawData.endAt, rawData.endAt),
                        records: oldRawData.records.concat(rawData.records)
                    };
                } else {
                    rawDataByCid[rawData.cid] = rawData;
                }
            }
            var result = [];
            for (var cid in rawDataByCid) {
                rawDataByCid[cid].records = rawDataByCid[cid].records.sort(function (a, b) {
                    return a.time - b.time;
                });
                result.push(rawDataByCid[cid]);
            }
            return result;
        }
        /**
         * 不同cid的录像时间之间是否存在重叠区域
         */

    }, {
        key: 'isChannelOverlapping',
        value: function isChannelOverlapping(listOfRawRecordList) {
            var listSortByBeginAt = listOfRawRecordList.sort(function (a, b) {
                return a.beginAt - b.beginAt;
            });
            for (var i = 0; i < listSortByBeginAt.length - 1; i++) {
                var first = listSortByBeginAt[i];
                var second = listSortByBeginAt[i + 1];
                if (first.endAt > second.beginAt) {
                    console.error('\nchannel:' + first.cid + '\u4E0Echannel:' + second.cid + '\u4E4B\u95F4\u7684\u65F6\u95F4\u5B58\u5728\u91CD\u53E0\u533A\u57DF\uFF0C\nchannel:' + first.cid + '\u7684\u5F00\u59CB\u7ED3\u675F\u65F6\u95F4\u4E3A: ' + this.formatTimeOffset(first.beginAt) + '-' + this.formatTimeOffset(first.endAt) + ',\nchannel:' + second.cid + '\u7684\u5F00\u59CB\u7ED3\u675F\u65F6\u95F4\u4E3A: ' + this.formatTimeOffset(second.beginAt) + '-' + this.formatTimeOffset(second.endAt) + '\n        ');
                    return true;
                }
            }
            return false;
        }
    }, {
        key: 'formatTimeOffset',
        value: function formatTimeOffset(offset) {
            return new Date(offset + this.timestamp).toLocaleString();
        }
    }, {
        key: 'hideTrackCb',
        value: function hideTrackCb() {}
    }, {
        key: 'pause',
        value: function pause() {}
    }, {
        key: 'play',
        value: function play() {}
    }]);
    return WTrack;
}(_Track3.default);

exports.default = WTrack;

/***/ }),

/***/ "./new_src/recordPlayer/assets/pause.svg":
/*!***********************************************!*\
  !*** ./new_src/recordPlayer/assets/pause.svg ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTUxOTYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MDgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU5Ljk0NzkyOTA5IDEzMy45MjE4OTNoMTI2LjAyNjAzNDgxYzIzLjMzODE1NDczIDAgNDIuMDA4Njc4MjcgMTguNjcwNTIzNTMgNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZ2NjcyLjEzODg1NzQ4YzAgMjMuMzM4MTU0NzMtMTguNjcwNTIzNTMgNDIuMDA4Njc4MjctNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZIMjU5Ljk0NzkyOTA5Yy0yMy4zMzgxNTQ3MyAwLTQyLjAwODY3ODI3LTE4LjY3MDUyMzUzLTQyLjAwODY3OTU2LTQyLjAwODY3ODI2VjE3NS45MzA1NzEyNmMwLTIzLjMzODE1NDczIDE4LjY3MDUyMzUzLTQyLjAwODY3ODI3IDQyLjAwODY3OTU2LTQyLjAwODY3ODI2ek02MzguMDI2MDM2MSAxMzMuOTIxODkzaDEyNi4wMjYwMzQ4MWMyMy4zMzgxNTQ3MyAwIDQyLjAwODY3ODI3IDE4LjY3MDUyMzUzIDQyLjAwODY3OTU2IDQyLjAwODY3ODI2djY3Mi4xMzg4NTc0OGMwIDIzLjMzODE1NDczLTE4LjY3MDUyMzUzIDQyLjAwODY3ODI3LTQyLjAwODY3OTU2IDQyLjAwODY3ODI2aC0xMjYuMDI2MDM0ODFjLTIzLjMzODE1NDczIDAtNDIuMDA4Njc4MjctMTguNjcwNTIzNTMtNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZWMTc1LjkzMDU3MTI2YzAtMjMuMzM4MTU0NzMgMTguNjcwNTIzNTMtNDIuMDA4Njc4MjcgNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyOTA5Ij48L3BhdGg+PC9zdmc+"

/***/ }),

/***/ "./new_src/recordPlayer/assets/play.svg":
/*!**********************************************!*\
  !*** ./new_src/recordPlayer/assets/play.svg ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTI0MjE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTEyLjcyNDg4NCA0MjkuMzU1NjgxTDIwOC43OTc1NDUgMTMuMTk4NjM4QzE1MS42MDM0NDktMjAuNTk3ODc0IDY0LjAxMjQ5IDEyLjE5ODc0MSA2NC4wMTI0OSA5NS43OTAxMTJWOTI3LjkwNDIxOWMwIDc0Ljk5MjI1OSA4MS4zOTE1OTkgMTIwLjE4NzU5NCAxNDQuNzg1MDU1IDgyLjU5MTQ3NWw3MDMuOTI3MzM5LTQxNS45NTcwNjRjNjIuNzkzNTE4LTM2Ljk5NjE4MSA2Mi45OTM0OTgtMTI4LjE4Njc2OCAwLTE2NS4xODI5NDl6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyMTMyIj48L3BhdGg+PC9zdmc+"

/***/ }),

/***/ "./new_src/recordPlayer/index.ts":
/*!***************************************!*\
  !*** ./new_src/recordPlayer/index.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

var _Timeline = __webpack_require__(/*! ./Timeline */ "./new_src/recordPlayer/Timeline.ts");

var _Timeline2 = _interopRequireDefault(_Timeline);

var _ToolUI = __webpack_require__(/*! ./ToolUI */ "./new_src/recordPlayer/ToolUI.tsx");

var _VideoTrack = __webpack_require__(/*! ./Track/VideoTrack */ "./new_src/recordPlayer/Track/VideoTrack.ts");

var _VideoTrack2 = _interopRequireDefault(_VideoTrack);

var _Wb_V1V = __webpack_require__(/*! ./Track/Wb_V1V2 */ "./new_src/recordPlayer/Track/Wb_V1V2.ts");

var _Wb_V1V2 = _interopRequireDefault(_Wb_V1V);

var _Wb_V = __webpack_require__(/*! ./Track/Wb_V3 */ "./new_src/recordPlayer/Track/Wb_V3.ts");

var _Wb_V2 = _interopRequireDefault(_Wb_V);

var _utils = __webpack_require__(/*! ./utils */ "./new_src/recordPlayer/utils.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

var RecordPlayer = function (_EventEmitter) {
    (0, _inherits3.default)(RecordPlayer, _EventEmitter);

    function RecordPlayer() {
        (0, _classCallCheck3.default)(this, RecordPlayer);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RecordPlayer.__proto__ || (0, _getPrototypeOf2.default)(RecordPlayer)).apply(this, arguments));

        _this.speed = 1;
        _this.init = function (opt) {
            var tracks = [];
            var v3TrackFileObjs = [];
            opt.videoTracks.forEach(function (fileObj) {
                tracks.push(new _VideoTrack2.default(fileObj));
            });
            opt.whiteboardTracks.forEach(function (fileObj) {
                if (opt.version === '1.0' || opt.version === '2.0') {
                    //白板1.0，2.0版本的录像文件
                    tracks.push(new _Wb_V1V2.default(fileObj, {
                        version: opt.version
                    }));
                } else {
                    //白板3.0版本的录像文件
                    v3TrackFileObjs.push(fileObj);
                }
            });
            var drawPlugin = undefined;
            if (v3TrackFileObjs.length > 0) {
                var wbTrack = new _Wb_V2.default(v3TrackFileObjs, {
                    version: opt.version
                });
                tracks.push(wbTrack);
                drawPlugin = wbTrack.drawManager;
            }
            _this.timeline = new _Timeline2.default(tracks);
            _this.timeline.on('tick', function (time) {
                return _this.emit('tick', time);
            });
            _this.timeline.on('pause', function () {
                return _this.emit('pause');
            });
            _this.timeline.on('play', function () {
                return _this.emit('play');
            });
            _this.timeline.on('finished', function () {
                _this.emit('finished');
            });
            _this.timeline.on('visibleChange', function (type, option, callback) {
                _this._visibleChangeCallHandler(type, option, callback);
                _this.emit('visibleChange', type, option);
            });
            var player = _this;
            return new _promise2.default(function (res, rej) {
                _this.timeline.once('ready', function (params) {
                    res({
                        player: player,
                        params: params,
                        drawPlugin: drawPlugin
                    });
                });
                _this.timeline.once('error', function (err) {
                    rej(err);
                });
            });
        };
        _this._visibleChangeCallHandler = function (type, option, callback) {
            if (type === 'show') {
                // 展示白板
                var dom = option.container;
                // 开发者可以在这个时候展示白板容器区域，完成后，将dom传入callback
                callback(dom);
            } else {
                // 开发者可以在这个时候隐藏白板容器区域，完成后，调用callback回调
                callback();
            }
        };
        return _this;
    }

    (0, _createClass3.default)(RecordPlayer, [{
        key: 'bindControlContainer',
        value: function bindControlContainer(div) {
            if (typeof this.unmount === 'function') {
                this.unmount();
            }
            this.unmount = (0, _ToolUI.mount)(div, this);
        }
    }, {
        key: 'setPlaySpeed',
        value: function setPlaySpeed(speed) {
            if (speed <= 0.1 || speed >= 100) {
                throw new Error('播放速度不能大于100，或者小于0.1');
            } else {
                if (this.timeline) {
                    this.timeline.setPlaySpeed(speed);
                    this.speed = speed;
                    this.emit('speedChange', speed);
                }
            }
        }
    }, {
        key: 'setViewer',
        value: function setViewer(viewer) {
            if (this.timeline) {
                this.timeline.setViewer(viewer);
            }
        }
    }, {
        key: 'play',
        value: function play() {
            if (this.timeline) {
                return this.timeline.play();
            }
        }
    }, {
        key: 'pause',
        value: function pause() {
            if (this.timeline) {
                return this.timeline.pause();
            }
        }
    }, {
        key: 'seekTo',
        value: function seekTo(time) {
            if (this.timeline) {
                this.timeline.seekTo(time);
            }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _this2 = this;

                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                if (!this.timeline) {
                                    _context.next = 3;
                                    break;
                                }

                                _context.next = 3;
                                return this.timeline.destroy();

                            case 3:
                                if (typeof this.unmount === 'function') {
                                    this.unmount();
                                    this.unmount = undefined;
                                }
                                delete this.timeline;
                                this.eventNames().forEach(function (name) {
                                    return _this2.off(name);
                                });

                            case 6:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
    }], [{
        key: 'getInstance',
        value: function getInstance(opt) {
            var whiteboardParams = opt.whiteboardParams.urlArr.map(function (url) {
                var params = (0, _utils.parseUrl)(url);
                if (params && opt.whiteboardParams.timestamp) {
                    params.timestamp = opt.whiteboardParams.timestamp;
                }
                if (!params.timestamp) {
                    throw new Error('replay--> \u65E0\u6CD5\u83B7\u53D6\u767D\u677F\u5F55\u50CF\u6587\u4EF6\u7684\u5F00\u59CB\u65F6\u95F4, \u8BF7\u4ED4\u7EC6\u68C0\u67E5\u4F60\u7684\u53C2\u6570');
                }
                if (!opt.whiteboardParams.container) {
                    throw new Error('replay--> 白板容器不可用，请仔细检查你的参数');
                }
                params.container = opt.whiteboardParams.container;
                params.drawPluginParams = opt.whiteboardParams.drawPluginParams;
                return params;
            }).filter(function (param) {
                return param;
            });
            var videoParams = void 0;
            if (!opt.videoParams) {
                videoParams = [];
            } else {
                videoParams = opt.videoParams.map(function (opt, index) {
                    var params = (0, _utils.parseUrl)(opt.url);
                    if (params && opt.timestamp) {
                        params.timestamp = opt.timestamp;
                    }
                    if (!params.timestamp) {
                        throw new Error('replay--> \u65E0\u6CD5\u83B7\u53D6\u7B2C' + (index + 1) + '\u4E2A\u89C6\u9891\u5F55\u50CF\u7684\u5F00\u59CB\u65F6\u95F4, \u8BF7\u4ED4\u7EC6\u68C0\u67E5\u4F60\u7684\u53C2\u6570');
                    }
                    if (!opt.container) {
                        console.error('replay--> \u7B2C' + (index + 1) + '\u4E2A\u5F55\u50CF\u6587\u4EF6\u7684\u5BB9\u5668\u4E3A\u7A7A\uFF0C\u8BF7\u4ED4\u7EC6\u68C0\u67E5\u4F60\u7684\u53C2\u6570');
                    }
                    params.container = opt.container;
                    return params;
                });
            }
            if (true) {
                console.log('replay--> 录像回放参数为', whiteboardParams, videoParams, opt.version);
            }
            var player = new RecordPlayer();
            if (true) {
                window.player = player;
            }
            return player.init({
                whiteboardTracks: whiteboardParams,
                videoTracks: videoParams,
                version: opt.version || '3.0' // 是否是兼容模式，对于老版本的录制文件，需要做不同的解析
            });
        }
    }]);
    return RecordPlayer;
}(_eventemitter2.default);

exports.default = RecordPlayer;

/***/ }),

/***/ "./new_src/recordPlayer/utils.ts":
/*!***************************************!*\
  !*** ./new_src/recordPlayer/utils.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getTime = exports.fetchBlob = exports.getID = exports.RECORD_FILE = undefined;

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

exports.parseUrl = parseUrl;
exports.ab2str = ab2str;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var RECORD_FILE = exports.RECORD_FILE = /(\d+)-(\d+)-(\d+)-(\d+)(-mixed)?\.(mp4|aac|flv|gz)$/i;
function parseUrl(url) {
    var match = RECORD_FILE.exec(url || '');
    if (match) {
        return {
            uid: match[1],
            cid: match[2],
            timestamp: parseInt(match[3]),
            chunk: parseInt(match[4]),
            type: match[6],
            url: url
        };
    } else {
        var lastIndexOfDot = url.lastIndexOf('.');
        return {
            url: url,
            type: url.slice(lastIndexOfDot + 1)
        };
    }
}
var getID = exports.getID = function getID() {
    return ~~(Math.random() * 10000);
};
var textDecoder = void 0;
if (typeof window.TextEncoder === 'function') {
    textDecoder = new window.TextDecoder("utf-8");
}
function ab2str(buf) {
    return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
        return _regenerator2.default.wrap(function _callee$(_context) {
            while (1) {
                switch (_context.prev = _context.next) {
                    case 0:
                        if (!textDecoder) {
                            _context.next = 4;
                            break;
                        }

                        return _context.abrupt('return', textDecoder.decode(buf));

                    case 4:
                        _context.next = 6;
                        return new _promise2.default(function (resolve, reject) {
                            var fileReader = new FileReader();
                            fileReader.onload = function () {
                                resolve(fileReader.result);
                            };
                            fileReader.onerror = reject;
                            fileReader.readAsText(new Blob([new Uint8Array(buf)]));
                        });

                    case 6:
                        return _context.abrupt('return', _context.sent);

                    case 7:
                    case 'end':
                        return _context.stop();
                }
            }
        }, _callee, this);
    }));
}
var fetchBlob = exports.fetchBlob = function fetchBlob(url) {
    return new _promise2.default(function (resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.responseType = 'blob';
        xhr.onload = function () {
            resolve(xhr.response);
        };
        xhr.onerror = reject;
        xhr.send();
    });
};
var p0 = function p0(n) {
    return n < 10 ? '0' + n : '' + n;
};
var getTime = exports.getTime = function getTime(n) {
    var showHour = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

    n = ~~(n / 1000);
    var second = n % 60;
    n -= second;
    n = ~~(n / 60); // 有多少分钟
    var minute = n % 60; // 
    var hour = ~~(n / 60);
    if (hour === 0 && showHour === false) {
        return [p0(minute) + ':' + p0(second), hour];
    }
    return [hour + ':' + p0(minute) + ':' + p0(second), hour];
};

/***/ }),

/***/ "./new_src/util/validate.ts":
/*!**********************************!*\
  !*** ./new_src/util/validate.ts ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ "./node_modules/babel-runtime/helpers/typeof.js");

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// schema = { // 登录参数规则
//     appKey: {
//       type: 'string',
//       isRequire: true
//     },
//     account: {
//       type: 'string',
//       isRequire: true
//     },
//     token: {
//       type: 'string',
//       isRequire: true
//     },
//     record: {
//       type: 'boolean',
//       defaultValue: false
//     },
//     channelName: {
//       type: 'string|number',
//       isRequire: true
//     },
//     platform: {
//       type: 'string',
//       isRequire: true,
//       enum: PlatformArray
//     }
//   }
// validate(schema)
// ===>>
// [{key, message}]
exports.default = {
    isUndefined: function isUndefined(value) {
        return typeof value === 'undefined';
    },
    isDOM: function isDOM(value) {
        if ((typeof HTMLElement === 'undefined' ? 'undefined' : (0, _typeof3.default)(HTMLElement)) === 'object') {
            return value instanceof HTMLElement;
        }
        return value && (typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) === 'object' && value.nodeType === 1 && typeof value.nodeName === 'string';
    },
    isValidString: function isValidString(value) {
        return Object.prototype.toString.call(value) === '[object String]';
    },
    isBoolean: function isBoolean(value) {
        return typeof value === 'boolean';
    },
    isFunction: function isFunction(value) {
        return typeof value === 'function';
    },
    isNumber: function isNumber(value) {
        return typeof value === 'number';
    },
    isValidArray: function isValidArray(value) {
        return Object.prototype.toString.call(value) === '[object Array]';
    },
    isValidHexColor: function isValidHexColor(value) {
        return (/^#[0-9abcdef]{6}$/gi.test(value)
        );
    },
    isObject: function isObject(value) {
        return (typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) === 'object';
    },
    isValidObject: function isValidObject(value) {
        if ((typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) !== 'object') {
            return false;
        }
        value = (0, _assign2.default)({}, value);
        if (_keys2.default && (0, _keys2.default)(value).length === 0) {
            return false;
        }
        try {
            return (0, _stringify2.default)(value) !== '{}';
        } catch (e) {
            return false;
        }
    },

    // 检查参数
    // data 检查的对象，rule 对象键值规则，skipKey 需要跳过的键，resObj 通过检查的赋值对象
    /* rule 例：
    {
      account: {
        type: 'string', // dom string boolean function number string|number
        isRequire: true
      }
     }
     */
    validate: function validate(position, data, ruleObj) {
        var _this = this;

        var validateErrors = [];
        (0, _keys2.default)(ruleObj).map(function (key) {
            var rule = ruleObj[key];
            var dataValue = data[key];
            if (_this.isUndefined(dataValue)) {
                /**
                 * 值空缺
                 */
                if (rule.isRequire) {
                    validateErrors.push({
                        key: key,
                        message: key + ' is required'
                    });
                }
            } else {
                /**
                 * 检查类型
                 */
                switch (rule.type.toLowerCase()) {
                    case 'dom':
                        if (!_this.isDOM(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected dom, but get other type'
                            });
                        }
                        break;
                    case 'string':
                        if (!_this.isValidString(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected string, but get other type'
                            });
                        }
                        break;
                    case 'boolean':
                        if (!_this.isBoolean(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected boolean, but get other type'
                            });
                        }
                        break;
                    case 'function':
                        if (!_this.isFunction(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected function, but get other type'
                            });
                        }
                        break;
                    case 'number':
                        if (!_this.isNumber(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected number, but get other type'
                            });
                        }
                        break;
                    case 'object':
                        if (!_this.isObject(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected object, but get other type'
                            });
                        }
                        break;
                    case 'array':
                        if (!_this.isValidArray(dataValue)) {
                            validateErrors.push({
                                key: key,
                                message: 'Expected array, but get other type'
                            });
                        }
                        break;
                    default:
                        validateErrors.push({
                            key: key,
                            message: key + '\u7684\u7C7B\u578B\u672A\u77E5: ' + rule.type.toLowerCase()
                        });
                }
                /**
                 * 检查是否为枚举之一
                 */
                if (rule.enum && !rule.enum.includes(dataValue)) {
                    validateErrors.push({
                        key: key,
                        message: 'Expected ' + key + ' to be one of ' + (0, _stringify2.default)(rule.enum) + ', but it is not'
                    });
                }
            }
        });
        if (validateErrors.length > 0) {
            console.error('白板-->', position + '\u53C2\u6570\u5F02\u5E38');
            console.error('白板-->', '错误信息：', validateErrors);
            console.error('白板-->', '参数为：', data);
        }
        return validateErrors.length === 0;
    }
};

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/array/from.js":
/*!**********************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/array/from.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/array/from */ "./node_modules/core-js/library/fn/array/from.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/get-iterator.js":
/*!************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/get-iterator.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/get-iterator */ "./node_modules/core-js/library/fn/get-iterator.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/is-iterable.js":
/*!***********************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/is-iterable.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/is-iterable */ "./node_modules/core-js/library/fn/is-iterable.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/json/stringify.js":
/*!**************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/json/stringify.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/json/stringify */ "./node_modules/core-js/library/fn/json/stringify.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/map.js":
/*!***************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/map.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/map */ "./node_modules/core-js/library/fn/map.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/number/is-integer.js":
/*!*****************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/number/is-integer.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/number/is-integer */ "./node_modules/core-js/library/fn/number/is-integer.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/assign.js":
/*!*************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/assign.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/assign */ "./node_modules/core-js/library/fn/object/assign.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/create.js":
/*!*************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/create.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/create */ "./node_modules/core-js/library/fn/object/create.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/define-properties.js":
/*!************************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/define-properties.js ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/define-properties */ "./node_modules/core-js/library/fn/object/define-properties.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/define-property.js":
/*!**********************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/define-property.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/define-property */ "./node_modules/core-js/library/fn/object/define-property.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js":
/*!***********************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/get-prototype-of.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/get-prototype-of */ "./node_modules/core-js/library/fn/object/get-prototype-of.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/keys.js":
/*!***********************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/keys.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/keys */ "./node_modules/core-js/library/fn/object/keys.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/object/set-prototype-of.js":
/*!***********************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/set-prototype-of.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/object/set-prototype-of */ "./node_modules/core-js/library/fn/object/set-prototype-of.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/promise.js":
/*!*******************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/promise.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/promise */ "./node_modules/core-js/library/fn/promise.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/set.js":
/*!***************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/set.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/set */ "./node_modules/core-js/library/fn/set.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/symbol.js":
/*!******************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/symbol.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/symbol */ "./node_modules/core-js/library/fn/symbol/index.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/core-js/symbol/iterator.js":
/*!***************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/symbol/iterator.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(/*! core-js/library/fn/symbol/iterator */ "./node_modules/core-js/library/fn/symbol/iterator.js"), __esModule: true };

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/classCallCheck.js":
/*!**************************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/classCallCheck.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

exports.default = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/createClass.js":
/*!***********************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/createClass.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _defineProperty = __webpack_require__(/*! ../core-js/object/define-property */ "./node_modules/babel-runtime/core-js/object/define-property.js");

var _defineProperty2 = _interopRequireDefault(_defineProperty);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      (0, _defineProperty2.default)(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/inherits.js":
/*!********************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/inherits.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _setPrototypeOf = __webpack_require__(/*! ../core-js/object/set-prototype-of */ "./node_modules/babel-runtime/core-js/object/set-prototype-of.js");

var _setPrototypeOf2 = _interopRequireDefault(_setPrototypeOf);

var _create = __webpack_require__(/*! ../core-js/object/create */ "./node_modules/babel-runtime/core-js/object/create.js");

var _create2 = _interopRequireDefault(_create);

var _typeof2 = __webpack_require__(/*! ../helpers/typeof */ "./node_modules/babel-runtime/helpers/typeof.js");

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : (0, _typeof3.default)(superClass)));
  }

  subClass.prototype = (0, _create2.default)(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  if (superClass) _setPrototypeOf2.default ? (0, _setPrototypeOf2.default)(subClass, superClass) : subClass.__proto__ = superClass;
};

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js":
/*!*************************************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/possibleConstructorReturn.js ***!
  \*************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _typeof2 = __webpack_require__(/*! ../helpers/typeof */ "./node_modules/babel-runtime/helpers/typeof.js");

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (self, call) {
  if (!self) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return call && ((typeof call === "undefined" ? "undefined" : (0, _typeof3.default)(call)) === "object" || typeof call === "function") ? call : self;
};

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/slicedToArray.js":
/*!*************************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/slicedToArray.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _isIterable2 = __webpack_require__(/*! ../core-js/is-iterable */ "./node_modules/babel-runtime/core-js/is-iterable.js");

var _isIterable3 = _interopRequireDefault(_isIterable2);

var _getIterator2 = __webpack_require__(/*! ../core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
  function sliceIterator(arr, i) {
    var _arr = [];
    var _n = true;
    var _d = false;
    var _e = undefined;

    try {
      for (var _i = (0, _getIterator3.default)(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {
        _arr.push(_s.value);

        if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;
      _e = err;
    } finally {
      try {
        if (!_n && _i["return"]) _i["return"]();
      } finally {
        if (_d) throw _e;
      }
    }

    return _arr;
  }

  return function (arr, i) {
    if (Array.isArray(arr)) {
      return arr;
    } else if ((0, _isIterable3.default)(Object(arr))) {
      return sliceIterator(arr, i);
    } else {
      throw new TypeError("Invalid attempt to destructure non-iterable instance");
    }
  };
}();

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/toConsumableArray.js":
/*!*****************************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/toConsumableArray.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _from = __webpack_require__(/*! ../core-js/array/from */ "./node_modules/babel-runtime/core-js/array/from.js");

var _from2 = _interopRequireDefault(_from);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
      arr2[i] = arr[i];
    }

    return arr2;
  } else {
    return (0, _from2.default)(arr);
  }
};

/***/ }),

/***/ "./node_modules/babel-runtime/helpers/typeof.js":
/*!******************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/typeof.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _iterator = __webpack_require__(/*! ../core-js/symbol/iterator */ "./node_modules/babel-runtime/core-js/symbol/iterator.js");

var _iterator2 = _interopRequireDefault(_iterator);

var _symbol = __webpack_require__(/*! ../core-js/symbol */ "./node_modules/babel-runtime/core-js/symbol.js");

var _symbol2 = _interopRequireDefault(_symbol);

var _typeof = typeof _symbol2.default === "function" && typeof _iterator2.default === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = typeof _symbol2.default === "function" && _typeof(_iterator2.default) === "symbol" ? function (obj) {
  return typeof obj === "undefined" ? "undefined" : _typeof(obj);
} : function (obj) {
  return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof(obj);
};

/***/ }),

/***/ "./node_modules/babel-runtime/node_modules/regenerator-runtime/runtime-module.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/babel-runtime/node_modules/regenerator-runtime/runtime-module.js ***!
  \***************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

// This method of obtaining a reference to the global object needs to be
// kept identical to the way it is obtained in runtime.js
var g = (function() { return this })() || Function("return this")();

// Use `getOwnPropertyNames` because not all browsers support calling
// `hasOwnProperty` on the global `self` object in a worker. See #183.
var hadRuntime = g.regeneratorRuntime &&
  Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime") >= 0;

// Save the old regeneratorRuntime in case it needs to be restored later.
var oldRuntime = hadRuntime && g.regeneratorRuntime;

// Force reevalutation of runtime.js.
g.regeneratorRuntime = undefined;

module.exports = __webpack_require__(/*! ./runtime */ "./node_modules/babel-runtime/node_modules/regenerator-runtime/runtime.js");

if (hadRuntime) {
  // Restore the original runtime.
  g.regeneratorRuntime = oldRuntime;
} else {
  // Remove the global property added by runtime.js.
  try {
    delete g.regeneratorRuntime;
  } catch(e) {
    g.regeneratorRuntime = undefined;
  }
}


/***/ }),

/***/ "./node_modules/babel-runtime/node_modules/regenerator-runtime/runtime.js":
/*!********************************************************************************!*\
  !*** ./node_modules/babel-runtime/node_modules/regenerator-runtime/runtime.js ***!
  \********************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!(function(global) {
  "use strict";

  var Op = Object.prototype;
  var hasOwn = Op.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var $Symbol = typeof Symbol === "function" ? Symbol : {};
  var iteratorSymbol = $Symbol.iterator || "@@iterator";
  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  var inModule = typeof module === "object";
  var runtime = global.regeneratorRuntime;
  if (runtime) {
    if (inModule) {
      // If regeneratorRuntime is defined globally and we're in a module,
      // make the exports object identical to regeneratorRuntime.
      module.exports = runtime;
    }
    // Don't bother evaluating the rest of this file if the runtime was
    // already defined globally.
    return;
  }

  // Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime = global.regeneratorRuntime = inModule ? module.exports : {};

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
    var generator = Object.create(protoGenerator.prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  runtime.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  // This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype = {};
  IteratorPrototype[iteratorSymbol] = function () {
    return this;
  };

  var getProto = Object.getPrototypeOf;
  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  if (NativeIteratorPrototype &&
      NativeIteratorPrototype !== Op &&
      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
    // This environment has a native %IteratorPrototype%; use it instead
    // of the polyfill.
    IteratorPrototype = NativeIteratorPrototype;
  }

  var Gp = GeneratorFunctionPrototype.prototype =
    Generator.prototype = Object.create(IteratorPrototype);
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunctionPrototype[toStringTagSymbol] =
    GeneratorFunction.displayName = "GeneratorFunction";

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      prototype[method] = function(arg) {
        return this._invoke(method, arg);
      };
    });
  }

  runtime.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  runtime.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
      if (!(toStringTagSymbol in genFun)) {
        genFun[toStringTagSymbol] = "GeneratorFunction";
      }
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  runtime.awrap = function(arg) {
    return { __await: arg };
  };

  function AsyncIterator(generator) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);
      if (record.type === "throw") {
        reject(record.arg);
      } else {
        var result = record.arg;
        var value = result.value;
        if (value &&
            typeof value === "object" &&
            hasOwn.call(value, "__await")) {
          return Promise.resolve(value.__await).then(function(value) {
            invoke("next", value, resolve, reject);
          }, function(err) {
            invoke("throw", err, resolve, reject);
          });
        }

        return Promise.resolve(value).then(function(unwrapped) {
          // When a yielded Promise is resolved, its final value becomes
          // the .value of the Promise<{value,done}> result for the
          // current iteration. If the Promise is rejected, however, the
          // result for this iteration will be rejected with the same
          // reason. Note that rejections of yielded Promises are not
          // thrown back into the generator function, as is the case
          // when an awaited Promise is rejected. This difference in
          // behavior between yield and await is important, because it
          // allows the consumer to decide what to do with the yielded
          // rejection (swallow it and continue, manually .throw it back
          // into the generator, abandon iteration, whatever). With
          // await, by contrast, there is no opportunity to examine the
          // rejection reason outside the generator function, so the
          // only option is to throw it from the await expression, and
          // let the generator function handle the exception.
          result.value = unwrapped;
          resolve(result);
        }, reject);
      }
    }

    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return new Promise(function(resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : callInvokeWithMethodAndArg();
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);
  AsyncIterator.prototype[asyncIteratorSymbol] = function () {
    return this;
  };
  runtime.AsyncIterator = AsyncIterator;

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async = function(innerFn, outerFn, self, tryLocsList) {
    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList)
    );

    return runtime.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      context.method = method;
      context.arg = arg;

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          var delegateResult = maybeInvokeDelegate(delegate, context);
          if (delegateResult) {
            if (delegateResult === ContinueSentinel) continue;
            return delegateResult;
          }
        }

        if (context.method === "next") {
          // Setting context._sent for legacy support of Babel's
          // function.sent implementation.
          context.sent = context._sent = context.arg;

        } else if (context.method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw context.arg;
          }

          context.dispatchException(context.arg);

        } else if (context.method === "return") {
          context.abrupt("return", context.arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          if (record.arg === ContinueSentinel) {
            continue;
          }

          return {
            value: record.arg,
            done: context.done
          };

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(context.arg) call above.
          context.method = "throw";
          context.arg = record.arg;
        }
      }
    };
  }

  // Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];
    if (method === undefined) {
      // A .throw or .return when the delegate iterator has no .throw
      // method always terminates the yield* loop.
      context.delegate = null;

      if (context.method === "throw") {
        if (delegate.iterator.return) {
          // If the delegate iterator has a return method, give it a
          // chance to clean up.
          context.method = "return";
          context.arg = undefined;
          maybeInvokeDelegate(delegate, context);

          if (context.method === "throw") {
            // If maybeInvokeDelegate(context) changed context.method from
            // "return" to "throw", let that override the TypeError below.
            return ContinueSentinel;
          }
        }

        context.method = "throw";
        context.arg = new TypeError(
          "The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);

    if (record.type === "throw") {
      context.method = "throw";
      context.arg = record.arg;
      context.delegate = null;
      return ContinueSentinel;
    }

    var info = record.arg;

    if (! info) {
      context.method = "throw";
      context.arg = new TypeError("iterator result is not an object");
      context.delegate = null;
      return ContinueSentinel;
    }

    if (info.done) {
      // Assign the result of the finished delegate to the temporary
      // variable specified by delegate.resultName (see delegateYield).
      context[delegate.resultName] = info.value;

      // Resume execution at the desired location (see delegateYield).
      context.next = delegate.nextLoc;

      // If context.method was "throw" but the delegate handled the
      // exception, let the outer generator proceed normally. If
      // context.method was "next", forget context.arg since it has been
      // "consumed" by the delegate iterator. If context.method was
      // "return", allow the original .return call to continue in the
      // outer generator.
      if (context.method !== "return") {
        context.method = "next";
        context.arg = undefined;
      }

    } else {
      // Re-yield the result returned by the delegate method.
      return info;
    }

    // The delegate iterator is finished, so forget it and continue with
    // the outer generator.
    context.delegate = null;
    return ContinueSentinel;
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  Gp[toStringTagSymbol] = "Generator";

  // A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  runtime.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  runtime.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      // Resetting context._sent for legacy support of Babel's
      // function.sent implementation.
      this.sent = this._sent = undefined;
      this.done = false;
      this.delegate = null;

      this.method = "next";
      this.arg = undefined;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;

        if (caught) {
          // If the dispatched exception was caught by a catch block,
          // then let that catch block handle the exception normally.
          context.method = "next";
          context.arg = undefined;
        }

        return !! caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.method = "next";
        this.next = finallyEntry.finallyLoc;
        return ContinueSentinel;
      }

      return this.complete(record);
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = this.arg = record.arg;
        this.method = "return";
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }

      return ContinueSentinel;
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      if (this.method === "next") {
        // Deliberately forget the last sent value so that we don't
        // accidentally pass it on to the delegate.
        this.arg = undefined;
      }

      return ContinueSentinel;
    }
  };
})(
  // In sloppy mode, unbound `this` refers to the global object, fallback to
  // Function constructor if we're in global strict mode. That is sadly a form
  // of indirect eval which violates Content Security Policy.
  (function() { return this })() || Function("return this")()
);


/***/ }),

/***/ "./node_modules/babel-runtime/regenerator/index.js":
/*!*********************************************************!*\
  !*** ./node_modules/babel-runtime/regenerator/index.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! regenerator-runtime */ "./node_modules/babel-runtime/node_modules/regenerator-runtime/runtime-module.js");


/***/ }),

/***/ "./node_modules/core-js/library/fn/array/from.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/fn/array/from.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
__webpack_require__(/*! ../../modules/es6.array.from */ "./node_modules/core-js/library/modules/es6.array.from.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Array.from;


/***/ }),

/***/ "./node_modules/core-js/library/fn/get-iterator.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/fn/get-iterator.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../modules/web.dom.iterable */ "./node_modules/core-js/library/modules/web.dom.iterable.js");
__webpack_require__(/*! ../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
module.exports = __webpack_require__(/*! ../modules/core.get-iterator */ "./node_modules/core-js/library/modules/core.get-iterator.js");


/***/ }),

/***/ "./node_modules/core-js/library/fn/is-iterable.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/library/fn/is-iterable.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../modules/web.dom.iterable */ "./node_modules/core-js/library/modules/web.dom.iterable.js");
__webpack_require__(/*! ../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
module.exports = __webpack_require__(/*! ../modules/core.is-iterable */ "./node_modules/core-js/library/modules/core.is-iterable.js");


/***/ }),

/***/ "./node_modules/core-js/library/fn/json/stringify.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/library/fn/json/stringify.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var core = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js");
var $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });
module.exports = function stringify(it) { // eslint-disable-line no-unused-vars
  return $JSON.stringify.apply($JSON, arguments);
};


/***/ }),

/***/ "./node_modules/core-js/library/fn/map.js":
/*!************************************************!*\
  !*** ./node_modules/core-js/library/fn/map.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../modules/es6.object.to-string */ "./node_modules/core-js/library/modules/es6.object.to-string.js");
__webpack_require__(/*! ../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
__webpack_require__(/*! ../modules/web.dom.iterable */ "./node_modules/core-js/library/modules/web.dom.iterable.js");
__webpack_require__(/*! ../modules/es6.map */ "./node_modules/core-js/library/modules/es6.map.js");
__webpack_require__(/*! ../modules/es7.map.to-json */ "./node_modules/core-js/library/modules/es7.map.to-json.js");
__webpack_require__(/*! ../modules/es7.map.of */ "./node_modules/core-js/library/modules/es7.map.of.js");
__webpack_require__(/*! ../modules/es7.map.from */ "./node_modules/core-js/library/modules/es7.map.from.js");
module.exports = __webpack_require__(/*! ../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Map;


/***/ }),

/***/ "./node_modules/core-js/library/fn/number/is-integer.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/fn/number/is-integer.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.number.is-integer */ "./node_modules/core-js/library/modules/es6.number.is-integer.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Number.isInteger;


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/assign.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/assign.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.assign */ "./node_modules/core-js/library/modules/es6.object.assign.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object.assign;


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/create.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/create.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.create */ "./node_modules/core-js/library/modules/es6.object.create.js");
var $Object = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object;
module.exports = function create(P, D) {
  return $Object.create(P, D);
};


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/define-properties.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/define-properties.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.define-properties */ "./node_modules/core-js/library/modules/es6.object.define-properties.js");
var $Object = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object;
module.exports = function defineProperties(T, D) {
  return $Object.defineProperties(T, D);
};


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/define-property.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/define-property.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.define-property */ "./node_modules/core-js/library/modules/es6.object.define-property.js");
var $Object = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object;
module.exports = function defineProperty(it, key, desc) {
  return $Object.defineProperty(it, key, desc);
};


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/get-prototype-of.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/get-prototype-of.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.get-prototype-of */ "./node_modules/core-js/library/modules/es6.object.get-prototype-of.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object.getPrototypeOf;


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/keys.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/keys.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.keys */ "./node_modules/core-js/library/modules/es6.object.keys.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object.keys;


/***/ }),

/***/ "./node_modules/core-js/library/fn/object/set-prototype-of.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/set-prototype-of.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.object.set-prototype-of */ "./node_modules/core-js/library/modules/es6.object.set-prototype-of.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Object.setPrototypeOf;


/***/ }),

/***/ "./node_modules/core-js/library/fn/promise.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/library/fn/promise.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../modules/es6.object.to-string */ "./node_modules/core-js/library/modules/es6.object.to-string.js");
__webpack_require__(/*! ../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
__webpack_require__(/*! ../modules/web.dom.iterable */ "./node_modules/core-js/library/modules/web.dom.iterable.js");
__webpack_require__(/*! ../modules/es6.promise */ "./node_modules/core-js/library/modules/es6.promise.js");
__webpack_require__(/*! ../modules/es7.promise.finally */ "./node_modules/core-js/library/modules/es7.promise.finally.js");
__webpack_require__(/*! ../modules/es7.promise.try */ "./node_modules/core-js/library/modules/es7.promise.try.js");
module.exports = __webpack_require__(/*! ../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Promise;


/***/ }),

/***/ "./node_modules/core-js/library/fn/set.js":
/*!************************************************!*\
  !*** ./node_modules/core-js/library/fn/set.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../modules/es6.object.to-string */ "./node_modules/core-js/library/modules/es6.object.to-string.js");
__webpack_require__(/*! ../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
__webpack_require__(/*! ../modules/web.dom.iterable */ "./node_modules/core-js/library/modules/web.dom.iterable.js");
__webpack_require__(/*! ../modules/es6.set */ "./node_modules/core-js/library/modules/es6.set.js");
__webpack_require__(/*! ../modules/es7.set.to-json */ "./node_modules/core-js/library/modules/es7.set.to-json.js");
__webpack_require__(/*! ../modules/es7.set.of */ "./node_modules/core-js/library/modules/es7.set.of.js");
__webpack_require__(/*! ../modules/es7.set.from */ "./node_modules/core-js/library/modules/es7.set.from.js");
module.exports = __webpack_require__(/*! ../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Set;


/***/ }),

/***/ "./node_modules/core-js/library/fn/symbol/index.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/fn/symbol/index.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.symbol */ "./node_modules/core-js/library/modules/es6.symbol.js");
__webpack_require__(/*! ../../modules/es6.object.to-string */ "./node_modules/core-js/library/modules/es6.object.to-string.js");
__webpack_require__(/*! ../../modules/es7.symbol.async-iterator */ "./node_modules/core-js/library/modules/es7.symbol.async-iterator.js");
__webpack_require__(/*! ../../modules/es7.symbol.observable */ "./node_modules/core-js/library/modules/es7.symbol.observable.js");
module.exports = __webpack_require__(/*! ../../modules/_core */ "./node_modules/core-js/library/modules/_core.js").Symbol;


/***/ }),

/***/ "./node_modules/core-js/library/fn/symbol/iterator.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/fn/symbol/iterator.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ../../modules/es6.string.iterator */ "./node_modules/core-js/library/modules/es6.string.iterator.js");
__webpack_require__(/*! ../../modules/web.dom.iterable */ "./node_modules/core-js/library/modules/web.dom.iterable.js");
module.exports = __webpack_require__(/*! ../../modules/_wks-ext */ "./node_modules/core-js/library/modules/_wks-ext.js").f('iterator');


/***/ }),

/***/ "./node_modules/core-js/library/modules/_a-function.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_a-function.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (it) {
  if (typeof it != 'function') throw TypeError(it + ' is not a function!');
  return it;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_add-to-unscopables.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_add-to-unscopables.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function () { /* empty */ };


/***/ }),

/***/ "./node_modules/core-js/library/modules/_an-instance.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_an-instance.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (it, Constructor, name, forbiddenField) {
  if (!(it instanceof Constructor) || (forbiddenField !== undefined && forbiddenField in it)) {
    throw TypeError(name + ': incorrect invocation!');
  } return it;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_an-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_an-object.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
module.exports = function (it) {
  if (!isObject(it)) throw TypeError(it + ' is not an object!');
  return it;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_array-from-iterable.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-from-iterable.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var forOf = __webpack_require__(/*! ./_for-of */ "./node_modules/core-js/library/modules/_for-of.js");

module.exports = function (iter, ITERATOR) {
  var result = [];
  forOf(iter, false, result.push, result, ITERATOR);
  return result;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_array-includes.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-includes.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// false -> Array#indexOf
// true  -> Array#includes
var toIObject = __webpack_require__(/*! ./_to-iobject */ "./node_modules/core-js/library/modules/_to-iobject.js");
var toLength = __webpack_require__(/*! ./_to-length */ "./node_modules/core-js/library/modules/_to-length.js");
var toAbsoluteIndex = __webpack_require__(/*! ./_to-absolute-index */ "./node_modules/core-js/library/modules/_to-absolute-index.js");
module.exports = function (IS_INCLUDES) {
  return function ($this, el, fromIndex) {
    var O = toIObject($this);
    var length = toLength(O.length);
    var index = toAbsoluteIndex(fromIndex, length);
    var value;
    // Array#includes uses SameValueZero equality algorithm
    // eslint-disable-next-line no-self-compare
    if (IS_INCLUDES && el != el) while (length > index) {
      value = O[index++];
      // eslint-disable-next-line no-self-compare
      if (value != value) return true;
    // Array#indexOf ignores holes, Array#includes - not
    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {
      if (O[index] === el) return IS_INCLUDES || index || 0;
    } return !IS_INCLUDES && -1;
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_array-methods.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-methods.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 0 -> Array#forEach
// 1 -> Array#map
// 2 -> Array#filter
// 3 -> Array#some
// 4 -> Array#every
// 5 -> Array#find
// 6 -> Array#findIndex
var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var IObject = __webpack_require__(/*! ./_iobject */ "./node_modules/core-js/library/modules/_iobject.js");
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var toLength = __webpack_require__(/*! ./_to-length */ "./node_modules/core-js/library/modules/_to-length.js");
var asc = __webpack_require__(/*! ./_array-species-create */ "./node_modules/core-js/library/modules/_array-species-create.js");
module.exports = function (TYPE, $create) {
  var IS_MAP = TYPE == 1;
  var IS_FILTER = TYPE == 2;
  var IS_SOME = TYPE == 3;
  var IS_EVERY = TYPE == 4;
  var IS_FIND_INDEX = TYPE == 6;
  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;
  var create = $create || asc;
  return function ($this, callbackfn, that) {
    var O = toObject($this);
    var self = IObject(O);
    var f = ctx(callbackfn, that, 3);
    var length = toLength(self.length);
    var index = 0;
    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;
    var val, res;
    for (;length > index; index++) if (NO_HOLES || index in self) {
      val = self[index];
      res = f(val, index, O);
      if (TYPE) {
        if (IS_MAP) result[index] = res;   // map
        else if (res) switch (TYPE) {
          case 3: return true;             // some
          case 5: return val;              // find
          case 6: return index;            // findIndex
          case 2: result.push(val);        // filter
        } else if (IS_EVERY) return false; // every
      }
    }
    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_array-species-constructor.js":
/*!****************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-species-constructor.js ***!
  \****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var isArray = __webpack_require__(/*! ./_is-array */ "./node_modules/core-js/library/modules/_is-array.js");
var SPECIES = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('species');

module.exports = function (original) {
  var C;
  if (isArray(original)) {
    C = original.constructor;
    // cross-realm fallback
    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;
    if (isObject(C)) {
      C = C[SPECIES];
      if (C === null) C = undefined;
    }
  } return C === undefined ? Array : C;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_array-species-create.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-species-create.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 9.4.2.3 ArraySpeciesCreate(originalArray, length)
var speciesConstructor = __webpack_require__(/*! ./_array-species-constructor */ "./node_modules/core-js/library/modules/_array-species-constructor.js");

module.exports = function (original, length) {
  return new (speciesConstructor(original))(length);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_classof.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_classof.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// getting tag from 19.1.3.6 Object.prototype.toString()
var cof = __webpack_require__(/*! ./_cof */ "./node_modules/core-js/library/modules/_cof.js");
var TAG = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('toStringTag');
// ES3 wrong here
var ARG = cof(function () { return arguments; }()) == 'Arguments';

// fallback for IE11 Script Access Denied error
var tryGet = function (it, key) {
  try {
    return it[key];
  } catch (e) { /* empty */ }
};

module.exports = function (it) {
  var O, T, B;
  return it === undefined ? 'Undefined' : it === null ? 'Null'
    // @@toStringTag case
    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T
    // builtinTag case
    : ARG ? cof(O)
    // ES3 arguments fallback
    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_cof.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_cof.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

var toString = {}.toString;

module.exports = function (it) {
  return toString.call(it).slice(8, -1);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_collection-strong.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_collection-strong.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var dP = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js").f;
var create = __webpack_require__(/*! ./_object-create */ "./node_modules/core-js/library/modules/_object-create.js");
var redefineAll = __webpack_require__(/*! ./_redefine-all */ "./node_modules/core-js/library/modules/_redefine-all.js");
var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var anInstance = __webpack_require__(/*! ./_an-instance */ "./node_modules/core-js/library/modules/_an-instance.js");
var forOf = __webpack_require__(/*! ./_for-of */ "./node_modules/core-js/library/modules/_for-of.js");
var $iterDefine = __webpack_require__(/*! ./_iter-define */ "./node_modules/core-js/library/modules/_iter-define.js");
var step = __webpack_require__(/*! ./_iter-step */ "./node_modules/core-js/library/modules/_iter-step.js");
var setSpecies = __webpack_require__(/*! ./_set-species */ "./node_modules/core-js/library/modules/_set-species.js");
var DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js");
var fastKey = __webpack_require__(/*! ./_meta */ "./node_modules/core-js/library/modules/_meta.js").fastKey;
var validate = __webpack_require__(/*! ./_validate-collection */ "./node_modules/core-js/library/modules/_validate-collection.js");
var SIZE = DESCRIPTORS ? '_s' : 'size';

var getEntry = function (that, key) {
  // fast case
  var index = fastKey(key);
  var entry;
  if (index !== 'F') return that._i[index];
  // frozen object case
  for (entry = that._f; entry; entry = entry.n) {
    if (entry.k == key) return entry;
  }
};

module.exports = {
  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {
    var C = wrapper(function (that, iterable) {
      anInstance(that, C, NAME, '_i');
      that._t = NAME;         // collection type
      that._i = create(null); // index
      that._f = undefined;    // first entry
      that._l = undefined;    // last entry
      that[SIZE] = 0;         // size
      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);
    });
    redefineAll(C.prototype, {
      // 23.1.3.1 Map.prototype.clear()
      // 23.2.3.2 Set.prototype.clear()
      clear: function clear() {
        for (var that = validate(this, NAME), data = that._i, entry = that._f; entry; entry = entry.n) {
          entry.r = true;
          if (entry.p) entry.p = entry.p.n = undefined;
          delete data[entry.i];
        }
        that._f = that._l = undefined;
        that[SIZE] = 0;
      },
      // 23.1.3.3 Map.prototype.delete(key)
      // 23.2.3.4 Set.prototype.delete(value)
      'delete': function (key) {
        var that = validate(this, NAME);
        var entry = getEntry(that, key);
        if (entry) {
          var next = entry.n;
          var prev = entry.p;
          delete that._i[entry.i];
          entry.r = true;
          if (prev) prev.n = next;
          if (next) next.p = prev;
          if (that._f == entry) that._f = next;
          if (that._l == entry) that._l = prev;
          that[SIZE]--;
        } return !!entry;
      },
      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)
      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)
      forEach: function forEach(callbackfn /* , that = undefined */) {
        validate(this, NAME);
        var f = ctx(callbackfn, arguments.length > 1 ? arguments[1] : undefined, 3);
        var entry;
        while (entry = entry ? entry.n : this._f) {
          f(entry.v, entry.k, this);
          // revert to the last existing entry
          while (entry && entry.r) entry = entry.p;
        }
      },
      // 23.1.3.7 Map.prototype.has(key)
      // 23.2.3.7 Set.prototype.has(value)
      has: function has(key) {
        return !!getEntry(validate(this, NAME), key);
      }
    });
    if (DESCRIPTORS) dP(C.prototype, 'size', {
      get: function () {
        return validate(this, NAME)[SIZE];
      }
    });
    return C;
  },
  def: function (that, key, value) {
    var entry = getEntry(that, key);
    var prev, index;
    // change existing entry
    if (entry) {
      entry.v = value;
    // create new entry
    } else {
      that._l = entry = {
        i: index = fastKey(key, true), // <- index
        k: key,                        // <- key
        v: value,                      // <- value
        p: prev = that._l,             // <- previous entry
        n: undefined,                  // <- next entry
        r: false                       // <- removed
      };
      if (!that._f) that._f = entry;
      if (prev) prev.n = entry;
      that[SIZE]++;
      // add to index
      if (index !== 'F') that._i[index] = entry;
    } return that;
  },
  getEntry: getEntry,
  setStrong: function (C, NAME, IS_MAP) {
    // add .keys, .values, .entries, [@@iterator]
    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11
    $iterDefine(C, NAME, function (iterated, kind) {
      this._t = validate(iterated, NAME); // target
      this._k = kind;                     // kind
      this._l = undefined;                // previous
    }, function () {
      var that = this;
      var kind = that._k;
      var entry = that._l;
      // revert to the last existing entry
      while (entry && entry.r) entry = entry.p;
      // get next entry
      if (!that._t || !(that._l = entry = entry ? entry.n : that._t._f)) {
        // or finish the iteration
        that._t = undefined;
        return step(1);
      }
      // return step by kind
      if (kind == 'keys') return step(0, entry.k);
      if (kind == 'values') return step(0, entry.v);
      return step(0, [entry.k, entry.v]);
    }, IS_MAP ? 'entries' : 'values', !IS_MAP, true);

    // add [@@species], 23.1.2.2, 23.2.2.2
    setSpecies(NAME);
  }
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_collection-to-json.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_collection-to-json.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var classof = __webpack_require__(/*! ./_classof */ "./node_modules/core-js/library/modules/_classof.js");
var from = __webpack_require__(/*! ./_array-from-iterable */ "./node_modules/core-js/library/modules/_array-from-iterable.js");
module.exports = function (NAME) {
  return function toJSON() {
    if (classof(this) != NAME) throw TypeError(NAME + "#toJSON isn't generic");
    return from(this);
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_collection.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_collection.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var meta = __webpack_require__(/*! ./_meta */ "./node_modules/core-js/library/modules/_meta.js");
var fails = __webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js");
var hide = __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js");
var redefineAll = __webpack_require__(/*! ./_redefine-all */ "./node_modules/core-js/library/modules/_redefine-all.js");
var forOf = __webpack_require__(/*! ./_for-of */ "./node_modules/core-js/library/modules/_for-of.js");
var anInstance = __webpack_require__(/*! ./_an-instance */ "./node_modules/core-js/library/modules/_an-instance.js");
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ "./node_modules/core-js/library/modules/_set-to-string-tag.js");
var dP = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js").f;
var each = __webpack_require__(/*! ./_array-methods */ "./node_modules/core-js/library/modules/_array-methods.js")(0);
var DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js");

module.exports = function (NAME, wrapper, methods, common, IS_MAP, IS_WEAK) {
  var Base = global[NAME];
  var C = Base;
  var ADDER = IS_MAP ? 'set' : 'add';
  var proto = C && C.prototype;
  var O = {};
  if (!DESCRIPTORS || typeof C != 'function' || !(IS_WEAK || proto.forEach && !fails(function () {
    new C().entries().next();
  }))) {
    // create collection constructor
    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);
    redefineAll(C.prototype, methods);
    meta.NEED = true;
  } else {
    C = wrapper(function (target, iterable) {
      anInstance(target, C, NAME, '_c');
      target._c = new Base();
      if (iterable != undefined) forOf(iterable, IS_MAP, target[ADDER], target);
    });
    each('add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON'.split(','), function (KEY) {
      var IS_ADDER = KEY == 'add' || KEY == 'set';
      if (KEY in proto && !(IS_WEAK && KEY == 'clear')) hide(C.prototype, KEY, function (a, b) {
        anInstance(this, C, KEY);
        if (!IS_ADDER && IS_WEAK && !isObject(a)) return KEY == 'get' ? undefined : false;
        var result = this._c[KEY](a === 0 ? 0 : a, b);
        return IS_ADDER ? this : result;
      });
    });
    IS_WEAK || dP(C.prototype, 'size', {
      get: function () {
        return this._c.size;
      }
    });
  }

  setToStringTag(C, NAME);

  O[NAME] = C;
  $export($export.G + $export.W + $export.F, O);

  if (!IS_WEAK) common.setStrong(C, NAME, IS_MAP);

  return C;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_core.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_core.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

var core = module.exports = { version: '2.6.11' };
if (typeof __e == 'number') __e = core; // eslint-disable-line no-undef


/***/ }),

/***/ "./node_modules/core-js/library/modules/_create-property.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_create-property.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var $defineProperty = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js");
var createDesc = __webpack_require__(/*! ./_property-desc */ "./node_modules/core-js/library/modules/_property-desc.js");

module.exports = function (object, index, value) {
  if (index in object) $defineProperty.f(object, index, createDesc(0, value));
  else object[index] = value;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_ctx.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_ctx.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// optional / simple context binding
var aFunction = __webpack_require__(/*! ./_a-function */ "./node_modules/core-js/library/modules/_a-function.js");
module.exports = function (fn, that, length) {
  aFunction(fn);
  if (that === undefined) return fn;
  switch (length) {
    case 1: return function (a) {
      return fn.call(that, a);
    };
    case 2: return function (a, b) {
      return fn.call(that, a, b);
    };
    case 3: return function (a, b, c) {
      return fn.call(that, a, b, c);
    };
  }
  return function (/* ...args */) {
    return fn.apply(that, arguments);
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_defined.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_defined.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// 7.2.1 RequireObjectCoercible(argument)
module.exports = function (it) {
  if (it == undefined) throw TypeError("Can't call method on  " + it);
  return it;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_descriptors.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_descriptors.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// Thank's IE8 for his funny defineProperty
module.exports = !__webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js")(function () {
  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/_dom-create.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_dom-create.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var document = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js").document;
// typeof document.createElement is 'object' in old IE
var is = isObject(document) && isObject(document.createElement);
module.exports = function (it) {
  return is ? document.createElement(it) : {};
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_enum-bug-keys.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_enum-bug-keys.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// IE 8- don't enum bug keys
module.exports = (
  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'
).split(',');


/***/ }),

/***/ "./node_modules/core-js/library/modules/_enum-keys.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_enum-keys.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// all enumerable object keys, includes symbols
var getKeys = __webpack_require__(/*! ./_object-keys */ "./node_modules/core-js/library/modules/_object-keys.js");
var gOPS = __webpack_require__(/*! ./_object-gops */ "./node_modules/core-js/library/modules/_object-gops.js");
var pIE = __webpack_require__(/*! ./_object-pie */ "./node_modules/core-js/library/modules/_object-pie.js");
module.exports = function (it) {
  var result = getKeys(it);
  var getSymbols = gOPS.f;
  if (getSymbols) {
    var symbols = getSymbols(it);
    var isEnum = pIE.f;
    var i = 0;
    var key;
    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);
  } return result;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_export.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_export.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var core = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js");
var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var hide = __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js");
var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var PROTOTYPE = 'prototype';

var $export = function (type, name, source) {
  var IS_FORCED = type & $export.F;
  var IS_GLOBAL = type & $export.G;
  var IS_STATIC = type & $export.S;
  var IS_PROTO = type & $export.P;
  var IS_BIND = type & $export.B;
  var IS_WRAP = type & $export.W;
  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});
  var expProto = exports[PROTOTYPE];
  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE];
  var key, own, out;
  if (IS_GLOBAL) source = name;
  for (key in source) {
    // contains in native
    own = !IS_FORCED && target && target[key] !== undefined;
    if (own && has(exports, key)) continue;
    // export native or passed
    out = own ? target[key] : source[key];
    // prevent global pollution for namespaces
    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]
    // bind timers to global for call from export context
    : IS_BIND && own ? ctx(out, global)
    // wrap global constructors for prevent change them in library
    : IS_WRAP && target[key] == out ? (function (C) {
      var F = function (a, b, c) {
        if (this instanceof C) {
          switch (arguments.length) {
            case 0: return new C();
            case 1: return new C(a);
            case 2: return new C(a, b);
          } return new C(a, b, c);
        } return C.apply(this, arguments);
      };
      F[PROTOTYPE] = C[PROTOTYPE];
      return F;
    // make static versions for prototype methods
    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;
    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%
    if (IS_PROTO) {
      (exports.virtual || (exports.virtual = {}))[key] = out;
      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%
      if (type & $export.R && expProto && !expProto[key]) hide(expProto, key, out);
    }
  }
};
// type bitmap
$export.F = 1;   // forced
$export.G = 2;   // global
$export.S = 4;   // static
$export.P = 8;   // proto
$export.B = 16;  // bind
$export.W = 32;  // wrap
$export.U = 64;  // safe
$export.R = 128; // real proto method for `library`
module.exports = $export;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_fails.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_fails.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (exec) {
  try {
    return !!exec();
  } catch (e) {
    return true;
  }
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_for-of.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_for-of.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var call = __webpack_require__(/*! ./_iter-call */ "./node_modules/core-js/library/modules/_iter-call.js");
var isArrayIter = __webpack_require__(/*! ./_is-array-iter */ "./node_modules/core-js/library/modules/_is-array-iter.js");
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var toLength = __webpack_require__(/*! ./_to-length */ "./node_modules/core-js/library/modules/_to-length.js");
var getIterFn = __webpack_require__(/*! ./core.get-iterator-method */ "./node_modules/core-js/library/modules/core.get-iterator-method.js");
var BREAK = {};
var RETURN = {};
var exports = module.exports = function (iterable, entries, fn, that, ITERATOR) {
  var iterFn = ITERATOR ? function () { return iterable; } : getIterFn(iterable);
  var f = ctx(fn, that, entries ? 2 : 1);
  var index = 0;
  var length, step, iterator, result;
  if (typeof iterFn != 'function') throw TypeError(iterable + ' is not iterable!');
  // fast case for arrays with default iterator
  if (isArrayIter(iterFn)) for (length = toLength(iterable.length); length > index; index++) {
    result = entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);
    if (result === BREAK || result === RETURN) return result;
  } else for (iterator = iterFn.call(iterable); !(step = iterator.next()).done;) {
    result = call(iterator, f, step.value, entries);
    if (result === BREAK || result === RETURN) return result;
  }
};
exports.BREAK = BREAK;
exports.RETURN = RETURN;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_global.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_global.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
var global = module.exports = typeof window != 'undefined' && window.Math == Math
  ? window : typeof self != 'undefined' && self.Math == Math ? self
  // eslint-disable-next-line no-new-func
  : Function('return this')();
if (typeof __g == 'number') __g = global; // eslint-disable-line no-undef


/***/ }),

/***/ "./node_modules/core-js/library/modules/_has.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_has.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

var hasOwnProperty = {}.hasOwnProperty;
module.exports = function (it, key) {
  return hasOwnProperty.call(it, key);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_hide.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_hide.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var dP = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js");
var createDesc = __webpack_require__(/*! ./_property-desc */ "./node_modules/core-js/library/modules/_property-desc.js");
module.exports = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js") ? function (object, key, value) {
  return dP.f(object, key, createDesc(1, value));
} : function (object, key, value) {
  object[key] = value;
  return object;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_html.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_html.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var document = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js").document;
module.exports = document && document.documentElement;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_ie8-dom-define.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_ie8-dom-define.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = !__webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js") && !__webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js")(function () {
  return Object.defineProperty(__webpack_require__(/*! ./_dom-create */ "./node_modules/core-js/library/modules/_dom-create.js")('div'), 'a', { get: function () { return 7; } }).a != 7;
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/_invoke.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_invoke.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// fast apply, http://jsperf.lnkit.com/fast-apply/5
module.exports = function (fn, args, that) {
  var un = that === undefined;
  switch (args.length) {
    case 0: return un ? fn()
                      : fn.call(that);
    case 1: return un ? fn(args[0])
                      : fn.call(that, args[0]);
    case 2: return un ? fn(args[0], args[1])
                      : fn.call(that, args[0], args[1]);
    case 3: return un ? fn(args[0], args[1], args[2])
                      : fn.call(that, args[0], args[1], args[2]);
    case 4: return un ? fn(args[0], args[1], args[2], args[3])
                      : fn.call(that, args[0], args[1], args[2], args[3]);
  } return fn.apply(that, args);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iobject.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iobject.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// fallback for non-array-like ES3 and non-enumerable old V8 strings
var cof = __webpack_require__(/*! ./_cof */ "./node_modules/core-js/library/modules/_cof.js");
// eslint-disable-next-line no-prototype-builtins
module.exports = Object('z').propertyIsEnumerable(0) ? Object : function (it) {
  return cof(it) == 'String' ? it.split('') : Object(it);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_is-array-iter.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-array-iter.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// check on default Array iterator
var Iterators = __webpack_require__(/*! ./_iterators */ "./node_modules/core-js/library/modules/_iterators.js");
var ITERATOR = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('iterator');
var ArrayProto = Array.prototype;

module.exports = function (it) {
  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_is-array.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-array.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 7.2.2 IsArray(argument)
var cof = __webpack_require__(/*! ./_cof */ "./node_modules/core-js/library/modules/_cof.js");
module.exports = Array.isArray || function isArray(arg) {
  return cof(arg) == 'Array';
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_is-integer.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-integer.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 20.1.2.3 Number.isInteger(number)
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var floor = Math.floor;
module.exports = function isInteger(it) {
  return !isObject(it) && isFinite(it) && floor(it) === it;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_is-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-object.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (it) {
  return typeof it === 'object' ? it !== null : typeof it === 'function';
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iter-call.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-call.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// call something on iterator step with safe closing on error
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
module.exports = function (iterator, fn, value, entries) {
  try {
    return entries ? fn(anObject(value)[0], value[1]) : fn(value);
  // 7.4.6 IteratorClose(iterator, completion)
  } catch (e) {
    var ret = iterator['return'];
    if (ret !== undefined) anObject(ret.call(iterator));
    throw e;
  }
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iter-create.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-create.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var create = __webpack_require__(/*! ./_object-create */ "./node_modules/core-js/library/modules/_object-create.js");
var descriptor = __webpack_require__(/*! ./_property-desc */ "./node_modules/core-js/library/modules/_property-desc.js");
var setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ "./node_modules/core-js/library/modules/_set-to-string-tag.js");
var IteratorPrototype = {};

// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()
__webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js")(IteratorPrototype, __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('iterator'), function () { return this; });

module.exports = function (Constructor, NAME, next) {
  Constructor.prototype = create(IteratorPrototype, { next: descriptor(1, next) });
  setToStringTag(Constructor, NAME + ' Iterator');
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iter-define.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-define.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var LIBRARY = __webpack_require__(/*! ./_library */ "./node_modules/core-js/library/modules/_library.js");
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var redefine = __webpack_require__(/*! ./_redefine */ "./node_modules/core-js/library/modules/_redefine.js");
var hide = __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js");
var Iterators = __webpack_require__(/*! ./_iterators */ "./node_modules/core-js/library/modules/_iterators.js");
var $iterCreate = __webpack_require__(/*! ./_iter-create */ "./node_modules/core-js/library/modules/_iter-create.js");
var setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ "./node_modules/core-js/library/modules/_set-to-string-tag.js");
var getPrototypeOf = __webpack_require__(/*! ./_object-gpo */ "./node_modules/core-js/library/modules/_object-gpo.js");
var ITERATOR = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('iterator');
var BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`
var FF_ITERATOR = '@@iterator';
var KEYS = 'keys';
var VALUES = 'values';

var returnThis = function () { return this; };

module.exports = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {
  $iterCreate(Constructor, NAME, next);
  var getMethod = function (kind) {
    if (!BUGGY && kind in proto) return proto[kind];
    switch (kind) {
      case KEYS: return function keys() { return new Constructor(this, kind); };
      case VALUES: return function values() { return new Constructor(this, kind); };
    } return function entries() { return new Constructor(this, kind); };
  };
  var TAG = NAME + ' Iterator';
  var DEF_VALUES = DEFAULT == VALUES;
  var VALUES_BUG = false;
  var proto = Base.prototype;
  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];
  var $default = $native || getMethod(DEFAULT);
  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;
  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;
  var methods, key, IteratorPrototype;
  // Fix native
  if ($anyNative) {
    IteratorPrototype = getPrototypeOf($anyNative.call(new Base()));
    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {
      // Set @@toStringTag to native iterators
      setToStringTag(IteratorPrototype, TAG, true);
      // fix for some old engines
      if (!LIBRARY && typeof IteratorPrototype[ITERATOR] != 'function') hide(IteratorPrototype, ITERATOR, returnThis);
    }
  }
  // fix Array#{values, @@iterator}.name in V8 / FF
  if (DEF_VALUES && $native && $native.name !== VALUES) {
    VALUES_BUG = true;
    $default = function values() { return $native.call(this); };
  }
  // Define iterator
  if ((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {
    hide(proto, ITERATOR, $default);
  }
  // Plug for library
  Iterators[NAME] = $default;
  Iterators[TAG] = returnThis;
  if (DEFAULT) {
    methods = {
      values: DEF_VALUES ? $default : getMethod(VALUES),
      keys: IS_SET ? $default : getMethod(KEYS),
      entries: $entries
    };
    if (FORCED) for (key in methods) {
      if (!(key in proto)) redefine(proto, key, methods[key]);
    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);
  }
  return methods;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iter-detect.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-detect.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var ITERATOR = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('iterator');
var SAFE_CLOSING = false;

try {
  var riter = [7][ITERATOR]();
  riter['return'] = function () { SAFE_CLOSING = true; };
  // eslint-disable-next-line no-throw-literal
  Array.from(riter, function () { throw 2; });
} catch (e) { /* empty */ }

module.exports = function (exec, skipClosing) {
  if (!skipClosing && !SAFE_CLOSING) return false;
  var safe = false;
  try {
    var arr = [7];
    var iter = arr[ITERATOR]();
    iter.next = function () { return { done: safe = true }; };
    arr[ITERATOR] = function () { return iter; };
    exec(arr);
  } catch (e) { /* empty */ }
  return safe;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iter-step.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-step.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (done, value) {
  return { value: value, done: !!done };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_iterators.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iterators.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = {};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_library.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_library.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = true;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_meta.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_meta.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var META = __webpack_require__(/*! ./_uid */ "./node_modules/core-js/library/modules/_uid.js")('meta');
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var setDesc = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js").f;
var id = 0;
var isExtensible = Object.isExtensible || function () {
  return true;
};
var FREEZE = !__webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js")(function () {
  return isExtensible(Object.preventExtensions({}));
});
var setMeta = function (it) {
  setDesc(it, META, { value: {
    i: 'O' + ++id, // object ID
    w: {}          // weak collections IDs
  } });
};
var fastKey = function (it, create) {
  // return primitive with prefix
  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return 'F';
    // not necessary to add metadata
    if (!create) return 'E';
    // add missing metadata
    setMeta(it);
  // return object ID
  } return it[META].i;
};
var getWeak = function (it, create) {
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return true;
    // not necessary to add metadata
    if (!create) return false;
    // add missing metadata
    setMeta(it);
  // return hash weak collections IDs
  } return it[META].w;
};
// add metadata on freeze-family methods calling
var onFreeze = function (it) {
  if (FREEZE && meta.NEED && isExtensible(it) && !has(it, META)) setMeta(it);
  return it;
};
var meta = module.exports = {
  KEY: META,
  NEED: false,
  fastKey: fastKey,
  getWeak: getWeak,
  onFreeze: onFreeze
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_microtask.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_microtask.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var macrotask = __webpack_require__(/*! ./_task */ "./node_modules/core-js/library/modules/_task.js").set;
var Observer = global.MutationObserver || global.WebKitMutationObserver;
var process = global.process;
var Promise = global.Promise;
var isNode = __webpack_require__(/*! ./_cof */ "./node_modules/core-js/library/modules/_cof.js")(process) == 'process';

module.exports = function () {
  var head, last, notify;

  var flush = function () {
    var parent, fn;
    if (isNode && (parent = process.domain)) parent.exit();
    while (head) {
      fn = head.fn;
      head = head.next;
      try {
        fn();
      } catch (e) {
        if (head) notify();
        else last = undefined;
        throw e;
      }
    } last = undefined;
    if (parent) parent.enter();
  };

  // Node.js
  if (isNode) {
    notify = function () {
      process.nextTick(flush);
    };
  // browsers with MutationObserver, except iOS Safari - https://github.com/zloirock/core-js/issues/339
  } else if (Observer && !(global.navigator && global.navigator.standalone)) {
    var toggle = true;
    var node = document.createTextNode('');
    new Observer(flush).observe(node, { characterData: true }); // eslint-disable-line no-new
    notify = function () {
      node.data = toggle = !toggle;
    };
  // environments with maybe non-completely correct, but existent Promise
  } else if (Promise && Promise.resolve) {
    // Promise.resolve without an argument throws an error in LG WebOS 2
    var promise = Promise.resolve(undefined);
    notify = function () {
      promise.then(flush);
    };
  // for other environments - macrotask based on:
  // - setImmediate
  // - MessageChannel
  // - window.postMessag
  // - onreadystatechange
  // - setTimeout
  } else {
    notify = function () {
      // strange IE + webpack dev server bug - use .call(global)
      macrotask.call(global, flush);
    };
  }

  return function (fn) {
    var task = { fn: fn, next: undefined };
    if (last) last.next = task;
    if (!head) {
      head = task;
      notify();
    } last = task;
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_new-promise-capability.js":
/*!*************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_new-promise-capability.js ***!
  \*************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// 25.4.1.5 NewPromiseCapability(C)
var aFunction = __webpack_require__(/*! ./_a-function */ "./node_modules/core-js/library/modules/_a-function.js");

function PromiseCapability(C) {
  var resolve, reject;
  this.promise = new C(function ($$resolve, $$reject) {
    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');
    resolve = $$resolve;
    reject = $$reject;
  });
  this.resolve = aFunction(resolve);
  this.reject = aFunction(reject);
}

module.exports.f = function (C) {
  return new PromiseCapability(C);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-assign.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-assign.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// 19.1.2.1 Object.assign(target, source, ...)
var DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js");
var getKeys = __webpack_require__(/*! ./_object-keys */ "./node_modules/core-js/library/modules/_object-keys.js");
var gOPS = __webpack_require__(/*! ./_object-gops */ "./node_modules/core-js/library/modules/_object-gops.js");
var pIE = __webpack_require__(/*! ./_object-pie */ "./node_modules/core-js/library/modules/_object-pie.js");
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var IObject = __webpack_require__(/*! ./_iobject */ "./node_modules/core-js/library/modules/_iobject.js");
var $assign = Object.assign;

// should work with symbols and should have deterministic property order (V8 bug)
module.exports = !$assign || __webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js")(function () {
  var A = {};
  var B = {};
  // eslint-disable-next-line no-undef
  var S = Symbol();
  var K = 'abcdefghijklmnopqrst';
  A[S] = 7;
  K.split('').forEach(function (k) { B[k] = k; });
  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;
}) ? function assign(target, source) { // eslint-disable-line no-unused-vars
  var T = toObject(target);
  var aLen = arguments.length;
  var index = 1;
  var getSymbols = gOPS.f;
  var isEnum = pIE.f;
  while (aLen > index) {
    var S = IObject(arguments[index++]);
    var keys = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S);
    var length = keys.length;
    var j = 0;
    var key;
    while (length > j) {
      key = keys[j++];
      if (!DESCRIPTORS || isEnum.call(S, key)) T[key] = S[key];
    }
  } return T;
} : $assign;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-create.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-create.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var dPs = __webpack_require__(/*! ./_object-dps */ "./node_modules/core-js/library/modules/_object-dps.js");
var enumBugKeys = __webpack_require__(/*! ./_enum-bug-keys */ "./node_modules/core-js/library/modules/_enum-bug-keys.js");
var IE_PROTO = __webpack_require__(/*! ./_shared-key */ "./node_modules/core-js/library/modules/_shared-key.js")('IE_PROTO');
var Empty = function () { /* empty */ };
var PROTOTYPE = 'prototype';

// Create object with fake `null` prototype: use iframe Object with cleared prototype
var createDict = function () {
  // Thrash, waste and sodomy: IE GC bug
  var iframe = __webpack_require__(/*! ./_dom-create */ "./node_modules/core-js/library/modules/_dom-create.js")('iframe');
  var i = enumBugKeys.length;
  var lt = '<';
  var gt = '>';
  var iframeDocument;
  iframe.style.display = 'none';
  __webpack_require__(/*! ./_html */ "./node_modules/core-js/library/modules/_html.js").appendChild(iframe);
  iframe.src = 'javascript:'; // eslint-disable-line no-script-url
  // createDict = iframe.contentWindow.Object;
  // html.removeChild(iframe);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);
  iframeDocument.close();
  createDict = iframeDocument.F;
  while (i--) delete createDict[PROTOTYPE][enumBugKeys[i]];
  return createDict();
};

module.exports = Object.create || function create(O, Properties) {
  var result;
  if (O !== null) {
    Empty[PROTOTYPE] = anObject(O);
    result = new Empty();
    Empty[PROTOTYPE] = null;
    // add "__proto__" for Object.getPrototypeOf polyfill
    result[IE_PROTO] = O;
  } else result = createDict();
  return Properties === undefined ? result : dPs(result, Properties);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-dp.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-dp.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var IE8_DOM_DEFINE = __webpack_require__(/*! ./_ie8-dom-define */ "./node_modules/core-js/library/modules/_ie8-dom-define.js");
var toPrimitive = __webpack_require__(/*! ./_to-primitive */ "./node_modules/core-js/library/modules/_to-primitive.js");
var dP = Object.defineProperty;

exports.f = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js") ? Object.defineProperty : function defineProperty(O, P, Attributes) {
  anObject(O);
  P = toPrimitive(P, true);
  anObject(Attributes);
  if (IE8_DOM_DEFINE) try {
    return dP(O, P, Attributes);
  } catch (e) { /* empty */ }
  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');
  if ('value' in Attributes) O[P] = Attributes.value;
  return O;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-dps.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-dps.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var dP = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js");
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var getKeys = __webpack_require__(/*! ./_object-keys */ "./node_modules/core-js/library/modules/_object-keys.js");

module.exports = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js") ? Object.defineProperties : function defineProperties(O, Properties) {
  anObject(O);
  var keys = getKeys(Properties);
  var length = keys.length;
  var i = 0;
  var P;
  while (length > i) dP.f(O, P = keys[i++], Properties[P]);
  return O;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-gopd.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gopd.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var pIE = __webpack_require__(/*! ./_object-pie */ "./node_modules/core-js/library/modules/_object-pie.js");
var createDesc = __webpack_require__(/*! ./_property-desc */ "./node_modules/core-js/library/modules/_property-desc.js");
var toIObject = __webpack_require__(/*! ./_to-iobject */ "./node_modules/core-js/library/modules/_to-iobject.js");
var toPrimitive = __webpack_require__(/*! ./_to-primitive */ "./node_modules/core-js/library/modules/_to-primitive.js");
var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var IE8_DOM_DEFINE = __webpack_require__(/*! ./_ie8-dom-define */ "./node_modules/core-js/library/modules/_ie8-dom-define.js");
var gOPD = Object.getOwnPropertyDescriptor;

exports.f = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js") ? gOPD : function getOwnPropertyDescriptor(O, P) {
  O = toIObject(O);
  P = toPrimitive(P, true);
  if (IE8_DOM_DEFINE) try {
    return gOPD(O, P);
  } catch (e) { /* empty */ }
  if (has(O, P)) return createDesc(!pIE.f.call(O, P), O[P]);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-gopn-ext.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gopn-ext.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
var toIObject = __webpack_require__(/*! ./_to-iobject */ "./node_modules/core-js/library/modules/_to-iobject.js");
var gOPN = __webpack_require__(/*! ./_object-gopn */ "./node_modules/core-js/library/modules/_object-gopn.js").f;
var toString = {}.toString;

var windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames
  ? Object.getOwnPropertyNames(window) : [];

var getWindowNames = function (it) {
  try {
    return gOPN(it);
  } catch (e) {
    return windowNames.slice();
  }
};

module.exports.f = function getOwnPropertyNames(it) {
  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-gopn.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gopn.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)
var $keys = __webpack_require__(/*! ./_object-keys-internal */ "./node_modules/core-js/library/modules/_object-keys-internal.js");
var hiddenKeys = __webpack_require__(/*! ./_enum-bug-keys */ "./node_modules/core-js/library/modules/_enum-bug-keys.js").concat('length', 'prototype');

exports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {
  return $keys(O, hiddenKeys);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-gops.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gops.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

exports.f = Object.getOwnPropertySymbols;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-gpo.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gpo.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)
var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var IE_PROTO = __webpack_require__(/*! ./_shared-key */ "./node_modules/core-js/library/modules/_shared-key.js")('IE_PROTO');
var ObjectProto = Object.prototype;

module.exports = Object.getPrototypeOf || function (O) {
  O = toObject(O);
  if (has(O, IE_PROTO)) return O[IE_PROTO];
  if (typeof O.constructor == 'function' && O instanceof O.constructor) {
    return O.constructor.prototype;
  } return O instanceof Object ? ObjectProto : null;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-keys-internal.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-keys-internal.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var toIObject = __webpack_require__(/*! ./_to-iobject */ "./node_modules/core-js/library/modules/_to-iobject.js");
var arrayIndexOf = __webpack_require__(/*! ./_array-includes */ "./node_modules/core-js/library/modules/_array-includes.js")(false);
var IE_PROTO = __webpack_require__(/*! ./_shared-key */ "./node_modules/core-js/library/modules/_shared-key.js")('IE_PROTO');

module.exports = function (object, names) {
  var O = toIObject(object);
  var i = 0;
  var result = [];
  var key;
  for (key in O) if (key != IE_PROTO) has(O, key) && result.push(key);
  // Don't enum bug & hidden keys
  while (names.length > i) if (has(O, key = names[i++])) {
    ~arrayIndexOf(result, key) || result.push(key);
  }
  return result;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-keys.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-keys.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.14 / 15.2.3.14 Object.keys(O)
var $keys = __webpack_require__(/*! ./_object-keys-internal */ "./node_modules/core-js/library/modules/_object-keys-internal.js");
var enumBugKeys = __webpack_require__(/*! ./_enum-bug-keys */ "./node_modules/core-js/library/modules/_enum-bug-keys.js");

module.exports = Object.keys || function keys(O) {
  return $keys(O, enumBugKeys);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-pie.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-pie.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

exports.f = {}.propertyIsEnumerable;


/***/ }),

/***/ "./node_modules/core-js/library/modules/_object-sap.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-sap.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// most Object methods by ES6 should accept primitives
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var core = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js");
var fails = __webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js");
module.exports = function (KEY, exec) {
  var fn = (core.Object || {})[KEY] || Object[KEY];
  var exp = {};
  exp[KEY] = exec(fn);
  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_perform.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_perform.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (exec) {
  try {
    return { e: false, v: exec() };
  } catch (e) {
    return { e: true, v: e };
  }
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_promise-resolve.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_promise-resolve.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var newPromiseCapability = __webpack_require__(/*! ./_new-promise-capability */ "./node_modules/core-js/library/modules/_new-promise-capability.js");

module.exports = function (C, x) {
  anObject(C);
  if (isObject(x) && x.constructor === C) return x;
  var promiseCapability = newPromiseCapability.f(C);
  var resolve = promiseCapability.resolve;
  resolve(x);
  return promiseCapability.promise;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_property-desc.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_property-desc.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (bitmap, value) {
  return {
    enumerable: !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable: !(bitmap & 4),
    value: value
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_redefine-all.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_redefine-all.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var hide = __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js");
module.exports = function (target, src, safe) {
  for (var key in src) {
    if (safe && target[key]) target[key] = src[key];
    else hide(target, key, src[key]);
  } return target;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_redefine.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_redefine.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js");


/***/ }),

/***/ "./node_modules/core-js/library/modules/_set-collection-from.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-collection-from.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// https://tc39.github.io/proposal-setmap-offrom/
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var aFunction = __webpack_require__(/*! ./_a-function */ "./node_modules/core-js/library/modules/_a-function.js");
var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var forOf = __webpack_require__(/*! ./_for-of */ "./node_modules/core-js/library/modules/_for-of.js");

module.exports = function (COLLECTION) {
  $export($export.S, COLLECTION, { from: function from(source /* , mapFn, thisArg */) {
    var mapFn = arguments[1];
    var mapping, A, n, cb;
    aFunction(this);
    mapping = mapFn !== undefined;
    if (mapping) aFunction(mapFn);
    if (source == undefined) return new this();
    A = [];
    if (mapping) {
      n = 0;
      cb = ctx(mapFn, arguments[2], 2);
      forOf(source, false, function (nextItem) {
        A.push(cb(nextItem, n++));
      });
    } else {
      forOf(source, false, A.push, A);
    }
    return new this(A);
  } });
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_set-collection-of.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-collection-of.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// https://tc39.github.io/proposal-setmap-offrom/
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");

module.exports = function (COLLECTION) {
  $export($export.S, COLLECTION, { of: function of() {
    var length = arguments.length;
    var A = new Array(length);
    while (length--) A[length] = arguments[length];
    return new this(A);
  } });
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_set-proto.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-proto.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// Works with __proto__ only. Old v8 can't work with null proto objects.
/* eslint-disable no-proto */
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var check = function (O, proto) {
  anObject(O);
  if (!isObject(proto) && proto !== null) throw TypeError(proto + ": can't set as prototype!");
};
module.exports = {
  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line
    function (test, buggy, set) {
      try {
        set = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js")(Function.call, __webpack_require__(/*! ./_object-gopd */ "./node_modules/core-js/library/modules/_object-gopd.js").f(Object.prototype, '__proto__').set, 2);
        set(test, []);
        buggy = !(test instanceof Array);
      } catch (e) { buggy = true; }
      return function setPrototypeOf(O, proto) {
        check(O, proto);
        if (buggy) O.__proto__ = proto;
        else set(O, proto);
        return O;
      };
    }({}, false) : undefined),
  check: check
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_set-species.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-species.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var core = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js");
var dP = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js");
var DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js");
var SPECIES = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('species');

module.exports = function (KEY) {
  var C = typeof core[KEY] == 'function' ? core[KEY] : global[KEY];
  if (DESCRIPTORS && C && !C[SPECIES]) dP.f(C, SPECIES, {
    configurable: true,
    get: function () { return this; }
  });
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_set-to-string-tag.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-to-string-tag.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var def = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js").f;
var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var TAG = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('toStringTag');

module.exports = function (it, tag, stat) {
  if (it && !has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_shared-key.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_shared-key.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var shared = __webpack_require__(/*! ./_shared */ "./node_modules/core-js/library/modules/_shared.js")('keys');
var uid = __webpack_require__(/*! ./_uid */ "./node_modules/core-js/library/modules/_uid.js");
module.exports = function (key) {
  return shared[key] || (shared[key] = uid(key));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_shared.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_shared.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var core = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js");
var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var SHARED = '__core-js_shared__';
var store = global[SHARED] || (global[SHARED] = {});

(module.exports = function (key, value) {
  return store[key] || (store[key] = value !== undefined ? value : {});
})('versions', []).push({
  version: core.version,
  mode: __webpack_require__(/*! ./_library */ "./node_modules/core-js/library/modules/_library.js") ? 'pure' : 'global',
  copyright: '© 2019 Denis Pushkarev (zloirock.ru)'
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/_species-constructor.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_species-constructor.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 7.3.20 SpeciesConstructor(O, defaultConstructor)
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var aFunction = __webpack_require__(/*! ./_a-function */ "./node_modules/core-js/library/modules/_a-function.js");
var SPECIES = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('species');
module.exports = function (O, D) {
  var C = anObject(O).constructor;
  var S;
  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_string-at.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_string-at.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var toInteger = __webpack_require__(/*! ./_to-integer */ "./node_modules/core-js/library/modules/_to-integer.js");
var defined = __webpack_require__(/*! ./_defined */ "./node_modules/core-js/library/modules/_defined.js");
// true  -> String#at
// false -> String#codePointAt
module.exports = function (TO_STRING) {
  return function (that, pos) {
    var s = String(defined(that));
    var i = toInteger(pos);
    var l = s.length;
    var a, b;
    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;
    a = s.charCodeAt(i);
    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff
      ? TO_STRING ? s.charAt(i) : a
      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;
  };
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_task.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_task.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var invoke = __webpack_require__(/*! ./_invoke */ "./node_modules/core-js/library/modules/_invoke.js");
var html = __webpack_require__(/*! ./_html */ "./node_modules/core-js/library/modules/_html.js");
var cel = __webpack_require__(/*! ./_dom-create */ "./node_modules/core-js/library/modules/_dom-create.js");
var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var process = global.process;
var setTask = global.setImmediate;
var clearTask = global.clearImmediate;
var MessageChannel = global.MessageChannel;
var Dispatch = global.Dispatch;
var counter = 0;
var queue = {};
var ONREADYSTATECHANGE = 'onreadystatechange';
var defer, channel, port;
var run = function () {
  var id = +this;
  // eslint-disable-next-line no-prototype-builtins
  if (queue.hasOwnProperty(id)) {
    var fn = queue[id];
    delete queue[id];
    fn();
  }
};
var listener = function (event) {
  run.call(event.data);
};
// Node.js 0.9+ & IE10+ has setImmediate, otherwise:
if (!setTask || !clearTask) {
  setTask = function setImmediate(fn) {
    var args = [];
    var i = 1;
    while (arguments.length > i) args.push(arguments[i++]);
    queue[++counter] = function () {
      // eslint-disable-next-line no-new-func
      invoke(typeof fn == 'function' ? fn : Function(fn), args);
    };
    defer(counter);
    return counter;
  };
  clearTask = function clearImmediate(id) {
    delete queue[id];
  };
  // Node.js 0.8-
  if (__webpack_require__(/*! ./_cof */ "./node_modules/core-js/library/modules/_cof.js")(process) == 'process') {
    defer = function (id) {
      process.nextTick(ctx(run, id, 1));
    };
  // Sphere (JS game engine) Dispatch API
  } else if (Dispatch && Dispatch.now) {
    defer = function (id) {
      Dispatch.now(ctx(run, id, 1));
    };
  // Browsers with MessageChannel, includes WebWorkers
  } else if (MessageChannel) {
    channel = new MessageChannel();
    port = channel.port2;
    channel.port1.onmessage = listener;
    defer = ctx(port.postMessage, port, 1);
  // Browsers with postMessage, skip WebWorkers
  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
  } else if (global.addEventListener && typeof postMessage == 'function' && !global.importScripts) {
    defer = function (id) {
      global.postMessage(id + '', '*');
    };
    global.addEventListener('message', listener, false);
  // IE8-
  } else if (ONREADYSTATECHANGE in cel('script')) {
    defer = function (id) {
      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function () {
        html.removeChild(this);
        run.call(id);
      };
    };
  // Rest old browsers
  } else {
    defer = function (id) {
      setTimeout(ctx(run, id, 1), 0);
    };
  }
}
module.exports = {
  set: setTask,
  clear: clearTask
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_to-absolute-index.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-absolute-index.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var toInteger = __webpack_require__(/*! ./_to-integer */ "./node_modules/core-js/library/modules/_to-integer.js");
var max = Math.max;
var min = Math.min;
module.exports = function (index, length) {
  index = toInteger(index);
  return index < 0 ? max(index + length, 0) : min(index, length);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_to-integer.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-integer.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// 7.1.4 ToInteger
var ceil = Math.ceil;
var floor = Math.floor;
module.exports = function (it) {
  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_to-iobject.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-iobject.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// to indexed object, toObject with fallback for non-array-like ES3 strings
var IObject = __webpack_require__(/*! ./_iobject */ "./node_modules/core-js/library/modules/_iobject.js");
var defined = __webpack_require__(/*! ./_defined */ "./node_modules/core-js/library/modules/_defined.js");
module.exports = function (it) {
  return IObject(defined(it));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_to-length.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-length.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 7.1.15 ToLength
var toInteger = __webpack_require__(/*! ./_to-integer */ "./node_modules/core-js/library/modules/_to-integer.js");
var min = Math.min;
module.exports = function (it) {
  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_to-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-object.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 7.1.13 ToObject(argument)
var defined = __webpack_require__(/*! ./_defined */ "./node_modules/core-js/library/modules/_defined.js");
module.exports = function (it) {
  return Object(defined(it));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_to-primitive.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-primitive.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 7.1.1 ToPrimitive(input [, PreferredType])
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
// instead of the ES6 spec version, we didn't implement @@toPrimitive case
// and the second argument - flag - preferred type is a string
module.exports = function (it, S) {
  if (!isObject(it)) return it;
  var fn, val;
  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;
  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;
  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;
  throw TypeError("Can't convert object to primitive value");
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_uid.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_uid.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

var id = 0;
var px = Math.random();
module.exports = function (key) {
  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_user-agent.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_user-agent.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var navigator = global.navigator;

module.exports = navigator && navigator.userAgent || '';


/***/ }),

/***/ "./node_modules/core-js/library/modules/_validate-collection.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_validate-collection.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
module.exports = function (it, TYPE) {
  if (!isObject(it) || it._t !== TYPE) throw TypeError('Incompatible receiver, ' + TYPE + ' required!');
  return it;
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_wks-define.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_wks-define.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var core = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js");
var LIBRARY = __webpack_require__(/*! ./_library */ "./node_modules/core-js/library/modules/_library.js");
var wksExt = __webpack_require__(/*! ./_wks-ext */ "./node_modules/core-js/library/modules/_wks-ext.js");
var defineProperty = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js").f;
module.exports = function (name) {
  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});
  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: wksExt.f(name) });
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/_wks-ext.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_wks-ext.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

exports.f = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js");


/***/ }),

/***/ "./node_modules/core-js/library/modules/_wks.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_wks.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var store = __webpack_require__(/*! ./_shared */ "./node_modules/core-js/library/modules/_shared.js")('wks');
var uid = __webpack_require__(/*! ./_uid */ "./node_modules/core-js/library/modules/_uid.js");
var Symbol = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js").Symbol;
var USE_SYMBOL = typeof Symbol == 'function';

var $exports = module.exports = function (name) {
  return store[name] || (store[name] =
    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));
};

$exports.store = store;


/***/ }),

/***/ "./node_modules/core-js/library/modules/core.get-iterator-method.js":
/*!**************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/core.get-iterator-method.js ***!
  \**************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var classof = __webpack_require__(/*! ./_classof */ "./node_modules/core-js/library/modules/_classof.js");
var ITERATOR = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('iterator');
var Iterators = __webpack_require__(/*! ./_iterators */ "./node_modules/core-js/library/modules/_iterators.js");
module.exports = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js").getIteratorMethod = function (it) {
  if (it != undefined) return it[ITERATOR]
    || it['@@iterator']
    || Iterators[classof(it)];
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/core.get-iterator.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/core.get-iterator.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var get = __webpack_require__(/*! ./core.get-iterator-method */ "./node_modules/core-js/library/modules/core.get-iterator-method.js");
module.exports = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js").getIterator = function (it) {
  var iterFn = get(it);
  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');
  return anObject(iterFn.call(it));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/core.is-iterable.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/core.is-iterable.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var classof = __webpack_require__(/*! ./_classof */ "./node_modules/core-js/library/modules/_classof.js");
var ITERATOR = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('iterator');
var Iterators = __webpack_require__(/*! ./_iterators */ "./node_modules/core-js/library/modules/_iterators.js");
module.exports = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js").isIterable = function (it) {
  var O = Object(it);
  return O[ITERATOR] !== undefined
    || '@@iterator' in O
    // eslint-disable-next-line no-prototype-builtins
    || Iterators.hasOwnProperty(classof(O));
};


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.array.from.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.array.from.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var call = __webpack_require__(/*! ./_iter-call */ "./node_modules/core-js/library/modules/_iter-call.js");
var isArrayIter = __webpack_require__(/*! ./_is-array-iter */ "./node_modules/core-js/library/modules/_is-array-iter.js");
var toLength = __webpack_require__(/*! ./_to-length */ "./node_modules/core-js/library/modules/_to-length.js");
var createProperty = __webpack_require__(/*! ./_create-property */ "./node_modules/core-js/library/modules/_create-property.js");
var getIterFn = __webpack_require__(/*! ./core.get-iterator-method */ "./node_modules/core-js/library/modules/core.get-iterator-method.js");

$export($export.S + $export.F * !__webpack_require__(/*! ./_iter-detect */ "./node_modules/core-js/library/modules/_iter-detect.js")(function (iter) { Array.from(iter); }), 'Array', {
  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)
  from: function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {
    var O = toObject(arrayLike);
    var C = typeof this == 'function' ? this : Array;
    var aLen = arguments.length;
    var mapfn = aLen > 1 ? arguments[1] : undefined;
    var mapping = mapfn !== undefined;
    var index = 0;
    var iterFn = getIterFn(O);
    var length, result, step, iterator;
    if (mapping) mapfn = ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);
    // if object isn't iterable or it's array with default iterator - use simple case
    if (iterFn != undefined && !(C == Array && isArrayIter(iterFn))) {
      for (iterator = iterFn.call(O), result = new C(); !(step = iterator.next()).done; index++) {
        createProperty(result, index, mapping ? call(iterator, mapfn, [step.value, index], true) : step.value);
      }
    } else {
      length = toLength(O.length);
      for (result = new C(length); length > index; index++) {
        createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);
      }
    }
    result.length = index;
    return result;
  }
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.array.iterator.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.array.iterator.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var addToUnscopables = __webpack_require__(/*! ./_add-to-unscopables */ "./node_modules/core-js/library/modules/_add-to-unscopables.js");
var step = __webpack_require__(/*! ./_iter-step */ "./node_modules/core-js/library/modules/_iter-step.js");
var Iterators = __webpack_require__(/*! ./_iterators */ "./node_modules/core-js/library/modules/_iterators.js");
var toIObject = __webpack_require__(/*! ./_to-iobject */ "./node_modules/core-js/library/modules/_to-iobject.js");

// 22.1.3.4 Array.prototype.entries()
// 22.1.3.13 Array.prototype.keys()
// 22.1.3.29 Array.prototype.values()
// 22.1.3.30 Array.prototype[@@iterator]()
module.exports = __webpack_require__(/*! ./_iter-define */ "./node_modules/core-js/library/modules/_iter-define.js")(Array, 'Array', function (iterated, kind) {
  this._t = toIObject(iterated); // target
  this._i = 0;                   // next index
  this._k = kind;                // kind
// 22.1.5.2.1 %ArrayIteratorPrototype%.next()
}, function () {
  var O = this._t;
  var kind = this._k;
  var index = this._i++;
  if (!O || index >= O.length) {
    this._t = undefined;
    return step(1);
  }
  if (kind == 'keys') return step(0, index);
  if (kind == 'values') return step(0, O[index]);
  return step(0, [index, O[index]]);
}, 'values');

// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)
Iterators.Arguments = Iterators.Array;

addToUnscopables('keys');
addToUnscopables('values');
addToUnscopables('entries');


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.map.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.map.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var strong = __webpack_require__(/*! ./_collection-strong */ "./node_modules/core-js/library/modules/_collection-strong.js");
var validate = __webpack_require__(/*! ./_validate-collection */ "./node_modules/core-js/library/modules/_validate-collection.js");
var MAP = 'Map';

// 23.1 Map Objects
module.exports = __webpack_require__(/*! ./_collection */ "./node_modules/core-js/library/modules/_collection.js")(MAP, function (get) {
  return function Map() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.1.3.6 Map.prototype.get(key)
  get: function get(key) {
    var entry = strong.getEntry(validate(this, MAP), key);
    return entry && entry.v;
  },
  // 23.1.3.9 Map.prototype.set(key, value)
  set: function set(key, value) {
    return strong.def(validate(this, MAP), key === 0 ? 0 : key, value);
  }
}, strong, true);


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.number.is-integer.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.number.is-integer.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 20.1.2.3 Number.isInteger(number)
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");

$export($export.S, 'Number', { isInteger: __webpack_require__(/*! ./_is-integer */ "./node_modules/core-js/library/modules/_is-integer.js") });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.assign.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.assign.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.3.1 Object.assign(target, source)
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");

$export($export.S + $export.F, 'Object', { assign: __webpack_require__(/*! ./_object-assign */ "./node_modules/core-js/library/modules/_object-assign.js") });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.create.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.create.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
$export($export.S, 'Object', { create: __webpack_require__(/*! ./_object-create */ "./node_modules/core-js/library/modules/_object-create.js") });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.define-properties.js":
/*!******************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.define-properties.js ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
// 19.1.2.3 / 15.2.3.7 Object.defineProperties(O, Properties)
$export($export.S + $export.F * !__webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js"), 'Object', { defineProperties: __webpack_require__(/*! ./_object-dps */ "./node_modules/core-js/library/modules/_object-dps.js") });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.define-property.js":
/*!****************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.define-property.js ***!
  \****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)
$export($export.S + $export.F * !__webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js"), 'Object', { defineProperty: __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js").f });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.get-prototype-of.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.get-prototype-of.js ***!
  \*****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.9 Object.getPrototypeOf(O)
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var $getPrototypeOf = __webpack_require__(/*! ./_object-gpo */ "./node_modules/core-js/library/modules/_object-gpo.js");

__webpack_require__(/*! ./_object-sap */ "./node_modules/core-js/library/modules/_object-sap.js")('getPrototypeOf', function () {
  return function getPrototypeOf(it) {
    return $getPrototypeOf(toObject(it));
  };
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.keys.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.keys.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.14 Object.keys(O)
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var $keys = __webpack_require__(/*! ./_object-keys */ "./node_modules/core-js/library/modules/_object-keys.js");

__webpack_require__(/*! ./_object-sap */ "./node_modules/core-js/library/modules/_object-sap.js")('keys', function () {
  return function keys(it) {
    return $keys(toObject(it));
  };
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.set-prototype-of.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.set-prototype-of.js ***!
  \*****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.3.19 Object.setPrototypeOf(O, proto)
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
$export($export.S, 'Object', { setPrototypeOf: __webpack_require__(/*! ./_set-proto */ "./node_modules/core-js/library/modules/_set-proto.js").set });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.object.to-string.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.to-string.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {



/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.promise.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.promise.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var LIBRARY = __webpack_require__(/*! ./_library */ "./node_modules/core-js/library/modules/_library.js");
var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var ctx = __webpack_require__(/*! ./_ctx */ "./node_modules/core-js/library/modules/_ctx.js");
var classof = __webpack_require__(/*! ./_classof */ "./node_modules/core-js/library/modules/_classof.js");
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var aFunction = __webpack_require__(/*! ./_a-function */ "./node_modules/core-js/library/modules/_a-function.js");
var anInstance = __webpack_require__(/*! ./_an-instance */ "./node_modules/core-js/library/modules/_an-instance.js");
var forOf = __webpack_require__(/*! ./_for-of */ "./node_modules/core-js/library/modules/_for-of.js");
var speciesConstructor = __webpack_require__(/*! ./_species-constructor */ "./node_modules/core-js/library/modules/_species-constructor.js");
var task = __webpack_require__(/*! ./_task */ "./node_modules/core-js/library/modules/_task.js").set;
var microtask = __webpack_require__(/*! ./_microtask */ "./node_modules/core-js/library/modules/_microtask.js")();
var newPromiseCapabilityModule = __webpack_require__(/*! ./_new-promise-capability */ "./node_modules/core-js/library/modules/_new-promise-capability.js");
var perform = __webpack_require__(/*! ./_perform */ "./node_modules/core-js/library/modules/_perform.js");
var userAgent = __webpack_require__(/*! ./_user-agent */ "./node_modules/core-js/library/modules/_user-agent.js");
var promiseResolve = __webpack_require__(/*! ./_promise-resolve */ "./node_modules/core-js/library/modules/_promise-resolve.js");
var PROMISE = 'Promise';
var TypeError = global.TypeError;
var process = global.process;
var versions = process && process.versions;
var v8 = versions && versions.v8 || '';
var $Promise = global[PROMISE];
var isNode = classof(process) == 'process';
var empty = function () { /* empty */ };
var Internal, newGenericPromiseCapability, OwnPromiseCapability, Wrapper;
var newPromiseCapability = newGenericPromiseCapability = newPromiseCapabilityModule.f;

var USE_NATIVE = !!function () {
  try {
    // correct subclassing with @@species support
    var promise = $Promise.resolve(1);
    var FakePromise = (promise.constructor = {})[__webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('species')] = function (exec) {
      exec(empty, empty);
    };
    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test
    return (isNode || typeof PromiseRejectionEvent == 'function')
      && promise.then(empty) instanceof FakePromise
      // v8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables
      // https://bugs.chromium.org/p/chromium/issues/detail?id=830565
      // we can't detect it synchronously, so just check versions
      && v8.indexOf('6.6') !== 0
      && userAgent.indexOf('Chrome/66') === -1;
  } catch (e) { /* empty */ }
}();

// helpers
var isThenable = function (it) {
  var then;
  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;
};
var notify = function (promise, isReject) {
  if (promise._n) return;
  promise._n = true;
  var chain = promise._c;
  microtask(function () {
    var value = promise._v;
    var ok = promise._s == 1;
    var i = 0;
    var run = function (reaction) {
      var handler = ok ? reaction.ok : reaction.fail;
      var resolve = reaction.resolve;
      var reject = reaction.reject;
      var domain = reaction.domain;
      var result, then, exited;
      try {
        if (handler) {
          if (!ok) {
            if (promise._h == 2) onHandleUnhandled(promise);
            promise._h = 1;
          }
          if (handler === true) result = value;
          else {
            if (domain) domain.enter();
            result = handler(value); // may throw
            if (domain) {
              domain.exit();
              exited = true;
            }
          }
          if (result === reaction.promise) {
            reject(TypeError('Promise-chain cycle'));
          } else if (then = isThenable(result)) {
            then.call(result, resolve, reject);
          } else resolve(result);
        } else reject(value);
      } catch (e) {
        if (domain && !exited) domain.exit();
        reject(e);
      }
    };
    while (chain.length > i) run(chain[i++]); // variable length - can't use forEach
    promise._c = [];
    promise._n = false;
    if (isReject && !promise._h) onUnhandled(promise);
  });
};
var onUnhandled = function (promise) {
  task.call(global, function () {
    var value = promise._v;
    var unhandled = isUnhandled(promise);
    var result, handler, console;
    if (unhandled) {
      result = perform(function () {
        if (isNode) {
          process.emit('unhandledRejection', value, promise);
        } else if (handler = global.onunhandledrejection) {
          handler({ promise: promise, reason: value });
        } else if ((console = global.console) && console.error) {
          console.error('Unhandled promise rejection', value);
        }
      });
      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should
      promise._h = isNode || isUnhandled(promise) ? 2 : 1;
    } promise._a = undefined;
    if (unhandled && result.e) throw result.v;
  });
};
var isUnhandled = function (promise) {
  return promise._h !== 1 && (promise._a || promise._c).length === 0;
};
var onHandleUnhandled = function (promise) {
  task.call(global, function () {
    var handler;
    if (isNode) {
      process.emit('rejectionHandled', promise);
    } else if (handler = global.onrejectionhandled) {
      handler({ promise: promise, reason: promise._v });
    }
  });
};
var $reject = function (value) {
  var promise = this;
  if (promise._d) return;
  promise._d = true;
  promise = promise._w || promise; // unwrap
  promise._v = value;
  promise._s = 2;
  if (!promise._a) promise._a = promise._c.slice();
  notify(promise, true);
};
var $resolve = function (value) {
  var promise = this;
  var then;
  if (promise._d) return;
  promise._d = true;
  promise = promise._w || promise; // unwrap
  try {
    if (promise === value) throw TypeError("Promise can't be resolved itself");
    if (then = isThenable(value)) {
      microtask(function () {
        var wrapper = { _w: promise, _d: false }; // wrap
        try {
          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));
        } catch (e) {
          $reject.call(wrapper, e);
        }
      });
    } else {
      promise._v = value;
      promise._s = 1;
      notify(promise, false);
    }
  } catch (e) {
    $reject.call({ _w: promise, _d: false }, e); // wrap
  }
};

// constructor polyfill
if (!USE_NATIVE) {
  // 25.4.3.1 Promise(executor)
  $Promise = function Promise(executor) {
    anInstance(this, $Promise, PROMISE, '_h');
    aFunction(executor);
    Internal.call(this);
    try {
      executor(ctx($resolve, this, 1), ctx($reject, this, 1));
    } catch (err) {
      $reject.call(this, err);
    }
  };
  // eslint-disable-next-line no-unused-vars
  Internal = function Promise(executor) {
    this._c = [];             // <- awaiting reactions
    this._a = undefined;      // <- checked in isUnhandled reactions
    this._s = 0;              // <- state
    this._d = false;          // <- done
    this._v = undefined;      // <- value
    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled
    this._n = false;          // <- notify
  };
  Internal.prototype = __webpack_require__(/*! ./_redefine-all */ "./node_modules/core-js/library/modules/_redefine-all.js")($Promise.prototype, {
    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)
    then: function then(onFulfilled, onRejected) {
      var reaction = newPromiseCapability(speciesConstructor(this, $Promise));
      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;
      reaction.fail = typeof onRejected == 'function' && onRejected;
      reaction.domain = isNode ? process.domain : undefined;
      this._c.push(reaction);
      if (this._a) this._a.push(reaction);
      if (this._s) notify(this, false);
      return reaction.promise;
    },
    // 25.4.5.1 Promise.prototype.catch(onRejected)
    'catch': function (onRejected) {
      return this.then(undefined, onRejected);
    }
  });
  OwnPromiseCapability = function () {
    var promise = new Internal();
    this.promise = promise;
    this.resolve = ctx($resolve, promise, 1);
    this.reject = ctx($reject, promise, 1);
  };
  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {
    return C === $Promise || C === Wrapper
      ? new OwnPromiseCapability(C)
      : newGenericPromiseCapability(C);
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Promise: $Promise });
__webpack_require__(/*! ./_set-to-string-tag */ "./node_modules/core-js/library/modules/_set-to-string-tag.js")($Promise, PROMISE);
__webpack_require__(/*! ./_set-species */ "./node_modules/core-js/library/modules/_set-species.js")(PROMISE);
Wrapper = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js")[PROMISE];

// statics
$export($export.S + $export.F * !USE_NATIVE, PROMISE, {
  // 25.4.4.5 Promise.reject(r)
  reject: function reject(r) {
    var capability = newPromiseCapability(this);
    var $$reject = capability.reject;
    $$reject(r);
    return capability.promise;
  }
});
$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {
  // 25.4.4.6 Promise.resolve(x)
  resolve: function resolve(x) {
    return promiseResolve(LIBRARY && this === Wrapper ? $Promise : this, x);
  }
});
$export($export.S + $export.F * !(USE_NATIVE && __webpack_require__(/*! ./_iter-detect */ "./node_modules/core-js/library/modules/_iter-detect.js")(function (iter) {
  $Promise.all(iter)['catch'](empty);
})), PROMISE, {
  // 25.4.4.1 Promise.all(iterable)
  all: function all(iterable) {
    var C = this;
    var capability = newPromiseCapability(C);
    var resolve = capability.resolve;
    var reject = capability.reject;
    var result = perform(function () {
      var values = [];
      var index = 0;
      var remaining = 1;
      forOf(iterable, false, function (promise) {
        var $index = index++;
        var alreadyCalled = false;
        values.push(undefined);
        remaining++;
        C.resolve(promise).then(function (value) {
          if (alreadyCalled) return;
          alreadyCalled = true;
          values[$index] = value;
          --remaining || resolve(values);
        }, reject);
      });
      --remaining || resolve(values);
    });
    if (result.e) reject(result.v);
    return capability.promise;
  },
  // 25.4.4.4 Promise.race(iterable)
  race: function race(iterable) {
    var C = this;
    var capability = newPromiseCapability(C);
    var reject = capability.reject;
    var result = perform(function () {
      forOf(iterable, false, function (promise) {
        C.resolve(promise).then(capability.resolve, reject);
      });
    });
    if (result.e) reject(result.v);
    return capability.promise;
  }
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.set.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.set.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var strong = __webpack_require__(/*! ./_collection-strong */ "./node_modules/core-js/library/modules/_collection-strong.js");
var validate = __webpack_require__(/*! ./_validate-collection */ "./node_modules/core-js/library/modules/_validate-collection.js");
var SET = 'Set';

// 23.2 Set Objects
module.exports = __webpack_require__(/*! ./_collection */ "./node_modules/core-js/library/modules/_collection.js")(SET, function (get) {
  return function Set() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.2.3.1 Set.prototype.add(value)
  add: function add(value) {
    return strong.def(validate(this, SET), value = value === 0 ? 0 : value, value);
  }
}, strong);


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.string.iterator.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.string.iterator.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var $at = __webpack_require__(/*! ./_string-at */ "./node_modules/core-js/library/modules/_string-at.js")(true);

// 21.1.3.27 String.prototype[@@iterator]()
__webpack_require__(/*! ./_iter-define */ "./node_modules/core-js/library/modules/_iter-define.js")(String, 'String', function (iterated) {
  this._t = String(iterated); // target
  this._i = 0;                // next index
// 21.1.5.2.1 %StringIteratorPrototype%.next()
}, function () {
  var O = this._t;
  var index = this._i;
  var point;
  if (index >= O.length) return { value: undefined, done: true };
  point = $at(O, index);
  this._i += point.length;
  return { value: point, done: false };
});


/***/ }),

/***/ "./node_modules/core-js/library/modules/es6.symbol.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.symbol.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// ECMAScript 6 symbols shim
var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var has = __webpack_require__(/*! ./_has */ "./node_modules/core-js/library/modules/_has.js");
var DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ "./node_modules/core-js/library/modules/_descriptors.js");
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var redefine = __webpack_require__(/*! ./_redefine */ "./node_modules/core-js/library/modules/_redefine.js");
var META = __webpack_require__(/*! ./_meta */ "./node_modules/core-js/library/modules/_meta.js").KEY;
var $fails = __webpack_require__(/*! ./_fails */ "./node_modules/core-js/library/modules/_fails.js");
var shared = __webpack_require__(/*! ./_shared */ "./node_modules/core-js/library/modules/_shared.js");
var setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ "./node_modules/core-js/library/modules/_set-to-string-tag.js");
var uid = __webpack_require__(/*! ./_uid */ "./node_modules/core-js/library/modules/_uid.js");
var wks = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js");
var wksExt = __webpack_require__(/*! ./_wks-ext */ "./node_modules/core-js/library/modules/_wks-ext.js");
var wksDefine = __webpack_require__(/*! ./_wks-define */ "./node_modules/core-js/library/modules/_wks-define.js");
var enumKeys = __webpack_require__(/*! ./_enum-keys */ "./node_modules/core-js/library/modules/_enum-keys.js");
var isArray = __webpack_require__(/*! ./_is-array */ "./node_modules/core-js/library/modules/_is-array.js");
var anObject = __webpack_require__(/*! ./_an-object */ "./node_modules/core-js/library/modules/_an-object.js");
var isObject = __webpack_require__(/*! ./_is-object */ "./node_modules/core-js/library/modules/_is-object.js");
var toObject = __webpack_require__(/*! ./_to-object */ "./node_modules/core-js/library/modules/_to-object.js");
var toIObject = __webpack_require__(/*! ./_to-iobject */ "./node_modules/core-js/library/modules/_to-iobject.js");
var toPrimitive = __webpack_require__(/*! ./_to-primitive */ "./node_modules/core-js/library/modules/_to-primitive.js");
var createDesc = __webpack_require__(/*! ./_property-desc */ "./node_modules/core-js/library/modules/_property-desc.js");
var _create = __webpack_require__(/*! ./_object-create */ "./node_modules/core-js/library/modules/_object-create.js");
var gOPNExt = __webpack_require__(/*! ./_object-gopn-ext */ "./node_modules/core-js/library/modules/_object-gopn-ext.js");
var $GOPD = __webpack_require__(/*! ./_object-gopd */ "./node_modules/core-js/library/modules/_object-gopd.js");
var $GOPS = __webpack_require__(/*! ./_object-gops */ "./node_modules/core-js/library/modules/_object-gops.js");
var $DP = __webpack_require__(/*! ./_object-dp */ "./node_modules/core-js/library/modules/_object-dp.js");
var $keys = __webpack_require__(/*! ./_object-keys */ "./node_modules/core-js/library/modules/_object-keys.js");
var gOPD = $GOPD.f;
var dP = $DP.f;
var gOPN = gOPNExt.f;
var $Symbol = global.Symbol;
var $JSON = global.JSON;
var _stringify = $JSON && $JSON.stringify;
var PROTOTYPE = 'prototype';
var HIDDEN = wks('_hidden');
var TO_PRIMITIVE = wks('toPrimitive');
var isEnum = {}.propertyIsEnumerable;
var SymbolRegistry = shared('symbol-registry');
var AllSymbols = shared('symbols');
var OPSymbols = shared('op-symbols');
var ObjectProto = Object[PROTOTYPE];
var USE_NATIVE = typeof $Symbol == 'function' && !!$GOPS.f;
var QObject = global.QObject;
// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173
var setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;

// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687
var setSymbolDesc = DESCRIPTORS && $fails(function () {
  return _create(dP({}, 'a', {
    get: function () { return dP(this, 'a', { value: 7 }).a; }
  })).a != 7;
}) ? function (it, key, D) {
  var protoDesc = gOPD(ObjectProto, key);
  if (protoDesc) delete ObjectProto[key];
  dP(it, key, D);
  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);
} : dP;

var wrap = function (tag) {
  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);
  sym._k = tag;
  return sym;
};

var isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {
  return typeof it == 'symbol';
} : function (it) {
  return it instanceof $Symbol;
};

var $defineProperty = function defineProperty(it, key, D) {
  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);
  anObject(it);
  key = toPrimitive(key, true);
  anObject(D);
  if (has(AllSymbols, key)) {
    if (!D.enumerable) {
      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));
      it[HIDDEN][key] = true;
    } else {
      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;
      D = _create(D, { enumerable: createDesc(0, false) });
    } return setSymbolDesc(it, key, D);
  } return dP(it, key, D);
};
var $defineProperties = function defineProperties(it, P) {
  anObject(it);
  var keys = enumKeys(P = toIObject(P));
  var i = 0;
  var l = keys.length;
  var key;
  while (l > i) $defineProperty(it, key = keys[i++], P[key]);
  return it;
};
var $create = function create(it, P) {
  return P === undefined ? _create(it) : $defineProperties(_create(it), P);
};
var $propertyIsEnumerable = function propertyIsEnumerable(key) {
  var E = isEnum.call(this, key = toPrimitive(key, true));
  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;
  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;
};
var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {
  it = toIObject(it);
  key = toPrimitive(key, true);
  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;
  var D = gOPD(it, key);
  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;
  return D;
};
var $getOwnPropertyNames = function getOwnPropertyNames(it) {
  var names = gOPN(toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);
  } return result;
};
var $getOwnPropertySymbols = function getOwnPropertySymbols(it) {
  var IS_OP = it === ObjectProto;
  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);
  } return result;
};

// 19.4.1.1 Symbol([description])
if (!USE_NATIVE) {
  $Symbol = function Symbol() {
    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');
    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);
    var $set = function (value) {
      if (this === ObjectProto) $set.call(OPSymbols, value);
      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;
      setSymbolDesc(this, tag, createDesc(1, value));
    };
    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });
    return wrap(tag);
  };
  redefine($Symbol[PROTOTYPE], 'toString', function toString() {
    return this._k;
  });

  $GOPD.f = $getOwnPropertyDescriptor;
  $DP.f = $defineProperty;
  __webpack_require__(/*! ./_object-gopn */ "./node_modules/core-js/library/modules/_object-gopn.js").f = gOPNExt.f = $getOwnPropertyNames;
  __webpack_require__(/*! ./_object-pie */ "./node_modules/core-js/library/modules/_object-pie.js").f = $propertyIsEnumerable;
  $GOPS.f = $getOwnPropertySymbols;

  if (DESCRIPTORS && !__webpack_require__(/*! ./_library */ "./node_modules/core-js/library/modules/_library.js")) {
    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);
  }

  wksExt.f = function (name) {
    return wrap(wks(name));
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });

for (var es6Symbols = (
  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14
  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'
).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);

for (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);

$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {
  // 19.4.2.1 Symbol.for(key)
  'for': function (key) {
    return has(SymbolRegistry, key += '')
      ? SymbolRegistry[key]
      : SymbolRegistry[key] = $Symbol(key);
  },
  // 19.4.2.5 Symbol.keyFor(sym)
  keyFor: function keyFor(sym) {
    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');
    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;
  },
  useSetter: function () { setter = true; },
  useSimple: function () { setter = false; }
});

$export($export.S + $export.F * !USE_NATIVE, 'Object', {
  // 19.1.2.2 Object.create(O [, Properties])
  create: $create,
  // 19.1.2.4 Object.defineProperty(O, P, Attributes)
  defineProperty: $defineProperty,
  // 19.1.2.3 Object.defineProperties(O, Properties)
  defineProperties: $defineProperties,
  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
  // 19.1.2.7 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $getOwnPropertyNames,
  // 19.1.2.8 Object.getOwnPropertySymbols(O)
  getOwnPropertySymbols: $getOwnPropertySymbols
});

// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives
// https://bugs.chromium.org/p/v8/issues/detail?id=3443
var FAILS_ON_PRIMITIVES = $fails(function () { $GOPS.f(1); });

$export($export.S + $export.F * FAILS_ON_PRIMITIVES, 'Object', {
  getOwnPropertySymbols: function getOwnPropertySymbols(it) {
    return $GOPS.f(toObject(it));
  }
});

// 24.3.2 JSON.stringify(value [, replacer [, space]])
$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {
  var S = $Symbol();
  // MS Edge converts symbol values to JSON as {}
  // WebKit converts symbol values to JSON as null
  // V8 throws on boxed symbols
  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';
})), 'JSON', {
  stringify: function stringify(it) {
    var args = [it];
    var i = 1;
    var replacer, $replacer;
    while (arguments.length > i) args.push(arguments[i++]);
    $replacer = replacer = args[1];
    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined
    if (!isArray(replacer)) replacer = function (key, value) {
      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);
      if (!isSymbol(value)) return value;
    };
    args[1] = replacer;
    return _stringify.apply($JSON, args);
  }
});

// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)
$Symbol[PROTOTYPE][TO_PRIMITIVE] || __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js")($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);
// 19.4.3.5 Symbol.prototype[@@toStringTag]
setToStringTag($Symbol, 'Symbol');
// 20.2.1.9 Math[@@toStringTag]
setToStringTag(Math, 'Math', true);
// 24.3.3 JSON[@@toStringTag]
setToStringTag(global.JSON, 'JSON', true);


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.map.from.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.map.from.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://tc39.github.io/proposal-setmap-offrom/#sec-map.from
__webpack_require__(/*! ./_set-collection-from */ "./node_modules/core-js/library/modules/_set-collection-from.js")('Map');


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.map.of.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.map.of.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://tc39.github.io/proposal-setmap-offrom/#sec-map.of
__webpack_require__(/*! ./_set-collection-of */ "./node_modules/core-js/library/modules/_set-collection-of.js")('Map');


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.map.to-json.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.map.to-json.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");

$export($export.P + $export.R, 'Map', { toJSON: __webpack_require__(/*! ./_collection-to-json */ "./node_modules/core-js/library/modules/_collection-to-json.js")('Map') });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.promise.finally.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.promise.finally.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
// https://github.com/tc39/proposal-promise-finally

var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var core = __webpack_require__(/*! ./_core */ "./node_modules/core-js/library/modules/_core.js");
var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var speciesConstructor = __webpack_require__(/*! ./_species-constructor */ "./node_modules/core-js/library/modules/_species-constructor.js");
var promiseResolve = __webpack_require__(/*! ./_promise-resolve */ "./node_modules/core-js/library/modules/_promise-resolve.js");

$export($export.P + $export.R, 'Promise', { 'finally': function (onFinally) {
  var C = speciesConstructor(this, core.Promise || global.Promise);
  var isFunction = typeof onFinally == 'function';
  return this.then(
    isFunction ? function (x) {
      return promiseResolve(C, onFinally()).then(function () { return x; });
    } : onFinally,
    isFunction ? function (e) {
      return promiseResolve(C, onFinally()).then(function () { throw e; });
    } : onFinally
  );
} });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.promise.try.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.promise.try.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// https://github.com/tc39/proposal-promise-try
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");
var newPromiseCapability = __webpack_require__(/*! ./_new-promise-capability */ "./node_modules/core-js/library/modules/_new-promise-capability.js");
var perform = __webpack_require__(/*! ./_perform */ "./node_modules/core-js/library/modules/_perform.js");

$export($export.S, 'Promise', { 'try': function (callbackfn) {
  var promiseCapability = newPromiseCapability.f(this);
  var result = perform(callbackfn);
  (result.e ? promiseCapability.reject : promiseCapability.resolve)(result.v);
  return promiseCapability.promise;
} });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.set.from.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.set.from.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://tc39.github.io/proposal-setmap-offrom/#sec-set.from
__webpack_require__(/*! ./_set-collection-from */ "./node_modules/core-js/library/modules/_set-collection-from.js")('Set');


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.set.of.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.set.of.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://tc39.github.io/proposal-setmap-offrom/#sec-set.of
__webpack_require__(/*! ./_set-collection-of */ "./node_modules/core-js/library/modules/_set-collection-of.js")('Set');


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.set.to-json.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.set.to-json.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $export = __webpack_require__(/*! ./_export */ "./node_modules/core-js/library/modules/_export.js");

$export($export.P + $export.R, 'Set', { toJSON: __webpack_require__(/*! ./_collection-to-json */ "./node_modules/core-js/library/modules/_collection-to-json.js")('Set') });


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.symbol.async-iterator.js":
/*!***************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.symbol.async-iterator.js ***!
  \***************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ./_wks-define */ "./node_modules/core-js/library/modules/_wks-define.js")('asyncIterator');


/***/ }),

/***/ "./node_modules/core-js/library/modules/es7.symbol.observable.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.symbol.observable.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ./_wks-define */ "./node_modules/core-js/library/modules/_wks-define.js")('observable');


/***/ }),

/***/ "./node_modules/core-js/library/modules/web.dom.iterable.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/web.dom.iterable.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! ./es6.array.iterator */ "./node_modules/core-js/library/modules/es6.array.iterator.js");
var global = __webpack_require__(/*! ./_global */ "./node_modules/core-js/library/modules/_global.js");
var hide = __webpack_require__(/*! ./_hide */ "./node_modules/core-js/library/modules/_hide.js");
var Iterators = __webpack_require__(/*! ./_iterators */ "./node_modules/core-js/library/modules/_iterators.js");
var TO_STRING_TAG = __webpack_require__(/*! ./_wks */ "./node_modules/core-js/library/modules/_wks.js")('toStringTag');

var DOMIterables = ('CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,' +
  'DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,' +
  'MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,' +
  'SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,' +
  'TextTrackList,TouchList').split(',');

for (var i = 0; i < DOMIterables.length; i++) {
  var NAME = DOMIterables[i];
  var Collection = global[NAME];
  var proto = Collection && Collection.prototype;
  if (proto && !proto[TO_STRING_TAG]) hide(proto, TO_STRING_TAG, NAME);
  Iterators[NAME] = Iterators.Array;
}


/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/src/index.js?!./new_src/component/toast/toast.less":
/*!***************************************************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js??ref--7-1!./node_modules/postcss-loader/src??postcss!./new_src/component/toast/toast.less ***!
  \***************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(/*! ../../../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js")(false);
// Module
exports.push([module.i, ".whiteboard-toast {\n    display: none;\n    position: fixed;\n    left: 50%;\n    transform: translate(-50%);\n    top: 200px;\n    padding: 8px 15px;\n    margin-bottom: 20px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: #3c763d;\n    background-color: #dff0d8;\n    border-color: #d6e9c6;\n    z-index: 100;\n}", ""]);



/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/src/index.js?!./new_src/core/ops/TextOp/TextToolbar.less":
/*!*********************************************************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js??ref--7-1!./node_modules/postcss-loader/src??postcss!./new_src/core/ops/TextOp/TextToolbar.less ***!
  \*********************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js")(false);
// Module
exports.push([module.i, ".text-toolbar {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-around;\n\n    position: absolute;\n\n    box-sizing: border-box;\n    height: 48px;\n    margin: 12px 12px 24px;\n\n    -webkit-user-select: none;\n\n       -moz-user-select: none;\n\n        -ms-user-select: none;\n\n            user-select: none;\n    background-color: white;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n    z-index: 7;\n}\n\n    .text-toolbar .flex-cell {\n        display: flex;\n        flex: 1;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        border: none;\n        width: 40px;\n        height: 40px;\n    }\n\n    .text-toolbar .color {\n        border-radius: 12px;\n    }\n\n    .text-toolbar .color span {\n            width: 18px;\n            height: 18px;\n            border-radius: 9px;\n        }\n\n    .text-toolbar .fontsize.input {\n        height: 24px;\n        vertical-align: top;\n        box-sizing: border-box;\n        width: 40px;\n        outline: none;\n        border: 1px solid rgba(0, 0, 0, 0.3);\n        margin: 0 6px 0 8px;\n        text-align: center;\n    }\n\n    .text-toolbar .fontsize.inc, .text-toolbar .fontsize.dec {\n        border-radius: 12px;\n        font-size: 32px;\n        line-height: 24px;\n        text-align: center;\n        vertical-align: top;\n        position: relative;\n        top: -3px;\n    }\n\n    .text-toolbar .platte-container {\n        position: absolute;\n        display: none;\n        flex-direction: row;\n        flex-wrap: wrap;\n\n        align-items: center;\n        justify-content: space-around;\n        box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n        bottom: 56px;\n        right: 0;\n        background-color: white;\n        width: 100%;\n    }\n\n    .text-toolbar .platte-container .color-cell {\n            width: 20px;\n            height: 20px;\n            border-radius: 10px;\n            margin: 10px;\n            display: inline-block;\n            box-sizing: border-box\n        }\n\n    .text-toolbar .platte-container .color-cell:hover {\n                cursor: pointer;\n            }", ""]);



/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/src/index.js?!./new_src/recordPlayer/ToolUI.less":
/*!*************************************************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js??ref--7-1!./node_modules/postcss-loader/src??postcss!./new_src/recordPlayer/ToolUI.less ***!
  \*************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js")(false);
// Module
exports.push([module.i, ".player-container {\n    display: block;\n    position: relative;\n    height: 30px;\n    background: rgba(113, 113, 113, 0.23);\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    display: flex;\n}\n\n    .player-container .player-play-icon-wrapper {\n        cursor: pointer;\n        position: relative;\n        width: 20px;\n        height: 20px;\n        padding: 5px;\n    }\n\n    .player-container .player-play-icon-wrapper .player-play-icon {\n            display:inline-block;\n            height:inherit;\n            width:inherit;\n            background-size:cover;\n        }\n\n    .player-container .player-speed {\n        padding: 5px;\n        height: 20px;\n        font-size: 14px;\n        font-family: sans-serif;\n        cursor: pointer;\n    }\n\n    .player-container .player-speed .player-speed-text {\n            text-align: center;\n        }\n\n    .player-container .player-speed .player-speed-options {\n            position: absolute;\n            bottom: 27px;\n            background: rgba(0,0,0,.8);\n            padding: 0 10px;\n            color: white;\n            text-align: center;\n        }\n\n    .player-container .player-speed .player-speed-options .option {\n                margin: 10px 0;\n            }\n\n    .player-container .player-duration {\n        height:20px;\n        font-size:14px;\n        font-family:sans-serif;\n        padding: 5px;\n    }\n\n    .player-container .player-timeline {\n        flex: 1;\n        height: 6px;\n        cursor: pointer;\n        background: rgba(0,0,0,0.12);\n        margin: 12px 5px;\n        position: relative;\n    }\n\n    .player-container .player-timeline-label {\n        position: absolute;\n        height: 20px;\n        background: white;\n        border-radius: 3px;\n        bottom: 10px;\n        padding: 4px 6px;\n        transform: translateX(-50%);\n    }\n\n    .player-container .player-timeline-bg {\n        position: absolute;\n        height: 20px;\n        background: 'white';\n        width: 2px;\n        bottom: -5px;\n        pointer-events: none;\n    }\n\n    .player-container .player-timeline-blueline {\n        position: absolute;\n        background: rgba(24, 121, 226, 0.7);\n        height: inherit;\n        pointer-events: none;\n    }\n\n    .player-container .player-timeline-slider {\n        position: absolute;\n        top: -5px;\n        bottom: -5px;\n        background: white;\n        box-sizing: content-box;\n        padding:0 4px;\n        width: 4px;\n        transform:translateX(-6px);\n    }", ""]);



/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
// css base code, injected by the css-loader
module.exports = function (useSourceMap) {
  var list = []; // return the list of modules as css string

  list.toString = function toString() {
    return this.map(function (item) {
      var content = cssWithMappingToString(item, useSourceMap);

      if (item[2]) {
        return '@media ' + item[2] + '{' + content + '}';
      } else {
        return content;
      }
    }).join('');
  }; // import a list of modules into the list


  list.i = function (modules, mediaQuery) {
    if (typeof modules === 'string') {
      modules = [[null, modules, '']];
    }

    var alreadyImportedModules = {};

    for (var i = 0; i < this.length; i++) {
      var id = this[i][0];

      if (id != null) {
        alreadyImportedModules[id] = true;
      }
    }

    for (i = 0; i < modules.length; i++) {
      var item = modules[i]; // skip already imported module
      // this implementation is not 100% perfect for weird media query combinations
      // when a module is imported multiple times with different media queries.
      // I hope this will never occur (Hey this way we have smaller bundles)

      if (item[0] == null || !alreadyImportedModules[item[0]]) {
        if (mediaQuery && !item[2]) {
          item[2] = mediaQuery;
        } else if (mediaQuery) {
          item[2] = '(' + item[2] + ') and (' + mediaQuery + ')';
        }

        list.push(item);
      }
    }
  };

  return list;
};

function cssWithMappingToString(item, useSourceMap) {
  var content = item[1] || '';
  var cssMapping = item[3];

  if (!cssMapping) {
    return content;
  }

  if (useSourceMap && typeof btoa === 'function') {
    var sourceMapping = toComment(cssMapping);
    var sourceURLs = cssMapping.sources.map(function (source) {
      return '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */';
    });
    return [content].concat(sourceURLs).concat([sourceMapping]).join('\n');
  }

  return [content].join('\n');
} // Adapted from convert-source-map (MIT)


function toComment(sourceMap) {
  // eslint-disable-next-line no-undef
  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));
  var data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;
  return '/*# ' + data + ' */';
}

/***/ }),

/***/ "./node_modules/debug/src/browser.js":
/*!*******************************************!*\
  !*** ./node_modules/debug/src/browser.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(process) {

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-env browser */

/**
 * This is the web browser implementation of `debug()`.
 */

exports.formatArgs = formatArgs;
exports.save = save;
exports.load = load;
exports.useColors = useColors;
exports.storage = localstorage();

/**
 * Colors.
 */

exports.colors = ['#0000CC', '#0000FF', '#0033CC', '#0033FF', '#0066CC', '#0066FF', '#0099CC', '#0099FF', '#00CC00', '#00CC33', '#00CC66', '#00CC99', '#00CCCC', '#00CCFF', '#3300CC', '#3300FF', '#3333CC', '#3333FF', '#3366CC', '#3366FF', '#3399CC', '#3399FF', '#33CC00', '#33CC33', '#33CC66', '#33CC99', '#33CCCC', '#33CCFF', '#6600CC', '#6600FF', '#6633CC', '#6633FF', '#66CC00', '#66CC33', '#9900CC', '#9900FF', '#9933CC', '#9933FF', '#99CC00', '#99CC33', '#CC0000', '#CC0033', '#CC0066', '#CC0099', '#CC00CC', '#CC00FF', '#CC3300', '#CC3333', '#CC3366', '#CC3399', '#CC33CC', '#CC33FF', '#CC6600', '#CC6633', '#CC9900', '#CC9933', '#CCCC00', '#CCCC33', '#FF0000', '#FF0033', '#FF0066', '#FF0099', '#FF00CC', '#FF00FF', '#FF3300', '#FF3333', '#FF3366', '#FF3399', '#FF33CC', '#FF33FF', '#FF6600', '#FF6633', '#FF9900', '#FF9933', '#FFCC00', '#FFCC33'];

/**
 * Currently only WebKit-based Web Inspectors, Firefox >= v31,
 * and the Firebug extension (any Firefox version) are known
 * to support "%c" CSS customizations.
 *
 * TODO: add a `localStorage` variable to explicitly enable/disable colors
 */

// eslint-disable-next-line complexity
function useColors() {
	// NB: In an Electron preload script, document will be defined but not fully
	// initialized. Since we know we're in Chrome, we'll just detect this case
	// explicitly
	if (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {
		return true;
	}

	// Internet Explorer and Edge do not support colors.
	if (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)) {
		return false;
	}

	// Is webkit? http://stackoverflow.com/a/16459606/376773
	// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632
	return typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance ||
	// Is firebug? http://stackoverflow.com/a/398120/376773
	typeof window !== 'undefined' && window.console && (window.console.firebug || window.console.exception && window.console.table) ||
	// Is firefox >= v31?
	// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages
	typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 ||
	// Double check webkit in userAgent just in case we are in a worker
	typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/);
}

/**
 * Colorize log arguments if enabled.
 *
 * @api public
 */

function formatArgs(args) {
	args[0] = (this.useColors ? '%c' : '') + this.namespace + (this.useColors ? ' %c' : ' ') + args[0] + (this.useColors ? '%c ' : ' ') + '+' + module.exports.humanize(this.diff);

	if (!this.useColors) {
		return;
	}

	var c = 'color: ' + this.color;
	args.splice(1, 0, c, 'color: inherit');

	// The final "%c" is somewhat tricky, because there could be other
	// arguments passed either before or after the %c, so we need to
	// figure out the correct index to insert the CSS into
	var index = 0;
	var lastC = 0;
	args[0].replace(/%[a-zA-Z%]/g, function (match) {
		if (match === '%%') {
			return;
		}
		index++;
		if (match === '%c') {
			// We only are interested in the *last* %c
			// (the user may have provided their own)
			lastC = index;
		}
	});

	args.splice(lastC, 0, c);
}

/**
 * Invokes `console.debug()` when available.
 * No-op when `console.debug` is not a "function".
 * If `console.debug` is not available, falls back
 * to `console.log`.
 *
 * @api public
 */
exports.log = console.debug || console.log || function () {};

/**
 * Save `namespaces`.
 *
 * @param {String} namespaces
 * @api private
 */
function save(namespaces) {
	try {
		if (namespaces) {
			exports.storage.setItem('debug', namespaces);
		} else {
			exports.storage.removeItem('debug');
		}
	} catch (error) {
		// Swallow
		// XXX (@Qix-) should we be logging these?
	}
}

/**
 * Load `namespaces`.
 *
 * @return {String} returns the previously persisted debug modes
 * @api private
 */
function load() {
	var r = void 0;
	try {
		r = exports.storage.getItem('debug');
	} catch (error) {}
	// Swallow
	// XXX (@Qix-) should we be logging these?


	// If debug isn't set in LS, and we're in Electron, try to load $DEBUG
	if (!r && typeof process !== 'undefined' && 'env' in process) {
		r = process.env.DEBUG;
	}

	return r;
}

/**
 * Localstorage attempts to return the localstorage.
 *
 * This is necessary because safari throws
 * when a user disables cookies/localstorage
 * and you attempt to access it.
 *
 * @return {LocalStorage}
 * @api private
 */

function localstorage() {
	try {
		// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context
		// The Browser also has localStorage in the global context.
		return localStorage;
	} catch (error) {
		// Swallow
		// XXX (@Qix-) should we be logging these?
	}
}

module.exports = __webpack_require__(/*! ./common */ "./node_modules/debug/src/common.js")(exports);

var formatters = module.exports.formatters;

/**
 * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.
 */

formatters.j = function (v) {
	try {
		return (0, _stringify2.default)(v);
	} catch (error) {
		return '[UnexpectedJSONParseError]: ' + error.message;
	}
};
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/debug/src/common.js":
/*!******************************************!*\
  !*** ./node_modules/debug/src/common.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * This is the common logic for both the Node.js and web browser
 * implementations of `debug()`.
 */

function setup(env) {
	createDebug.debug = createDebug;
	createDebug.default = createDebug;
	createDebug.coerce = coerce;
	createDebug.disable = disable;
	createDebug.enable = enable;
	createDebug.enabled = enabled;
	createDebug.humanize = __webpack_require__(/*! ms */ "./node_modules/ms/index.js");

	(0, _keys2.default)(env).forEach(function (key) {
		createDebug[key] = env[key];
	});

	/**
 * Active `debug` instances.
 */
	createDebug.instances = [];

	/**
 * The currently active debug mode names, and names to skip.
 */

	createDebug.names = [];
	createDebug.skips = [];

	/**
 * Map of special "%n" handling functions, for the debug "format" argument.
 *
 * Valid key names are a single, lower or upper-case letter, i.e. "n" and "N".
 */
	createDebug.formatters = {};

	/**
 * Selects a color for a debug namespace
 * @param {String} namespace The namespace string for the for the debug instance to be colored
 * @return {Number|String} An ANSI color code for the given namespace
 * @api private
 */
	function selectColor(namespace) {
		var hash = 0;

		for (var i = 0; i < namespace.length; i++) {
			hash = (hash << 5) - hash + namespace.charCodeAt(i);
			hash |= 0; // Convert to 32bit integer
		}

		return createDebug.colors[Math.abs(hash) % createDebug.colors.length];
	}
	createDebug.selectColor = selectColor;

	/**
 * Create a debugger with the given `namespace`.
 *
 * @param {String} namespace
 * @return {Function}
 * @api public
 */
	function createDebug(namespace) {
		var prevTime = void 0;

		function debug() {
			for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
				args[_key] = arguments[_key];
			}

			// Disabled?
			if (!debug.enabled) {
				return;
			}

			var self = debug;

			// Set `diff` timestamp
			var curr = Number(new Date());
			var ms = curr - (prevTime || curr);
			self.diff = ms;
			self.prev = prevTime;
			self.curr = curr;
			prevTime = curr;

			args[0] = createDebug.coerce(args[0]);

			if (typeof args[0] !== 'string') {
				// Anything else let's inspect with %O
				args.unshift('%O');
			}

			// Apply any `formatters` transformations
			var index = 0;
			args[0] = args[0].replace(/%([a-zA-Z%])/g, function (match, format) {
				// If we encounter an escaped % then don't increase the array index
				if (match === '%%') {
					return match;
				}
				index++;
				var formatter = createDebug.formatters[format];
				if (typeof formatter === 'function') {
					var val = args[index];
					match = formatter.call(self, val);

					// Now we need to remove `args[index]` since it's inlined in the `format`
					args.splice(index, 1);
					index--;
				}
				return match;
			});

			// Apply env-specific formatting (colors, etc.)
			createDebug.formatArgs.call(self, args);

			var logFn = self.log || createDebug.log;
			logFn.apply(self, args);
		}

		debug.namespace = namespace;
		debug.enabled = createDebug.enabled(namespace);
		debug.useColors = createDebug.useColors();
		debug.color = createDebug.selectColor(namespace);
		debug.destroy = destroy;
		debug.extend = extend;

		// Env-specific initialization logic for debug instances
		if (typeof createDebug.init === 'function') {
			createDebug.init(debug);
		}

		createDebug.instances.push(debug);

		return debug;
	}

	function destroy() {
		var index = createDebug.instances.indexOf(this);
		if (index !== -1) {
			createDebug.instances.splice(index, 1);
			return true;
		}
		return false;
	}

	function extend(namespace, delimiter) {
		var newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);
		newDebug.log = this.log;
		return newDebug;
	}

	/**
 * Enables a debug mode by namespaces. This can include modes
 * separated by a colon and wildcards.
 *
 * @param {String} namespaces
 * @api public
 */
	function enable(namespaces) {
		createDebug.save(namespaces);

		createDebug.names = [];
		createDebug.skips = [];

		var i = void 0;
		var split = (typeof namespaces === 'string' ? namespaces : '').split(/[\s,]+/);
		var len = split.length;

		for (i = 0; i < len; i++) {
			if (!split[i]) {
				// ignore empty strings
				continue;
			}

			namespaces = split[i].replace(/\*/g, '.*?');

			if (namespaces[0] === '-') {
				createDebug.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));
			} else {
				createDebug.names.push(new RegExp('^' + namespaces + '$'));
			}
		}

		for (i = 0; i < createDebug.instances.length; i++) {
			var instance = createDebug.instances[i];
			instance.enabled = createDebug.enabled(instance.namespace);
		}
	}

	/**
 * Disable debug output.
 *
 * @return {String} namespaces
 * @api public
 */
	function disable() {
		var namespaces = [].concat((0, _toConsumableArray3.default)(createDebug.names.map(toNamespace)), (0, _toConsumableArray3.default)(createDebug.skips.map(toNamespace).map(function (namespace) {
			return '-' + namespace;
		}))).join(',');
		createDebug.enable('');
		return namespaces;
	}

	/**
 * Returns true if the given mode name is enabled, false otherwise.
 *
 * @param {String} name
 * @return {Boolean}
 * @api public
 */
	function enabled(name) {
		if (name[name.length - 1] === '*') {
			return true;
		}

		var i = void 0;
		var len = void 0;

		for (i = 0, len = createDebug.skips.length; i < len; i++) {
			if (createDebug.skips[i].test(name)) {
				return false;
			}
		}

		for (i = 0, len = createDebug.names.length; i < len; i++) {
			if (createDebug.names[i].test(name)) {
				return true;
			}
		}

		return false;
	}

	/**
 * Convert regexp to namespace
 *
 * @param {RegExp} regxep
 * @return {String} namespace
 * @api private
 */
	function toNamespace(regexp) {
		return regexp.toString().substring(2, regexp.toString().length - 2).replace(/\.\*\?$/, '*');
	}

	/**
 * Coerce `val`.
 *
 * @param {Mixed} val
 * @return {Mixed}
 * @api private
 */
	function coerce(val) {
		if (val instanceof Error) {
			return val.stack || val.message;
		}
		return val;
	}

	createDebug.enable(createDebug.load());

	return createDebug;
}

module.exports = setup;

/***/ }),

/***/ "./node_modules/debug/src/index.js":
/*!*****************************************!*\
  !*** ./node_modules/debug/src/index.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(process) {

/**
 * Detect Electron renderer / nwjs process, which is node, but we should
 * treat as a browser.
 */

if (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {
  module.exports = __webpack_require__(/*! ./browser.js */ "./node_modules/debug/src/browser.js");
} else {
  module.exports = __webpack_require__(/*! ./node.js */ "./node_modules/debug/src/node.js");
}
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/debug/src/node.js":
/*!****************************************!*\
  !*** ./node_modules/debug/src/node.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(process) {

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Module dependencies.
 */

var tty = __webpack_require__(/*! tty */ "./node_modules/tty-browserify/index.js");
var util = __webpack_require__(/*! util */ "./node_modules/util/util.js");

/**
 * This is the Node.js implementation of `debug()`.
 */

exports.init = init;
exports.log = log;
exports.formatArgs = formatArgs;
exports.save = save;
exports.load = load;
exports.useColors = useColors;

/**
 * Colors.
 */

exports.colors = [6, 2, 3, 4, 5, 1];

try {
	// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)
	// eslint-disable-next-line import/no-extraneous-dependencies
	var supportsColor = __webpack_require__(/*! supports-color */ "./node_modules/supports-color/browser.js");

	if (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {
		exports.colors = [20, 21, 26, 27, 32, 33, 38, 39, 40, 41, 42, 43, 44, 45, 56, 57, 62, 63, 68, 69, 74, 75, 76, 77, 78, 79, 80, 81, 92, 93, 98, 99, 112, 113, 128, 129, 134, 135, 148, 149, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 178, 179, 184, 185, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 214, 215, 220, 221];
	}
} catch (error) {}
// Swallow - we only care if `supports-color` is available; it doesn't have to be.


/**
 * Build up the default `inspectOpts` object from the environment variables.
 *
 *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js
 */

exports.inspectOpts = (0, _keys2.default)(process.env).filter(function (key) {
	return (/^debug_/i.test(key)
	);
}).reduce(function (obj, key) {
	// Camel-case
	var prop = key.substring(6).toLowerCase().replace(/_([a-z])/g, function (_, k) {
		return k.toUpperCase();
	});

	// Coerce string value into JS value
	var val = process.env[key];
	if (/^(yes|on|true|enabled)$/i.test(val)) {
		val = true;
	} else if (/^(no|off|false|disabled)$/i.test(val)) {
		val = false;
	} else if (val === 'null') {
		val = null;
	} else {
		val = Number(val);
	}

	obj[prop] = val;
	return obj;
}, {});

/**
 * Is stdout a TTY? Colored output is enabled when `true`.
 */

function useColors() {
	return 'colors' in exports.inspectOpts ? Boolean(exports.inspectOpts.colors) : tty.isatty(process.stderr.fd);
}

/**
 * Adds ANSI color escape codes if enabled.
 *
 * @api public
 */

function formatArgs(args) {
	var name = this.namespace,
	    useColors = this.useColors;


	if (useColors) {
		var c = this.color;
		var colorCode = '\x1B[3' + (c < 8 ? c : '8;5;' + c);
		var prefix = '  ' + colorCode + ';1m' + name + ' \x1B[0m';

		args[0] = prefix + args[0].split('\n').join('\n' + prefix);
		args.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\x1B[0m');
	} else {
		args[0] = getDate() + name + ' ' + args[0];
	}
}

function getDate() {
	if (exports.inspectOpts.hideDate) {
		return '';
	}
	return new Date().toISOString() + ' ';
}

/**
 * Invokes `util.format()` with the specified arguments and writes to stderr.
 */

function log() {
	return process.stderr.write(util.format.apply(util, arguments) + '\n');
}

/**
 * Save `namespaces`.
 *
 * @param {String} namespaces
 * @api private
 */
function save(namespaces) {
	if (namespaces) {
		process.env.DEBUG = namespaces;
	} else {
		// If you set a process.env field to null or undefined, it gets cast to the
		// string 'null' or 'undefined'. Just delete instead.
		delete process.env.DEBUG;
	}
}

/**
 * Load `namespaces`.
 *
 * @return {String} returns the previously persisted debug modes
 * @api private
 */

function load() {
	return process.env.DEBUG;
}

/**
 * Init logic for `debug` instances.
 *
 * Create a new `inspectOpts` object in case `useColors` is set
 * differently for a particular `debug` instance.
 */

function init(debug) {
	debug.inspectOpts = {};

	var keys = (0, _keys2.default)(exports.inspectOpts);
	for (var i = 0; i < keys.length; i++) {
		debug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];
	}
}

module.exports = __webpack_require__(/*! ./common */ "./node_modules/debug/src/common.js")(exports);

var formatters = module.exports.formatters;

/**
 * Map %o to `util.inspect()`, all on a single line.
 */

formatters.o = function (v) {
	this.inspectOpts.colors = this.useColors;
	return util.inspect(v, this.inspectOpts).replace(/\s*\n\s*/g, ' ');
};

/**
 * Map %O to `util.inspect()`, allowing multiple lines if needed.
 */

formatters.O = function (v) {
	this.inspectOpts.colors = this.useColors;
	return util.inspect(v, this.inspectOpts);
};
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/eventemitter3/umd/eventemitter3.min.js":
/*!*************************************************************!*\
  !*** ./node_modules/eventemitter3/umd/eventemitter3.min.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=e()}(function(){return function i(s,f,c){function u(t,e){if(!f[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(a)return a(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=f[t]={exports:{}};s[t][0].call(o.exports,function(e){return u(s[t][1][e]||e)},o,o.exports,i,s,f,c)}return f[t].exports}for(var a="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,v="~";function o(){}function f(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new f(n,r||e,o),s=v?v+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],i]:e._events[s].push(i):(e._events[s]=i,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(v=!1)),s.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(v?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e){var t=v?v+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},s.prototype.listenerCount=function(e){var t=v?v+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,r,o,i){var s=v?v+e:e;if(!this._events[s])return!1;var f,c=this._events[s],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,i),!0}for(p=1,f=new Array(u-1);p<u;p++)f[p-1]=arguments[p];c.fn.apply(c.context,f)}else for(var a,l=c.length,p=0;p<l;p++)switch(c[p].once&&this.removeListener(e,c[p].fn,void 0,!0),u){case 1:c[p].fn.call(c[p].context);break;case 2:c[p].fn.call(c[p].context,t);break;case 3:c[p].fn.call(c[p].context,t,n);break;case 4:c[p].fn.call(c[p].context,t,n,r);break;default:if(!f)for(a=1,f=new Array(u-1);a<u;a++)f[a-1]=arguments[a];c[p].fn.apply(c[p].context,f)}return!0},s.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,n,r){var o=v?v+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var i=this._events[o];if(i.fn)i.fn!==t||r&&!i.once||n&&i.context!==n||u(this,o);else{for(var s=0,f=[],c=i.length;s<c;s++)(i[s].fn!==t||r&&!i[s].once||n&&i[s].context!==n)&&f.push(i[s]);f.length?this._events[o]=1===f.length?f[0]:f:u(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=v?v+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=v,s.EventEmitter=s,void 0!==t&&(t.exports=s)},{}]},{},[1])(1)});

/***/ }),

/***/ "./node_modules/inherits/inherits_browser.js":
/*!***************************************************!*\
  !*** ./node_modules/inherits/inherits_browser.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

if (typeof Object.create === 'function') {
  // implementation from standard node.js 'util' module
  module.exports = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor
    ctor.prototype = Object.create(superCtor.prototype, {
      constructor: {
        value: ctor,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
  };
} else {
  // old school shim for old browsers
  module.exports = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor
    var TempCtor = function () {}
    TempCtor.prototype = superCtor.prototype
    ctor.prototype = new TempCtor()
    ctor.prototype.constructor = ctor
  }
}


/***/ }),

/***/ "./node_modules/is-base64/is-base64.js":
/*!*********************************************!*\
  !*** ./node_modules/is-base64/is-base64.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

;(function(root) {
  'use strict';

  function isBase64(v, opts) {
    if (v instanceof Boolean || typeof v === 'boolean') {
      return false
    }

    if (!(opts instanceof Object)) {
      opts = {}
    }

    if (opts.allowEmpty === false && v === '') {
      return false
    }

    var regex = '(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\/]{3}=)?'
    var mimeRegex = '(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)'

    if (opts.mimeRequired === true) {
      regex =  mimeRegex + regex
    } else if (opts.allowMime === true) {
      regex = mimeRegex + '?' + regex
    }

    if (opts.paddingRequired === false) {
      regex = '(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?'
    }

    return (new RegExp('^' + regex + '$', 'gi')).test(v)
  }

  if (true) {
    if ( true && module.exports) {
      exports = module.exports = isBase64
    }
    exports.isBase64 = isBase64
  } else {}
})(this);


/***/ }),

/***/ "./node_modules/lodash.clonedeep/index.js":
/*!************************************************!*\
  !*** ./node_modules/lodash.clonedeep/index.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(global, module) {/**
 * lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="npm" -o ./`
 * Copyright jQuery Foundation and other contributors <https://jquery.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */

/** Used as the size to enable large array optimizations. */
var LARGE_ARRAY_SIZE = 200;

/** Used to stand-in for `undefined` hash values. */
var HASH_UNDEFINED = '__lodash_hash_undefined__';

/** Used as references for various `Number` constants. */
var MAX_SAFE_INTEGER = 9007199254740991;

/** `Object#toString` result references. */
var argsTag = '[object Arguments]',
    arrayTag = '[object Array]',
    boolTag = '[object Boolean]',
    dateTag = '[object Date]',
    errorTag = '[object Error]',
    funcTag = '[object Function]',
    genTag = '[object GeneratorFunction]',
    mapTag = '[object Map]',
    numberTag = '[object Number]',
    objectTag = '[object Object]',
    promiseTag = '[object Promise]',
    regexpTag = '[object RegExp]',
    setTag = '[object Set]',
    stringTag = '[object String]',
    symbolTag = '[object Symbol]',
    weakMapTag = '[object WeakMap]';

var arrayBufferTag = '[object ArrayBuffer]',
    dataViewTag = '[object DataView]',
    float32Tag = '[object Float32Array]',
    float64Tag = '[object Float64Array]',
    int8Tag = '[object Int8Array]',
    int16Tag = '[object Int16Array]',
    int32Tag = '[object Int32Array]',
    uint8Tag = '[object Uint8Array]',
    uint8ClampedTag = '[object Uint8ClampedArray]',
    uint16Tag = '[object Uint16Array]',
    uint32Tag = '[object Uint32Array]';

/**
 * Used to match `RegExp`
 * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
 */
var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;

/** Used to match `RegExp` flags from their coerced string values. */
var reFlags = /\w*$/;

/** Used to detect host constructors (Safari). */
var reIsHostCtor = /^\[object .+?Constructor\]$/;

/** Used to detect unsigned integer values. */
var reIsUint = /^(?:0|[1-9]\d*)$/;

/** Used to identify `toStringTag` values supported by `_.clone`. */
var cloneableTags = {};
cloneableTags[argsTag] = cloneableTags[arrayTag] =
cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =
cloneableTags[boolTag] = cloneableTags[dateTag] =
cloneableTags[float32Tag] = cloneableTags[float64Tag] =
cloneableTags[int8Tag] = cloneableTags[int16Tag] =
cloneableTags[int32Tag] = cloneableTags[mapTag] =
cloneableTags[numberTag] = cloneableTags[objectTag] =
cloneableTags[regexpTag] = cloneableTags[setTag] =
cloneableTags[stringTag] = cloneableTags[symbolTag] =
cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =
cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
cloneableTags[errorTag] = cloneableTags[funcTag] =
cloneableTags[weakMapTag] = false;

/** Detect free variable `global` from Node.js. */
var freeGlobal = typeof global == 'object' && global && global.Object === Object && global;

/** Detect free variable `self`. */
var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

/** Used as a reference to the global object. */
var root = freeGlobal || freeSelf || Function('return this')();

/** Detect free variable `exports`. */
var freeExports =  true && exports && !exports.nodeType && exports;

/** Detect free variable `module`. */
var freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;

/** Detect the popular CommonJS extension `module.exports`. */
var moduleExports = freeModule && freeModule.exports === freeExports;

/**
 * Adds the key-value `pair` to `map`.
 *
 * @private
 * @param {Object} map The map to modify.
 * @param {Array} pair The key-value pair to add.
 * @returns {Object} Returns `map`.
 */
function addMapEntry(map, pair) {
  // Don't return `map.set` because it's not chainable in IE 11.
  map.set(pair[0], pair[1]);
  return map;
}

/**
 * Adds `value` to `set`.
 *
 * @private
 * @param {Object} set The set to modify.
 * @param {*} value The value to add.
 * @returns {Object} Returns `set`.
 */
function addSetEntry(set, value) {
  // Don't return `set.add` because it's not chainable in IE 11.
  set.add(value);
  return set;
}

/**
 * A specialized version of `_.forEach` for arrays without support for
 * iteratee shorthands.
 *
 * @private
 * @param {Array} [array] The array to iterate over.
 * @param {Function} iteratee The function invoked per iteration.
 * @returns {Array} Returns `array`.
 */
function arrayEach(array, iteratee) {
  var index = -1,
      length = array ? array.length : 0;

  while (++index < length) {
    if (iteratee(array[index], index, array) === false) {
      break;
    }
  }
  return array;
}

/**
 * Appends the elements of `values` to `array`.
 *
 * @private
 * @param {Array} array The array to modify.
 * @param {Array} values The values to append.
 * @returns {Array} Returns `array`.
 */
function arrayPush(array, values) {
  var index = -1,
      length = values.length,
      offset = array.length;

  while (++index < length) {
    array[offset + index] = values[index];
  }
  return array;
}

/**
 * A specialized version of `_.reduce` for arrays without support for
 * iteratee shorthands.
 *
 * @private
 * @param {Array} [array] The array to iterate over.
 * @param {Function} iteratee The function invoked per iteration.
 * @param {*} [accumulator] The initial value.
 * @param {boolean} [initAccum] Specify using the first element of `array` as
 *  the initial value.
 * @returns {*} Returns the accumulated value.
 */
function arrayReduce(array, iteratee, accumulator, initAccum) {
  var index = -1,
      length = array ? array.length : 0;

  if (initAccum && length) {
    accumulator = array[++index];
  }
  while (++index < length) {
    accumulator = iteratee(accumulator, array[index], index, array);
  }
  return accumulator;
}

/**
 * The base implementation of `_.times` without support for iteratee shorthands
 * or max array length checks.
 *
 * @private
 * @param {number} n The number of times to invoke `iteratee`.
 * @param {Function} iteratee The function invoked per iteration.
 * @returns {Array} Returns the array of results.
 */
function baseTimes(n, iteratee) {
  var index = -1,
      result = Array(n);

  while (++index < n) {
    result[index] = iteratee(index);
  }
  return result;
}

/**
 * Gets the value at `key` of `object`.
 *
 * @private
 * @param {Object} [object] The object to query.
 * @param {string} key The key of the property to get.
 * @returns {*} Returns the property value.
 */
function getValue(object, key) {
  return object == null ? undefined : object[key];
}

/**
 * Checks if `value` is a host object in IE < 9.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
 */
function isHostObject(value) {
  // Many host objects are `Object` objects that can coerce to strings
  // despite having improperly defined `toString` methods.
  var result = false;
  if (value != null && typeof value.toString != 'function') {
    try {
      result = !!(value + '');
    } catch (e) {}
  }
  return result;
}

/**
 * Converts `map` to its key-value pairs.
 *
 * @private
 * @param {Object} map The map to convert.
 * @returns {Array} Returns the key-value pairs.
 */
function mapToArray(map) {
  var index = -1,
      result = Array(map.size);

  map.forEach(function(value, key) {
    result[++index] = [key, value];
  });
  return result;
}

/**
 * Creates a unary function that invokes `func` with its argument transformed.
 *
 * @private
 * @param {Function} func The function to wrap.
 * @param {Function} transform The argument transform.
 * @returns {Function} Returns the new function.
 */
function overArg(func, transform) {
  return function(arg) {
    return func(transform(arg));
  };
}

/**
 * Converts `set` to an array of its values.
 *
 * @private
 * @param {Object} set The set to convert.
 * @returns {Array} Returns the values.
 */
function setToArray(set) {
  var index = -1,
      result = Array(set.size);

  set.forEach(function(value) {
    result[++index] = value;
  });
  return result;
}

/** Used for built-in method references. */
var arrayProto = Array.prototype,
    funcProto = Function.prototype,
    objectProto = Object.prototype;

/** Used to detect overreaching core-js shims. */
var coreJsData = root['__core-js_shared__'];

/** Used to detect methods masquerading as native. */
var maskSrcKey = (function() {
  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
  return uid ? ('Symbol(src)_1.' + uid) : '';
}());

/** Used to resolve the decompiled source of functions. */
var funcToString = funcProto.toString;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * Used to resolve the
 * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
 * of values.
 */
var objectToString = objectProto.toString;

/** Used to detect if a method is native. */
var reIsNative = RegExp('^' +
  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
  .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
);

/** Built-in value references. */
var Buffer = moduleExports ? root.Buffer : undefined,
    Symbol = root.Symbol,
    Uint8Array = root.Uint8Array,
    getPrototype = overArg(Object.getPrototypeOf, Object),
    objectCreate = Object.create,
    propertyIsEnumerable = objectProto.propertyIsEnumerable,
    splice = arrayProto.splice;

/* Built-in method references for those with the same name as other `lodash` methods. */
var nativeGetSymbols = Object.getOwnPropertySymbols,
    nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,
    nativeKeys = overArg(Object.keys, Object);

/* Built-in method references that are verified to be native. */
var DataView = getNative(root, 'DataView'),
    Map = getNative(root, 'Map'),
    Promise = getNative(root, 'Promise'),
    Set = getNative(root, 'Set'),
    WeakMap = getNative(root, 'WeakMap'),
    nativeCreate = getNative(Object, 'create');

/** Used to detect maps, sets, and weakmaps. */
var dataViewCtorString = toSource(DataView),
    mapCtorString = toSource(Map),
    promiseCtorString = toSource(Promise),
    setCtorString = toSource(Set),
    weakMapCtorString = toSource(WeakMap);

/** Used to convert symbols to primitives and strings. */
var symbolProto = Symbol ? Symbol.prototype : undefined,
    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;

/**
 * Creates a hash object.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function Hash(entries) {
  var index = -1,
      length = entries ? entries.length : 0;

  this.clear();
  while (++index < length) {
    var entry = entries[index];
    this.set(entry[0], entry[1]);
  }
}

/**
 * Removes all key-value entries from the hash.
 *
 * @private
 * @name clear
 * @memberOf Hash
 */
function hashClear() {
  this.__data__ = nativeCreate ? nativeCreate(null) : {};
}

/**
 * Removes `key` and its value from the hash.
 *
 * @private
 * @name delete
 * @memberOf Hash
 * @param {Object} hash The hash to modify.
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function hashDelete(key) {
  return this.has(key) && delete this.__data__[key];
}

/**
 * Gets the hash value for `key`.
 *
 * @private
 * @name get
 * @memberOf Hash
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function hashGet(key) {
  var data = this.__data__;
  if (nativeCreate) {
    var result = data[key];
    return result === HASH_UNDEFINED ? undefined : result;
  }
  return hasOwnProperty.call(data, key) ? data[key] : undefined;
}

/**
 * Checks if a hash value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf Hash
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function hashHas(key) {
  var data = this.__data__;
  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);
}

/**
 * Sets the hash `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf Hash
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the hash instance.
 */
function hashSet(key, value) {
  var data = this.__data__;
  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
  return this;
}

// Add methods to `Hash`.
Hash.prototype.clear = hashClear;
Hash.prototype['delete'] = hashDelete;
Hash.prototype.get = hashGet;
Hash.prototype.has = hashHas;
Hash.prototype.set = hashSet;

/**
 * Creates an list cache object.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function ListCache(entries) {
  var index = -1,
      length = entries ? entries.length : 0;

  this.clear();
  while (++index < length) {
    var entry = entries[index];
    this.set(entry[0], entry[1]);
  }
}

/**
 * Removes all key-value entries from the list cache.
 *
 * @private
 * @name clear
 * @memberOf ListCache
 */
function listCacheClear() {
  this.__data__ = [];
}

/**
 * Removes `key` and its value from the list cache.
 *
 * @private
 * @name delete
 * @memberOf ListCache
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function listCacheDelete(key) {
  var data = this.__data__,
      index = assocIndexOf(data, key);

  if (index < 0) {
    return false;
  }
  var lastIndex = data.length - 1;
  if (index == lastIndex) {
    data.pop();
  } else {
    splice.call(data, index, 1);
  }
  return true;
}

/**
 * Gets the list cache value for `key`.
 *
 * @private
 * @name get
 * @memberOf ListCache
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function listCacheGet(key) {
  var data = this.__data__,
      index = assocIndexOf(data, key);

  return index < 0 ? undefined : data[index][1];
}

/**
 * Checks if a list cache value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf ListCache
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function listCacheHas(key) {
  return assocIndexOf(this.__data__, key) > -1;
}

/**
 * Sets the list cache `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf ListCache
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the list cache instance.
 */
function listCacheSet(key, value) {
  var data = this.__data__,
      index = assocIndexOf(data, key);

  if (index < 0) {
    data.push([key, value]);
  } else {
    data[index][1] = value;
  }
  return this;
}

// Add methods to `ListCache`.
ListCache.prototype.clear = listCacheClear;
ListCache.prototype['delete'] = listCacheDelete;
ListCache.prototype.get = listCacheGet;
ListCache.prototype.has = listCacheHas;
ListCache.prototype.set = listCacheSet;

/**
 * Creates a map cache object to store key-value pairs.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function MapCache(entries) {
  var index = -1,
      length = entries ? entries.length : 0;

  this.clear();
  while (++index < length) {
    var entry = entries[index];
    this.set(entry[0], entry[1]);
  }
}

/**
 * Removes all key-value entries from the map.
 *
 * @private
 * @name clear
 * @memberOf MapCache
 */
function mapCacheClear() {
  this.__data__ = {
    'hash': new Hash,
    'map': new (Map || ListCache),
    'string': new Hash
  };
}

/**
 * Removes `key` and its value from the map.
 *
 * @private
 * @name delete
 * @memberOf MapCache
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function mapCacheDelete(key) {
  return getMapData(this, key)['delete'](key);
}

/**
 * Gets the map value for `key`.
 *
 * @private
 * @name get
 * @memberOf MapCache
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function mapCacheGet(key) {
  return getMapData(this, key).get(key);
}

/**
 * Checks if a map value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf MapCache
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function mapCacheHas(key) {
  return getMapData(this, key).has(key);
}

/**
 * Sets the map `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf MapCache
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the map cache instance.
 */
function mapCacheSet(key, value) {
  getMapData(this, key).set(key, value);
  return this;
}

// Add methods to `MapCache`.
MapCache.prototype.clear = mapCacheClear;
MapCache.prototype['delete'] = mapCacheDelete;
MapCache.prototype.get = mapCacheGet;
MapCache.prototype.has = mapCacheHas;
MapCache.prototype.set = mapCacheSet;

/**
 * Creates a stack cache object to store key-value pairs.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function Stack(entries) {
  this.__data__ = new ListCache(entries);
}

/**
 * Removes all key-value entries from the stack.
 *
 * @private
 * @name clear
 * @memberOf Stack
 */
function stackClear() {
  this.__data__ = new ListCache;
}

/**
 * Removes `key` and its value from the stack.
 *
 * @private
 * @name delete
 * @memberOf Stack
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function stackDelete(key) {
  return this.__data__['delete'](key);
}

/**
 * Gets the stack value for `key`.
 *
 * @private
 * @name get
 * @memberOf Stack
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function stackGet(key) {
  return this.__data__.get(key);
}

/**
 * Checks if a stack value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf Stack
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function stackHas(key) {
  return this.__data__.has(key);
}

/**
 * Sets the stack `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf Stack
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the stack cache instance.
 */
function stackSet(key, value) {
  var cache = this.__data__;
  if (cache instanceof ListCache) {
    var pairs = cache.__data__;
    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
      pairs.push([key, value]);
      return this;
    }
    cache = this.__data__ = new MapCache(pairs);
  }
  cache.set(key, value);
  return this;
}

// Add methods to `Stack`.
Stack.prototype.clear = stackClear;
Stack.prototype['delete'] = stackDelete;
Stack.prototype.get = stackGet;
Stack.prototype.has = stackHas;
Stack.prototype.set = stackSet;

/**
 * Creates an array of the enumerable property names of the array-like `value`.
 *
 * @private
 * @param {*} value The value to query.
 * @param {boolean} inherited Specify returning inherited property names.
 * @returns {Array} Returns the array of property names.
 */
function arrayLikeKeys(value, inherited) {
  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
  // Safari 9 makes `arguments.length` enumerable in strict mode.
  var result = (isArray(value) || isArguments(value))
    ? baseTimes(value.length, String)
    : [];

  var length = result.length,
      skipIndexes = !!length;

  for (var key in value) {
    if ((inherited || hasOwnProperty.call(value, key)) &&
        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {
      result.push(key);
    }
  }
  return result;
}

/**
 * Assigns `value` to `key` of `object` if the existing value is not equivalent
 * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
 * for equality comparisons.
 *
 * @private
 * @param {Object} object The object to modify.
 * @param {string} key The key of the property to assign.
 * @param {*} value The value to assign.
 */
function assignValue(object, key, value) {
  var objValue = object[key];
  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||
      (value === undefined && !(key in object))) {
    object[key] = value;
  }
}

/**
 * Gets the index at which the `key` is found in `array` of key-value pairs.
 *
 * @private
 * @param {Array} array The array to inspect.
 * @param {*} key The key to search for.
 * @returns {number} Returns the index of the matched value, else `-1`.
 */
function assocIndexOf(array, key) {
  var length = array.length;
  while (length--) {
    if (eq(array[length][0], key)) {
      return length;
    }
  }
  return -1;
}

/**
 * The base implementation of `_.assign` without support for multiple sources
 * or `customizer` functions.
 *
 * @private
 * @param {Object} object The destination object.
 * @param {Object} source The source object.
 * @returns {Object} Returns `object`.
 */
function baseAssign(object, source) {
  return object && copyObject(source, keys(source), object);
}

/**
 * The base implementation of `_.clone` and `_.cloneDeep` which tracks
 * traversed objects.
 *
 * @private
 * @param {*} value The value to clone.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @param {boolean} [isFull] Specify a clone including symbols.
 * @param {Function} [customizer] The function to customize cloning.
 * @param {string} [key] The key of `value`.
 * @param {Object} [object] The parent object of `value`.
 * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
 * @returns {*} Returns the cloned value.
 */
function baseClone(value, isDeep, isFull, customizer, key, object, stack) {
  var result;
  if (customizer) {
    result = object ? customizer(value, key, object, stack) : customizer(value);
  }
  if (result !== undefined) {
    return result;
  }
  if (!isObject(value)) {
    return value;
  }
  var isArr = isArray(value);
  if (isArr) {
    result = initCloneArray(value);
    if (!isDeep) {
      return copyArray(value, result);
    }
  } else {
    var tag = getTag(value),
        isFunc = tag == funcTag || tag == genTag;

    if (isBuffer(value)) {
      return cloneBuffer(value, isDeep);
    }
    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {
      if (isHostObject(value)) {
        return object ? value : {};
      }
      result = initCloneObject(isFunc ? {} : value);
      if (!isDeep) {
        return copySymbols(value, baseAssign(result, value));
      }
    } else {
      if (!cloneableTags[tag]) {
        return object ? value : {};
      }
      result = initCloneByTag(value, tag, baseClone, isDeep);
    }
  }
  // Check for circular references and return its corresponding clone.
  stack || (stack = new Stack);
  var stacked = stack.get(value);
  if (stacked) {
    return stacked;
  }
  stack.set(value, result);

  if (!isArr) {
    var props = isFull ? getAllKeys(value) : keys(value);
  }
  arrayEach(props || value, function(subValue, key) {
    if (props) {
      key = subValue;
      subValue = value[key];
    }
    // Recursively populate clone (susceptible to call stack limits).
    assignValue(result, key, baseClone(subValue, isDeep, isFull, customizer, key, value, stack));
  });
  return result;
}

/**
 * The base implementation of `_.create` without support for assigning
 * properties to the created object.
 *
 * @private
 * @param {Object} prototype The object to inherit from.
 * @returns {Object} Returns the new object.
 */
function baseCreate(proto) {
  return isObject(proto) ? objectCreate(proto) : {};
}

/**
 * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
 * `keysFunc` and `symbolsFunc` to get the enumerable property names and
 * symbols of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @param {Function} keysFunc The function to get the keys of `object`.
 * @param {Function} symbolsFunc The function to get the symbols of `object`.
 * @returns {Array} Returns the array of property names and symbols.
 */
function baseGetAllKeys(object, keysFunc, symbolsFunc) {
  var result = keysFunc(object);
  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));
}

/**
 * The base implementation of `getTag`.
 *
 * @private
 * @param {*} value The value to query.
 * @returns {string} Returns the `toStringTag`.
 */
function baseGetTag(value) {
  return objectToString.call(value);
}

/**
 * The base implementation of `_.isNative` without bad shim checks.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a native function,
 *  else `false`.
 */
function baseIsNative(value) {
  if (!isObject(value) || isMasked(value)) {
    return false;
  }
  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;
  return pattern.test(toSource(value));
}

/**
 * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of property names.
 */
function baseKeys(object) {
  if (!isPrototype(object)) {
    return nativeKeys(object);
  }
  var result = [];
  for (var key in Object(object)) {
    if (hasOwnProperty.call(object, key) && key != 'constructor') {
      result.push(key);
    }
  }
  return result;
}

/**
 * Creates a clone of  `buffer`.
 *
 * @private
 * @param {Buffer} buffer The buffer to clone.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @returns {Buffer} Returns the cloned buffer.
 */
function cloneBuffer(buffer, isDeep) {
  if (isDeep) {
    return buffer.slice();
  }
  var result = new buffer.constructor(buffer.length);
  buffer.copy(result);
  return result;
}

/**
 * Creates a clone of `arrayBuffer`.
 *
 * @private
 * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
 * @returns {ArrayBuffer} Returns the cloned array buffer.
 */
function cloneArrayBuffer(arrayBuffer) {
  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
  new Uint8Array(result).set(new Uint8Array(arrayBuffer));
  return result;
}

/**
 * Creates a clone of `dataView`.
 *
 * @private
 * @param {Object} dataView The data view to clone.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @returns {Object} Returns the cloned data view.
 */
function cloneDataView(dataView, isDeep) {
  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;
  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);
}

/**
 * Creates a clone of `map`.
 *
 * @private
 * @param {Object} map The map to clone.
 * @param {Function} cloneFunc The function to clone values.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @returns {Object} Returns the cloned map.
 */
function cloneMap(map, isDeep, cloneFunc) {
  var array = isDeep ? cloneFunc(mapToArray(map), true) : mapToArray(map);
  return arrayReduce(array, addMapEntry, new map.constructor);
}

/**
 * Creates a clone of `regexp`.
 *
 * @private
 * @param {Object} regexp The regexp to clone.
 * @returns {Object} Returns the cloned regexp.
 */
function cloneRegExp(regexp) {
  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
  result.lastIndex = regexp.lastIndex;
  return result;
}

/**
 * Creates a clone of `set`.
 *
 * @private
 * @param {Object} set The set to clone.
 * @param {Function} cloneFunc The function to clone values.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @returns {Object} Returns the cloned set.
 */
function cloneSet(set, isDeep, cloneFunc) {
  var array = isDeep ? cloneFunc(setToArray(set), true) : setToArray(set);
  return arrayReduce(array, addSetEntry, new set.constructor);
}

/**
 * Creates a clone of the `symbol` object.
 *
 * @private
 * @param {Object} symbol The symbol object to clone.
 * @returns {Object} Returns the cloned symbol object.
 */
function cloneSymbol(symbol) {
  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};
}

/**
 * Creates a clone of `typedArray`.
 *
 * @private
 * @param {Object} typedArray The typed array to clone.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @returns {Object} Returns the cloned typed array.
 */
function cloneTypedArray(typedArray, isDeep) {
  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);
}

/**
 * Copies the values of `source` to `array`.
 *
 * @private
 * @param {Array} source The array to copy values from.
 * @param {Array} [array=[]] The array to copy values to.
 * @returns {Array} Returns `array`.
 */
function copyArray(source, array) {
  var index = -1,
      length = source.length;

  array || (array = Array(length));
  while (++index < length) {
    array[index] = source[index];
  }
  return array;
}

/**
 * Copies properties of `source` to `object`.
 *
 * @private
 * @param {Object} source The object to copy properties from.
 * @param {Array} props The property identifiers to copy.
 * @param {Object} [object={}] The object to copy properties to.
 * @param {Function} [customizer] The function to customize copied values.
 * @returns {Object} Returns `object`.
 */
function copyObject(source, props, object, customizer) {
  object || (object = {});

  var index = -1,
      length = props.length;

  while (++index < length) {
    var key = props[index];

    var newValue = customizer
      ? customizer(object[key], source[key], key, object, source)
      : undefined;

    assignValue(object, key, newValue === undefined ? source[key] : newValue);
  }
  return object;
}

/**
 * Copies own symbol properties of `source` to `object`.
 *
 * @private
 * @param {Object} source The object to copy symbols from.
 * @param {Object} [object={}] The object to copy symbols to.
 * @returns {Object} Returns `object`.
 */
function copySymbols(source, object) {
  return copyObject(source, getSymbols(source), object);
}

/**
 * Creates an array of own enumerable property names and symbols of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of property names and symbols.
 */
function getAllKeys(object) {
  return baseGetAllKeys(object, keys, getSymbols);
}

/**
 * Gets the data for `map`.
 *
 * @private
 * @param {Object} map The map to query.
 * @param {string} key The reference key.
 * @returns {*} Returns the map data.
 */
function getMapData(map, key) {
  var data = map.__data__;
  return isKeyable(key)
    ? data[typeof key == 'string' ? 'string' : 'hash']
    : data.map;
}

/**
 * Gets the native function at `key` of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @param {string} key The key of the method to get.
 * @returns {*} Returns the function if it's native, else `undefined`.
 */
function getNative(object, key) {
  var value = getValue(object, key);
  return baseIsNative(value) ? value : undefined;
}

/**
 * Creates an array of the own enumerable symbol properties of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of symbols.
 */
var getSymbols = nativeGetSymbols ? overArg(nativeGetSymbols, Object) : stubArray;

/**
 * Gets the `toStringTag` of `value`.
 *
 * @private
 * @param {*} value The value to query.
 * @returns {string} Returns the `toStringTag`.
 */
var getTag = baseGetTag;

// Fallback for data views, maps, sets, and weak maps in IE 11,
// for data views in Edge < 14, and promises in Node.js.
if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
    (Map && getTag(new Map) != mapTag) ||
    (Promise && getTag(Promise.resolve()) != promiseTag) ||
    (Set && getTag(new Set) != setTag) ||
    (WeakMap && getTag(new WeakMap) != weakMapTag)) {
  getTag = function(value) {
    var result = objectToString.call(value),
        Ctor = result == objectTag ? value.constructor : undefined,
        ctorString = Ctor ? toSource(Ctor) : undefined;

    if (ctorString) {
      switch (ctorString) {
        case dataViewCtorString: return dataViewTag;
        case mapCtorString: return mapTag;
        case promiseCtorString: return promiseTag;
        case setCtorString: return setTag;
        case weakMapCtorString: return weakMapTag;
      }
    }
    return result;
  };
}

/**
 * Initializes an array clone.
 *
 * @private
 * @param {Array} array The array to clone.
 * @returns {Array} Returns the initialized clone.
 */
function initCloneArray(array) {
  var length = array.length,
      result = array.constructor(length);

  // Add properties assigned by `RegExp#exec`.
  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {
    result.index = array.index;
    result.input = array.input;
  }
  return result;
}

/**
 * Initializes an object clone.
 *
 * @private
 * @param {Object} object The object to clone.
 * @returns {Object} Returns the initialized clone.
 */
function initCloneObject(object) {
  return (typeof object.constructor == 'function' && !isPrototype(object))
    ? baseCreate(getPrototype(object))
    : {};
}

/**
 * Initializes an object clone based on its `toStringTag`.
 *
 * **Note:** This function only supports cloning values with tags of
 * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
 *
 * @private
 * @param {Object} object The object to clone.
 * @param {string} tag The `toStringTag` of the object to clone.
 * @param {Function} cloneFunc The function to clone values.
 * @param {boolean} [isDeep] Specify a deep clone.
 * @returns {Object} Returns the initialized clone.
 */
function initCloneByTag(object, tag, cloneFunc, isDeep) {
  var Ctor = object.constructor;
  switch (tag) {
    case arrayBufferTag:
      return cloneArrayBuffer(object);

    case boolTag:
    case dateTag:
      return new Ctor(+object);

    case dataViewTag:
      return cloneDataView(object, isDeep);

    case float32Tag: case float64Tag:
    case int8Tag: case int16Tag: case int32Tag:
    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:
      return cloneTypedArray(object, isDeep);

    case mapTag:
      return cloneMap(object, isDeep, cloneFunc);

    case numberTag:
    case stringTag:
      return new Ctor(object);

    case regexpTag:
      return cloneRegExp(object);

    case setTag:
      return cloneSet(object, isDeep, cloneFunc);

    case symbolTag:
      return cloneSymbol(object);
  }
}

/**
 * Checks if `value` is a valid array-like index.
 *
 * @private
 * @param {*} value The value to check.
 * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
 * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
 */
function isIndex(value, length) {
  length = length == null ? MAX_SAFE_INTEGER : length;
  return !!length &&
    (typeof value == 'number' || reIsUint.test(value)) &&
    (value > -1 && value % 1 == 0 && value < length);
}

/**
 * Checks if `value` is suitable for use as unique object key.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
 */
function isKeyable(value) {
  var type = typeof value;
  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
    ? (value !== '__proto__')
    : (value === null);
}

/**
 * Checks if `func` has its source masked.
 *
 * @private
 * @param {Function} func The function to check.
 * @returns {boolean} Returns `true` if `func` is masked, else `false`.
 */
function isMasked(func) {
  return !!maskSrcKey && (maskSrcKey in func);
}

/**
 * Checks if `value` is likely a prototype object.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
 */
function isPrototype(value) {
  var Ctor = value && value.constructor,
      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

  return value === proto;
}

/**
 * Converts `func` to its source code.
 *
 * @private
 * @param {Function} func The function to process.
 * @returns {string} Returns the source code.
 */
function toSource(func) {
  if (func != null) {
    try {
      return funcToString.call(func);
    } catch (e) {}
    try {
      return (func + '');
    } catch (e) {}
  }
  return '';
}

/**
 * This method is like `_.clone` except that it recursively clones `value`.
 *
 * @static
 * @memberOf _
 * @since 1.0.0
 * @category Lang
 * @param {*} value The value to recursively clone.
 * @returns {*} Returns the deep cloned value.
 * @see _.clone
 * @example
 *
 * var objects = [{ 'a': 1 }, { 'b': 2 }];
 *
 * var deep = _.cloneDeep(objects);
 * console.log(deep[0] === objects[0]);
 * // => false
 */
function cloneDeep(value) {
  return baseClone(value, true, true);
}

/**
 * Performs a
 * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
 * comparison between two values to determine if they are equivalent.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to compare.
 * @param {*} other The other value to compare.
 * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
 * @example
 *
 * var object = { 'a': 1 };
 * var other = { 'a': 1 };
 *
 * _.eq(object, object);
 * // => true
 *
 * _.eq(object, other);
 * // => false
 *
 * _.eq('a', 'a');
 * // => true
 *
 * _.eq('a', Object('a'));
 * // => false
 *
 * _.eq(NaN, NaN);
 * // => true
 */
function eq(value, other) {
  return value === other || (value !== value && other !== other);
}

/**
 * Checks if `value` is likely an `arguments` object.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an `arguments` object,
 *  else `false`.
 * @example
 *
 * _.isArguments(function() { return arguments; }());
 * // => true
 *
 * _.isArguments([1, 2, 3]);
 * // => false
 */
function isArguments(value) {
  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&
    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);
}

/**
 * Checks if `value` is classified as an `Array` object.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an array, else `false`.
 * @example
 *
 * _.isArray([1, 2, 3]);
 * // => true
 *
 * _.isArray(document.body.children);
 * // => false
 *
 * _.isArray('abc');
 * // => false
 *
 * _.isArray(_.noop);
 * // => false
 */
var isArray = Array.isArray;

/**
 * Checks if `value` is array-like. A value is considered array-like if it's
 * not a function and has a `value.length` that's an integer greater than or
 * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
 * @example
 *
 * _.isArrayLike([1, 2, 3]);
 * // => true
 *
 * _.isArrayLike(document.body.children);
 * // => true
 *
 * _.isArrayLike('abc');
 * // => true
 *
 * _.isArrayLike(_.noop);
 * // => false
 */
function isArrayLike(value) {
  return value != null && isLength(value.length) && !isFunction(value);
}

/**
 * This method is like `_.isArrayLike` except that it also checks if `value`
 * is an object.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an array-like object,
 *  else `false`.
 * @example
 *
 * _.isArrayLikeObject([1, 2, 3]);
 * // => true
 *
 * _.isArrayLikeObject(document.body.children);
 * // => true
 *
 * _.isArrayLikeObject('abc');
 * // => false
 *
 * _.isArrayLikeObject(_.noop);
 * // => false
 */
function isArrayLikeObject(value) {
  return isObjectLike(value) && isArrayLike(value);
}

/**
 * Checks if `value` is a buffer.
 *
 * @static
 * @memberOf _
 * @since 4.3.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
 * @example
 *
 * _.isBuffer(new Buffer(2));
 * // => true
 *
 * _.isBuffer(new Uint8Array(2));
 * // => false
 */
var isBuffer = nativeIsBuffer || stubFalse;

/**
 * Checks if `value` is classified as a `Function` object.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a function, else `false`.
 * @example
 *
 * _.isFunction(_);
 * // => true
 *
 * _.isFunction(/abc/);
 * // => false
 */
function isFunction(value) {
  // The use of `Object#toString` avoids issues with the `typeof` operator
  // in Safari 8-9 which returns 'object' for typed array and other constructors.
  var tag = isObject(value) ? objectToString.call(value) : '';
  return tag == funcTag || tag == genTag;
}

/**
 * Checks if `value` is a valid array-like length.
 *
 * **Note:** This method is loosely based on
 * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
 * @example
 *
 * _.isLength(3);
 * // => true
 *
 * _.isLength(Number.MIN_VALUE);
 * // => false
 *
 * _.isLength(Infinity);
 * // => false
 *
 * _.isLength('3');
 * // => false
 */
function isLength(value) {
  return typeof value == 'number' &&
    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
}

/**
 * Checks if `value` is the
 * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
 * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an object, else `false`.
 * @example
 *
 * _.isObject({});
 * // => true
 *
 * _.isObject([1, 2, 3]);
 * // => true
 *
 * _.isObject(_.noop);
 * // => true
 *
 * _.isObject(null);
 * // => false
 */
function isObject(value) {
  var type = typeof value;
  return !!value && (type == 'object' || type == 'function');
}

/**
 * Checks if `value` is object-like. A value is object-like if it's not `null`
 * and has a `typeof` result of "object".
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
 * @example
 *
 * _.isObjectLike({});
 * // => true
 *
 * _.isObjectLike([1, 2, 3]);
 * // => true
 *
 * _.isObjectLike(_.noop);
 * // => false
 *
 * _.isObjectLike(null);
 * // => false
 */
function isObjectLike(value) {
  return !!value && typeof value == 'object';
}

/**
 * Creates an array of the own enumerable property names of `object`.
 *
 * **Note:** Non-object values are coerced to objects. See the
 * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
 * for more details.
 *
 * @static
 * @since 0.1.0
 * @memberOf _
 * @category Object
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of property names.
 * @example
 *
 * function Foo() {
 *   this.a = 1;
 *   this.b = 2;
 * }
 *
 * Foo.prototype.c = 3;
 *
 * _.keys(new Foo);
 * // => ['a', 'b'] (iteration order is not guaranteed)
 *
 * _.keys('hi');
 * // => ['0', '1']
 */
function keys(object) {
  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
}

/**
 * This method returns a new empty array.
 *
 * @static
 * @memberOf _
 * @since 4.13.0
 * @category Util
 * @returns {Array} Returns the new empty array.
 * @example
 *
 * var arrays = _.times(2, _.stubArray);
 *
 * console.log(arrays);
 * // => [[], []]
 *
 * console.log(arrays[0] === arrays[1]);
 * // => false
 */
function stubArray() {
  return [];
}

/**
 * This method returns `false`.
 *
 * @static
 * @memberOf _
 * @since 4.13.0
 * @category Util
 * @returns {boolean} Returns `false`.
 * @example
 *
 * _.times(2, _.stubFalse);
 * // => [false, false]
 */
function stubFalse() {
  return false;
}

module.exports = cloneDeep;

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js"), __webpack_require__(/*! ./../webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./node_modules/ms/index.js":
/*!**********************************!*\
  !*** ./node_modules/ms/index.js ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports) {

/**
 * Helpers.
 */

var s = 1000;
var m = s * 60;
var h = m * 60;
var d = h * 24;
var w = d * 7;
var y = d * 365.25;

/**
 * Parse or format the given `val`.
 *
 * Options:
 *
 *  - `long` verbose formatting [false]
 *
 * @param {String|Number} val
 * @param {Object} [options]
 * @throws {Error} throw an error if val is not a non-empty string or a number
 * @return {String|Number}
 * @api public
 */

module.exports = function(val, options) {
  options = options || {};
  var type = typeof val;
  if (type === 'string' && val.length > 0) {
    return parse(val);
  } else if (type === 'number' && isFinite(val)) {
    return options.long ? fmtLong(val) : fmtShort(val);
  }
  throw new Error(
    'val is not a non-empty string or a valid number. val=' +
      JSON.stringify(val)
  );
};

/**
 * Parse the given `str` and return milliseconds.
 *
 * @param {String} str
 * @return {Number}
 * @api private
 */

function parse(str) {
  str = String(str);
  if (str.length > 100) {
    return;
  }
  var match = /^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(
    str
  );
  if (!match) {
    return;
  }
  var n = parseFloat(match[1]);
  var type = (match[2] || 'ms').toLowerCase();
  switch (type) {
    case 'years':
    case 'year':
    case 'yrs':
    case 'yr':
    case 'y':
      return n * y;
    case 'weeks':
    case 'week':
    case 'w':
      return n * w;
    case 'days':
    case 'day':
    case 'd':
      return n * d;
    case 'hours':
    case 'hour':
    case 'hrs':
    case 'hr':
    case 'h':
      return n * h;
    case 'minutes':
    case 'minute':
    case 'mins':
    case 'min':
    case 'm':
      return n * m;
    case 'seconds':
    case 'second':
    case 'secs':
    case 'sec':
    case 's':
      return n * s;
    case 'milliseconds':
    case 'millisecond':
    case 'msecs':
    case 'msec':
    case 'ms':
      return n;
    default:
      return undefined;
  }
}

/**
 * Short format for `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api private
 */

function fmtShort(ms) {
  var msAbs = Math.abs(ms);
  if (msAbs >= d) {
    return Math.round(ms / d) + 'd';
  }
  if (msAbs >= h) {
    return Math.round(ms / h) + 'h';
  }
  if (msAbs >= m) {
    return Math.round(ms / m) + 'm';
  }
  if (msAbs >= s) {
    return Math.round(ms / s) + 's';
  }
  return ms + 'ms';
}

/**
 * Long format for `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api private
 */

function fmtLong(ms) {
  var msAbs = Math.abs(ms);
  if (msAbs >= d) {
    return plural(ms, msAbs, d, 'day');
  }
  if (msAbs >= h) {
    return plural(ms, msAbs, h, 'hour');
  }
  if (msAbs >= m) {
    return plural(ms, msAbs, m, 'minute');
  }
  if (msAbs >= s) {
    return plural(ms, msAbs, s, 'second');
  }
  return ms + ' ms';
}

/**
 * Pluralization helper.
 */

function plural(ms, msAbs, n, name) {
  var isPlural = msAbs >= n * 1.5;
  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');
}


/***/ }),

/***/ "./node_modules/pako/dist/pako.min.js":
/*!********************************************!*\
  !*** ./node_modules/pako/dist/pako.min.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=t()}}(function(){return function r(s,o,l){function h(e,t){if(!o[e]){if(!s[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(d)return d(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[e]={exports:{}};s[e][0].call(n.exports,function(t){return h(s[e][1][t]||t)},n,n.exports,r,s,o,l)}return o[e].exports}for(var d="function"==typeof require&&require,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(t,e,a){"use strict";var s=t("./zlib/deflate"),o=t("./utils/common"),l=t("./utils/strings"),n=t("./zlib/messages"),r=t("./zlib/zstream"),h=Object.prototype.toString,d=0,f=-1,_=0,u=8;function c(t){if(!(this instanceof c))return new c(t);this.options=o.assign({level:f,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var a=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==d)throw new Error(n[a]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"==typeof e.dictionary?l.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(a=s.deflateSetDictionary(this.strm,i))!==d)throw new Error(n[a]);this._dict_set=!0}}function i(t,e){var a=new c(e);if(a.push(t,!0),a.err)throw a.msg||n[a.err];return a.result}c.prototype.push=function(t,e){var a,i,n=this.strm,r=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?4:0,"string"==typeof t?n.input=l.string2buf(t):"[object ArrayBuffer]"===h.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new o.Buf8(r),n.next_out=0,n.avail_out=r),1!==(a=s.deflate(n,i))&&a!==d)return this.onEnd(a),!(this.ended=!0);0!==n.avail_out&&(0!==n.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(l.buf2binstring(o.shrinkBuf(n.output,n.next_out))):this.onData(o.shrinkBuf(n.output,n.next_out)))}while((0<n.avail_in||0===n.avail_out)&&1!==a);return 4===i?(a=s.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===d):2!==i||(this.onEnd(d),!(n.avail_out=0))},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){t===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Deflate=c,a.deflate=i,a.deflateRaw=function(t,e){return(e=e||{}).raw=!0,i(t,e)},a.gzip=function(t,e){return(e=e||{}).gzip=!0,i(t,e)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(t,e,a){"use strict";var f=t("./zlib/inflate"),_=t("./utils/common"),u=t("./utils/strings"),c=t("./zlib/constants"),i=t("./zlib/messages"),n=t("./zlib/zstream"),r=t("./zlib/gzheader"),b=Object.prototype.toString;function s(t){if(!(this instanceof s))return new s(t);this.options=_.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var a=f.inflateInit2(this.strm,e.windowBits);if(a!==c.Z_OK)throw new Error(i[a]);if(this.header=new r,f.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=u.string2buf(e.dictionary):"[object ArrayBuffer]"===b.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(a=f.inflateSetDictionary(this.strm,e.dictionary))!==c.Z_OK))throw new Error(i[a])}function o(t,e){var a=new s(e);if(a.push(t,!0),a.err)throw a.msg||i[a.err];return a.result}s.prototype.push=function(t,e){var a,i,n,r,s,o=this.strm,l=this.options.chunkSize,h=this.options.dictionary,d=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof t?o.input=u.binstring2buf(t):"[object ArrayBuffer]"===b.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new _.Buf8(l),o.next_out=0,o.avail_out=l),(a=f.inflate(o,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&h&&(a=f.inflateSetDictionary(this.strm,h)),a===c.Z_BUF_ERROR&&!0===d&&(a=c.Z_OK,d=!1),a!==c.Z_STREAM_END&&a!==c.Z_OK)return this.onEnd(a),!(this.ended=!0);o.next_out&&(0!==o.avail_out&&a!==c.Z_STREAM_END&&(0!==o.avail_in||i!==c.Z_FINISH&&i!==c.Z_SYNC_FLUSH)||("string"===this.options.to?(n=u.utf8border(o.output,o.next_out),r=o.next_out-n,s=u.buf2string(o.output,n),o.next_out=r,o.avail_out=l-r,r&&_.arraySet(o.output,o.output,n,r,0),this.onData(s)):this.onData(_.shrinkBuf(o.output,o.next_out)))),0===o.avail_in&&0===o.avail_out&&(d=!0)}while((0<o.avail_in||0===o.avail_out)&&a!==c.Z_STREAM_END);return a===c.Z_STREAM_END&&(i=c.Z_FINISH),i===c.Z_FINISH?(a=f.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===c.Z_OK):i!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(o.avail_out=0))},s.prototype.onData=function(t){this.chunks.push(t)},s.prototype.onEnd=function(t){t===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=_.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Inflate=s,a.inflate=o,a.inflateRaw=function(t,e){return(e=e||{}).raw=!0,o(t,e)},a.ungzip=o},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(t,e,a){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;a.assign=function(t){for(var e,a,i=Array.prototype.slice.call(arguments,1);i.length;){var n=i.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)e=n,a=r,Object.prototype.hasOwnProperty.call(e,a)&&(t[r]=n[r])}}return t},a.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,a,i,n){if(e.subarray&&t.subarray)t.set(e.subarray(a,a+i),n);else for(var r=0;r<i;r++)t[n+r]=e[a+r]},flattenChunks:function(t){var e,a,i,n,r,s;for(e=i=0,a=t.length;e<a;e++)i+=t[e].length;for(s=new Uint8Array(i),e=n=0,a=t.length;e<a;e++)r=t[e],s.set(r,n),n+=r.length;return s}},r={arraySet:function(t,e,a,i,n){for(var r=0;r<i;r++)t[n+r]=e[a+r]},flattenChunks:function(t){return[].concat.apply([],t)}};a.setTyped=function(t){t?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,n)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,r))},a.setTyped(i)},{}],4:[function(t,e,a){"use strict";var l=t("./common"),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(t){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){r=!1}for(var h=new l.Buf8(256),i=0;i<256;i++)h[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function d(t,e){if(e<65534&&(t.subarray&&r||!t.subarray&&n))return String.fromCharCode.apply(null,l.shrinkBuf(t,e));for(var a="",i=0;i<e;i++)a+=String.fromCharCode(t[i]);return a}h[254]=h[254]=1,a.string2buf=function(t){var e,a,i,n,r,s=t.length,o=0;for(n=0;n<s;n++)55296==(64512&(a=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(i=t.charCodeAt(n+1)))&&(a=65536+(a-55296<<10)+(i-56320),n++),o+=a<128?1:a<2048?2:a<65536?3:4;for(e=new l.Buf8(o),n=r=0;r<o;n++)55296==(64512&(a=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(i=t.charCodeAt(n+1)))&&(a=65536+(a-55296<<10)+(i-56320),n++),a<128?e[r++]=a:(a<2048?e[r++]=192|a>>>6:(a<65536?e[r++]=224|a>>>12:(e[r++]=240|a>>>18,e[r++]=128|a>>>12&63),e[r++]=128|a>>>6&63),e[r++]=128|63&a);return e},a.buf2binstring=function(t){return d(t,t.length)},a.binstring2buf=function(t){for(var e=new l.Buf8(t.length),a=0,i=e.length;a<i;a++)e[a]=t.charCodeAt(a);return e},a.buf2string=function(t,e){var a,i,n,r,s=e||t.length,o=new Array(2*s);for(a=i=0;a<s;)if((n=t[a++])<128)o[i++]=n;else if(4<(r=h[n]))o[i++]=65533,a+=r-1;else{for(n&=2===r?31:3===r?15:7;1<r&&a<s;)n=n<<6|63&t[a++],r--;1<r?o[i++]=65533:n<65536?o[i++]=n:(n-=65536,o[i++]=55296|n>>10&1023,o[i++]=56320|1023&n)}return d(o,i)},a.utf8border=function(t,e){var a;for((e=e||t.length)>t.length&&(e=t.length),a=e-1;0<=a&&128==(192&t[a]);)a--;return a<0?e:0===a?e:a+h[t[a]]>e?a:e}},{"./common":3}],5:[function(t,e,a){"use strict";e.exports=function(t,e,a,i){for(var n=65535&t|0,r=t>>>16&65535|0,s=0;0!==a;){for(a-=s=2e3<a?2e3:a;r=r+(n=n+e[i++]|0)|0,--s;);n%=65521,r%=65521}return n|r<<16|0}},{}],6:[function(t,e,a){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(t,e,a){"use strict";var o=function(){for(var t,e=[],a=0;a<256;a++){t=a;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}();e.exports=function(t,e,a,i){var n=o,r=i+a;t^=-1;for(var s=i;s<r;s++)t=t>>>8^n[255&(t^e[s])];return-1^t}},{}],8:[function(t,e,a){"use strict";var l,_=t("../utils/common"),h=t("./trees"),u=t("./adler32"),c=t("./crc32"),i=t("./messages"),d=0,f=4,b=0,g=-2,m=-1,w=4,n=2,p=8,v=9,r=286,s=30,o=19,k=2*r+1,y=15,x=3,z=258,B=z+x+1,S=42,E=113,A=1,Z=2,R=3,C=4;function N(t,e){return t.msg=i[e],e}function O(t){return(t<<1)-(4<t?9:0)}function D(t){for(var e=t.length;0<=--e;)t[e]=0}function I(t){var e=t.state,a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(_.arraySet(t.output,e.pending_buf,e.pending_out,a,t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))}function U(t,e){h._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,I(t.strm)}function T(t,e){t.pending_buf[t.pending++]=e}function F(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function L(t,e){var a,i,n=t.max_chain_length,r=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-B?t.strstart-(t.w_size-B):0,h=t.window,d=t.w_mask,f=t.prev,_=t.strstart+z,u=h[r+s-1],c=h[r+s];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(a=e)+s]===c&&h[a+s-1]===u&&h[a]===h[r]&&h[++a]===h[r+1]){r+=2,a++;do{}while(h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&r<_);if(i=z-(_-r),r=_-z,s<i){if(t.match_start=e,o<=(s=i))break;u=h[r+s-1],c=h[r+s]}}}while((e=f[e&d])>l&&0!=--n);return s<=t.lookahead?s:t.lookahead}function H(t){var e,a,i,n,r,s,o,l,h,d,f=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-B)){for(_.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=a=t.hash_size;i=t.head[--e],t.head[e]=f<=i?i-f:0,--a;);for(e=a=f;i=t.prev[--e],t.prev[e]=f<=i?i-f:0,--a;);n+=f}if(0===t.strm.avail_in)break;if(s=t.strm,o=t.window,l=t.strstart+t.lookahead,h=n,d=void 0,d=s.avail_in,h<d&&(d=h),a=0===d?0:(s.avail_in-=d,_.arraySet(o,s.input,s.next_in,d,l),1===s.state.wrap?s.adler=u(s.adler,o,d,l):2===s.state.wrap&&(s.adler=c(s.adler,o,d,l)),s.next_in+=d,s.total_in+=d,d),t.lookahead+=a,t.lookahead+t.insert>=x)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+x-1])&t.hash_mask,t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<x)););}while(t.lookahead<B&&0!==t.strm.avail_in)}function j(t,e){for(var a,i;;){if(t.lookahead<B){if(H(t),t.lookahead<B&&e===d)return A;if(0===t.lookahead)break}if(a=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-B&&(t.match_length=L(t,a)),t.match_length>=x)if(i=h._tr_tally(t,t.strstart-t.match_start,t.match_length-x),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=x){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(U(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<x-1?t.strstart:x-1,e===f?(U(t,!0),0===t.strm.avail_out?R:C):t.last_lit&&(U(t,!1),0===t.strm.avail_out)?A:Z}function K(t,e){for(var a,i,n;;){if(t.lookahead<B){if(H(t),t.lookahead<B&&e===d)return A;if(0===t.lookahead)break}if(a=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=x-1,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-B&&(t.match_length=L(t,a),t.match_length<=5&&(1===t.strategy||t.match_length===x&&4096<t.strstart-t.match_start)&&(t.match_length=x-1)),t.prev_length>=x&&t.match_length<=t.prev_length){for(n=t.strstart+t.lookahead-x,i=h._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-x),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=x-1,t.strstart++,i&&(U(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((i=h._tr_tally(t,0,t.window[t.strstart-1]))&&U(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=h._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<x-1?t.strstart:x-1,e===f?(U(t,!0),0===t.strm.avail_out?R:C):t.last_lit&&(U(t,!1),0===t.strm.avail_out)?A:Z}function M(t,e,a,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=i,this.func=n}function P(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=p,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _.Buf16(2*k),this.dyn_dtree=new _.Buf16(2*(2*s+1)),this.bl_tree=new _.Buf16(2*(2*o+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _.Buf16(y+1),this.heap=new _.Buf16(2*r+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _.Buf16(2*r+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Y(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=n,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?S:E,t.adler=2===e.wrap?0:1,e.last_flush=d,h._tr_init(e),b):N(t,g)}function q(t){var e,a=Y(t);return a===b&&((e=t.state).window_size=2*e.w_size,D(e.head),e.max_lazy_match=l[e.level].max_lazy,e.good_match=l[e.level].good_length,e.nice_match=l[e.level].nice_length,e.max_chain_length=l[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=x-1,e.match_available=0,e.ins_h=0),a}function G(t,e,a,i,n,r){if(!t)return g;var s=1;if(e===m&&(e=6),i<0?(s=0,i=-i):15<i&&(s=2,i-=16),n<1||v<n||a!==p||i<8||15<i||e<0||9<e||r<0||w<r)return N(t,g);8===i&&(i=9);var o=new P;return(t.state=o).strm=t,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+x-1)/x),o.window=new _.Buf8(2*o.w_size),o.head=new _.Buf16(o.hash_size),o.prev=new _.Buf16(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new _.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=r,o.method=a,q(t)}l=[new M(0,0,0,0,function(t,e){var a=65535;for(a>t.pending_buf_size-5&&(a=t.pending_buf_size-5);;){if(t.lookahead<=1){if(H(t),0===t.lookahead&&e===d)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+a;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,U(t,!1),0===t.strm.avail_out))return A;if(t.strstart-t.block_start>=t.w_size-B&&(U(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===f?(U(t,!0),0===t.strm.avail_out?R:C):(t.strstart>t.block_start&&(U(t,!1),t.strm.avail_out),A)}),new M(4,4,8,4,j),new M(4,5,16,8,j),new M(4,6,32,32,j),new M(4,4,16,16,K),new M(8,16,32,32,K),new M(8,16,128,128,K),new M(8,32,128,256,K),new M(32,128,258,1024,K),new M(32,258,258,4096,K)],a.deflateInit=function(t,e){return G(t,e,p,15,8,0)},a.deflateInit2=G,a.deflateReset=q,a.deflateResetKeep=Y,a.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,b):g},a.deflate=function(t,e){var a,i,n,r;if(!t||!t.state||5<e||e<0)return t?N(t,g):g;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&e!==f)return N(t,0===t.avail_out?-5:g);if(i.strm=t,a=i.last_flush,i.last_flush=e,i.status===S)if(2===i.wrap)t.adler=0,T(i,31),T(i,139),T(i,8),i.gzhead?(T(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),T(i,255&i.gzhead.time),T(i,i.gzhead.time>>8&255),T(i,i.gzhead.time>>16&255),T(i,i.gzhead.time>>24&255),T(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),T(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(T(i,255&i.gzhead.extra.length),T(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=c(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(T(i,0),T(i,0),T(i,0),T(i,0),T(i,0),T(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),T(i,3),i.status=E);else{var s=p+(i.w_bits-8<<4)<<8;s|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(s|=32),s+=31-s%31,i.status=E,F(i,s),0!==i.strstart&&(F(i,t.adler>>>16),F(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),I(t),n=i.pending,i.pending!==i.pending_buf_size));)T(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),I(t),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}T(i,r=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0)}while(0!==r);i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),0===r&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),I(t),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}T(i,r=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0)}while(0!==r);i.gzhead.hcrc&&i.pending>n&&(t.adler=c(t.adler,i.pending_buf,i.pending-n,n)),0===r&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&I(t),i.pending+2<=i.pending_buf_size&&(T(i,255&t.adler),T(i,t.adler>>8&255),t.adler=0,i.status=E)):i.status=E),0!==i.pending){if(I(t),0===t.avail_out)return i.last_flush=-1,b}else if(0===t.avail_in&&O(e)<=O(a)&&e!==f)return N(t,-5);if(666===i.status&&0!==t.avail_in)return N(t,-5);if(0!==t.avail_in||0!==i.lookahead||e!==d&&666!==i.status){var o=2===i.strategy?function(t,e){for(var a;;){if(0===t.lookahead&&(H(t),0===t.lookahead)){if(e===d)return A;break}if(t.match_length=0,a=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(U(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===f?(U(t,!0),0===t.strm.avail_out?R:C):t.last_lit&&(U(t,!1),0===t.strm.avail_out)?A:Z}(i,e):3===i.strategy?function(t,e){for(var a,i,n,r,s=t.window;;){if(t.lookahead<=z){if(H(t),t.lookahead<=z&&e===d)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=x&&0<t.strstart&&(i=s[n=t.strstart-1])===s[++n]&&i===s[++n]&&i===s[++n]){r=t.strstart+z;do{}while(i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&n<r);t.match_length=z-(r-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=x?(a=h._tr_tally(t,1,t.match_length-x),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(U(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===f?(U(t,!0),0===t.strm.avail_out?R:C):t.last_lit&&(U(t,!1),0===t.strm.avail_out)?A:Z}(i,e):l[i.level].func(i,e);if(o!==R&&o!==C||(i.status=666),o===A||o===R)return 0===t.avail_out&&(i.last_flush=-1),b;if(o===Z&&(1===e?h._tr_align(i):5!==e&&(h._tr_stored_block(i,0,0,!1),3===e&&(D(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),I(t),0===t.avail_out))return i.last_flush=-1,b}return e!==f?b:i.wrap<=0?1:(2===i.wrap?(T(i,255&t.adler),T(i,t.adler>>8&255),T(i,t.adler>>16&255),T(i,t.adler>>24&255),T(i,255&t.total_in),T(i,t.total_in>>8&255),T(i,t.total_in>>16&255),T(i,t.total_in>>24&255)):(F(i,t.adler>>>16),F(i,65535&t.adler)),I(t),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?b:1)},a.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==S&&69!==e&&73!==e&&91!==e&&103!==e&&e!==E&&666!==e?N(t,g):(t.state=null,e===E?N(t,-3):b):g},a.deflateSetDictionary=function(t,e){var a,i,n,r,s,o,l,h,d=e.length;if(!t||!t.state)return g;if(2===(r=(a=t.state).wrap)||1===r&&a.status!==S||a.lookahead)return g;for(1===r&&(t.adler=u(t.adler,e,d,0)),a.wrap=0,d>=a.w_size&&(0===r&&(D(a.head),a.strstart=0,a.block_start=0,a.insert=0),h=new _.Buf8(a.w_size),_.arraySet(h,e,d-a.w_size,a.w_size,0),e=h,d=a.w_size),s=t.avail_in,o=t.next_in,l=t.input,t.avail_in=d,t.next_in=0,t.input=e,H(a);a.lookahead>=x;){for(i=a.strstart,n=a.lookahead-(x-1);a.ins_h=(a.ins_h<<a.hash_shift^a.window[i+x-1])&a.hash_mask,a.prev[i&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=i,i++,--n;);a.strstart=i,a.lookahead=x-1,H(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=x-1,a.match_available=0,t.next_in=o,t.input=l,t.avail_in=s,a.wrap=r,b},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(t,e,a){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(t,e,a){"use strict";e.exports=function(t,e){var a,i,n,r,s,o,l,h,d,f,_,u,c,b,g,m,w,p,v,k,y,x,z,B,S;a=t.state,i=t.next_in,B=t.input,n=i+(t.avail_in-5),r=t.next_out,S=t.output,s=r-(e-t.avail_out),o=r+(t.avail_out-257),l=a.dmax,h=a.wsize,d=a.whave,f=a.wnext,_=a.window,u=a.hold,c=a.bits,b=a.lencode,g=a.distcode,m=(1<<a.lenbits)-1,w=(1<<a.distbits)-1;t:do{c<15&&(u+=B[i++]<<c,c+=8,u+=B[i++]<<c,c+=8),p=b[u&m];e:for(;;){if(u>>>=v=p>>>24,c-=v,0===(v=p>>>16&255))S[r++]=65535&p;else{if(!(16&v)){if(0==(64&v)){p=b[(65535&p)+(u&(1<<v)-1)];continue e}if(32&v){a.mode=12;break t}t.msg="invalid literal/length code",a.mode=30;break t}k=65535&p,(v&=15)&&(c<v&&(u+=B[i++]<<c,c+=8),k+=u&(1<<v)-1,u>>>=v,c-=v),c<15&&(u+=B[i++]<<c,c+=8,u+=B[i++]<<c,c+=8),p=g[u&w];a:for(;;){if(u>>>=v=p>>>24,c-=v,!(16&(v=p>>>16&255))){if(0==(64&v)){p=g[(65535&p)+(u&(1<<v)-1)];continue a}t.msg="invalid distance code",a.mode=30;break t}if(y=65535&p,c<(v&=15)&&(u+=B[i++]<<c,(c+=8)<v&&(u+=B[i++]<<c,c+=8)),l<(y+=u&(1<<v)-1)){t.msg="invalid distance too far back",a.mode=30;break t}if(u>>>=v,c-=v,(v=r-s)<y){if(d<(v=y-v)&&a.sane){t.msg="invalid distance too far back",a.mode=30;break t}if(z=_,(x=0)===f){if(x+=h-v,v<k){for(k-=v;S[r++]=_[x++],--v;);x=r-y,z=S}}else if(f<v){if(x+=h+f-v,(v-=f)<k){for(k-=v;S[r++]=_[x++],--v;);if(x=0,f<k){for(k-=v=f;S[r++]=_[x++],--v;);x=r-y,z=S}}}else if(x+=f-v,v<k){for(k-=v;S[r++]=_[x++],--v;);x=r-y,z=S}for(;2<k;)S[r++]=z[x++],S[r++]=z[x++],S[r++]=z[x++],k-=3;k&&(S[r++]=z[x++],1<k&&(S[r++]=z[x++]))}else{for(x=r-y;S[r++]=S[x++],S[r++]=S[x++],S[r++]=S[x++],2<(k-=3););k&&(S[r++]=S[x++],1<k&&(S[r++]=S[x++]))}break}}break}}while(i<n&&r<o);i-=k=c>>3,u&=(1<<(c-=k<<3))-1,t.next_in=i,t.next_out=r,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=r<o?o-r+257:257-(r-o),a.hold=u,a.bits=c}},{}],11:[function(t,e,a){"use strict";var Z=t("../utils/common"),R=t("./adler32"),C=t("./crc32"),N=t("./inffast"),O=t("./inftrees"),D=1,I=2,U=0,T=-2,F=1,i=852,n=592;function L(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Z.Buf16(320),this.work=new Z.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=F,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Z.Buf32(i),e.distcode=e.distdyn=new Z.Buf32(n),e.sane=1,e.back=-1,U):T}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,s(t)):T}function l(t,e){var a,i;return t&&t.state?(i=t.state,e<0?(a=0,e=-e):(a=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?T:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=a,i.wbits=e,o(t))):T}function h(t,e){var a,i;return t?(i=new r,(t.state=i).window=null,(a=l(t,e))!==U&&(t.state=null),a):T}var d,f,_=!0;function H(t){if(_){var e;for(d=new Z.Buf32(512),f=new Z.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(O(D,t.lens,0,288,d,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;O(I,t.lens,0,32,f,0,t.work,{bits:5}),_=!1}t.lencode=d,t.lenbits=9,t.distcode=f,t.distbits=5}function j(t,e,a,i){var n,r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Z.Buf8(r.wsize)),i>=r.wsize?(Z.arraySet(r.window,e,a-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(i<(n=r.wsize-r.wnext)&&(n=i),Z.arraySet(r.window,e,a-i,n,r.wnext),(i-=n)?(Z.arraySet(r.window,e,a-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0}a.inflateReset=o,a.inflateReset2=l,a.inflateResetKeep=s,a.inflateInit=function(t){return h(t,15)},a.inflateInit2=h,a.inflate=function(t,e){var a,i,n,r,s,o,l,h,d,f,_,u,c,b,g,m,w,p,v,k,y,x,z,B,S=0,E=new Z.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return T;12===(a=t.state).mode&&(a.mode=13),s=t.next_out,n=t.output,l=t.avail_out,r=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,f=o,_=l,x=U;t:for(;;)switch(a.mode){case F:if(0===a.wrap){a.mode=13;break}for(;d<16;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(2&a.wrap&&35615===h){E[a.check=0]=255&h,E[1]=h>>>8&255,a.check=C(a.check,E,2,0),d=h=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",a.mode=30;break}if(8!=(15&h)){t.msg="unknown compression method",a.mode=30;break}if(d-=4,y=8+(15&(h>>>=4)),0===a.wbits)a.wbits=y;else if(y>a.wbits){t.msg="invalid window size",a.mode=30;break}a.dmax=1<<y,t.adler=a.check=1,a.mode=512&h?10:12,d=h=0;break;case 2:for(;d<16;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(a.flags=h,8!=(255&a.flags)){t.msg="unknown compression method",a.mode=30;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=30;break}a.head&&(a.head.text=h>>8&1),512&a.flags&&(E[0]=255&h,E[1]=h>>>8&255,a.check=C(a.check,E,2,0)),d=h=0,a.mode=3;case 3:for(;d<32;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}a.head&&(a.head.time=h),512&a.flags&&(E[0]=255&h,E[1]=h>>>8&255,E[2]=h>>>16&255,E[3]=h>>>24&255,a.check=C(a.check,E,4,0)),d=h=0,a.mode=4;case 4:for(;d<16;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&(E[0]=255&h,E[1]=h>>>8&255,a.check=C(a.check,E,2,0)),d=h=0,a.mode=5;case 5:if(1024&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&(E[0]=255&h,E[1]=h>>>8&255,a.check=C(a.check,E,2,0)),d=h=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(1024&a.flags&&(o<(u=a.length)&&(u=o),u&&(a.head&&(y=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),Z.arraySet(a.head.extra,i,r,u,y)),512&a.flags&&(a.check=C(a.check,i,u,r)),o-=u,r+=u,a.length-=u),a.length))break t;a.length=0,a.mode=7;case 7:if(2048&a.flags){if(0===o)break t;for(u=0;y=i[r+u++],a.head&&y&&a.length<65536&&(a.head.name+=String.fromCharCode(y)),y&&u<o;);if(512&a.flags&&(a.check=C(a.check,i,u,r)),o-=u,r+=u,y)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(4096&a.flags){if(0===o)break t;for(u=0;y=i[r+u++],a.head&&y&&a.length<65536&&(a.head.comment+=String.fromCharCode(y)),y&&u<o;);if(512&a.flags&&(a.check=C(a.check,i,u,r)),o-=u,r+=u,y)break t}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(512&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(h!==(65535&a.check)){t.msg="header crc mismatch",a.mode=30;break}d=h=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=12;break;case 10:for(;d<32;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}t.adler=a.check=L(h),d=h=0,a.mode=11;case 11:if(0===a.havedict)return t.next_out=s,t.avail_out=l,t.next_in=r,t.avail_in=o,a.hold=h,a.bits=d,2;t.adler=a.check=1,a.mode=12;case 12:if(5===e||6===e)break t;case 13:if(a.last){h>>>=7&d,d-=7&d,a.mode=27;break}for(;d<3;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}switch(a.last=1&h,d-=1,3&(h>>>=1)){case 0:a.mode=14;break;case 1:if(H(a),a.mode=20,6!==e)break;h>>>=2,d-=2;break t;case 2:a.mode=17;break;case 3:t.msg="invalid block type",a.mode=30}h>>>=2,d-=2;break;case 14:for(h>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",a.mode=30;break}if(a.length=65535&h,d=h=0,a.mode=15,6===e)break t;case 15:a.mode=16;case 16:if(u=a.length){if(o<u&&(u=o),l<u&&(u=l),0===u)break t;Z.arraySet(n,i,r,u,s),o-=u,r+=u,l-=u,s+=u,a.length-=u;break}a.mode=12;break;case 17:for(;d<14;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(a.nlen=257+(31&h),h>>>=5,d-=5,a.ndist=1+(31&h),h>>>=5,d-=5,a.ncode=4+(15&h),h>>>=4,d-=4,286<a.nlen||30<a.ndist){t.msg="too many length or distance symbols",a.mode=30;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;d<3;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}a.lens[A[a.have++]]=7&h,h>>>=3,d-=3}for(;a.have<19;)a.lens[A[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,z={bits:a.lenbits},x=O(0,a.lens,0,19,a.lencode,0,a.work,z),a.lenbits=z.bits,x){t.msg="invalid code lengths set",a.mode=30;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;m=(S=a.lencode[h&(1<<a.lenbits)-1])>>>16&255,w=65535&S,!((g=S>>>24)<=d);){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(w<16)h>>>=g,d-=g,a.lens[a.have++]=w;else{if(16===w){for(B=g+2;d<B;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(h>>>=g,d-=g,0===a.have){t.msg="invalid bit length repeat",a.mode=30;break}y=a.lens[a.have-1],u=3+(3&h),h>>>=2,d-=2}else if(17===w){for(B=g+3;d<B;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}d-=g,y=0,u=3+(7&(h>>>=g)),h>>>=3,d-=3}else{for(B=g+7;d<B;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}d-=g,y=0,u=11+(127&(h>>>=g)),h>>>=7,d-=7}if(a.have+u>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=30;break}for(;u--;)a.lens[a.have++]=y}}if(30===a.mode)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=30;break}if(a.lenbits=9,z={bits:a.lenbits},x=O(D,a.lens,0,a.nlen,a.lencode,0,a.work,z),a.lenbits=z.bits,x){t.msg="invalid literal/lengths set",a.mode=30;break}if(a.distbits=6,a.distcode=a.distdyn,z={bits:a.distbits},x=O(I,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,z),a.distbits=z.bits,x){t.msg="invalid distances set",a.mode=30;break}if(a.mode=20,6===e)break t;case 20:a.mode=21;case 21:if(6<=o&&258<=l){t.next_out=s,t.avail_out=l,t.next_in=r,t.avail_in=o,a.hold=h,a.bits=d,N(t,_),s=t.next_out,n=t.output,l=t.avail_out,r=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,12===a.mode&&(a.back=-1);break}for(a.back=0;m=(S=a.lencode[h&(1<<a.lenbits)-1])>>>16&255,w=65535&S,!((g=S>>>24)<=d);){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(m&&0==(240&m)){for(p=g,v=m,k=w;m=(S=a.lencode[k+((h&(1<<p+v)-1)>>p)])>>>16&255,w=65535&S,!(p+(g=S>>>24)<=d);){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=g,d-=g,a.back+=g,a.length=w,0===m){a.mode=26;break}if(32&m){a.back=-1,a.mode=12;break}if(64&m){t.msg="invalid literal/length code",a.mode=30;break}a.extra=15&m,a.mode=22;case 22:if(a.extra){for(B=a.extra;d<B;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;m=(S=a.distcode[h&(1<<a.distbits)-1])>>>16&255,w=65535&S,!((g=S>>>24)<=d);){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(0==(240&m)){for(p=g,v=m,k=w;m=(S=a.distcode[k+((h&(1<<p+v)-1)>>p)])>>>16&255,w=65535&S,!(p+(g=S>>>24)<=d);){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=g,d-=g,a.back+=g,64&m){t.msg="invalid distance code",a.mode=30;break}a.offset=w,a.extra=15&m,a.mode=24;case 24:if(a.extra){for(B=a.extra;d<B;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=30;break}a.mode=25;case 25:if(0===l)break t;if(u=_-l,a.offset>u){if((u=a.offset-u)>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=30;break}u>a.wnext?(u-=a.wnext,c=a.wsize-u):c=a.wnext-u,u>a.length&&(u=a.length),b=a.window}else b=n,c=s-a.offset,u=a.length;for(l<u&&(u=l),l-=u,a.length-=u;n[s++]=b[c++],--u;);0===a.length&&(a.mode=21);break;case 26:if(0===l)break t;n[s++]=a.length,l--,a.mode=21;break;case 27:if(a.wrap){for(;d<32;){if(0===o)break t;o--,h|=i[r++]<<d,d+=8}if(_-=l,t.total_out+=_,a.total+=_,_&&(t.adler=a.check=a.flags?C(a.check,n,_,s-_):R(a.check,n,_,s-_)),_=l,(a.flags?h:L(h))!==a.check){t.msg="incorrect data check",a.mode=30;break}d=h=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;d<32;){if(0===o)break t;o--,h+=i[r++]<<d,d+=8}if(h!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=30;break}d=h=0}a.mode=29;case 29:x=1;break t;case 30:x=-3;break t;case 31:return-4;case 32:default:return T}return t.next_out=s,t.avail_out=l,t.next_in=r,t.avail_in=o,a.hold=h,a.bits=d,(a.wsize||_!==t.avail_out&&a.mode<30&&(a.mode<27||4!==e))&&j(t,t.output,t.next_out,_-t.avail_out)?(a.mode=31,-4):(f-=t.avail_in,_-=t.avail_out,t.total_in+=f,t.total_out+=_,a.total+=_,a.wrap&&_&&(t.adler=a.check=a.flags?C(a.check,n,_,t.next_out-_):R(a.check,n,_,t.next_out-_)),t.data_type=a.bits+(a.last?64:0)+(12===a.mode?128:0)+(20===a.mode||15===a.mode?256:0),(0===f&&0===_||4===e)&&x===U&&(x=-5),x)},a.inflateEnd=function(t){if(!t||!t.state)return T;var e=t.state;return e.window&&(e.window=null),t.state=null,U},a.inflateGetHeader=function(t,e){var a;return t&&t.state?0==(2&(a=t.state).wrap)?T:((a.head=e).done=!1,U):T},a.inflateSetDictionary=function(t,e){var a,i=e.length;return t&&t.state?0!==(a=t.state).wrap&&11!==a.mode?T:11===a.mode&&R(1,e,i,0)!==a.check?-3:j(t,e,i,i)?(a.mode=31,-4):(a.havedict=1,U):T},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(t,e,a){"use strict";var D=t("../utils/common"),I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],U=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],T=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],F=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,a,i,n,r,s,o){var l,h,d,f,_,u,c,b,g,m=o.bits,w=0,p=0,v=0,k=0,y=0,x=0,z=0,B=0,S=0,E=0,A=null,Z=0,R=new D.Buf16(16),C=new D.Buf16(16),N=null,O=0;for(w=0;w<=15;w++)R[w]=0;for(p=0;p<i;p++)R[e[a+p]]++;for(y=m,k=15;1<=k&&0===R[k];k--);if(k<y&&(y=k),0===k)return n[r++]=20971520,n[r++]=20971520,o.bits=1,0;for(v=1;v<k&&0===R[v];v++);for(y<v&&(y=v),w=B=1;w<=15;w++)if(B<<=1,(B-=R[w])<0)return-1;if(0<B&&(0===t||1!==k))return-1;for(C[1]=0,w=1;w<15;w++)C[w+1]=C[w]+R[w];for(p=0;p<i;p++)0!==e[a+p]&&(s[C[e[a+p]]++]=p);if(0===t?(A=N=s,u=19):1===t?(A=I,Z-=257,N=U,O-=257,u=256):(A=T,N=F,u=-1),w=v,_=r,z=p=E=0,d=-1,f=(S=1<<(x=y))-1,1===t&&852<S||2===t&&592<S)return 1;for(;;){for(c=w-z,s[p]<u?(b=0,g=s[p]):s[p]>u?(b=N[O+s[p]],g=A[Z+s[p]]):(b=96,g=0),l=1<<w-z,v=h=1<<x;n[_+(E>>z)+(h-=l)]=c<<24|b<<16|g|0,0!==h;);for(l=1<<w-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,p++,0==--R[w]){if(w===k)break;w=e[a+s[p]]}if(y<w&&(E&f)!==d){for(0===z&&(z=y),_+=v,B=1<<(x=w-z);x+z<k&&!((B-=R[x+z])<=0);)x++,B<<=1;if(S+=1<<x,1===t&&852<S||2===t&&592<S)return 1;n[d=E&f]=y<<24|x<<16|_-r|0}}return 0!==E&&(n[_+E]=w-z<<24|64<<16|0),o.bits=y,0}},{"../utils/common":3}],13:[function(t,e,a){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(t,e,a){"use strict";var l=t("../utils/common"),o=0,h=1;function i(t){for(var e=t.length;0<=--e;)t[e]=0}var d=0,s=29,f=256,_=f+1+s,u=30,c=19,g=2*_+1,m=15,n=16,b=7,w=256,p=16,v=17,k=18,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=new Array(2*(_+2));i(S);var E=new Array(2*u);i(E);var A=new Array(512);i(A);var Z=new Array(256);i(Z);var R=new Array(s);i(R);var C,N,O,D=new Array(u);function I(t,e,a,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function r(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function U(t){return t<256?A[t]:A[256+(t>>>7)]}function T(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function F(t,e,a){t.bi_valid>n-a?(t.bi_buf|=e<<t.bi_valid&65535,T(t,t.bi_buf),t.bi_buf=e>>n-t.bi_valid,t.bi_valid+=a-n):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)}function L(t,e,a){F(t,a[2*e],a[2*e+1])}function H(t,e){for(var a=0;a|=1&t,t>>>=1,a<<=1,0<--e;);return a>>>1}function j(t,e,a){var i,n,r=new Array(m+1),s=0;for(i=1;i<=m;i++)r[i]=s=s+a[i-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=H(r[o]++,o))}}function K(t){var e;for(e=0;e<_;e++)t.dyn_ltree[2*e]=0;for(e=0;e<u;e++)t.dyn_dtree[2*e]=0;for(e=0;e<c;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*w]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function M(t){8<t.bi_valid?T(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function P(t,e,a,i){var n=2*e,r=2*a;return t[n]<t[r]||t[n]===t[r]&&i[e]<=i[a]}function Y(t,e,a){for(var i=t.heap[a],n=a<<1;n<=t.heap_len&&(n<t.heap_len&&P(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!P(e,i,t.heap[n],t.depth));)t.heap[a]=t.heap[n],a=n,n<<=1;t.heap[a]=i}function q(t,e,a){var i,n,r,s,o=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],n=t.pending_buf[t.l_buf+o],o++,0===i?L(t,n,e):(L(t,(r=Z[n])+f+1,e),0!==(s=y[r])&&F(t,n-=R[r],s),L(t,r=U(--i),a),0!==(s=x[r])&&F(t,i-=D[r],s)),o<t.last_lit;);L(t,w,e)}function G(t,e){var a,i,n,r=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=g,a=0;a<l;a++)0!==r[2*a]?(t.heap[++t.heap_len]=h=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)r[2*(n=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=s[2*n+1]);for(e.max_code=h,a=t.heap_len>>1;1<=a;a--)Y(t,r,a);for(n=l;a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Y(t,r,1),i=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=i,r[2*n]=r[2*a]+r[2*i],t.depth[n]=(t.depth[a]>=t.depth[i]?t.depth[a]:t.depth[i])+1,r[2*a+1]=r[2*i+1]=n,t.heap[1]=n++,Y(t,r,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var a,i,n,r,s,o,l=e.dyn_tree,h=e.max_code,d=e.stat_desc.static_tree,f=e.stat_desc.has_stree,_=e.stat_desc.extra_bits,u=e.stat_desc.extra_base,c=e.stat_desc.max_length,b=0;for(r=0;r<=m;r++)t.bl_count[r]=0;for(l[2*t.heap[t.heap_max]+1]=0,a=t.heap_max+1;a<g;a++)c<(r=l[2*l[2*(i=t.heap[a])+1]+1]+1)&&(r=c,b++),l[2*i+1]=r,h<i||(t.bl_count[r]++,s=0,u<=i&&(s=_[i-u]),o=l[2*i],t.opt_len+=o*(r+s),f&&(t.static_len+=o*(d[2*i+1]+s)));if(0!==b){do{for(r=c-1;0===t.bl_count[r];)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[c]--,b-=2}while(0<b);for(r=c;0!==r;r--)for(i=t.bl_count[r];0!==i;)h<(n=t.heap[--a])||(l[2*n+1]!==r&&(t.opt_len+=(r-l[2*n+1])*l[2*n],l[2*n+1]=r),i--)}}(t,e),j(r,h,t.bl_count)}function X(t,e,a){var i,n,r=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(a+1)+1]=65535,i=0;i<=a;i++)n=s,s=e[2*(i+1)+1],++o<l&&n===s||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==r&&t.bl_tree[2*n]++,t.bl_tree[2*p]++):o<=10?t.bl_tree[2*v]++:t.bl_tree[2*k]++,r=n,(o=0)===s?(l=138,h=3):n===s?(l=6,h=3):(l=7,h=4))}function W(t,e,a){var i,n,r=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),i=0;i<=a;i++)if(n=s,s=e[2*(i+1)+1],!(++o<l&&n===s)){if(o<h)for(;L(t,n,t.bl_tree),0!=--o;);else 0!==n?(n!==r&&(L(t,n,t.bl_tree),o--),L(t,p,t.bl_tree),F(t,o-3,2)):o<=10?(L(t,v,t.bl_tree),F(t,o-3,3)):(L(t,k,t.bl_tree),F(t,o-11,7));r=n,(o=0)===s?(l=138,h=3):n===s?(l=6,h=3):(l=7,h=4)}}i(D);var J=!1;function Q(t,e,a,i){var n,r,s,o;F(t,(d<<1)+(i?1:0),3),r=e,s=a,o=!0,M(n=t),o&&(T(n,s),T(n,~s)),l.arraySet(n.pending_buf,n.window,r,s,n.pending),n.pending+=s}a._tr_init=function(t){J||(function(){var t,e,a,i,n,r=new Array(m+1);for(i=a=0;i<s-1;i++)for(R[i]=a,t=0;t<1<<y[i];t++)Z[a++]=i;for(Z[a-1]=i,i=n=0;i<16;i++)for(D[i]=n,t=0;t<1<<x[i];t++)A[n++]=i;for(n>>=7;i<u;i++)for(D[i]=n<<7,t=0;t<1<<x[i]-7;t++)A[256+n++]=i;for(e=0;e<=m;e++)r[e]=0;for(t=0;t<=143;)S[2*t+1]=8,t++,r[8]++;for(;t<=255;)S[2*t+1]=9,t++,r[9]++;for(;t<=279;)S[2*t+1]=7,t++,r[7]++;for(;t<=287;)S[2*t+1]=8,t++,r[8]++;for(j(S,_+1,r),t=0;t<u;t++)E[2*t+1]=5,E[2*t]=H(t,5);C=new I(S,y,f+1,_,m),N=new I(E,x,0,u,m),O=new I(new Array(0),z,0,c,b)}(),J=!0),t.l_desc=new r(t.dyn_ltree,C),t.d_desc=new r(t.dyn_dtree,N),t.bl_desc=new r(t.bl_tree,O),t.bi_buf=0,t.bi_valid=0,K(t)},a._tr_stored_block=Q,a._tr_flush_block=function(t,e,a,i){var n,r,s=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return h;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return h;return o}(t)),G(t,t.l_desc),G(t,t.d_desc),s=function(t){var e;for(X(t,t.dyn_ltree,t.l_desc.max_code),X(t,t.dyn_dtree,t.d_desc.max_code),G(t,t.bl_desc),e=c-1;3<=e&&0===t.bl_tree[2*B[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(r=t.static_len+3+7>>>3)<=n&&(n=r)):n=r=a+5,a+4<=n&&-1!==e?Q(t,e,a,i):4===t.strategy||r===n?(F(t,2+(i?1:0),3),q(t,S,E)):(F(t,4+(i?1:0),3),function(t,e,a,i){var n;for(F(t,e-257,5),F(t,a-1,5),F(t,i-4,4),n=0;n<i;n++)F(t,t.bl_tree[2*B[n]+1],3);W(t,t.dyn_ltree,e-1),W(t,t.dyn_dtree,a-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),q(t,t.dyn_ltree,t.dyn_dtree)),K(t),i&&M(t)},a._tr_tally=function(t,e,a){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&a,t.last_lit++,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(Z[a]+f+1)]++,t.dyn_dtree[2*U(e)]++),t.last_lit===t.lit_bufsize-1},a._tr_align=function(t){var e;F(t,2,3),L(t,w,S),16===(e=t).bi_valid?(T(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":3}],15:[function(t,e,a){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(t,e,a){"use strict";var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")});


/***/ }),

/***/ "./node_modules/preact/dist/preact.min.js":
/*!************************************************!*\
  !*** ./node_modules/preact/dist/preact.min.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

!function(){"use strict";function e(e,t){var n,o,r,i,l=W;for(i=arguments.length;i-- >2;)P.push(arguments[i]);t&&null!=t.children&&(P.length||P.push(t.children),delete t.children);while(P.length)if((o=P.pop())&&void 0!==o.pop)for(i=o.length;i--;)P.push(o[i]);else"boolean"==typeof o&&(o=null),(r="function"!=typeof e)&&(null==o?o="":"number"==typeof o?o+="":"string"!=typeof o&&(r=!1)),r&&n?l[l.length-1]+=o:l===W?l=[o]:l.push(o),n=r;var a=new T;return a.nodeName=e,a.children=l,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,void 0!==M.vnode&&M.vnode(a),a}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){e&&("function"==typeof e?e(t):e.current=t)}function o(n,o){return e(n.nodeName,t(t({},n.attributes),o),arguments.length>2?[].slice.call(arguments,2):n.children)}function r(e){!e.__d&&(e.__d=!0)&&1==V.push(e)&&(M.debounceRendering||D)(i)}function i(){var e;while(e=V.pop())e.__d&&x(e)}function l(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&a(e,t.nodeName):n||e._componentConstructor===t.nodeName}function a(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function u(e){var n=t({},e.attributes);n.children=e.children;var o=e.nodeName.defaultProps;if(void 0!==o)for(var r in o)void 0===n[r]&&(n[r]=o[r]);return n}function c(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}function p(e){var t=e.parentNode;t&&t.removeChild(e)}function s(e,t,o,r,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n(o,null),n(r,e);else if("class"!==t||i)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof o||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof o)for(var l in o)l in r||(e.style[l]="");for(var l in r)e.style[l]="number"==typeof r[l]&&!1===E.test(l)?r[l]+"px":r[l]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?o||e.addEventListener(t,_,a):e.removeEventListener(t,_,a),(e.__l||(e.__l={}))[t]=r}else if("list"!==t&&"type"!==t&&!i&&t in e){try{e[t]=null==r?"":r}catch(e){}null!=r&&!1!==r||"spellcheck"==t||e.removeAttribute(t)}else{var u=i&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?u?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(u?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function _(e){return this.__l[e.type](M.event&&M.event(e)||e)}function f(){var e;while(e=A.shift())M.afterMount&&M.afterMount(e),e.componentDidMount&&e.componentDidMount()}function d(e,t,n,o,r,i){H++||(R=null!=r&&void 0!==r.ownerSVGElement,B=null!=e&&!("__preactattr_"in e));var l=h(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--H||(B=!1,i||f()),l}function h(e,t,n,o,r){var i=e,l=R;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0))),i.__preactattr_=!0,i;var u=t.nodeName;if("function"==typeof u)return N(e,t,n,o);if(R="svg"===u||"foreignObject"!==u&&R,u+="",(!e||!a(e,u))&&(i=c(u,R),e)){while(e.firstChild)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0)}var p=i.firstChild,s=i.__preactattr_,_=t.children;if(null==s){s=i.__preactattr_={};for(var f=i.attributes,d=f.length;d--;)s[f[d].name]=f[d].value}return!B&&_&&1===_.length&&"string"==typeof _[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=_[0]&&(p.nodeValue=_[0]):(_&&_.length||null!=p)&&m(i,_,n,o,B||null!=s.dangerouslySetInnerHTML),y(i,t.attributes,s),R=l,i}function m(e,t,n,o,r){var i,a,u,c,s,_=e.childNodes,f=[],d={},m=0,b=0,y=_.length,g=0,w=t?t.length:0;if(0!==y)for(var C=0;C<y;C++){var x=_[C],N=x.__preactattr_,k=w&&N?x._component?x._component.__k:N.key:null;null!=k?(m++,d[k]=x):(N||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(f[g++]=x)}if(0!==w)for(var C=0;C<w;C++){c=t[C],s=null;var k=c.key;if(null!=k)m&&void 0!==d[k]&&(s=d[k],d[k]=void 0,m--);else if(b<g)for(i=b;i<g;i++)if(void 0!==f[i]&&l(a=f[i],c,r)){s=a,f[i]=void 0,i===g-1&&g--,i===b&&b++;break}s=h(s,c,n,o),u=_[C],s&&s!==e&&s!==u&&(null==u?e.appendChild(s):s===u.nextSibling?p(u):e.insertBefore(s,u))}if(m)for(var C in d)void 0!==d[C]&&v(d[C],!1);while(b<=g)void 0!==(s=f[g--])&&v(s,!1)}function v(e,t){var o=e._component;o?k(o):(null!=e.__preactattr_&&n(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||p(e),b(e))}function b(e){e=e.lastChild;while(e){var t=e.previousSibling;v(e,!0),e=t}}function y(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||s(e,o,n[o],n[o]=void 0,R);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||s(e,o,n[o],n[o]=t[o],R)}function g(e,t,n){var o,r=F.length;e.prototype&&e.prototype.render?(o=new e(t,n),U.call(o,t,n)):(o=new U(t,n),o.constructor=e,o.render=w);while(r--)if(F[r].constructor===e)return o.__b=F[r].__b,F.splice(r,1),o;return o}function w(e,t,n){return this.constructor(e,n)}function C(e,t,o,i,l){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||l?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(e.__c||(e.__c=e.context),e.context=i),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==o&&(1!==o&&!1===M.syncComponentUpdates&&e.base?r(e):x(e,1,l)),n(e.__r,e))}function x(e,n,o,r){if(!e.__x){var i,l,a,c=e.props,p=e.state,s=e.context,_=e.__p||c,h=e.__s||p,m=e.__c||s,b=e.base,y=e.__b,w=b||y,N=e._component,U=!1,S=m;if(e.constructor.getDerivedStateFromProps&&(p=t(t({},p),e.constructor.getDerivedStateFromProps(c,p)),e.state=p),b&&(e.props=_,e.state=h,e.context=m,2!==n&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,p,s)?U=!0:e.componentWillUpdate&&e.componentWillUpdate(c,p,s),e.props=c,e.state=p,e.context=s),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!U){i=e.render(c,p,s),e.getChildContext&&(s=t(t({},s),e.getChildContext())),b&&e.getSnapshotBeforeUpdate&&(S=e.getSnapshotBeforeUpdate(_,h));var L,T,P=i&&i.nodeName;if("function"==typeof P){var W=u(i);l=N,l&&l.constructor===P&&W.key==l.__k?C(l,W,1,s,!1):(L=l,e._component=l=g(P,W,s),l.__b=l.__b||y,l.__u=e,C(l,W,0,s,!1),x(l,1,o,!0)),T=l.base}else a=w,L=N,L&&(a=e._component=null),(w||1===n)&&(a&&(a._component=null),T=d(a,i,s,o||!b,w&&w.parentNode,!0));if(w&&T!==w&&l!==N){var D=w.parentNode;D&&T!==D&&(D.replaceChild(T,w),L||(w._component=null,v(w,!1)))}if(L&&k(L),e.base=T,T&&!r){var E=e,V=e;while(V=V.__u)(E=V).base=T;T._component=E,T._componentConstructor=E.constructor}}!b||o?A.push(e):U||(e.componentDidUpdate&&e.componentDidUpdate(_,h,S),M.afterUpdate&&M.afterUpdate(e));while(e.__h.length)e.__h.pop().call(e);H||r||f()}}function N(e,t,n,o){var r=e&&e._component,i=r,l=e,a=r&&e._componentConstructor===t.nodeName,c=a,p=u(t);while(r&&!c&&(r=r.__u))c=r.constructor===t.nodeName;return r&&c&&(!o||r._component)?(C(r,p,3,n,o),e=r.base):(i&&!a&&(k(i),e=l=null),r=g(t.nodeName,p,n),e&&!r.__b&&(r.__b=e,l=null),C(r,p,1,n,o),e=r.base,l&&e!==l&&(l._component=null,v(l,!1))),e}function k(e){M.beforeUnmount&&M.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?k(o):t&&(null!=t.__preactattr_&&n(t.__preactattr_.ref,null),e.__b=t,p(t),F.push(e),b(t)),n(e.__r,null)}function U(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}function S(e,t,n){return d(n,e,{},!1,t,!1)}function L(){return{}}var T=function(){},M={},P=[],W=[],D="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,E=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,V=[],A=[],H=0,R=!1,B=!1,F=[];t(U.prototype,{setState:function(e,n){this.__s||(this.__s=this.state),this.state=t(t({},this.state),"function"==typeof e?e(this.state,this.props):e),n&&this.__h.push(n),r(this)},forceUpdate:function(e){e&&this.__h.push(e),x(this,2)},render:function(){}});var j={h:e,createElement:e,cloneElement:o,createRef:L,Component:U,render:S,rerender:i,options:M}; true?module.exports=j:undefined}();
//# sourceMappingURL=preact.min.js.map

/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };


/***/ }),

/***/ "./node_modules/style-loader/lib/addStyles.js":
/*!****************************************************!*\
  !*** ./node_modules/style-loader/lib/addStyles.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/

var stylesInDom = {};

var	memoize = function (fn) {
	var memo;

	return function () {
		if (typeof memo === "undefined") memo = fn.apply(this, arguments);
		return memo;
	};
};

var isOldIE = memoize(function () {
	// Test for IE <= 9 as proposed by Browserhacks
	// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805
	// Tests for existence of standard globals is to allow style-loader
	// to operate correctly into non-standard environments
	// @see https://github.com/webpack-contrib/style-loader/issues/177
	return window && document && document.all && !window.atob;
});

var getTarget = function (target, parent) {
  if (parent){
    return parent.querySelector(target);
  }
  return document.querySelector(target);
};

var getElement = (function (fn) {
	var memo = {};

	return function(target, parent) {
                // If passing function in options, then use it for resolve "head" element.
                // Useful for Shadow Root style i.e
                // {
                //   insertInto: function () { return document.querySelector("#foo").shadowRoot }
                // }
                if (typeof target === 'function') {
                        return target();
                }
                if (typeof memo[target] === "undefined") {
			var styleTarget = getTarget.call(this, target, parent);
			// Special case to return head of iframe instead of iframe itself
			if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
				try {
					// This will throw an exception if access to iframe is blocked
					// due to cross-origin restrictions
					styleTarget = styleTarget.contentDocument.head;
				} catch(e) {
					styleTarget = null;
				}
			}
			memo[target] = styleTarget;
		}
		return memo[target]
	};
})();

var singleton = null;
var	singletonCounter = 0;
var	stylesInsertedAtTop = [];

var	fixUrls = __webpack_require__(/*! ./urls */ "./node_modules/style-loader/lib/urls.js");

module.exports = function(list, options) {
	if (typeof DEBUG !== "undefined" && DEBUG) {
		if (typeof document !== "object") throw new Error("The style-loader cannot be used in a non-browser environment");
	}

	options = options || {};

	options.attrs = typeof options.attrs === "object" ? options.attrs : {};

	// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
	// tags it will allow on a page
	if (!options.singleton && typeof options.singleton !== "boolean") options.singleton = isOldIE();

	// By default, add <style> tags to the <head> element
        if (!options.insertInto) options.insertInto = "head";

	// By default, add <style> tags to the bottom of the target
	if (!options.insertAt) options.insertAt = "bottom";

	var styles = listToStyles(list, options);

	addStylesToDom(styles, options);

	return function update (newList) {
		var mayRemove = [];

		for (var i = 0; i < styles.length; i++) {
			var item = styles[i];
			var domStyle = stylesInDom[item.id];

			domStyle.refs--;
			mayRemove.push(domStyle);
		}

		if(newList) {
			var newStyles = listToStyles(newList, options);
			addStylesToDom(newStyles, options);
		}

		for (var i = 0; i < mayRemove.length; i++) {
			var domStyle = mayRemove[i];

			if(domStyle.refs === 0) {
				for (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();

				delete stylesInDom[domStyle.id];
			}
		}
	};
};

function addStylesToDom (styles, options) {
	for (var i = 0; i < styles.length; i++) {
		var item = styles[i];
		var domStyle = stylesInDom[item.id];

		if(domStyle) {
			domStyle.refs++;

			for(var j = 0; j < domStyle.parts.length; j++) {
				domStyle.parts[j](item.parts[j]);
			}

			for(; j < item.parts.length; j++) {
				domStyle.parts.push(addStyle(item.parts[j], options));
			}
		} else {
			var parts = [];

			for(var j = 0; j < item.parts.length; j++) {
				parts.push(addStyle(item.parts[j], options));
			}

			stylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};
		}
	}
}

function listToStyles (list, options) {
	var styles = [];
	var newStyles = {};

	for (var i = 0; i < list.length; i++) {
		var item = list[i];
		var id = options.base ? item[0] + options.base : item[0];
		var css = item[1];
		var media = item[2];
		var sourceMap = item[3];
		var part = {css: css, media: media, sourceMap: sourceMap};

		if(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});
		else newStyles[id].parts.push(part);
	}

	return styles;
}

function insertStyleElement (options, style) {
	var target = getElement(options.insertInto)

	if (!target) {
		throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");
	}

	var lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];

	if (options.insertAt === "top") {
		if (!lastStyleElementInsertedAtTop) {
			target.insertBefore(style, target.firstChild);
		} else if (lastStyleElementInsertedAtTop.nextSibling) {
			target.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);
		} else {
			target.appendChild(style);
		}
		stylesInsertedAtTop.push(style);
	} else if (options.insertAt === "bottom") {
		target.appendChild(style);
	} else if (typeof options.insertAt === "object" && options.insertAt.before) {
		var nextSibling = getElement(options.insertAt.before, target);
		target.insertBefore(style, nextSibling);
	} else {
		throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");
	}
}

function removeStyleElement (style) {
	if (style.parentNode === null) return false;
	style.parentNode.removeChild(style);

	var idx = stylesInsertedAtTop.indexOf(style);
	if(idx >= 0) {
		stylesInsertedAtTop.splice(idx, 1);
	}
}

function createStyleElement (options) {
	var style = document.createElement("style");

	if(options.attrs.type === undefined) {
		options.attrs.type = "text/css";
	}

	if(options.attrs.nonce === undefined) {
		var nonce = getNonce();
		if (nonce) {
			options.attrs.nonce = nonce;
		}
	}

	addAttrs(style, options.attrs);
	insertStyleElement(options, style);

	return style;
}

function createLinkElement (options) {
	var link = document.createElement("link");

	if(options.attrs.type === undefined) {
		options.attrs.type = "text/css";
	}
	options.attrs.rel = "stylesheet";

	addAttrs(link, options.attrs);
	insertStyleElement(options, link);

	return link;
}

function addAttrs (el, attrs) {
	Object.keys(attrs).forEach(function (key) {
		el.setAttribute(key, attrs[key]);
	});
}

function getNonce() {
	if (false) {}

	return __webpack_require__.nc;
}

function addStyle (obj, options) {
	var style, update, remove, result;

	// If a transform function was defined, run it on the css
	if (options.transform && obj.css) {
	    result = typeof options.transform === 'function'
		 ? options.transform(obj.css) 
		 : options.transform.default(obj.css);

	    if (result) {
	    	// If transform returns a value, use that instead of the original css.
	    	// This allows running runtime transformations on the css.
	    	obj.css = result;
	    } else {
	    	// If the transform function returns a falsy value, don't add this css.
	    	// This allows conditional loading of css
	    	return function() {
	    		// noop
	    	};
	    }
	}

	if (options.singleton) {
		var styleIndex = singletonCounter++;

		style = singleton || (singleton = createStyleElement(options));

		update = applyToSingletonTag.bind(null, style, styleIndex, false);
		remove = applyToSingletonTag.bind(null, style, styleIndex, true);

	} else if (
		obj.sourceMap &&
		typeof URL === "function" &&
		typeof URL.createObjectURL === "function" &&
		typeof URL.revokeObjectURL === "function" &&
		typeof Blob === "function" &&
		typeof btoa === "function"
	) {
		style = createLinkElement(options);
		update = updateLink.bind(null, style, options);
		remove = function () {
			removeStyleElement(style);

			if(style.href) URL.revokeObjectURL(style.href);
		};
	} else {
		style = createStyleElement(options);
		update = applyToTag.bind(null, style);
		remove = function () {
			removeStyleElement(style);
		};
	}

	update(obj);

	return function updateStyle (newObj) {
		if (newObj) {
			if (
				newObj.css === obj.css &&
				newObj.media === obj.media &&
				newObj.sourceMap === obj.sourceMap
			) {
				return;
			}

			update(obj = newObj);
		} else {
			remove();
		}
	};
}

var replaceText = (function () {
	var textStore = [];

	return function (index, replacement) {
		textStore[index] = replacement;

		return textStore.filter(Boolean).join('\n');
	};
})();

function applyToSingletonTag (style, index, remove, obj) {
	var css = remove ? "" : obj.css;

	if (style.styleSheet) {
		style.styleSheet.cssText = replaceText(index, css);
	} else {
		var cssNode = document.createTextNode(css);
		var childNodes = style.childNodes;

		if (childNodes[index]) style.removeChild(childNodes[index]);

		if (childNodes.length) {
			style.insertBefore(cssNode, childNodes[index]);
		} else {
			style.appendChild(cssNode);
		}
	}
}

function applyToTag (style, obj) {
	var css = obj.css;
	var media = obj.media;

	if(media) {
		style.setAttribute("media", media)
	}

	if(style.styleSheet) {
		style.styleSheet.cssText = css;
	} else {
		while(style.firstChild) {
			style.removeChild(style.firstChild);
		}

		style.appendChild(document.createTextNode(css));
	}
}

function updateLink (link, options, obj) {
	var css = obj.css;
	var sourceMap = obj.sourceMap;

	/*
		If convertToAbsoluteUrls isn't defined, but sourcemaps are enabled
		and there is no publicPath defined then lets turn convertToAbsoluteUrls
		on by default.  Otherwise default to the convertToAbsoluteUrls option
		directly
	*/
	var autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;

	if (options.convertToAbsoluteUrls || autoFixUrls) {
		css = fixUrls(css);
	}

	if (sourceMap) {
		// http://stackoverflow.com/a/26603875
		css += "\n/*# sourceMappingURL=data:application/json;base64," + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + " */";
	}

	var blob = new Blob([css], { type: "text/css" });

	var oldSrc = link.href;

	link.href = URL.createObjectURL(blob);

	if(oldSrc) URL.revokeObjectURL(oldSrc);
}


/***/ }),

/***/ "./node_modules/style-loader/lib/urls.js":
/*!***********************************************!*\
  !*** ./node_modules/style-loader/lib/urls.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports) {


/**
 * When source maps are enabled, `style-loader` uses a link element with a data-uri to
 * embed the css on the page. This breaks all relative urls because now they are relative to a
 * bundle instead of the current page.
 *
 * One solution is to only use full urls, but that may be impossible.
 *
 * Instead, this function "fixes" the relative urls to be absolute according to the current page location.
 *
 * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.
 *
 */

module.exports = function (css) {
  // get current location
  var location = typeof window !== "undefined" && window.location;

  if (!location) {
    throw new Error("fixUrls requires window.location");
  }

	// blank or null?
	if (!css || typeof css !== "string") {
	  return css;
  }

  var baseUrl = location.protocol + "//" + location.host;
  var currentDir = baseUrl + location.pathname.replace(/\/[^\/]*$/, "/");

	// convert each url(...)
	/*
	This regular expression is just a way to recursively match brackets within
	a string.

	 /url\s*\(  = Match on the word "url" with any whitespace after it and then a parens
	   (  = Start a capturing group
	     (?:  = Start a non-capturing group
	         [^)(]  = Match anything that isn't a parentheses
	         |  = OR
	         \(  = Match a start parentheses
	             (?:  = Start another non-capturing groups
	                 [^)(]+  = Match anything that isn't a parentheses
	                 |  = OR
	                 \(  = Match a start parentheses
	                     [^)(]*  = Match anything that isn't a parentheses
	                 \)  = Match a end parentheses
	             )  = End Group
              *\) = Match anything and then a close parens
          )  = Close non-capturing group
          *  = Match anything
       )  = Close capturing group
	 \)  = Match a close parens

	 /gi  = Get all matches, not the first.  Be case insensitive.
	 */
	var fixedCss = css.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi, function(fullMatch, origUrl) {
		// strip quotes (if they exist)
		var unquotedOrigUrl = origUrl
			.trim()
			.replace(/^"(.*)"$/, function(o, $1){ return $1; })
			.replace(/^'(.*)'$/, function(o, $1){ return $1; });

		// already a full url? no change
		if (/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(unquotedOrigUrl)) {
		  return fullMatch;
		}

		// convert the url to a full url
		var newUrl;

		if (unquotedOrigUrl.indexOf("//") === 0) {
		  	//TODO: should we add protocol?
			newUrl = unquotedOrigUrl;
		} else if (unquotedOrigUrl.indexOf("/") === 0) {
			// path should be relative to the base url
			newUrl = baseUrl + unquotedOrigUrl; // already starts with '/'
		} else {
			// path should be relative to current directory
			newUrl = currentDir + unquotedOrigUrl.replace(/^\.\//, ""); // Strip leading './'
		}

		// send back the fixed url(...)
		return "url(" + JSON.stringify(newUrl) + ")";
	});

	// send back the fixed css
	return fixedCss;
};


/***/ }),

/***/ "./node_modules/supports-color/browser.js":
/*!************************************************!*\
  !*** ./node_modules/supports-color/browser.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

module.exports = {
	stdout: false,
	stderr: false
};


/***/ }),

/***/ "./node_modules/tapable/lib/AsyncParallelBailHook.js":
/*!***********************************************************!*\
  !*** ./node_modules/tapable/lib/AsyncParallelBailHook.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _defineProperties = __webpack_require__(/*! babel-runtime/core-js/object/define-properties */ "./node_modules/babel-runtime/core-js/object/define-properties.js");

var _defineProperties2 = _interopRequireDefault(_defineProperties);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var AsyncParallelBailHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(AsyncParallelBailHookCodeFactory, _HookCodeFactory);

	function AsyncParallelBailHookCodeFactory() {
		(0, _classCallCheck3.default)(this, AsyncParallelBailHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncParallelBailHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(AsyncParallelBailHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncParallelBailHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var onError = _ref.onError,
			    onResult = _ref.onResult,
			    onDone = _ref.onDone;

			var code = "";
			code += "var _results = new Array(" + this.options.taps.length + ");\n";
			code += "var _checkDone = () => {\n";
			code += "for(var i = 0; i < _results.length; i++) {\n";
			code += "var item = _results[i];\n";
			code += "if(item === undefined) return false;\n";
			code += "if(item.result !== undefined) {\n";
			code += onResult("item.result");
			code += "return true;\n";
			code += "}\n";
			code += "if(item.error) {\n";
			code += onError("item.error");
			code += "return true;\n";
			code += "}\n";
			code += "}\n";
			code += "return false;\n";
			code += "}\n";
			code += this.callTapsParallel({
				onError: function onError(i, err, done, doneBreak) {
					var code = "";
					code += "if(" + i + " < _results.length && ((_results.length = " + (i + 1) + "), (_results[" + i + "] = { error: " + err + " }), _checkDone())) {\n";
					code += doneBreak(true);
					code += "} else {\n";
					code += done();
					code += "}\n";
					return code;
				},
				onResult: function onResult(i, result, done, doneBreak) {
					var code = "";
					code += "if(" + i + " < _results.length && (" + result + " !== undefined && (_results.length = " + (i + 1) + "), (_results[" + i + "] = { result: " + result + " }), _checkDone())) {\n";
					code += doneBreak(true);
					code += "} else {\n";
					code += done();
					code += "}\n";
					return code;
				},
				onTap: function onTap(i, run, done, doneBreak) {
					var code = "";
					if (i > 0) {
						code += "if(" + i + " >= _results.length) {\n";
						code += done();
						code += "} else {\n";
					}
					code += run();
					if (i > 0) code += "}\n";
					return code;
				},
				onDone: onDone
			});
			return code;
		}
	}]);
	return AsyncParallelBailHookCodeFactory;
}(HookCodeFactory);

var factory = new AsyncParallelBailHookCodeFactory();

var AsyncParallelBailHook = function (_Hook) {
	(0, _inherits3.default)(AsyncParallelBailHook, _Hook);

	function AsyncParallelBailHook() {
		(0, _classCallCheck3.default)(this, AsyncParallelBailHook);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncParallelBailHook.__proto__ || (0, _getPrototypeOf2.default)(AsyncParallelBailHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncParallelBailHook, [{
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return AsyncParallelBailHook;
}(Hook);

(0, _defineProperties2.default)(AsyncParallelBailHook.prototype, {
	_call: { value: undefined, configurable: true, writable: true }
});

module.exports = AsyncParallelBailHook;

/***/ }),

/***/ "./node_modules/tapable/lib/AsyncParallelHook.js":
/*!*******************************************************!*\
  !*** ./node_modules/tapable/lib/AsyncParallelHook.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _defineProperties = __webpack_require__(/*! babel-runtime/core-js/object/define-properties */ "./node_modules/babel-runtime/core-js/object/define-properties.js");

var _defineProperties2 = _interopRequireDefault(_defineProperties);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var AsyncParallelHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(AsyncParallelHookCodeFactory, _HookCodeFactory);

	function AsyncParallelHookCodeFactory() {
		(0, _classCallCheck3.default)(this, AsyncParallelHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncParallelHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(AsyncParallelHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncParallelHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _onError = _ref.onError,
			    onDone = _ref.onDone;

			return this.callTapsParallel({
				onError: function onError(i, err, done, doneBreak) {
					return _onError(err) + doneBreak(true);
				},
				onDone: onDone
			});
		}
	}]);
	return AsyncParallelHookCodeFactory;
}(HookCodeFactory);

var factory = new AsyncParallelHookCodeFactory();

var AsyncParallelHook = function (_Hook) {
	(0, _inherits3.default)(AsyncParallelHook, _Hook);

	function AsyncParallelHook() {
		(0, _classCallCheck3.default)(this, AsyncParallelHook);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncParallelHook.__proto__ || (0, _getPrototypeOf2.default)(AsyncParallelHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncParallelHook, [{
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return AsyncParallelHook;
}(Hook);

(0, _defineProperties2.default)(AsyncParallelHook.prototype, {
	_call: { value: undefined, configurable: true, writable: true }
});

module.exports = AsyncParallelHook;

/***/ }),

/***/ "./node_modules/tapable/lib/AsyncSeriesBailHook.js":
/*!*********************************************************!*\
  !*** ./node_modules/tapable/lib/AsyncSeriesBailHook.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _defineProperties = __webpack_require__(/*! babel-runtime/core-js/object/define-properties */ "./node_modules/babel-runtime/core-js/object/define-properties.js");

var _defineProperties2 = _interopRequireDefault(_defineProperties);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var AsyncSeriesBailHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(AsyncSeriesBailHookCodeFactory, _HookCodeFactory);

	function AsyncSeriesBailHookCodeFactory() {
		(0, _classCallCheck3.default)(this, AsyncSeriesBailHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncSeriesBailHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(AsyncSeriesBailHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncSeriesBailHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _onError = _ref.onError,
			    _onResult = _ref.onResult,
			    resultReturns = _ref.resultReturns,
			    onDone = _ref.onDone;

			return this.callTapsSeries({
				onError: function onError(i, err, next, doneBreak) {
					return _onError(err) + doneBreak(true);
				},
				onResult: function onResult(i, result, next) {
					return "if(" + result + " !== undefined) {\n" + _onResult(result) + ";\n} else {\n" + next() + "}\n";
				},
				resultReturns: resultReturns,
				onDone: onDone
			});
		}
	}]);
	return AsyncSeriesBailHookCodeFactory;
}(HookCodeFactory);

var factory = new AsyncSeriesBailHookCodeFactory();

var AsyncSeriesBailHook = function (_Hook) {
	(0, _inherits3.default)(AsyncSeriesBailHook, _Hook);

	function AsyncSeriesBailHook() {
		(0, _classCallCheck3.default)(this, AsyncSeriesBailHook);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncSeriesBailHook.__proto__ || (0, _getPrototypeOf2.default)(AsyncSeriesBailHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncSeriesBailHook, [{
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return AsyncSeriesBailHook;
}(Hook);

(0, _defineProperties2.default)(AsyncSeriesBailHook.prototype, {
	_call: { value: undefined, configurable: true, writable: true }
});

module.exports = AsyncSeriesBailHook;

/***/ }),

/***/ "./node_modules/tapable/lib/AsyncSeriesHook.js":
/*!*****************************************************!*\
  !*** ./node_modules/tapable/lib/AsyncSeriesHook.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _defineProperties = __webpack_require__(/*! babel-runtime/core-js/object/define-properties */ "./node_modules/babel-runtime/core-js/object/define-properties.js");

var _defineProperties2 = _interopRequireDefault(_defineProperties);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var AsyncSeriesHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(AsyncSeriesHookCodeFactory, _HookCodeFactory);

	function AsyncSeriesHookCodeFactory() {
		(0, _classCallCheck3.default)(this, AsyncSeriesHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncSeriesHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(AsyncSeriesHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncSeriesHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _onError = _ref.onError,
			    onDone = _ref.onDone;

			return this.callTapsSeries({
				onError: function onError(i, err, next, doneBreak) {
					return _onError(err) + doneBreak(true);
				},
				onDone: onDone
			});
		}
	}]);
	return AsyncSeriesHookCodeFactory;
}(HookCodeFactory);

var factory = new AsyncSeriesHookCodeFactory();

var AsyncSeriesHook = function (_Hook) {
	(0, _inherits3.default)(AsyncSeriesHook, _Hook);

	function AsyncSeriesHook() {
		(0, _classCallCheck3.default)(this, AsyncSeriesHook);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncSeriesHook.__proto__ || (0, _getPrototypeOf2.default)(AsyncSeriesHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncSeriesHook, [{
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return AsyncSeriesHook;
}(Hook);

(0, _defineProperties2.default)(AsyncSeriesHook.prototype, {
	_call: { value: undefined, configurable: true, writable: true }
});

module.exports = AsyncSeriesHook;

/***/ }),

/***/ "./node_modules/tapable/lib/AsyncSeriesWaterfallHook.js":
/*!**************************************************************!*\
  !*** ./node_modules/tapable/lib/AsyncSeriesWaterfallHook.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _defineProperties = __webpack_require__(/*! babel-runtime/core-js/object/define-properties */ "./node_modules/babel-runtime/core-js/object/define-properties.js");

var _defineProperties2 = _interopRequireDefault(_defineProperties);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var AsyncSeriesWaterfallHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(AsyncSeriesWaterfallHookCodeFactory, _HookCodeFactory);

	function AsyncSeriesWaterfallHookCodeFactory() {
		(0, _classCallCheck3.default)(this, AsyncSeriesWaterfallHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (AsyncSeriesWaterfallHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(AsyncSeriesWaterfallHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(AsyncSeriesWaterfallHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _this2 = this;

			var _onError = _ref.onError,
			    onResult = _ref.onResult,
			    onDone = _ref.onDone;

			return this.callTapsSeries({
				onError: function onError(i, err, next, doneBreak) {
					return _onError(err) + doneBreak(true);
				},
				onResult: function onResult(i, result, next) {
					var code = "";
					code += "if(" + result + " !== undefined) {\n";
					code += _this2._args[0] + " = " + result + ";\n";
					code += "}\n";
					code += next();
					return code;
				},
				onDone: function onDone() {
					return onResult(_this2._args[0]);
				}
			});
		}
	}]);
	return AsyncSeriesWaterfallHookCodeFactory;
}(HookCodeFactory);

var factory = new AsyncSeriesWaterfallHookCodeFactory();

var AsyncSeriesWaterfallHook = function (_Hook) {
	(0, _inherits3.default)(AsyncSeriesWaterfallHook, _Hook);

	function AsyncSeriesWaterfallHook(args) {
		(0, _classCallCheck3.default)(this, AsyncSeriesWaterfallHook);

		var _this3 = (0, _possibleConstructorReturn3.default)(this, (AsyncSeriesWaterfallHook.__proto__ || (0, _getPrototypeOf2.default)(AsyncSeriesWaterfallHook)).call(this, args));

		if (args.length < 1) throw new Error("Waterfall hooks must have at least one argument");
		return _this3;
	}

	(0, _createClass3.default)(AsyncSeriesWaterfallHook, [{
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return AsyncSeriesWaterfallHook;
}(Hook);

(0, _defineProperties2.default)(AsyncSeriesWaterfallHook.prototype, {
	_call: { value: undefined, configurable: true, writable: true }
});

module.exports = AsyncSeriesWaterfallHook;

/***/ }),

/***/ "./node_modules/tapable/lib/Hook.js":
/*!******************************************!*\
  !*** ./node_modules/tapable/lib/Hook.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _defineProperties = __webpack_require__(/*! babel-runtime/core-js/object/define-properties */ "./node_modules/babel-runtime/core-js/object/define-properties.js");

var _defineProperties2 = _interopRequireDefault(_defineProperties);

var _set = __webpack_require__(/*! babel-runtime/core-js/set */ "./node_modules/babel-runtime/core-js/set.js");

var _set2 = _interopRequireDefault(_set);

var _create = __webpack_require__(/*! babel-runtime/core-js/object/create */ "./node_modules/babel-runtime/core-js/object/create.js");

var _create2 = _interopRequireDefault(_create);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ "./node_modules/babel-runtime/helpers/typeof.js");

var _typeof3 = _interopRequireDefault(_typeof2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = function () {
	function Hook(args) {
		(0, _classCallCheck3.default)(this, Hook);

		if (!Array.isArray(args)) args = [];
		this._args = args;
		this.taps = [];
		this.interceptors = [];
		this.call = this._call;
		this.promise = this._promise;
		this.callAsync = this._callAsync;
		this._x = undefined;
	}

	(0, _createClass3.default)(Hook, [{
		key: "compile",
		value: function compile(options) {
			throw new Error("Abstract: should be overriden");
		}
	}, {
		key: "_createCall",
		value: function _createCall(type) {
			return this.compile({
				taps: this.taps,
				interceptors: this.interceptors,
				args: this._args,
				type: type
			});
		}
	}, {
		key: "tap",
		value: function tap(options, fn) {
			if (typeof options === "string") options = { name: options };
			if ((typeof options === "undefined" ? "undefined" : (0, _typeof3.default)(options)) !== "object" || options === null) throw new Error("Invalid arguments to tap(options: Object, fn: function)");
			options = (0, _assign2.default)({ type: "sync", fn: fn }, options);
			if (typeof options.name !== "string" || options.name === "") throw new Error("Missing name for tap");
			options = this._runRegisterInterceptors(options);
			this._insert(options);
		}
	}, {
		key: "tapAsync",
		value: function tapAsync(options, fn) {
			if (typeof options === "string") options = { name: options };
			if ((typeof options === "undefined" ? "undefined" : (0, _typeof3.default)(options)) !== "object" || options === null) throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");
			options = (0, _assign2.default)({ type: "async", fn: fn }, options);
			if (typeof options.name !== "string" || options.name === "") throw new Error("Missing name for tapAsync");
			options = this._runRegisterInterceptors(options);
			this._insert(options);
		}
	}, {
		key: "tapPromise",
		value: function tapPromise(options, fn) {
			if (typeof options === "string") options = { name: options };
			if ((typeof options === "undefined" ? "undefined" : (0, _typeof3.default)(options)) !== "object" || options === null) throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");
			options = (0, _assign2.default)({ type: "promise", fn: fn }, options);
			if (typeof options.name !== "string" || options.name === "") throw new Error("Missing name for tapPromise");
			options = this._runRegisterInterceptors(options);
			this._insert(options);
		}
	}, {
		key: "_runRegisterInterceptors",
		value: function _runRegisterInterceptors(options) {
			var _iteratorNormalCompletion = true;
			var _didIteratorError = false;
			var _iteratorError = undefined;

			try {
				for (var _iterator = (0, _getIterator3.default)(this.interceptors), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
					var interceptor = _step.value;

					if (interceptor.register) {
						var newOptions = interceptor.register(options);
						if (newOptions !== undefined) options = newOptions;
					}
				}
			} catch (err) {
				_didIteratorError = true;
				_iteratorError = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion && _iterator.return) {
						_iterator.return();
					}
				} finally {
					if (_didIteratorError) {
						throw _iteratorError;
					}
				}
			}

			return options;
		}
	}, {
		key: "withOptions",
		value: function withOptions(options) {
			var mergeOptions = function mergeOptions(opt) {
				return (0, _assign2.default)({}, options, typeof opt === "string" ? { name: opt } : opt);
			};

			// Prevent creating endless prototype chains
			options = (0, _assign2.default)({}, options, this._withOptions);
			var base = this._withOptionsBase || this;
			var newHook = (0, _create2.default)(base);

			newHook.tapAsync = function (opt, fn) {
				return base.tapAsync(mergeOptions(opt), fn);
			}, newHook.tap = function (opt, fn) {
				return base.tap(mergeOptions(opt), fn);
			};
			newHook.tapPromise = function (opt, fn) {
				return base.tapPromise(mergeOptions(opt), fn);
			};
			newHook._withOptions = options;
			newHook._withOptionsBase = base;
			return newHook;
		}
	}, {
		key: "isUsed",
		value: function isUsed() {
			return this.taps.length > 0 || this.interceptors.length > 0;
		}
	}, {
		key: "intercept",
		value: function intercept(interceptor) {
			this._resetCompilation();
			this.interceptors.push((0, _assign2.default)({}, interceptor));
			if (interceptor.register) {
				for (var i = 0; i < this.taps.length; i++) {
					this.taps[i] = interceptor.register(this.taps[i]);
				}
			}
		}
	}, {
		key: "_resetCompilation",
		value: function _resetCompilation() {
			this.call = this._call;
			this.callAsync = this._callAsync;
			this.promise = this._promise;
		}
	}, {
		key: "_insert",
		value: function _insert(item) {
			this._resetCompilation();
			var before = void 0;
			if (typeof item.before === "string") before = new _set2.default([item.before]);else if (Array.isArray(item.before)) {
				before = new _set2.default(item.before);
			}
			var stage = 0;
			if (typeof item.stage === "number") stage = item.stage;
			var i = this.taps.length;
			while (i > 0) {
				i--;
				var x = this.taps[i];
				this.taps[i + 1] = x;
				var xStage = x.stage || 0;
				if (before) {
					if (before.has(x.name)) {
						before.delete(x.name);
						continue;
					}
					if (before.size > 0) {
						continue;
					}
				}
				if (xStage > stage) {
					continue;
				}
				i++;
				break;
			}
			this.taps[i] = item;
		}
	}]);
	return Hook;
}();

function createCompileDelegate(name, type) {
	return function lazyCompileHook() {
		this[name] = this._createCall(type);
		return this[name].apply(this, arguments);
	};
}

(0, _defineProperties2.default)(Hook.prototype, {
	_call: {
		value: createCompileDelegate("call", "sync"),
		configurable: true,
		writable: true
	},
	_promise: {
		value: createCompileDelegate("promise", "promise"),
		configurable: true,
		writable: true
	},
	_callAsync: {
		value: createCompileDelegate("callAsync", "async"),
		configurable: true,
		writable: true
	}
});

module.exports = Hook;

/***/ }),

/***/ "./node_modules/tapable/lib/HookCodeFactory.js":
/*!*****************************************************!*\
  !*** ./node_modules/tapable/lib/HookCodeFactory.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var HookCodeFactory = function () {
	function HookCodeFactory(config) {
		(0, _classCallCheck3.default)(this, HookCodeFactory);

		this.config = config;
		this.options = undefined;
		this._args = undefined;
	}

	(0, _createClass3.default)(HookCodeFactory, [{
		key: "create",
		value: function create(options) {
			this.init(options);
			var fn = void 0;
			switch (this.options.type) {
				case "sync":
					fn = new Function(this.args(), '"use strict";\n' + this.header() + this.content({
						onError: function onError(err) {
							return "throw " + err + ";\n";
						},
						onResult: function onResult(result) {
							return "return " + result + ";\n";
						},
						resultReturns: true,
						onDone: function onDone() {
							return "";
						},
						rethrowIfPossible: true
					}));
					break;
				case "async":
					fn = new Function(this.args({
						after: "_callback"
					}), '"use strict";\n' + this.header() + this.content({
						onError: function onError(err) {
							return "_callback(" + err + ");\n";
						},
						onResult: function onResult(result) {
							return "_callback(null, " + result + ");\n";
						},
						onDone: function onDone() {
							return "_callback();\n";
						}
					}));
					break;
				case "promise":
					var errorHelperUsed = false;
					var content = this.content({
						onError: function onError(err) {
							errorHelperUsed = true;
							return "_error(" + err + ");\n";
						},
						onResult: function onResult(result) {
							return "_resolve(" + result + ");\n";
						},
						onDone: function onDone() {
							return "_resolve();\n";
						}
					});
					var code = "";
					code += '"use strict";\n';
					code += "return new Promise((_resolve, _reject) => {\n";
					if (errorHelperUsed) {
						code += "var _sync = true;\n";
						code += "function _error(_err) {\n";
						code += "if(_sync)\n";
						code += "_resolve(Promise.resolve().then(() => { throw _err; }));\n";
						code += "else\n";
						code += "_reject(_err);\n";
						code += "};\n";
					}
					code += this.header();
					code += content;
					if (errorHelperUsed) {
						code += "_sync = false;\n";
					}
					code += "});\n";
					fn = new Function(this.args(), code);
					break;
			}
			this.deinit();
			return fn;
		}
	}, {
		key: "setup",
		value: function setup(instance, options) {
			instance._x = options.taps.map(function (t) {
				return t.fn;
			});
		}

		/**
   * @param {{ type: "sync" | "promise" | "async", taps: Array<Tap>, interceptors: Array<Interceptor> }} options
   */

	}, {
		key: "init",
		value: function init(options) {
			this.options = options;
			this._args = options.args.slice();
		}
	}, {
		key: "deinit",
		value: function deinit() {
			this.options = undefined;
			this._args = undefined;
		}
	}, {
		key: "header",
		value: function header() {
			var code = "";
			if (this.needContext()) {
				code += "var _context = {};\n";
			} else {
				code += "var _context;\n";
			}
			code += "var _x = this._x;\n";
			if (this.options.interceptors.length > 0) {
				code += "var _taps = this.taps;\n";
				code += "var _interceptors = this.interceptors;\n";
			}
			for (var i = 0; i < this.options.interceptors.length; i++) {
				var interceptor = this.options.interceptors[i];
				if (interceptor.call) {
					code += this.getInterceptor(i) + ".call(" + this.args({
						before: interceptor.context ? "_context" : undefined
					}) + ");\n";
				}
			}
			return code;
		}
	}, {
		key: "needContext",
		value: function needContext() {
			var _iteratorNormalCompletion = true;
			var _didIteratorError = false;
			var _iteratorError = undefined;

			try {
				for (var _iterator = (0, _getIterator3.default)(this.options.taps), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
					var tap = _step.value;
					if (tap.context) return true;
				}
			} catch (err) {
				_didIteratorError = true;
				_iteratorError = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion && _iterator.return) {
						_iterator.return();
					}
				} finally {
					if (_didIteratorError) {
						throw _iteratorError;
					}
				}
			}

			return false;
		}
	}, {
		key: "callTap",
		value: function callTap(tapIndex, _ref) {
			var onError = _ref.onError,
			    onResult = _ref.onResult,
			    onDone = _ref.onDone,
			    rethrowIfPossible = _ref.rethrowIfPossible;

			var code = "";
			var hasTapCached = false;
			for (var i = 0; i < this.options.interceptors.length; i++) {
				var interceptor = this.options.interceptors[i];
				if (interceptor.tap) {
					if (!hasTapCached) {
						code += "var _tap" + tapIndex + " = " + this.getTap(tapIndex) + ";\n";
						hasTapCached = true;
					}
					code += this.getInterceptor(i) + ".tap(" + (interceptor.context ? "_context, " : "") + "_tap" + tapIndex + ");\n";
				}
			}
			code += "var _fn" + tapIndex + " = " + this.getTapFn(tapIndex) + ";\n";
			var tap = this.options.taps[tapIndex];
			switch (tap.type) {
				case "sync":
					if (!rethrowIfPossible) {
						code += "var _hasError" + tapIndex + " = false;\n";
						code += "try {\n";
					}
					if (onResult) {
						code += "var _result" + tapIndex + " = _fn" + tapIndex + "(" + this.args({
							before: tap.context ? "_context" : undefined
						}) + ");\n";
					} else {
						code += "_fn" + tapIndex + "(" + this.args({
							before: tap.context ? "_context" : undefined
						}) + ");\n";
					}
					if (!rethrowIfPossible) {
						code += "} catch(_err) {\n";
						code += "_hasError" + tapIndex + " = true;\n";
						code += onError("_err");
						code += "}\n";
						code += "if(!_hasError" + tapIndex + ") {\n";
					}
					if (onResult) {
						code += onResult("_result" + tapIndex);
					}
					if (onDone) {
						code += onDone();
					}
					if (!rethrowIfPossible) {
						code += "}\n";
					}
					break;
				case "async":
					var cbCode = "";
					if (onResult) cbCode += "(_err" + tapIndex + ", _result" + tapIndex + ") => {\n";else cbCode += "_err" + tapIndex + " => {\n";
					cbCode += "if(_err" + tapIndex + ") {\n";
					cbCode += onError("_err" + tapIndex);
					cbCode += "} else {\n";
					if (onResult) {
						cbCode += onResult("_result" + tapIndex);
					}
					if (onDone) {
						cbCode += onDone();
					}
					cbCode += "}\n";
					cbCode += "}";
					code += "_fn" + tapIndex + "(" + this.args({
						before: tap.context ? "_context" : undefined,
						after: cbCode
					}) + ");\n";
					break;
				case "promise":
					code += "var _hasResult" + tapIndex + " = false;\n";
					code += "var _promise" + tapIndex + " = _fn" + tapIndex + "(" + this.args({
						before: tap.context ? "_context" : undefined
					}) + ");\n";
					code += "if (!_promise" + tapIndex + " || !_promise" + tapIndex + ".then)\n";
					code += "  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise" + tapIndex + " + ')');\n";
					code += "_promise" + tapIndex + ".then(_result" + tapIndex + " => {\n";
					code += "_hasResult" + tapIndex + " = true;\n";
					if (onResult) {
						code += onResult("_result" + tapIndex);
					}
					if (onDone) {
						code += onDone();
					}
					code += "}, _err" + tapIndex + " => {\n";
					code += "if(_hasResult" + tapIndex + ") throw _err" + tapIndex + ";\n";
					code += onError("_err" + tapIndex);
					code += "});\n";
					break;
			}
			return code;
		}
	}, {
		key: "callTapsSeries",
		value: function callTapsSeries(_ref2) {
			var _this = this;

			var _onError = _ref2.onError,
			    onResult = _ref2.onResult,
			    resultReturns = _ref2.resultReturns,
			    onDone = _ref2.onDone,
			    doneReturns = _ref2.doneReturns,
			    rethrowIfPossible = _ref2.rethrowIfPossible;

			if (this.options.taps.length === 0) return onDone();
			var firstAsync = this.options.taps.findIndex(function (t) {
				return t.type !== "sync";
			});
			var somethingReturns = resultReturns || doneReturns || false;
			var code = "";
			var current = onDone;

			var _loop = function _loop(j) {
				var i = j;
				var unroll = current !== onDone && _this.options.taps[i].type !== "sync";
				if (unroll) {
					code += "function _next" + i + "() {\n";
					code += current();
					code += "}\n";
					current = function current() {
						return (somethingReturns ? "return " : "") + "_next" + i + "();\n";
					};
				}
				var done = current;
				var doneBreak = function doneBreak(skipDone) {
					if (skipDone) return "";
					return onDone();
				};
				var content = _this.callTap(i, {
					onError: function onError(error) {
						return _onError(i, error, done, doneBreak);
					},
					onResult: onResult && function (result) {
						return onResult(i, result, done, doneBreak);
					},
					onDone: !onResult && done,
					rethrowIfPossible: rethrowIfPossible && (firstAsync < 0 || i < firstAsync)
				});
				current = function current() {
					return content;
				};
			};

			for (var j = this.options.taps.length - 1; j >= 0; j--) {
				_loop(j);
			}
			code += current();
			return code;
		}
	}, {
		key: "callTapsLooping",
		value: function callTapsLooping(_ref3) {
			var onError = _ref3.onError,
			    onDone = _ref3.onDone,
			    rethrowIfPossible = _ref3.rethrowIfPossible;

			if (this.options.taps.length === 0) return onDone();
			var syncOnly = this.options.taps.every(function (t) {
				return t.type === "sync";
			});
			var code = "";
			if (!syncOnly) {
				code += "var _looper = () => {\n";
				code += "var _loopAsync = false;\n";
			}
			code += "var _loop;\n";
			code += "do {\n";
			code += "_loop = false;\n";
			for (var _i = 0; _i < this.options.interceptors.length; _i++) {
				var interceptor = this.options.interceptors[_i];
				if (interceptor.loop) {
					code += this.getInterceptor(_i) + ".loop(" + this.args({
						before: interceptor.context ? "_context" : undefined
					}) + ");\n";
				}
			}
			code += this.callTapsSeries({
				onError: onError,
				onResult: function onResult(i, result, next, doneBreak) {
					var code = "";
					code += "if(" + result + " !== undefined) {\n";
					code += "_loop = true;\n";
					if (!syncOnly) code += "if(_loopAsync) _looper();\n";
					code += doneBreak(true);
					code += "} else {\n";
					code += next();
					code += "}\n";
					return code;
				},
				onDone: onDone && function () {
					var code = "";
					code += "if(!_loop) {\n";
					code += onDone();
					code += "}\n";
					return code;
				},
				rethrowIfPossible: rethrowIfPossible && syncOnly
			});
			code += "} while(_loop);\n";
			if (!syncOnly) {
				code += "_loopAsync = true;\n";
				code += "};\n";
				code += "_looper();\n";
			}
			return code;
		}
	}, {
		key: "callTapsParallel",
		value: function callTapsParallel(_ref4) {
			var _this2 = this;

			var _onError2 = _ref4.onError,
			    onResult = _ref4.onResult,
			    onDone = _ref4.onDone,
			    rethrowIfPossible = _ref4.rethrowIfPossible,
			    _ref4$onTap = _ref4.onTap,
			    onTap = _ref4$onTap === undefined ? function (i, run) {
				return run();
			} : _ref4$onTap;

			if (this.options.taps.length <= 1) {
				return this.callTapsSeries({
					onError: _onError2,
					onResult: onResult,
					onDone: onDone,
					rethrowIfPossible: rethrowIfPossible
				});
			}
			var code = "";
			code += "do {\n";
			code += "var _counter = " + this.options.taps.length + ";\n";
			if (onDone) {
				code += "var _done = () => {\n";
				code += onDone();
				code += "};\n";
			}

			var _loop2 = function _loop2(_i2) {
				var done = function done() {
					if (onDone) return "if(--_counter === 0) _done();\n";else return "--_counter;";
				};
				var doneBreak = function doneBreak(skipDone) {
					if (skipDone || !onDone) return "_counter = 0;\n";else return "_counter = 0;\n_done();\n";
				};
				code += "if(_counter <= 0) break;\n";
				code += onTap(_i2, function () {
					return _this2.callTap(_i2, {
						onError: function onError(error) {
							var code = "";
							code += "if(_counter > 0) {\n";
							code += _onError2(_i2, error, done, doneBreak);
							code += "}\n";
							return code;
						},
						onResult: onResult && function (result) {
							var code = "";
							code += "if(_counter > 0) {\n";
							code += onResult(_i2, result, done, doneBreak);
							code += "}\n";
							return code;
						},
						onDone: !onResult && function () {
							return done();
						},
						rethrowIfPossible: rethrowIfPossible
					});
				}, done, doneBreak);
			};

			for (var _i2 = 0; _i2 < this.options.taps.length; _i2++) {
				_loop2(_i2);
			}
			code += "} while(false);\n";
			return code;
		}
	}, {
		key: "args",
		value: function args() {
			var _ref5 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
			    before = _ref5.before,
			    after = _ref5.after;

			var allArgs = this._args;
			if (before) allArgs = [before].concat(allArgs);
			if (after) allArgs = allArgs.concat(after);
			if (allArgs.length === 0) {
				return "";
			} else {
				return allArgs.join(", ");
			}
		}
	}, {
		key: "getTapFn",
		value: function getTapFn(idx) {
			return "_x[" + idx + "]";
		}
	}, {
		key: "getTap",
		value: function getTap(idx) {
			return "_taps[" + idx + "]";
		}
	}, {
		key: "getInterceptor",
		value: function getInterceptor(idx) {
			return "_interceptors[" + idx + "]";
		}
	}]);
	return HookCodeFactory;
}();

module.exports = HookCodeFactory;

/***/ }),

/***/ "./node_modules/tapable/lib/HookMap.js":
/*!*********************************************!*\
  !*** ./node_modules/tapable/lib/HookMap.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _map = __webpack_require__(/*! babel-runtime/core-js/map */ "./node_modules/babel-runtime/core-js/map.js");

var _map2 = _interopRequireDefault(_map);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var HookMap = function () {
	function HookMap(factory) {
		(0, _classCallCheck3.default)(this, HookMap);

		this._map = new _map2.default();
		this._factory = factory;
		this._interceptors = [];
	}

	(0, _createClass3.default)(HookMap, [{
		key: "get",
		value: function get(key) {
			return this._map.get(key);
		}
	}, {
		key: "for",
		value: function _for(key) {
			var hook = this.get(key);
			if (hook !== undefined) {
				return hook;
			}
			var newHook = this._factory(key);
			var interceptors = this._interceptors;
			for (var i = 0; i < interceptors.length; i++) {
				newHook = interceptors[i].factory(key, newHook);
			}
			this._map.set(key, newHook);
			return newHook;
		}
	}, {
		key: "intercept",
		value: function intercept(interceptor) {
			this._interceptors.push((0, _assign2.default)({
				factory: function factory(key, hook) {
					return hook;
				}
			}, interceptor));
		}
	}, {
		key: "tap",
		value: function tap(key, options, fn) {
			return this.for(key).tap(options, fn);
		}
	}, {
		key: "tapAsync",
		value: function tapAsync(key, options, fn) {
			return this.for(key).tapAsync(options, fn);
		}
	}, {
		key: "tapPromise",
		value: function tapPromise(key, options, fn) {
			return this.for(key).tapPromise(options, fn);
		}
	}]);
	return HookMap;
}();

module.exports = HookMap;

/***/ }),

/***/ "./node_modules/tapable/lib/MultiHook.js":
/*!***********************************************!*\
  !*** ./node_modules/tapable/lib/MultiHook.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");

var MultiHook = function () {
	function MultiHook(hooks) {
		(0, _classCallCheck3.default)(this, MultiHook);

		this.hooks = hooks;
	}

	(0, _createClass3.default)(MultiHook, [{
		key: "tap",
		value: function tap(options, fn) {
			var _iteratorNormalCompletion = true;
			var _didIteratorError = false;
			var _iteratorError = undefined;

			try {
				for (var _iterator = (0, _getIterator3.default)(this.hooks), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
					var hook = _step.value;

					hook.tap(options, fn);
				}
			} catch (err) {
				_didIteratorError = true;
				_iteratorError = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion && _iterator.return) {
						_iterator.return();
					}
				} finally {
					if (_didIteratorError) {
						throw _iteratorError;
					}
				}
			}
		}
	}, {
		key: "tapAsync",
		value: function tapAsync(options, fn) {
			var _iteratorNormalCompletion2 = true;
			var _didIteratorError2 = false;
			var _iteratorError2 = undefined;

			try {
				for (var _iterator2 = (0, _getIterator3.default)(this.hooks), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
					var hook = _step2.value;

					hook.tapAsync(options, fn);
				}
			} catch (err) {
				_didIteratorError2 = true;
				_iteratorError2 = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion2 && _iterator2.return) {
						_iterator2.return();
					}
				} finally {
					if (_didIteratorError2) {
						throw _iteratorError2;
					}
				}
			}
		}
	}, {
		key: "tapPromise",
		value: function tapPromise(options, fn) {
			var _iteratorNormalCompletion3 = true;
			var _didIteratorError3 = false;
			var _iteratorError3 = undefined;

			try {
				for (var _iterator3 = (0, _getIterator3.default)(this.hooks), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
					var hook = _step3.value;

					hook.tapPromise(options, fn);
				}
			} catch (err) {
				_didIteratorError3 = true;
				_iteratorError3 = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion3 && _iterator3.return) {
						_iterator3.return();
					}
				} finally {
					if (_didIteratorError3) {
						throw _iteratorError3;
					}
				}
			}
		}
	}, {
		key: "isUsed",
		value: function isUsed() {
			var _iteratorNormalCompletion4 = true;
			var _didIteratorError4 = false;
			var _iteratorError4 = undefined;

			try {
				for (var _iterator4 = (0, _getIterator3.default)(this.hooks), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
					var hook = _step4.value;

					if (hook.isUsed()) return true;
				}
			} catch (err) {
				_didIteratorError4 = true;
				_iteratorError4 = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion4 && _iterator4.return) {
						_iterator4.return();
					}
				} finally {
					if (_didIteratorError4) {
						throw _iteratorError4;
					}
				}
			}

			return false;
		}
	}, {
		key: "intercept",
		value: function intercept(interceptor) {
			var _iteratorNormalCompletion5 = true;
			var _didIteratorError5 = false;
			var _iteratorError5 = undefined;

			try {
				for (var _iterator5 = (0, _getIterator3.default)(this.hooks), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
					var hook = _step5.value;

					hook.intercept(interceptor);
				}
			} catch (err) {
				_didIteratorError5 = true;
				_iteratorError5 = err;
			} finally {
				try {
					if (!_iteratorNormalCompletion5 && _iterator5.return) {
						_iterator5.return();
					}
				} finally {
					if (_didIteratorError5) {
						throw _iteratorError5;
					}
				}
			}
		}
	}, {
		key: "withOptions",
		value: function withOptions(options) {
			return new MultiHook(this.hooks.map(function (h) {
				return h.withOptions(options);
			}));
		}
	}]);
	return MultiHook;
}();

module.exports = MultiHook;

/***/ }),

/***/ "./node_modules/tapable/lib/SyncBailHook.js":
/*!**************************************************!*\
  !*** ./node_modules/tapable/lib/SyncBailHook.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var SyncBailHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(SyncBailHookCodeFactory, _HookCodeFactory);

	function SyncBailHookCodeFactory() {
		(0, _classCallCheck3.default)(this, SyncBailHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (SyncBailHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(SyncBailHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncBailHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _onError = _ref.onError,
			    _onResult = _ref.onResult,
			    resultReturns = _ref.resultReturns,
			    onDone = _ref.onDone,
			    rethrowIfPossible = _ref.rethrowIfPossible;

			return this.callTapsSeries({
				onError: function onError(i, err) {
					return _onError(err);
				},
				onResult: function onResult(i, result, next) {
					return "if(" + result + " !== undefined) {\n" + _onResult(result) + ";\n} else {\n" + next() + "}\n";
				},
				resultReturns: resultReturns,
				onDone: onDone,
				rethrowIfPossible: rethrowIfPossible
			});
		}
	}]);
	return SyncBailHookCodeFactory;
}(HookCodeFactory);

var factory = new SyncBailHookCodeFactory();

var SyncBailHook = function (_Hook) {
	(0, _inherits3.default)(SyncBailHook, _Hook);

	function SyncBailHook() {
		(0, _classCallCheck3.default)(this, SyncBailHook);
		return (0, _possibleConstructorReturn3.default)(this, (SyncBailHook.__proto__ || (0, _getPrototypeOf2.default)(SyncBailHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncBailHook, [{
		key: "tapAsync",
		value: function tapAsync() {
			throw new Error("tapAsync is not supported on a SyncBailHook");
		}
	}, {
		key: "tapPromise",
		value: function tapPromise() {
			throw new Error("tapPromise is not supported on a SyncBailHook");
		}
	}, {
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return SyncBailHook;
}(Hook);

module.exports = SyncBailHook;

/***/ }),

/***/ "./node_modules/tapable/lib/SyncHook.js":
/*!**********************************************!*\
  !*** ./node_modules/tapable/lib/SyncHook.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var SyncHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(SyncHookCodeFactory, _HookCodeFactory);

	function SyncHookCodeFactory() {
		(0, _classCallCheck3.default)(this, SyncHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (SyncHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(SyncHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _onError = _ref.onError,
			    onDone = _ref.onDone,
			    rethrowIfPossible = _ref.rethrowIfPossible;

			return this.callTapsSeries({
				onError: function onError(i, err) {
					return _onError(err);
				},
				onDone: onDone,
				rethrowIfPossible: rethrowIfPossible
			});
		}
	}]);
	return SyncHookCodeFactory;
}(HookCodeFactory);

var factory = new SyncHookCodeFactory();

var SyncHook = function (_Hook) {
	(0, _inherits3.default)(SyncHook, _Hook);

	function SyncHook() {
		(0, _classCallCheck3.default)(this, SyncHook);
		return (0, _possibleConstructorReturn3.default)(this, (SyncHook.__proto__ || (0, _getPrototypeOf2.default)(SyncHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncHook, [{
		key: "tapAsync",
		value: function tapAsync() {
			throw new Error("tapAsync is not supported on a SyncHook");
		}
	}, {
		key: "tapPromise",
		value: function tapPromise() {
			throw new Error("tapPromise is not supported on a SyncHook");
		}
	}, {
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return SyncHook;
}(Hook);

module.exports = SyncHook;

/***/ }),

/***/ "./node_modules/tapable/lib/SyncLoopHook.js":
/*!**************************************************!*\
  !*** ./node_modules/tapable/lib/SyncLoopHook.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var SyncLoopHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(SyncLoopHookCodeFactory, _HookCodeFactory);

	function SyncLoopHookCodeFactory() {
		(0, _classCallCheck3.default)(this, SyncLoopHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (SyncLoopHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(SyncLoopHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncLoopHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _onError = _ref.onError,
			    onDone = _ref.onDone,
			    rethrowIfPossible = _ref.rethrowIfPossible;

			return this.callTapsLooping({
				onError: function onError(i, err) {
					return _onError(err);
				},
				onDone: onDone,
				rethrowIfPossible: rethrowIfPossible
			});
		}
	}]);
	return SyncLoopHookCodeFactory;
}(HookCodeFactory);

var factory = new SyncLoopHookCodeFactory();

var SyncLoopHook = function (_Hook) {
	(0, _inherits3.default)(SyncLoopHook, _Hook);

	function SyncLoopHook() {
		(0, _classCallCheck3.default)(this, SyncLoopHook);
		return (0, _possibleConstructorReturn3.default)(this, (SyncLoopHook.__proto__ || (0, _getPrototypeOf2.default)(SyncLoopHook)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncLoopHook, [{
		key: "tapAsync",
		value: function tapAsync() {
			throw new Error("tapAsync is not supported on a SyncLoopHook");
		}
	}, {
		key: "tapPromise",
		value: function tapPromise() {
			throw new Error("tapPromise is not supported on a SyncLoopHook");
		}
	}, {
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return SyncLoopHook;
}(Hook);

module.exports = SyncLoopHook;

/***/ }),

/***/ "./node_modules/tapable/lib/SyncWaterfallHook.js":
/*!*******************************************************!*\
  !*** ./node_modules/tapable/lib/SyncWaterfallHook.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Hook = __webpack_require__(/*! ./Hook */ "./node_modules/tapable/lib/Hook.js");
var HookCodeFactory = __webpack_require__(/*! ./HookCodeFactory */ "./node_modules/tapable/lib/HookCodeFactory.js");

var SyncWaterfallHookCodeFactory = function (_HookCodeFactory) {
	(0, _inherits3.default)(SyncWaterfallHookCodeFactory, _HookCodeFactory);

	function SyncWaterfallHookCodeFactory() {
		(0, _classCallCheck3.default)(this, SyncWaterfallHookCodeFactory);
		return (0, _possibleConstructorReturn3.default)(this, (SyncWaterfallHookCodeFactory.__proto__ || (0, _getPrototypeOf2.default)(SyncWaterfallHookCodeFactory)).apply(this, arguments));
	}

	(0, _createClass3.default)(SyncWaterfallHookCodeFactory, [{
		key: "content",
		value: function content(_ref) {
			var _this2 = this;

			var _onError = _ref.onError,
			    onResult = _ref.onResult,
			    resultReturns = _ref.resultReturns,
			    rethrowIfPossible = _ref.rethrowIfPossible;

			return this.callTapsSeries({
				onError: function onError(i, err) {
					return _onError(err);
				},
				onResult: function onResult(i, result, next) {
					var code = "";
					code += "if(" + result + " !== undefined) {\n";
					code += _this2._args[0] + " = " + result + ";\n";
					code += "}\n";
					code += next();
					return code;
				},
				onDone: function onDone() {
					return onResult(_this2._args[0]);
				},
				doneReturns: resultReturns,
				rethrowIfPossible: rethrowIfPossible
			});
		}
	}]);
	return SyncWaterfallHookCodeFactory;
}(HookCodeFactory);

var factory = new SyncWaterfallHookCodeFactory();

var SyncWaterfallHook = function (_Hook) {
	(0, _inherits3.default)(SyncWaterfallHook, _Hook);

	function SyncWaterfallHook(args) {
		(0, _classCallCheck3.default)(this, SyncWaterfallHook);

		var _this3 = (0, _possibleConstructorReturn3.default)(this, (SyncWaterfallHook.__proto__ || (0, _getPrototypeOf2.default)(SyncWaterfallHook)).call(this, args));

		if (args.length < 1) throw new Error("Waterfall hooks must have at least one argument");
		return _this3;
	}

	(0, _createClass3.default)(SyncWaterfallHook, [{
		key: "tapAsync",
		value: function tapAsync() {
			throw new Error("tapAsync is not supported on a SyncWaterfallHook");
		}
	}, {
		key: "tapPromise",
		value: function tapPromise() {
			throw new Error("tapPromise is not supported on a SyncWaterfallHook");
		}
	}, {
		key: "compile",
		value: function compile(options) {
			factory.setup(this, options);
			return factory.create(options);
		}
	}]);
	return SyncWaterfallHook;
}(Hook);

module.exports = SyncWaterfallHook;

/***/ }),

/***/ "./node_modules/tapable/lib/Tapable.js":
/*!*********************************************!*\
  !*** ./node_modules/tapable/lib/Tapable.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


var _set = __webpack_require__(/*! babel-runtime/core-js/set */ "./node_modules/babel-runtime/core-js/set.js");

var _set2 = _interopRequireDefault(_set);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var util = __webpack_require__(/*! util */ "./node_modules/util/util.js");
var SyncBailHook = __webpack_require__(/*! ./SyncBailHook */ "./node_modules/tapable/lib/SyncBailHook.js");

function Tapable() {
	var _this = this;

	this._pluginCompat = new SyncBailHook(["options"]);
	this._pluginCompat.tap({
		name: "Tapable camelCase",
		stage: 100
	}, function (options) {
		options.names.add(options.name.replace(/[- ]([a-z])/g, function (str, ch) {
			return ch.toUpperCase();
		}));
	});
	this._pluginCompat.tap({
		name: "Tapable this.hooks",
		stage: 200
	}, function (options) {
		var hook = void 0;
		var _iteratorNormalCompletion = true;
		var _didIteratorError = false;
		var _iteratorError = undefined;

		try {
			for (var _iterator = (0, _getIterator3.default)(options.names), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
				var name = _step.value;

				hook = _this.hooks[name];
				if (hook !== undefined) {
					break;
				}
			}
		} catch (err) {
			_didIteratorError = true;
			_iteratorError = err;
		} finally {
			try {
				if (!_iteratorNormalCompletion && _iterator.return) {
					_iterator.return();
				}
			} finally {
				if (_didIteratorError) {
					throw _iteratorError;
				}
			}
		}

		if (hook !== undefined) {
			var tapOpt = {
				name: options.fn.name || "unnamed compat plugin",
				stage: options.stage || 0
			};
			if (options.async) hook.tapAsync(tapOpt, options.fn);else hook.tap(tapOpt, options.fn);
			return true;
		}
	});
}
module.exports = Tapable;

Tapable.addCompatLayer = function addCompatLayer(instance) {
	Tapable.call(instance);
	instance.plugin = Tapable.prototype.plugin;
	instance.apply = Tapable.prototype.apply;
};

Tapable.prototype.plugin = util.deprecate(function plugin(name, fn) {
	if (Array.isArray(name)) {
		name.forEach(function (name) {
			this.plugin(name, fn);
		}, this);
		return;
	}
	var result = this._pluginCompat.call({
		name: name,
		fn: fn,
		names: new _set2.default([name])
	});
	if (!result) {
		throw new Error("Plugin could not be registered at '" + name + "'. Hook was not found.\n" + "BREAKING CHANGE: There need to exist a hook at 'this.hooks'. " + "To create a compatibility layer for this hook, hook into 'this._pluginCompat'.");
	}
}, "Tapable.plugin is deprecated. Use new API on `.hooks` instead");

Tapable.prototype.apply = util.deprecate(function apply() {
	for (var i = 0; i < arguments.length; i++) {
		arguments[i].apply(this);
	}
}, "Tapable.apply is deprecated. Call apply on the plugin directly instead");

/***/ }),

/***/ "./node_modules/tapable/lib/index.js":
/*!*******************************************!*\
  !*** ./node_modules/tapable/lib/index.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/


exports.__esModule = true;
exports.Tapable = __webpack_require__(/*! ./Tapable */ "./node_modules/tapable/lib/Tapable.js");
exports.SyncHook = __webpack_require__(/*! ./SyncHook */ "./node_modules/tapable/lib/SyncHook.js");
exports.SyncBailHook = __webpack_require__(/*! ./SyncBailHook */ "./node_modules/tapable/lib/SyncBailHook.js");
exports.SyncWaterfallHook = __webpack_require__(/*! ./SyncWaterfallHook */ "./node_modules/tapable/lib/SyncWaterfallHook.js");
exports.SyncLoopHook = __webpack_require__(/*! ./SyncLoopHook */ "./node_modules/tapable/lib/SyncLoopHook.js");
exports.AsyncParallelHook = __webpack_require__(/*! ./AsyncParallelHook */ "./node_modules/tapable/lib/AsyncParallelHook.js");
exports.AsyncParallelBailHook = __webpack_require__(/*! ./AsyncParallelBailHook */ "./node_modules/tapable/lib/AsyncParallelBailHook.js");
exports.AsyncSeriesHook = __webpack_require__(/*! ./AsyncSeriesHook */ "./node_modules/tapable/lib/AsyncSeriesHook.js");
exports.AsyncSeriesBailHook = __webpack_require__(/*! ./AsyncSeriesBailHook */ "./node_modules/tapable/lib/AsyncSeriesBailHook.js");
exports.AsyncSeriesWaterfallHook = __webpack_require__(/*! ./AsyncSeriesWaterfallHook */ "./node_modules/tapable/lib/AsyncSeriesWaterfallHook.js");
exports.HookMap = __webpack_require__(/*! ./HookMap */ "./node_modules/tapable/lib/HookMap.js");
exports.MultiHook = __webpack_require__(/*! ./MultiHook */ "./node_modules/tapable/lib/MultiHook.js");

/***/ }),

/***/ "./node_modules/tty-browserify/index.js":
/*!**********************************************!*\
  !*** ./node_modules/tty-browserify/index.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

exports.isatty = function () { return false; };

function ReadStream() {
  throw new Error('tty.ReadStream is not implemented');
}
exports.ReadStream = ReadStream;

function WriteStream() {
  throw new Error('tty.ReadStream is not implemented');
}
exports.WriteStream = WriteStream;


/***/ }),

/***/ "./node_modules/util/support/isBufferBrowser.js":
/*!******************************************************!*\
  !*** ./node_modules/util/support/isBufferBrowser.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function isBuffer(arg) {
  return arg && typeof arg === 'object'
    && typeof arg.copy === 'function'
    && typeof arg.fill === 'function'
    && typeof arg.readUInt8 === 'function';
}

/***/ }),

/***/ "./node_modules/util/util.js":
/*!***********************************!*\
  !*** ./node_modules/util/util.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process) {// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||
  function getOwnPropertyDescriptors(obj) {
    var keys = Object.keys(obj);
    var descriptors = {};
    for (var i = 0; i < keys.length; i++) {
      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);
    }
    return descriptors;
  };

var formatRegExp = /%[sdj%]/g;
exports.format = function(f) {
  if (!isString(f)) {
    var objects = [];
    for (var i = 0; i < arguments.length; i++) {
      objects.push(inspect(arguments[i]));
    }
    return objects.join(' ');
  }

  var i = 1;
  var args = arguments;
  var len = args.length;
  var str = String(f).replace(formatRegExp, function(x) {
    if (x === '%%') return '%';
    if (i >= len) return x;
    switch (x) {
      case '%s': return String(args[i++]);
      case '%d': return Number(args[i++]);
      case '%j':
        try {
          return JSON.stringify(args[i++]);
        } catch (_) {
          return '[Circular]';
        }
      default:
        return x;
    }
  });
  for (var x = args[i]; i < len; x = args[++i]) {
    if (isNull(x) || !isObject(x)) {
      str += ' ' + x;
    } else {
      str += ' ' + inspect(x);
    }
  }
  return str;
};


// Mark that a method should not be used.
// Returns a modified function which warns once by default.
// If --no-deprecation is set, then it is a no-op.
exports.deprecate = function(fn, msg) {
  if (typeof process !== 'undefined' && process.noDeprecation === true) {
    return fn;
  }

  // Allow for deprecating things in the process of starting up.
  if (typeof process === 'undefined') {
    return function() {
      return exports.deprecate(fn, msg).apply(this, arguments);
    };
  }

  var warned = false;
  function deprecated() {
    if (!warned) {
      if (process.throwDeprecation) {
        throw new Error(msg);
      } else if (process.traceDeprecation) {
        console.trace(msg);
      } else {
        console.error(msg);
      }
      warned = true;
    }
    return fn.apply(this, arguments);
  }

  return deprecated;
};


var debugs = {};
var debugEnviron;
exports.debuglog = function(set) {
  if (isUndefined(debugEnviron))
    debugEnviron = process.env.NODE_DEBUG || '';
  set = set.toUpperCase();
  if (!debugs[set]) {
    if (new RegExp('\\b' + set + '\\b', 'i').test(debugEnviron)) {
      var pid = process.pid;
      debugs[set] = function() {
        var msg = exports.format.apply(exports, arguments);
        console.error('%s %d: %s', set, pid, msg);
      };
    } else {
      debugs[set] = function() {};
    }
  }
  return debugs[set];
};


/**
 * Echos the value of a value. Trys to print the value out
 * in the best way possible given the different types.
 *
 * @param {Object} obj The object to print out.
 * @param {Object} opts Optional options object that alters the output.
 */
/* legacy: obj, showHidden, depth, colors*/
function inspect(obj, opts) {
  // default options
  var ctx = {
    seen: [],
    stylize: stylizeNoColor
  };
  // legacy...
  if (arguments.length >= 3) ctx.depth = arguments[2];
  if (arguments.length >= 4) ctx.colors = arguments[3];
  if (isBoolean(opts)) {
    // legacy...
    ctx.showHidden = opts;
  } else if (opts) {
    // got an "options" object
    exports._extend(ctx, opts);
  }
  // set default options
  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;
  if (isUndefined(ctx.depth)) ctx.depth = 2;
  if (isUndefined(ctx.colors)) ctx.colors = false;
  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;
  if (ctx.colors) ctx.stylize = stylizeWithColor;
  return formatValue(ctx, obj, ctx.depth);
}
exports.inspect = inspect;


// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics
inspect.colors = {
  'bold' : [1, 22],
  'italic' : [3, 23],
  'underline' : [4, 24],
  'inverse' : [7, 27],
  'white' : [37, 39],
  'grey' : [90, 39],
  'black' : [30, 39],
  'blue' : [34, 39],
  'cyan' : [36, 39],
  'green' : [32, 39],
  'magenta' : [35, 39],
  'red' : [31, 39],
  'yellow' : [33, 39]
};

// Don't use 'blue' not visible on cmd.exe
inspect.styles = {
  'special': 'cyan',
  'number': 'yellow',
  'boolean': 'yellow',
  'undefined': 'grey',
  'null': 'bold',
  'string': 'green',
  'date': 'magenta',
  // "name": intentionally not styling
  'regexp': 'red'
};


function stylizeWithColor(str, styleType) {
  var style = inspect.styles[styleType];

  if (style) {
    return '\u001b[' + inspect.colors[style][0] + 'm' + str +
           '\u001b[' + inspect.colors[style][1] + 'm';
  } else {
    return str;
  }
}


function stylizeNoColor(str, styleType) {
  return str;
}


function arrayToHash(array) {
  var hash = {};

  array.forEach(function(val, idx) {
    hash[val] = true;
  });

  return hash;
}


function formatValue(ctx, value, recurseTimes) {
  // Provide a hook for user-specified inspect functions.
  // Check that value is an object with an inspect function on it
  if (ctx.customInspect &&
      value &&
      isFunction(value.inspect) &&
      // Filter out the util module, it's inspect function is special
      value.inspect !== exports.inspect &&
      // Also filter out any prototype objects using the circular check.
      !(value.constructor && value.constructor.prototype === value)) {
    var ret = value.inspect(recurseTimes, ctx);
    if (!isString(ret)) {
      ret = formatValue(ctx, ret, recurseTimes);
    }
    return ret;
  }

  // Primitive types cannot have properties
  var primitive = formatPrimitive(ctx, value);
  if (primitive) {
    return primitive;
  }

  // Look up the keys of the object.
  var keys = Object.keys(value);
  var visibleKeys = arrayToHash(keys);

  if (ctx.showHidden) {
    keys = Object.getOwnPropertyNames(value);
  }

  // IE doesn't make error fields non-enumerable
  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx
  if (isError(value)
      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {
    return formatError(value);
  }

  // Some type of object without properties can be shortcutted.
  if (keys.length === 0) {
    if (isFunction(value)) {
      var name = value.name ? ': ' + value.name : '';
      return ctx.stylize('[Function' + name + ']', 'special');
    }
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    }
    if (isDate(value)) {
      return ctx.stylize(Date.prototype.toString.call(value), 'date');
    }
    if (isError(value)) {
      return formatError(value);
    }
  }

  var base = '', array = false, braces = ['{', '}'];

  // Make Array say that they are Array
  if (isArray(value)) {
    array = true;
    braces = ['[', ']'];
  }

  // Make functions say that they are functions
  if (isFunction(value)) {
    var n = value.name ? ': ' + value.name : '';
    base = ' [Function' + n + ']';
  }

  // Make RegExps say that they are RegExps
  if (isRegExp(value)) {
    base = ' ' + RegExp.prototype.toString.call(value);
  }

  // Make dates with properties first say the date
  if (isDate(value)) {
    base = ' ' + Date.prototype.toUTCString.call(value);
  }

  // Make error with message first say the error
  if (isError(value)) {
    base = ' ' + formatError(value);
  }

  if (keys.length === 0 && (!array || value.length == 0)) {
    return braces[0] + base + braces[1];
  }

  if (recurseTimes < 0) {
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    } else {
      return ctx.stylize('[Object]', 'special');
    }
  }

  ctx.seen.push(value);

  var output;
  if (array) {
    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);
  } else {
    output = keys.map(function(key) {
      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);
    });
  }

  ctx.seen.pop();

  return reduceToSingleString(output, base, braces);
}


function formatPrimitive(ctx, value) {
  if (isUndefined(value))
    return ctx.stylize('undefined', 'undefined');
  if (isString(value)) {
    var simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '')
                                             .replace(/'/g, "\\'")
                                             .replace(/\\"/g, '"') + '\'';
    return ctx.stylize(simple, 'string');
  }
  if (isNumber(value))
    return ctx.stylize('' + value, 'number');
  if (isBoolean(value))
    return ctx.stylize('' + value, 'boolean');
  // For some reason typeof null is "object", so special case here.
  if (isNull(value))
    return ctx.stylize('null', 'null');
}


function formatError(value) {
  return '[' + Error.prototype.toString.call(value) + ']';
}


function formatArray(ctx, value, recurseTimes, visibleKeys, keys) {
  var output = [];
  for (var i = 0, l = value.length; i < l; ++i) {
    if (hasOwnProperty(value, String(i))) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
          String(i), true));
    } else {
      output.push('');
    }
  }
  keys.forEach(function(key) {
    if (!key.match(/^\d+$/)) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
          key, true));
    }
  });
  return output;
}


function formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {
  var name, str, desc;
  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };
  if (desc.get) {
    if (desc.set) {
      str = ctx.stylize('[Getter/Setter]', 'special');
    } else {
      str = ctx.stylize('[Getter]', 'special');
    }
  } else {
    if (desc.set) {
      str = ctx.stylize('[Setter]', 'special');
    }
  }
  if (!hasOwnProperty(visibleKeys, key)) {
    name = '[' + key + ']';
  }
  if (!str) {
    if (ctx.seen.indexOf(desc.value) < 0) {
      if (isNull(recurseTimes)) {
        str = formatValue(ctx, desc.value, null);
      } else {
        str = formatValue(ctx, desc.value, recurseTimes - 1);
      }
      if (str.indexOf('\n') > -1) {
        if (array) {
          str = str.split('\n').map(function(line) {
            return '  ' + line;
          }).join('\n').substr(2);
        } else {
          str = '\n' + str.split('\n').map(function(line) {
            return '   ' + line;
          }).join('\n');
        }
      }
    } else {
      str = ctx.stylize('[Circular]', 'special');
    }
  }
  if (isUndefined(name)) {
    if (array && key.match(/^\d+$/)) {
      return str;
    }
    name = JSON.stringify('' + key);
    if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) {
      name = name.substr(1, name.length - 2);
      name = ctx.stylize(name, 'name');
    } else {
      name = name.replace(/'/g, "\\'")
                 .replace(/\\"/g, '"')
                 .replace(/(^"|"$)/g, "'");
      name = ctx.stylize(name, 'string');
    }
  }

  return name + ': ' + str;
}


function reduceToSingleString(output, base, braces) {
  var numLinesEst = 0;
  var length = output.reduce(function(prev, cur) {
    numLinesEst++;
    if (cur.indexOf('\n') >= 0) numLinesEst++;
    return prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1;
  }, 0);

  if (length > 60) {
    return braces[0] +
           (base === '' ? '' : base + '\n ') +
           ' ' +
           output.join(',\n  ') +
           ' ' +
           braces[1];
  }

  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
}


// NOTE: These type checking functions intentionally don't use `instanceof`
// because it is fragile and can be easily faked with `Object.create()`.
function isArray(ar) {
  return Array.isArray(ar);
}
exports.isArray = isArray;

function isBoolean(arg) {
  return typeof arg === 'boolean';
}
exports.isBoolean = isBoolean;

function isNull(arg) {
  return arg === null;
}
exports.isNull = isNull;

function isNullOrUndefined(arg) {
  return arg == null;
}
exports.isNullOrUndefined = isNullOrUndefined;

function isNumber(arg) {
  return typeof arg === 'number';
}
exports.isNumber = isNumber;

function isString(arg) {
  return typeof arg === 'string';
}
exports.isString = isString;

function isSymbol(arg) {
  return typeof arg === 'symbol';
}
exports.isSymbol = isSymbol;

function isUndefined(arg) {
  return arg === void 0;
}
exports.isUndefined = isUndefined;

function isRegExp(re) {
  return isObject(re) && objectToString(re) === '[object RegExp]';
}
exports.isRegExp = isRegExp;

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}
exports.isObject = isObject;

function isDate(d) {
  return isObject(d) && objectToString(d) === '[object Date]';
}
exports.isDate = isDate;

function isError(e) {
  return isObject(e) &&
      (objectToString(e) === '[object Error]' || e instanceof Error);
}
exports.isError = isError;

function isFunction(arg) {
  return typeof arg === 'function';
}
exports.isFunction = isFunction;

function isPrimitive(arg) {
  return arg === null ||
         typeof arg === 'boolean' ||
         typeof arg === 'number' ||
         typeof arg === 'string' ||
         typeof arg === 'symbol' ||  // ES6 symbol
         typeof arg === 'undefined';
}
exports.isPrimitive = isPrimitive;

exports.isBuffer = __webpack_require__(/*! ./support/isBuffer */ "./node_modules/util/support/isBufferBrowser.js");

function objectToString(o) {
  return Object.prototype.toString.call(o);
}


function pad(n) {
  return n < 10 ? '0' + n.toString(10) : n.toString(10);
}


var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',
              'Oct', 'Nov', 'Dec'];

// 26 Feb 16:19:34
function timestamp() {
  var d = new Date();
  var time = [pad(d.getHours()),
              pad(d.getMinutes()),
              pad(d.getSeconds())].join(':');
  return [d.getDate(), months[d.getMonth()], time].join(' ');
}


// log is just a thin wrapper to console.log that prepends a timestamp
exports.log = function() {
  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));
};


/**
 * Inherit the prototype methods from one constructor into another.
 *
 * The Function.prototype.inherits from lang.js rewritten as a standalone
 * function (not on Function.prototype). NOTE: If this file is to be loaded
 * during bootstrapping this function needs to be rewritten using some native
 * functions as prototype setup using normal JavaScript does not work as
 * expected during bootstrapping (see mirror.js in r114903).
 *
 * @param {function} ctor Constructor function which needs to inherit the
 *     prototype.
 * @param {function} superCtor Constructor function to inherit prototype from.
 */
exports.inherits = __webpack_require__(/*! inherits */ "./node_modules/inherits/inherits_browser.js");

exports._extend = function(origin, add) {
  // Don't do anything if add isn't an object
  if (!add || !isObject(add)) return origin;

  var keys = Object.keys(add);
  var i = keys.length;
  while (i--) {
    origin[keys[i]] = add[keys[i]];
  }
  return origin;
};

function hasOwnProperty(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}

var kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;

exports.promisify = function promisify(original) {
  if (typeof original !== 'function')
    throw new TypeError('The "original" argument must be of type Function');

  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {
    var fn = original[kCustomPromisifiedSymbol];
    if (typeof fn !== 'function') {
      throw new TypeError('The "util.promisify.custom" argument must be of type Function');
    }
    Object.defineProperty(fn, kCustomPromisifiedSymbol, {
      value: fn, enumerable: false, writable: false, configurable: true
    });
    return fn;
  }

  function fn() {
    var promiseResolve, promiseReject;
    var promise = new Promise(function (resolve, reject) {
      promiseResolve = resolve;
      promiseReject = reject;
    });

    var args = [];
    for (var i = 0; i < arguments.length; i++) {
      args.push(arguments[i]);
    }
    args.push(function (err, value) {
      if (err) {
        promiseReject(err);
      } else {
        promiseResolve(value);
      }
    });

    try {
      original.apply(this, args);
    } catch (err) {
      promiseReject(err);
    }

    return promise;
  }

  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));

  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {
    value: fn, enumerable: false, writable: false, configurable: true
  });
  return Object.defineProperties(
    fn,
    getOwnPropertyDescriptors(original)
  );
}

exports.promisify.custom = kCustomPromisifiedSymbol

function callbackifyOnRejected(reason, cb) {
  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).
  // Because `null` is a special error value in callbacks which means "no error
  // occurred", we error-wrap so the callback consumer can distinguish between
  // "the promise rejected with null" or "the promise fulfilled with undefined".
  if (!reason) {
    var newReason = new Error('Promise was rejected with a falsy value');
    newReason.reason = reason;
    reason = newReason;
  }
  return cb(reason);
}

function callbackify(original) {
  if (typeof original !== 'function') {
    throw new TypeError('The "original" argument must be of type Function');
  }

  // We DO NOT return the promise as it gives the user a false sense that
  // the promise is actually somehow related to the callback's execution
  // and that the callback throwing will reject the promise.
  function callbackified() {
    var args = [];
    for (var i = 0; i < arguments.length; i++) {
      args.push(arguments[i]);
    }

    var maybeCb = args.pop();
    if (typeof maybeCb !== 'function') {
      throw new TypeError('The last argument must be of type Function');
    }
    var self = this;
    var cb = function() {
      return maybeCb.apply(self, arguments);
    };
    // In true node style we process the callback on `nextTick` with all the
    // implications (stack, `uncaughtException`, `async_hooks`)
    original.apply(this, args)
      .then(function(ret) { process.nextTick(cb, null, ret) },
            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });
  }

  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));
  Object.defineProperties(callbackified,
                          getOwnPropertyDescriptors(original));
  return callbackified;
}
exports.callbackify = callbackify;

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/index.js ***!
  \*****************************************************/
/*! exports provided: v1, v3, v4, v5, NIL, version, validate, stringify, parse */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _v1_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./v1.js */ "./node_modules/uuid/dist/esm-browser/v1.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v1", function() { return _v1_js__WEBPACK_IMPORTED_MODULE_0__["default"]; });

/* harmony import */ var _v3_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./v3.js */ "./node_modules/uuid/dist/esm-browser/v3.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v3", function() { return _v3_js__WEBPACK_IMPORTED_MODULE_1__["default"]; });

/* harmony import */ var _v4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./v4.js */ "./node_modules/uuid/dist/esm-browser/v4.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v4", function() { return _v4_js__WEBPACK_IMPORTED_MODULE_2__["default"]; });

/* harmony import */ var _v5_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./v5.js */ "./node_modules/uuid/dist/esm-browser/v5.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v5", function() { return _v5_js__WEBPACK_IMPORTED_MODULE_3__["default"]; });

/* harmony import */ var _nil_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./nil.js */ "./node_modules/uuid/dist/esm-browser/nil.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NIL", function() { return _nil_js__WEBPACK_IMPORTED_MODULE_4__["default"]; });

/* harmony import */ var _version_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./version.js */ "./node_modules/uuid/dist/esm-browser/version.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "version", function() { return _version_js__WEBPACK_IMPORTED_MODULE_5__["default"]; });

/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./validate.js */ "./node_modules/uuid/dist/esm-browser/validate.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "validate", function() { return _validate_js__WEBPACK_IMPORTED_MODULE_6__["default"]; });

/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stringify.js */ "./node_modules/uuid/dist/esm-browser/stringify.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "stringify", function() { return _stringify_js__WEBPACK_IMPORTED_MODULE_7__["default"]; });

/* harmony import */ var _parse_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./parse.js */ "./node_modules/uuid/dist/esm-browser/parse.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "parse", function() { return _parse_js__WEBPACK_IMPORTED_MODULE_8__["default"]; });











/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/md5.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/md5.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/*
 * Browser-compatible JavaScript MD5
 *
 * Modification of JavaScript MD5
 * https://github.com/blueimp/JavaScript-MD5
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 *
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
function md5(bytes) {
  if (typeof bytes === 'string') {
    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

    bytes = new Uint8Array(msg.length);

    for (var i = 0; i < msg.length; ++i) {
      bytes[i] = msg.charCodeAt(i);
    }
  }

  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));
}
/*
 * Convert an array of little-endian words to an array of bytes
 */


function md5ToHexEncodedArray(input) {
  var output = [];
  var length32 = input.length * 32;
  var hexTab = '0123456789abcdef';

  for (var i = 0; i < length32; i += 8) {
    var x = input[i >> 5] >>> i % 32 & 0xff;
    var hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);
    output.push(hex);
  }

  return output;
}
/**
 * Calculate output length with padding and bit length
 */


function getOutputLength(inputLength8) {
  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;
}
/*
 * Calculate the MD5 of an array of little-endian words, and a bit length.
 */


function wordsToMd5(x, len) {
  /* append padding */
  x[len >> 5] |= 0x80 << len % 32;
  x[getOutputLength(len) - 1] = len;
  var a = 1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d = 271733878;

  for (var i = 0; i < x.length; i += 16) {
    var olda = a;
    var oldb = b;
    var oldc = c;
    var oldd = d;
    a = md5ff(a, b, c, d, x[i], 7, -680876936);
    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);
    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);
    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);
    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);
    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);
    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);
    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);
    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);
    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);
    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);
    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);
    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);
    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);
    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);
    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);
    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);
    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);
    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);
    b = md5gg(b, c, d, a, x[i], 20, -373897302);
    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);
    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);
    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);
    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);
    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);
    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);
    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);
    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);
    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);
    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);
    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);
    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);
    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);
    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);
    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);
    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);
    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);
    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);
    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);
    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);
    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);
    d = md5hh(d, a, b, c, x[i], 11, -358537222);
    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);
    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);
    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);
    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);
    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);
    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);
    a = md5ii(a, b, c, d, x[i], 6, -198630844);
    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);
    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);
    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);
    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);
    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);
    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);
    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);
    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);
    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);
    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);
    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);
    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);
    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);
    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);
    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);
    a = safeAdd(a, olda);
    b = safeAdd(b, oldb);
    c = safeAdd(c, oldc);
    d = safeAdd(d, oldd);
  }

  return [a, b, c, d];
}
/*
 * Convert an array bytes to an array of little-endian words
 * Characters >255 have their high-byte silently ignored.
 */


function bytesToWords(input) {
  if (input.length === 0) {
    return [];
  }

  var length8 = input.length * 8;
  var output = new Uint32Array(getOutputLength(length8));

  for (var i = 0; i < length8; i += 8) {
    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;
  }

  return output;
}
/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */


function safeAdd(x, y) {
  var lsw = (x & 0xffff) + (y & 0xffff);
  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return msw << 16 | lsw & 0xffff;
}
/*
 * Bitwise rotate a 32-bit number to the left.
 */


function bitRotateLeft(num, cnt) {
  return num << cnt | num >>> 32 - cnt;
}
/*
 * These functions implement the four basic operations the algorithm uses.
 */


function md5cmn(q, a, b, x, s, t) {
  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);
}

function md5ff(a, b, c, d, x, s, t) {
  return md5cmn(b & c | ~b & d, a, b, x, s, t);
}

function md5gg(a, b, c, d, x, s, t) {
  return md5cmn(b & d | c & ~d, a, b, x, s, t);
}

function md5hh(a, b, c, d, x, s, t) {
  return md5cmn(b ^ c ^ d, a, b, x, s, t);
}

function md5ii(a, b, c, d, x, s, t) {
  return md5cmn(c ^ (b | ~d), a, b, x, s, t);
}

/* harmony default export */ __webpack_exports__["default"] = (md5);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/nil.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/nil.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = ('00000000-0000-0000-0000-000000000000');

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/parse.js":
/*!*****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/parse.js ***!
  \*****************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ "./node_modules/uuid/dist/esm-browser/validate.js");


function parse(uuid) {
  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__["default"])(uuid)) {
    throw TypeError('Invalid UUID');
  }

  var v;
  var arr = new Uint8Array(16); // Parse ########-....-....-....-............

  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;
  arr[1] = v >>> 16 & 0xff;
  arr[2] = v >>> 8 & 0xff;
  arr[3] = v & 0xff; // Parse ........-####-....-....-............

  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;
  arr[5] = v & 0xff; // Parse ........-....-####-....-............

  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;
  arr[7] = v & 0xff; // Parse ........-....-....-####-............

  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;
  arr[9] = v & 0xff; // Parse ........-....-....-....-############
  // (Use "/" to avoid 32-bit truncation when bit-shifting high-order bytes)

  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;
  arr[11] = v / 0x100000000 & 0xff;
  arr[12] = v >>> 24 & 0xff;
  arr[13] = v >>> 16 & 0xff;
  arr[14] = v >>> 8 & 0xff;
  arr[15] = v & 0xff;
  return arr;
}

/* harmony default export */ __webpack_exports__["default"] = (parse);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/regex.js":
/*!*****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/regex.js ***!
  \*****************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = (/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/rng.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/rng.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return rng; });
// Unique ID creation requires a high quality random # generator. In the browser we therefore
// require the crypto API and do not support built-in fallback to lower quality random number
// generators (like Math.random()).
var getRandomValues;
var rnds8 = new Uint8Array(16);
function rng() {
  // lazy load so that environments that need to polyfill have a chance to do so
  if (!getRandomValues) {
    // getRandomValues needs to be invoked in a context where "this" is a Crypto implementation. Also,
    // find the complete implementation of crypto (msCrypto) on IE11.
    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);

    if (!getRandomValues) {
      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
    }
  }

  return getRandomValues(rnds8);
}

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/sha1.js":
/*!****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/sha1.js ***!
  \****************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// Adapted from Chris Veness' SHA1 code at
// http://www.movable-type.co.uk/scripts/sha1.html
function f(s, x, y, z) {
  switch (s) {
    case 0:
      return x & y ^ ~x & z;

    case 1:
      return x ^ y ^ z;

    case 2:
      return x & y ^ x & z ^ y & z;

    case 3:
      return x ^ y ^ z;
  }
}

function ROTL(x, n) {
  return x << n | x >>> 32 - n;
}

function sha1(bytes) {
  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];
  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];

  if (typeof bytes === 'string') {
    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

    bytes = [];

    for (var i = 0; i < msg.length; ++i) {
      bytes.push(msg.charCodeAt(i));
    }
  } else if (!Array.isArray(bytes)) {
    // Convert Array-like to Array
    bytes = Array.prototype.slice.call(bytes);
  }

  bytes.push(0x80);
  var l = bytes.length / 4 + 2;
  var N = Math.ceil(l / 16);
  var M = new Array(N);

  for (var _i = 0; _i < N; ++_i) {
    var arr = new Uint32Array(16);

    for (var j = 0; j < 16; ++j) {
      arr[j] = bytes[_i * 64 + j * 4] << 24 | bytes[_i * 64 + j * 4 + 1] << 16 | bytes[_i * 64 + j * 4 + 2] << 8 | bytes[_i * 64 + j * 4 + 3];
    }

    M[_i] = arr;
  }

  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);
  M[N - 1][14] = Math.floor(M[N - 1][14]);
  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;

  for (var _i2 = 0; _i2 < N; ++_i2) {
    var W = new Uint32Array(80);

    for (var t = 0; t < 16; ++t) {
      W[t] = M[_i2][t];
    }

    for (var _t = 16; _t < 80; ++_t) {
      W[_t] = ROTL(W[_t - 3] ^ W[_t - 8] ^ W[_t - 14] ^ W[_t - 16], 1);
    }

    var a = H[0];
    var b = H[1];
    var c = H[2];
    var d = H[3];
    var e = H[4];

    for (var _t2 = 0; _t2 < 80; ++_t2) {
      var s = Math.floor(_t2 / 20);
      var T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[_t2] >>> 0;
      e = d;
      d = c;
      c = ROTL(b, 30) >>> 0;
      b = a;
      a = T;
    }

    H[0] = H[0] + a >>> 0;
    H[1] = H[1] + b >>> 0;
    H[2] = H[2] + c >>> 0;
    H[3] = H[3] + d >>> 0;
    H[4] = H[4] + e >>> 0;
  }

  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];
}

/* harmony default export */ __webpack_exports__["default"] = (sha1);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/stringify.js":
/*!*********************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/stringify.js ***!
  \*********************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ "./node_modules/uuid/dist/esm-browser/validate.js");

/**
 * Convert array of 16 byte values to UUID string format of the form:
 * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
 */

var byteToHex = [];

for (var i = 0; i < 256; ++i) {
  byteToHex.push((i + 0x100).toString(16).substr(1));
}

function stringify(arr) {
  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  // Note: Be careful editing this code!  It's been tuned for performance
  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434
  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one
  // of the following:
  // - One or more input array values don't map to a hex octet (leading to
  // "undefined" in the uuid)
  // - Invalid input values for the RFC `version` or `variant` fields

  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__["default"])(uuid)) {
    throw TypeError('Stringified UUID is invalid');
  }

  return uuid;
}

/* harmony default export */ __webpack_exports__["default"] = (stringify);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/v1.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v1.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rng.js */ "./node_modules/uuid/dist/esm-browser/rng.js");
/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stringify.js */ "./node_modules/uuid/dist/esm-browser/stringify.js");

 // **`v1()` - Generate time-based UUID**
//
// Inspired by https://github.com/LiosK/UUID.js
// and http://docs.python.org/library/uuid.html

var _nodeId;

var _clockseq; // Previous uuid creation time


var _lastMSecs = 0;
var _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details

function v1(options, buf, offset) {
  var i = buf && offset || 0;
  var b = buf || new Array(16);
  options = options || {};
  var node = options.node || _nodeId;
  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not
  // specified.  We do this lazily to minimize issues related to insufficient
  // system entropy.  See #189

  if (node == null || clockseq == null) {
    var seedBytes = options.random || (options.rng || _rng_js__WEBPACK_IMPORTED_MODULE_0__["default"])();

    if (node == null) {
      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)
      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];
    }

    if (clockseq == null) {
      // Per 4.2.2, randomize (14 bit) clockseq
      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;
    }
  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,
  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so
  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'
  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.


  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock
  // cycle to simulate higher resolution clock

  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)

  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression

  if (dt < 0 && options.clockseq === undefined) {
    clockseq = clockseq + 1 & 0x3fff;
  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new
  // time interval


  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {
    nsecs = 0;
  } // Per 4.2.1.2 Throw error if too many uuids are requested


  if (nsecs >= 10000) {
    throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");
  }

  _lastMSecs = msecs;
  _lastNSecs = nsecs;
  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch

  msecs += 12219292800000; // `time_low`

  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
  b[i++] = tl >>> 24 & 0xff;
  b[i++] = tl >>> 16 & 0xff;
  b[i++] = tl >>> 8 & 0xff;
  b[i++] = tl & 0xff; // `time_mid`

  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;
  b[i++] = tmh >>> 8 & 0xff;
  b[i++] = tmh & 0xff; // `time_high_and_version`

  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version

  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)

  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`

  b[i++] = clockseq & 0xff; // `node`

  for (var n = 0; n < 6; ++n) {
    b[i + n] = node[n];
  }

  return buf || Object(_stringify_js__WEBPACK_IMPORTED_MODULE_1__["default"])(b);
}

/* harmony default export */ __webpack_exports__["default"] = (v1);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/v3.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v3.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _v35_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./v35.js */ "./node_modules/uuid/dist/esm-browser/v35.js");
/* harmony import */ var _md5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./md5.js */ "./node_modules/uuid/dist/esm-browser/md5.js");


var v3 = Object(_v35_js__WEBPACK_IMPORTED_MODULE_0__["default"])('v3', 0x30, _md5_js__WEBPACK_IMPORTED_MODULE_1__["default"]);
/* harmony default export */ __webpack_exports__["default"] = (v3);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/v35.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v35.js ***!
  \***************************************************/
/*! exports provided: DNS, URL, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DNS", function() { return DNS; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URL", function() { return URL; });
/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./stringify.js */ "./node_modules/uuid/dist/esm-browser/stringify.js");
/* harmony import */ var _parse_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./parse.js */ "./node_modules/uuid/dist/esm-browser/parse.js");



function stringToBytes(str) {
  str = unescape(encodeURIComponent(str)); // UTF8 escape

  var bytes = [];

  for (var i = 0; i < str.length; ++i) {
    bytes.push(str.charCodeAt(i));
  }

  return bytes;
}

var DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';
var URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';
/* harmony default export */ __webpack_exports__["default"] = (function (name, version, hashfunc) {
  function generateUUID(value, namespace, buf, offset) {
    if (typeof value === 'string') {
      value = stringToBytes(value);
    }

    if (typeof namespace === 'string') {
      namespace = Object(_parse_js__WEBPACK_IMPORTED_MODULE_1__["default"])(namespace);
    }

    if (namespace.length !== 16) {
      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');
    } // Compute hash of namespace and value, Per 4.3
    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =
    // hashfunc([...namespace, ... value])`


    var bytes = new Uint8Array(16 + value.length);
    bytes.set(namespace);
    bytes.set(value, namespace.length);
    bytes = hashfunc(bytes);
    bytes[6] = bytes[6] & 0x0f | version;
    bytes[8] = bytes[8] & 0x3f | 0x80;

    if (buf) {
      offset = offset || 0;

      for (var i = 0; i < 16; ++i) {
        buf[offset + i] = bytes[i];
      }

      return buf;
    }

    return Object(_stringify_js__WEBPACK_IMPORTED_MODULE_0__["default"])(bytes);
  } // Function#name is not settable on some platforms (#270)


  try {
    generateUUID.name = name; // eslint-disable-next-line no-empty
  } catch (err) {} // For CommonJS default export support


  generateUUID.DNS = DNS;
  generateUUID.URL = URL;
  return generateUUID;
});

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/v4.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v4.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rng.js */ "./node_modules/uuid/dist/esm-browser/rng.js");
/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stringify.js */ "./node_modules/uuid/dist/esm-browser/stringify.js");



function v4(options, buf, offset) {
  options = options || {};
  var rnds = options.random || (options.rng || _rng_js__WEBPACK_IMPORTED_MODULE_0__["default"])(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`

  rnds[6] = rnds[6] & 0x0f | 0x40;
  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided

  if (buf) {
    offset = offset || 0;

    for (var i = 0; i < 16; ++i) {
      buf[offset + i] = rnds[i];
    }

    return buf;
  }

  return Object(_stringify_js__WEBPACK_IMPORTED_MODULE_1__["default"])(rnds);
}

/* harmony default export */ __webpack_exports__["default"] = (v4);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/v5.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v5.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _v35_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./v35.js */ "./node_modules/uuid/dist/esm-browser/v35.js");
/* harmony import */ var _sha1_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sha1.js */ "./node_modules/uuid/dist/esm-browser/sha1.js");


var v5 = Object(_v35_js__WEBPACK_IMPORTED_MODULE_0__["default"])('v5', 0x50, _sha1_js__WEBPACK_IMPORTED_MODULE_1__["default"]);
/* harmony default export */ __webpack_exports__["default"] = (v5);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/validate.js":
/*!********************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/validate.js ***!
  \********************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _regex_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./regex.js */ "./node_modules/uuid/dist/esm-browser/regex.js");


function validate(uuid) {
  return typeof uuid === 'string' && _regex_js__WEBPACK_IMPORTED_MODULE_0__["default"].test(uuid);
}

/* harmony default export */ __webpack_exports__["default"] = (validate);

/***/ }),

/***/ "./node_modules/uuid/dist/esm-browser/version.js":
/*!*******************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/version.js ***!
  \*******************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ "./node_modules/uuid/dist/esm-browser/validate.js");


function version(uuid) {
  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__["default"])(uuid)) {
    throw TypeError('Invalid UUID');
  }

  return parseInt(uuid.substr(14, 1), 16);
}

/* harmony default export */ __webpack_exports__["default"] = (version);

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

var g;

// This works in non-strict mode
g = (function() {
	return this;
})();

try {
	// This works if eval is allowed (see CSP)
	g = g || new Function("return this")();
} catch (e) {
	// This works if the window reference is available
	if (typeof window === "object") g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;


/***/ }),

/***/ "./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function(module) {
	if (!module.webpackPolyfill) {
		module.deprecate = function() {};
		module.paths = [];
		// module.parent = undefined by default
		if (!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),

/***/ "./src/core/ActionManager.ts":
/*!***********************************!*\
  !*** ./src/core/ActionManager.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _Itypes = __webpack_require__(/*! ./Itypes */ "./src/core/Itypes.ts");

var _Actions = __webpack_require__(/*! ./Actions */ "./src/core/Actions/index.ts");

var _debug = __webpack_require__(/*! ../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

var _ActionUtils = __webpack_require__(/*! ./ActionUtils */ "./src/core/ActionUtils.ts");

var ActionUtils = _interopRequireWildcard(_ActionUtils);

var _utils = __webpack_require__(/*! ./utils */ "./src/core/utils.ts");

var _pako = __webpack_require__(/*! pako */ "./node_modules/pako/dist/pako.min.js");

var _pako2 = _interopRequireDefault(_pako);

var _GlobalHub = __webpack_require__(/*! ./Model/GlobalHub */ "./src/core/Model/GlobalHub.ts");

var _GlobalHub2 = _interopRequireDefault(_GlobalHub);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 *  在WebSocket里传输的是Command, 白板内使用的是Action
 */
window.pako = _pako2.default;

var SyncManager = function (_EventEmitter) {
    (0, _inherits3.default)(SyncManager, _EventEmitter);

    function SyncManager(account) {
        (0, _classCallCheck3.default)(this, SyncManager);

        /**
         * 是广播消息给所有用户吗？？ 不太确定。account === 0的时候表示发送给所有用户么？
         *
         * 文件动作如果是重复文件，则不重复推送
         *
         * @param anyAction
         */
        var _this = (0, _possibleConstructorReturn3.default)(this, (SyncManager.__proto__ || (0, _getPrototypeOf2.default)(SyncManager)).call(this));

        _this.broadcastAction = function (anyAction) {
            // 广播消息前 预处理一些数据
            var action = anyAction.action;
            if (action.TYPE === _Itypes.WActions.FILE) {
                var fileAction = action;
                var file = fileAction.file;

                console.log(file);
                var isSameDoc = _this.fileData && file.docId && file.docId === _this.fileData.docId;
                if (_this.fileData && (0, _stringify2.default)(file) === (0, _stringify2.default)(_this.fileData)) {
                    return; // 如果两次文件相同，就不推入队列了
                }
                if (file.type === 'clear') {
                    _this.setFileData(undefined);
                } else {
                    _this.setFileData(file);
                }
            }
            _this.pushQueue(0, anyAction);
            //   this.commandManager.revoke(this.account)
        };
        _this.account = account;
        _this.dataQue = {}; // Map<uid, List<command>>
        // this.fileData // Map<uid, command>
        _this.lastDataMap = {}; // Map<uid, command>
        _this.shadowUsers = {};
        _this.doNotSendBefore = Date.now();
        _this.startLoop();
        return _this;
    }
    /**
     * 将用户的动作推入该用户的队列中：this.dataQue[account]
     *
     * @param account
     * @param action
     */


    (0, _createClass3.default)(SyncManager, [{
        key: 'pushQueue',
        value: function pushQueue(account, action) {
            _debug2.default.m.syncmanager('pushQueue', account, action);
            if (typeof action.action === 'undefined') {
                var error = new Error('ss');
                console.log(error.stack);
            }
            // const commandStr = JSON.stringify(action)
            // if (this.lastDataMap[account] === commandStr) {
            //   return
            // }
            // this.lastDataMap[account] = commandStr
            this.dataQue[account] = this.dataQue[account] || [];
            this.dataQue[account].push(action);
        }
        /**
         * 将obj转化为协议中约定的格式，然后调用flush函数发送数据
         *
         * @param obj
         * @param delayBase
         */

    }, {
        key: 'send',
        value: function send(obj, delayBase) {
            var _this2 = this;

            var toAccount = obj.toAccount,
                actions = obj.actions;

            if (!actions || actions.length < 1) return;
            var dataStr = ActionUtils.packBulk(actions.filter(function (x) {
                return !!x;
            }));
            console.log('send', dataStr);
            // 如果文本长度超过10个字，就使用gzip压缩方式传输,这个方式的传输比较
            if (dataStr.length > 10 && "" + toAccount !== '0') {
                var datas = this.gzipStr(dataStr);
                datas.forEach(function (data, index) {
                    _this2.flush({ toAccount: toAccount, data: data }, index, delayBase);
                });
            } else {
                var data = { toAccount: toAccount, data: dataStr };
                this.flush(data, 0, delayBase);
                _debug2.default.m.syncmanager('sendRaw:\n', data);
            }
        }
        /**
         * 触发'flush'事件。
         *
         * 在core/index.js中，syncManager监听flush事件，然后调用connector.sendData发送数据
         */

    }, {
        key: 'flush',
        value: function flush(data) {
            var _this3 = this;

            var delayIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
            var delayBase = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 200;

            setTimeout(function () {
                _this3.emit('flush', data);
            }, delayBase * delayIndex);
        }
        /**
         * 发送“清除响应”
         *
         * @param account
         */

    }, {
        key: 'makeClearAck',
        value: function makeClearAck(account) {
            this.send({
                toAccount: account,
                actions: [{ action: new _Actions.ClearAckAction() }]
            });
        }
        /**
         * 发送“同步准备”
         */

    }, {
        key: 'makeSyncPrepare',
        value: function makeSyncPrepare() {
            this.send({
                toAccount: 0,
                actions: [{ action: new _Actions.SyncPrepareAction() }]
            });
        }
        /**
         * 发送“同步准备回应”
         *
         * @param account
         */

    }, {
        key: 'makeSyncPrepareAck',
        value: function makeSyncPrepareAck(account) {
            this.send({
                toAccount: 0,
                actions: [{ action: new _Actions.SyncPrepareAckAction() }]
            });
        }
    }, {
        key: 'gzipStr',
        value: function gzipStr(str) {
            var doTag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            console.log('gzip stirng:', str);
            var gziped = _pako2.default.gzip(str, { to: 'string' });
            console.log('gzip stirng:', _pako2.default.gzip(str));
            var kiloBytes = (0, _utils.getKiloBytes)(gziped);
            var dataArr = [];
            if (kiloBytes > 49) {
                var len = gziped.length;
                var begin = 0;
                while (begin < len) {
                    //每次取的字符长度 =  49KB（长度限制） * 1024 Byte/KB / 2 Byte（每个字符占用两个字节）
                    dataArr.push(gziped.substr(begin, 25088));
                    begin += 25088;
                }
            } else {
                dataArr.push(gziped);
            }
            if (doTag) {
                var version = 1;
                var _dataArr = dataArr,
                    length = _dataArr.length;

                var id = '' + Date.now() + '.' + Math.floor(Math.random() * 1000) + Math.floor(Math.random() * 1000) + Math.floor(Math.random() * 1000);
                dataArr = dataArr.map(function (data, index) {
                    return 'GZIP:' + version + '|' + id + '|' + length + '|' + index + '|=||=|' + data;
                });
            }
            return dataArr;
        }
        /**
         * 发送“同步请求”
         *
         * @param account
         */

    }, {
        key: 'makeSyncRequest',
        value: function makeSyncRequest(account) {
            this.send({
                toAccount: account,
                actions: [{ action: new _Actions.SyncRequestAction() }]
            });
        }
        // 向account发送同步数据；TODO：做 相互抵消的重做、撤销 命令的过滤
        /**
         * 向toAccount发送同步数据, snapshot包含现有图形
         *
         * @param toAccount
         * @param snapshot
         */

    }, {
        key: 'syncTo',
        value: function syncTo(toAccount, snapshot) {
            if (this.fileData) {
                snapshot.file = this.fileData;
            }
            var action = new _Actions.SyncAction(snapshot);
            this.send({ toAccount: toAccount, actions: [{ action: action }] });
        }
        /**
         * 清空画布
         */

    }, {
        key: 'clear',
        value: function clear() {
            console.warn('clear sync manager');
            this.dataQue = {};
        }
        /**
         * 在msTime到来前，先不要发送数据
         *
         * @param msTime
         */

    }, {
        key: 'delayMS',
        value: function delayMS(msTime) {
            this.doNotSendBefore = Date.now() + msTime;
        }
        /**
         * 每100ms将队列中所有动作发出。
         */

    }, {
        key: 'startLoop',
        value: function startLoop() {
            var _this4 = this;

            this.timer = setInterval(function () {
                if (Date.now() < _this4.doNotSendBefore) {
                    return;
                }
                var dq = _this4.dataQue;
                (0, _keys2.default)(dq).forEach(function (key) {
                    if (!dq[key] || dq[key].length < 1) {
                        return;
                    }
                    if (_this4.send) {
                        _this4.send({ toAccount: key, actions: dq[key] });
                        dq[key].length = 0;
                    }
                });
            }, 100);
        }
        /**
         * 销毁syncManager
         */

    }, {
        key: 'destroy',
        value: function destroy() {
            this.timer && clearInterval(this.timer);
            this.timer = undefined;
            this.dataQue = {};
        }
        /**
         * 设置文件数据
         * @param data
         */

    }, {
        key: 'setFileData',
        value: function setFileData(data) {
            this.fileData = data;
            _GlobalHub2.default.emit('globalFile', this.fileData);
        }
    }]);
    return SyncManager;
}(_eventemitter2.default);

exports.default = SyncManager;

SyncManager.GZIP_TESTER_1 = /1\|([\d.]+)\|(\d+)\|(\d+)\|=\|\|=\|/;

/***/ }),

/***/ "./src/core/ActionUtils.old.ts":
/*!*************************************!*\
  !*** ./src/core/ActionUtils.old.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.packBulk = packBulk;
exports.pack = pack;
exports.unpackBulk = unpackBulk;
exports.unpack = unpack;
exports.formatColor = formatColor;
exports.hex2rgb = hex2rgb;

var _debug = __webpack_require__(/*! ../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

var _Actions = __webpack_require__(/*! ./Actions */ "./src/core/Actions/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 *  这个文件是新白板的录制回放，需要播放以前录制的白板文件，所以需要兼容老旧的第一版协议,来适配新版本.
 *
 */
/**
 * 老版本不需要发松消息，如果想做兼容的，所以这个没什么用
 */
function packBulk(anyActions) {
    var str = anyActions.map(function (anyAction) {
        return pack(anyAction);
    }).join(';') + ';';
    _debug2.default.m.syncmanager('packBulk anyAction', str);
    return str;
}
/**
 * 老版本不需要发松消息，如果想做兼容的，所以这个没什么用
 */
function pack(anyAction, isP2P) {
    _debug2.default.m.syncmanager('pack anyAction', anyAction);
    console.assert(anyAction.action !== undefined, 'ooops');
    var action = anyAction.action;

    var str = action.toString();
    return str;
}
function unpackBulk(data) {
    var actions = [];
    var ops = data.split(';');
    ops.forEach(function (op) {
        var action = unpack(op);
        if (action) {
            if (Array.isArray(action)) {
                while (action.length) {
                    var tmp = action.shift();
                    if (tmp) {
                        actions.push(tmp);
                    }
                }
            } else {
                actions.push(action);
            }
        }
    });
    return actions;
}
function unpack(data) {
    if (!data) {
        return;
    }
    var actionIndex = data.indexOf(':');
    _debug2.default.m.syncmanager('unpack command ', data);
    var action = void 0;
    var valueStr = void 0;
    if (actionIndex == -1) {
        action = +data;
        valueStr = '';
    } else {
        action = +data.slice(0, actionIndex);
        valueStr = data.slice(actionIndex + 1, data.length);
    }
    var value = valueStr.length > 1 ? valueStr.split(',') : [];
    _debug2.default.command('unpack', data);
    switch (action) {
        case 1 /* START */:
            {
                var ret = [new _Actions.StartAction(+value[0], +value[1])];
                if (value[2]) {
                    ret.unshift(new _Actions.CalibrateAction({ color: formatColor(value[2]) }));
                }
                return ret;
            }
        case 2 /* MOVE */:
            {
                var _ret = [new _Actions.MoveAction(+value[0], +value[1])];
                if (value[2]) {
                    _ret.unshift(new _Actions.CalibrateAction({ color: formatColor(value[2]) }));
                }
                return _ret;
            }
        case 3 /* END */:
            {
                var _ret2 = [new _Actions.EndAction(+value[0], +value[1])];
                if (value[2]) {
                    _ret2.unshift(new _Actions.CalibrateAction({ color: formatColor(value[2]) }));
                }
                return _ret2;
            }
        case 12 /* LASER_PEN */:
            {
                return new _Actions.LaserPenAction(+value[0], +value[1]);
            }
        case 13 /* LASER_PEN_END */:
            return new _Actions.LaserPenEndAction();
        case 4 /* REVOKE */:
            return new _Actions.RevokeAction();
        case 5 /* SERIAL */:
            return new _Actions.SerialAction();
        case 6 /* CLEAR */:
            return new _Actions.ClearAction();
        case 7 /* CLEAR_ACK */:
            return new _Actions.ClearAckAction();
        case 8 /* SYNC_REQUEST */:
            return new _Actions.SyncRequestAction(); // TODO
        case 9 /* SYNC */:
            console.warn('收到了同步指令，未做兼容，请联系云信技术支持');
            return undefined;
        // return {
        //   action: action,
        //   sync: {
        //     account: value[0],
        //     dataMap: {},
        //     all: value[1] as '0' | '1',
        //     index: +value[2],
        //     num: +value[3]
        //   }
        // }
        case 10 /* SYNC_PREPARE */:
            return new _Actions.SyncPrepareAction();
        case 11 /* SYNC_PREPARE_ACK */:
            return new _Actions.SyncPrepareAckAction();
        case 14 /* FILE */:
            return new _Actions.FileAction({
                docId: value[0],
                currentPage: +value[1],
                pageCount: +value[2],
                type: value[2] == '0' ? 'clear' : 'img'
            });
        // return {
        //   action: action,
        //   file: {
        //     docId: value[0] || '',
        //     currentPage: value[1] || '',
        //     pageCount: value[2] || '',
        //     type: value[3] === '0' ? 'img' : (value[3] === '1' ? 'h5' : ''),
        //     url: value[4] || '',
        //     urlStr: value[5] || '',
        //     h5Cmd: value[6] || ''
        //   }
        // }
        // case OLD_ACTION.REDO:
        //   return RedoAction.fromString(valueStr)
        // case OLD_ACTION.CALIBRATE:
        //   return CalibrateAction.fromString(valueStr)
        // case OLD_ACTION.TEXT:
        //   return TextAction.fromString(valueStr)
        default:
            var fullCaseChecker = action;
    }
}
function formatColor(color) {
    var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;

    if (!color) return -1;
    var res = '';
    if (format === 16) {
        color = +color;
        if (color < 0) {
            res = hex2rgb(color);
            console.log('hex2rgb', color, res);
            return res;
        }
        res = color.toString(16);
        if (res.length < 3) {
            res = ('000' + res).slice(-3);
        }
        if (res.length > 3 && res.length < 6) {
            res = ('000' + res).slice(-6);
        }
        res = '#' + res;
        //console.log('formatColor 16', color, res)
        return res;
    } else if (format === 10) {
        res = color.replace(/#/gi, '');
        res = parseInt('0x' + res);
        //console.log('formatColor 10', color, res)
        return isNaN(res) ? -1 : res;
    }
}
// rgba转rgb
function hex2rgb(val) {
    // return '#' + (0x00FFFFFF & val)
    var alpha = val >> 24 & 0xff;
    var red = val >> 16 & 0xff;
    var green = val >> 8 & 0xff;
    var blue = val & 0xff;
    red = red.toString(16);
    green = green.toString(16);
    blue = blue.toString(16);
    console.log('rgb', red, green, blue);
    return '#' + ('0' + red).slice(-2) + ('0' + green).slice(-2) + ('0' + blue).slice(-2);
}

/***/ }),

/***/ "./src/core/ActionUtils.ts":
/*!*********************************!*\
  !*** ./src/core/ActionUtils.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.packBulk = packBulk;
exports.pack = pack;
exports.unpackBulk = unpackBulk;
exports.unpack = unpack;

var _debug = __webpack_require__(/*! ../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

var _Itypes = __webpack_require__(/*! ./Itypes */ "./src/core/Itypes.ts");

var _Actions = __webpack_require__(/*! ./Actions */ "./src/core/Actions/index.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 *  在WebSocket里传输的是Command, 白板内使用的是Action
 */
/**
 * 将Array<Action>转化为command字符串。command之间用分号连接
 *
 * @param anyActions
 */
function packBulk(anyActions) {
    var str = anyActions.map(function (anyAction) {
        return pack(anyAction);
    }).join(';') + ';';
    _debug2.default.m.syncmanager('packBulk anyAction', str);
    return str;
}
/**
 * 将动作转化为字符串(command)
 *
 * 示例：
 * 输入： MoveAction(x=0.3, y=0.5)
 * 输出： “2:0.3, 0.5”
 *
 * @param anyAction
 * @param isP2P
 */
function pack(anyAction, isP2P) {
    _debug2.default.m.syncmanager('pack anyAction', anyAction);
    console.assert(anyAction.action !== undefined, 'ooops');
    var action = anyAction.action;

    var str = action.toString();
    return str;
}
/**
 * 将连续的command转换为Array<Action>
 *
 * @param data
 */
function unpackBulk(data) {
    var actions = [];
    var ops = data.split(';');
    ops.forEach(function (op) {
        var action = unpack(op);
        if (action) {
            actions.push(action);
        }
    });
    return actions;
}
/**
 * 将command转化为action。action是js对象，包含动作的各个属性值。
 *
 * 示例：
 * 输入： "2:0.3,0.5"
 * 输出： MoveAction(x=0.3, y=0.5)
 *
 * @param data
 */
function unpack(data) {
    if (!data) {
        return;
    }
    var actionIndex = data.indexOf(':');
    _debug2.default.m.syncmanager('unpack command ', data);
    var action = void 0;
    var valueStr = void 0;
    /**
     * +data将data转换为数值
     * 若actionIndex == -1, 则该命令没有附加valueStr。
     */
    if (actionIndex == -1) {
        action = +data;
        valueStr = '';
    } else {
        action = +data.slice(0, actionIndex);
        valueStr = data.slice(actionIndex + 1, data.length);
    }
    _debug2.default.command('unpack', data);
    switch (action) {
        case _Itypes.WActions.START:
            return _Actions.StartAction.fromString(valueStr);
        case _Itypes.WActions.MOVE:
            return _Actions.MoveAction.fromString(valueStr);
        case _Itypes.WActions.END:
            return _Actions.EndAction.fromString(valueStr);
        case _Itypes.WActions.REVOKE:
            return _Actions.RevokeAction.fromString(valueStr);
        case _Itypes.WActions.SERIAL:
            return _Actions.SerialAction.fromString(valueStr);
        case _Itypes.WActions.CLEAR:
            return _Actions.ClearAction.fromString(valueStr);
        case _Itypes.WActions.CLEAR_ACK:
            return _Actions.ClearAckAction.fromString(valueStr);
        case _Itypes.WActions.LASER_PEN:
            return _Actions.LaserPenAction.fromString(valueStr);
        case _Itypes.WActions.SYNC_REQUEST:
            return _Actions.SyncRequestAction.fromString(valueStr); // TODO
        case _Itypes.WActions.SYNC:
            return _Actions.SyncAction.fromString(valueStr);
        // return {
        //   action: action,
        //   sync: {
        //     account: value[0],
        //     dataMap: {},
        //     all: value[1] as '0' | '1',
        //     index: +value[2],
        //     num: +value[3]
        //   }
        // }
        case _Itypes.WActions.SYNC_PREPARE:
            return _Actions.SyncPrepareAction.fromString(valueStr);
        case _Itypes.WActions.SYNC_PREPARE_ACK:
            return _Actions.SyncPrepareAckAction.fromString(valueStr);
        case _Itypes.WActions.LASER_PEN_END:
            return _Actions.LaserPenEndAction.fromString(valueStr);
        case _Itypes.WActions.FILE:
            return _Actions.FileAction.fromString(valueStr);
        // return {
        //   action: action,
        //   file: {
        //     docId: value[0] || '',
        //     currentPage: value[1] || '',
        //     pageCount: value[2] || '',
        //     type: value[3] === '0' ? 'img' : (value[3] === '1' ? 'h5' : ''),
        //     url: value[4] || '',
        //     urlStr: value[5] || '',
        //     h5Cmd: value[6] || ''
        //   }
        // }
        case _Itypes.WActions.REDO:
            return _Actions.RedoAction.fromString(valueStr);
        case _Itypes.WActions.CALIBRATE:
            return _Actions.CalibrateAction.fromString(valueStr);
        case _Itypes.WActions.TEXT:
            return _Actions.TextAction.fromString(valueStr);
        case _Itypes.WActions.VERSION:
            return _Actions.VersionAction.fromString(valueStr);
        default:
            var fullCaseChecker = action;
    }
}

/***/ }),

/***/ "./src/core/Actions/index.ts":
/*!***********************************!*\
  !*** ./src/core/Actions/index.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.VersionAction = exports.TextAction = exports.CalibrateAction = exports.RedoAction = exports.FileAction = exports.LaserPenEndAction = exports.LaserPenAction = exports.SyncPrepareAckAction = exports.SyncPrepareAction = exports.SyncAction = exports.SyncRequestAction = exports.ClearAckAction = exports.ClearAction = exports.SerialAction = exports.RevokeAction = exports.EndAction = exports.MoveAction = exports.StartAction = undefined;

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _Itypes = __webpack_require__(/*! ../Itypes */ "./src/core/Itypes.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var encodeNumber = function encodeNumber(n) {
    if (n === 0 || n < 0) {
        return '0';
    }
    if (n === 1 || n > 1) {
        return '1';
    }
    return n.toFixed(4).slice(2); // 4位已经够了
}; /**
    * 定义如何从字符串中解析动作，以及如何将动作转换为字符串(command)。
    */

var decodeNumber = function decodeNumber(str) {
    if (str === '0') {
        return 0;
    }
    if (str === '1') {
        return 1;
    }
    return parseFloat('0.' + str);
};
var stringify = function stringify(obj, props) {
    if (typeof obj === 'string') {
        return obj;
    } else {
        var str = (0, _stringify2.default)(obj, props);
        return str.replace(/;/gm, '；').replace(/,/gm, '，').replace(/:/gm, '¦');
    }
};
var unstringify = function unstringify(str) {
    var originStr = str.replace(/；/gm, ';').replace(/，/gm, ',').replace(/¦/gm, ':');
    return JSON.parse(originStr);
};

var IAction = function IAction() {
    (0, _classCallCheck3.default)(this, IAction);
};

var StartAction = exports.StartAction = function (_IAction) {
    (0, _inherits3.default)(StartAction, _IAction);

    function StartAction(x, y) {
        (0, _classCallCheck3.default)(this, StartAction);

        var _this = (0, _possibleConstructorReturn3.default)(this, (StartAction.__proto__ || (0, _getPrototypeOf2.default)(StartAction)).call(this));

        _this.x = x;
        _this.y = y;
        _this.TYPE = _Itypes.WActions.START;
        return _this;
    }

    (0, _createClass3.default)(StartAction, [{
        key: 'toString',
        value: function toString() {
            var x = encodeNumber(this.x);
            var y = encodeNumber(this.y);
            return this.TYPE + ':' + x + ',' + y;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            // version 1: x, y
            var pis = str.split(',');
            var action = new StartAction(decodeNumber(pis[0]), decodeNumber(pis[1]));
            return action;
        }
    }]);
    return StartAction;
}(IAction);

var MoveAction = exports.MoveAction = function (_StartAction) {
    (0, _inherits3.default)(MoveAction, _StartAction);

    function MoveAction(x, y) {
        (0, _classCallCheck3.default)(this, MoveAction);

        var _this2 = (0, _possibleConstructorReturn3.default)(this, (MoveAction.__proto__ || (0, _getPrototypeOf2.default)(MoveAction)).call(this, x, y));

        _this2.x = x;
        _this2.y = y;
        _this2.TYPE = _Itypes.WActions.MOVE;
        return _this2;
    }

    (0, _createClass3.default)(MoveAction, null, [{
        key: 'fromString',
        value: function fromString(str) {
            var pis = str.split(',');
            return new MoveAction(decodeNumber(pis[0]), decodeNumber(pis[1]));
        }
    }]);
    return MoveAction;
}(StartAction);

var EndAction = exports.EndAction = function (_StartAction2) {
    (0, _inherits3.default)(EndAction, _StartAction2);

    function EndAction(x, y) {
        (0, _classCallCheck3.default)(this, EndAction);

        var _this3 = (0, _possibleConstructorReturn3.default)(this, (EndAction.__proto__ || (0, _getPrototypeOf2.default)(EndAction)).call(this, x, y));

        _this3.x = x;
        _this3.y = y;
        _this3.TYPE = _Itypes.WActions.END;
        return _this3;
    }

    (0, _createClass3.default)(EndAction, null, [{
        key: 'fromString',
        value: function fromString(str) {
            var pis = str.split(',');
            return new EndAction(decodeNumber(pis[0]), decodeNumber(pis[1]));
        }
    }]);
    return EndAction;
}(StartAction);

var RevokeAction = exports.RevokeAction = function (_IAction2) {
    (0, _inherits3.default)(RevokeAction, _IAction2);

    function RevokeAction() {
        (0, _classCallCheck3.default)(this, RevokeAction);

        var _this4 = (0, _possibleConstructorReturn3.default)(this, (RevokeAction.__proto__ || (0, _getPrototypeOf2.default)(RevokeAction)).call(this));

        _this4.TYPE = _Itypes.WActions.REVOKE;
        _this4.TYPE = _Itypes.WActions.REVOKE;
        return _this4;
    }

    (0, _createClass3.default)(RevokeAction, [{
        key: 'toString',
        value: function toString() {
            return '' + this.TYPE;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new RevokeAction();
        }
    }]);
    return RevokeAction;
}(IAction);

var SerialAction = exports.SerialAction = function (_IAction3) {
    (0, _inherits3.default)(SerialAction, _IAction3);

    function SerialAction() {
        (0, _classCallCheck3.default)(this, SerialAction);

        var _this5 = (0, _possibleConstructorReturn3.default)(this, (SerialAction.__proto__ || (0, _getPrototypeOf2.default)(SerialAction)).call(this));

        _this5.TYPE = _Itypes.WActions.SERIAL;
        return _this5;
    }

    (0, _createClass3.default)(SerialAction, [{
        key: 'toString',
        value: function toString() {
            return '' + this.TYPE;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new SerialAction();
        }
    }]);
    return SerialAction;
}(IAction);

var ClearAction = exports.ClearAction = function (_IAction4) {
    (0, _inherits3.default)(ClearAction, _IAction4);

    function ClearAction(accounts) {
        (0, _classCallCheck3.default)(this, ClearAction);

        var _this6 = (0, _possibleConstructorReturn3.default)(this, (ClearAction.__proto__ || (0, _getPrototypeOf2.default)(ClearAction)).call(this));

        _this6.TYPE = _Itypes.WActions.CLEAR;
        if (Array.isArray(accounts)) {
            _this6.accounts = accounts;
        } else if (accounts) {
            _this6.accounts = [accounts];
        } else {
            _this6.accounts = [];
        }
        return _this6;
    }

    (0, _createClass3.default)(ClearAction, [{
        key: 'toString',
        value: function toString() {
            var str = stringify(this.accounts);
            return this.TYPE + ':' + str;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            var accounts = unstringify(str);
            return new ClearAction(accounts);
        }
    }]);
    return ClearAction;
}(IAction);

var ClearAckAction = exports.ClearAckAction = function (_IAction5) {
    (0, _inherits3.default)(ClearAckAction, _IAction5);

    function ClearAckAction() {
        (0, _classCallCheck3.default)(this, ClearAckAction);

        var _this7 = (0, _possibleConstructorReturn3.default)(this, (ClearAckAction.__proto__ || (0, _getPrototypeOf2.default)(ClearAckAction)).call(this));

        _this7.TYPE = _Itypes.WActions.CLEAR_ACK;
        return _this7;
    }

    (0, _createClass3.default)(ClearAckAction, [{
        key: 'toString',
        value: function toString() {
            return this.TYPE + ':';
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new ClearAckAction();
        }
    }]);
    return ClearAckAction;
}(IAction);

var SyncRequestAction = exports.SyncRequestAction = function (_IAction6) {
    (0, _inherits3.default)(SyncRequestAction, _IAction6);

    function SyncRequestAction() {
        (0, _classCallCheck3.default)(this, SyncRequestAction);

        var _this8 = (0, _possibleConstructorReturn3.default)(this, (SyncRequestAction.__proto__ || (0, _getPrototypeOf2.default)(SyncRequestAction)).call(this));

        _this8.TYPE = _Itypes.WActions.SYNC_REQUEST;
        return _this8;
    }

    (0, _createClass3.default)(SyncRequestAction, [{
        key: 'toString',
        value: function toString() {
            return '' + this.TYPE;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new SyncRequestAction();
        }
    }]);
    return SyncRequestAction;
}(IAction);

var SyncAction = exports.SyncAction = function (_IAction7) {
    (0, _inherits3.default)(SyncAction, _IAction7);

    function SyncAction(sync) {
        (0, _classCallCheck3.default)(this, SyncAction);

        var _this9 = (0, _possibleConstructorReturn3.default)(this, (SyncAction.__proto__ || (0, _getPrototypeOf2.default)(SyncAction)).call(this));

        _this9.sync = sync;
        _this9.TYPE = _Itypes.WActions.SYNC;
        return _this9;
    }

    (0, _createClass3.default)(SyncAction, [{
        key: 'toString',
        value: function toString() {
            var sync = this.sync;
            var originStr = stringify(sync);
            return this.TYPE + ':' + originStr;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            var snapshot = unstringify(str);
            return new SyncAction(snapshot);
        }
    }]);
    return SyncAction;
}(IAction);

var SyncPrepareAction = exports.SyncPrepareAction = function (_IAction8) {
    (0, _inherits3.default)(SyncPrepareAction, _IAction8);

    function SyncPrepareAction() {
        (0, _classCallCheck3.default)(this, SyncPrepareAction);

        var _this10 = (0, _possibleConstructorReturn3.default)(this, (SyncPrepareAction.__proto__ || (0, _getPrototypeOf2.default)(SyncPrepareAction)).call(this));

        _this10.TYPE = _Itypes.WActions.SYNC_PREPARE;
        return _this10;
    }

    (0, _createClass3.default)(SyncPrepareAction, [{
        key: 'toString',
        value: function toString() {
            var originStr = stringify(this, ['']);
            return this.TYPE + ':' + originStr;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new SyncPrepareAction();
        }
    }]);
    return SyncPrepareAction;
}(IAction);

var SyncPrepareAckAction = exports.SyncPrepareAckAction = function (_IAction9) {
    (0, _inherits3.default)(SyncPrepareAckAction, _IAction9);

    function SyncPrepareAckAction() {
        (0, _classCallCheck3.default)(this, SyncPrepareAckAction);

        var _this11 = (0, _possibleConstructorReturn3.default)(this, (SyncPrepareAckAction.__proto__ || (0, _getPrototypeOf2.default)(SyncPrepareAckAction)).call(this));

        _this11.TYPE = _Itypes.WActions.SYNC_PREPARE_ACK;
        return _this11;
    }

    (0, _createClass3.default)(SyncPrepareAckAction, [{
        key: 'toString',
        value: function toString() {
            return this.TYPE + ':';
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new SyncPrepareAckAction();
        }
    }]);
    return SyncPrepareAckAction;
}(IAction);

var LaserPenAction = exports.LaserPenAction = function (_StartAction3) {
    (0, _inherits3.default)(LaserPenAction, _StartAction3);

    function LaserPenAction(x, y) {
        (0, _classCallCheck3.default)(this, LaserPenAction);

        var _this12 = (0, _possibleConstructorReturn3.default)(this, (LaserPenAction.__proto__ || (0, _getPrototypeOf2.default)(LaserPenAction)).call(this, x, y));

        _this12.x = x;
        _this12.y = y;
        _this12.TYPE = _Itypes.WActions.LASER_PEN;
        return _this12;
    }

    (0, _createClass3.default)(LaserPenAction, null, [{
        key: 'fromString',
        value: function fromString(str) {
            var pis = str.split(',');
            return new LaserPenAction(+pis[0], +pis[1]);
        }
    }]);
    return LaserPenAction;
}(StartAction);

var LaserPenEndAction = exports.LaserPenEndAction = function (_IAction10) {
    (0, _inherits3.default)(LaserPenEndAction, _IAction10);

    function LaserPenEndAction() {
        (0, _classCallCheck3.default)(this, LaserPenEndAction);

        var _this13 = (0, _possibleConstructorReturn3.default)(this, (LaserPenEndAction.__proto__ || (0, _getPrototypeOf2.default)(LaserPenEndAction)).call(this));

        _this13.TYPE = _Itypes.WActions.LASER_PEN_END;
        return _this13;
    }

    (0, _createClass3.default)(LaserPenEndAction, [{
        key: 'toString',
        value: function toString() {
            return this.TYPE + ':';
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new LaserPenEndAction();
        }
    }]);
    return LaserPenEndAction;
}(IAction);

var FileAction = exports.FileAction = function (_IAction11) {
    (0, _inherits3.default)(FileAction, _IAction11);

    function FileAction(file) {
        (0, _classCallCheck3.default)(this, FileAction);

        var _this14 = (0, _possibleConstructorReturn3.default)(this, (FileAction.__proto__ || (0, _getPrototypeOf2.default)(FileAction)).call(this));

        _this14.file = file;
        _this14.TYPE = _Itypes.WActions.FILE;
        return _this14;
    }

    (0, _createClass3.default)(FileAction, [{
        key: 'toString',
        value: function toString() {
            var file = this.file;
            var fileType = void 0;
            if (file.type === 'img') {
                fileType = '0';
            } else if (file.type === 'h5') {
                fileType = '1';
            } else {
                fileType = '-1';
            }
            return this.TYPE + ':' + (file.docId || '') + ',' + (file.currentPage || '') + ',' + (file.pageCount || '') + ',' + fileType + ',' + (file.url || '') + ',' + (file.urlStr || '') + ',' + (file.h5Cmd || '');
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            var value = str.split(',');
            var fileType = void 0;
            if (value[3] === '0') {
                fileType = 'img';
            } else if (value[3] === '1') {
                fileType = 'h5';
            } else {
                fileType = 'clear';
            }
            var file = {
                docId: value[0] || '',
                currentPage: parseInt(value[1] || '1'),
                pageCount: parseInt(value[2] || '1'),
                type: fileType || 'img',
                url: value[4] || '',
                urlStr: value[5] || '',
                h5Cmd: value[6] || ''
            };
            return new FileAction(file);
        }
    }, {
        key: 'immuteUpdate',
        value: function immuteUpdate(fileA, fileB) {
            var gatherFile = {};
            var diff = {};
            FileAction.PROPS.forEach(function (propName) {
                var valueOld = fileA[propName];
                var valueNext = fileB[propName];
                if (typeof valueNext === 'undefined' || valueNext === '') {
                    gatherFile[propName] = valueOld;
                } else {
                    if (valueNext !== valueOld) {
                        diff[propName] = valueNext;
                        gatherFile[propName] = valueNext;
                    } else {
                        gatherFile[propName] = valueOld;
                    }
                }
            });
            return [gatherFile, diff];
        }
    }]);
    return FileAction;
}(IAction);

FileAction.PROPS = ['docId', 'currentPage', 'pageCount', 'type', 'url', 'urlStr', 'h5Cmd'];

var RedoAction = exports.RedoAction = function (_IAction12) {
    (0, _inherits3.default)(RedoAction, _IAction12);

    function RedoAction() {
        (0, _classCallCheck3.default)(this, RedoAction);

        var _this15 = (0, _possibleConstructorReturn3.default)(this, (RedoAction.__proto__ || (0, _getPrototypeOf2.default)(RedoAction)).call(this));

        _this15.TYPE = _Itypes.WActions.REDO;
        return _this15;
    }

    (0, _createClass3.default)(RedoAction, [{
        key: 'toString',
        value: function toString() {
            return '' + this.TYPE;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            return new RedoAction();
        }
    }]);
    return RedoAction;
}(IAction);

var CalibrateAction = exports.CalibrateAction = function (_IAction13) {
    (0, _inherits3.default)(CalibrateAction, _IAction13);

    function CalibrateAction(opt) {
        (0, _classCallCheck3.default)(this, CalibrateAction);

        var _this16 = (0, _possibleConstructorReturn3.default)(this, (CalibrateAction.__proto__ || (0, _getPrototypeOf2.default)(CalibrateAction)).call(this));

        _this16.TYPE = _Itypes.WActions.CALIBRATE;
        (0, _assign2.default)(_this16, opt);
        return _this16;
    }

    (0, _createClass3.default)(CalibrateAction, [{
        key: 'toString',
        value: function toString() {
            var originStr = stringify(this, CalibrateAction.PROPS);
            return this.TYPE + ':' + originStr;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            var opt = unstringify(str);
            return new CalibrateAction(opt);
        }
    }]);
    return CalibrateAction;
}(IAction);
// static readonly PROPS = [
//   'mode', 'tool', 'size', 'color', 'fontsize',
// ]


CalibrateAction.USER_PROPS = ['mode', 'tool', 'size', 'color', 'fontsize', 'isMouseDown', 'keyDown', 'flagPos'];
CalibrateAction.PROPS = [].concat((0, _toConsumableArray3.default)(CalibrateAction.USER_PROPS), ['altKey', 'shiftKey', 'which', 'ctrlKey'], ['ownerCanvasHeight', 'ownerCanvasWidth']);

var TextAction = exports.TextAction = function (_IAction14) {
    (0, _inherits3.default)(TextAction, _IAction14);

    function TextAction(x, y, text) {
        (0, _classCallCheck3.default)(this, TextAction);

        var _this17 = (0, _possibleConstructorReturn3.default)(this, (TextAction.__proto__ || (0, _getPrototypeOf2.default)(TextAction)).call(this));

        _this17.x = x;
        _this17.y = y;
        _this17.text = text;
        _this17.TYPE = _Itypes.WActions.TEXT;
        return _this17;
    }

    (0, _createClass3.default)(TextAction, [{
        key: 'toString',
        value: function toString() {
            var originStr = stringify(this, TextAction.PROPS);
            return this.TYPE + ':' + originStr;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            // str.split(',') 不能用，分割，因为用户可能会输入‘，’
            var _unstringify = unstringify(str),
                x = _unstringify.x,
                y = _unstringify.y,
                text = _unstringify.text;

            return new TextAction(x, y, text);
        }
    }]);
    return TextAction;
}(IAction);

TextAction.PROPS = ['x', 'y', 'text'];

var VersionAction = exports.VersionAction = function (_IAction15) {
    (0, _inherits3.default)(VersionAction, _IAction15);

    function VersionAction(_ref) {
        var ver = _ref.ver,
            account = _ref.account,
            gzip = _ref.gzip;
        (0, _classCallCheck3.default)(this, VersionAction);

        var _this18 = (0, _possibleConstructorReturn3.default)(this, (VersionAction.__proto__ || (0, _getPrototypeOf2.default)(VersionAction)).call(this));

        _this18.TYPE = _Itypes.WActions.VERSION;
        _this18.ver = ver;
        _this18.account = account;
        _this18.gzip = gzip;
        return _this18;
    }

    (0, _createClass3.default)(VersionAction, [{
        key: 'toString',
        value: function toString() {
            var originStr = stringify(this, VersionAction.PROPS);
            return this.TYPE + ':' + originStr;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            // str.split(',') 不能用，分割，因为用户可能会输入‘，’
            var _unstringify2 = unstringify(str),
                ver = _unstringify2.ver,
                account = _unstringify2.account,
                gzip = _unstringify2.gzip;

            return new VersionAction({
                ver: ver,
                account: account,
                gzip: gzip
            });
        }
    }]);
    return VersionAction;
}(IAction);

VersionAction.PROPS = ['ver', 'account', 'gzip'];

/***/ }),

/***/ "./src/core/DrawWorker/CanvasHelper.ts":
/*!*********************************************!*\
  !*** ./src/core/DrawWorker/CanvasHelper.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.setLineStyle = setLineStyle;
exports.setpixelated = setpixelated;
exports.setCavansStyleSize = setCavansStyleSize;
exports.setCanvasPropSize = setCanvasPropSize;
exports.applyCanvasLayout = applyCanvasLayout;
exports.clearCtx = clearCtx;
exports.free = free;
exports.line = line;
exports.rect = rect;
exports.roundRect = roundRect;
exports.circle = circle;
exports.ellipse = ellipse;
exports.fill = fill;
exports.text = text;

var _Point = __webpack_require__(/*! ../Model/Point */ "./src/core/Model/Point.ts");

var _debug = __webpack_require__(/*! debug */ "./node_modules/debug/src/index.js");

var _debug2 = _interopRequireDefault(_debug);

var _debug3 = __webpack_require__(/*! ../../debug */ "./src/debug.ts");

var _debug4 = _interopRequireDefault(_debug3);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 为什么每次开始都需要调用beginPath
 * https://codetheory.in/why-clearrect-might-not-be-clearing-canvas-pixels/
 */
var debug = (0, _debug2.default)('DrawWorker/CanvasHelper');
function setLineStyle(ctx) {
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
}
/* eslint-disable camelcase */
function setpixelated(context) {
    if (context === null) {
        return;
    }
    // context.translate(0.5, 0.5)
    // context.lineWidth = .5;
    context['imageSmoothingEnabled'] = false; /* standard */
    context['mozImageSmoothingEnabled'] = false; /* Firefox */
    context['oImageSmoothingEnabled'] = false; /* Opera */
    context['webkitImageSmoothingEnabled'] = false; /* Safari */
    context['msImageSmoothingEnabled'] = false; /* IE */
    /* tslint:enable */
}
/**
 * 等比例缩放Canvas
 * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
 * @param {ResizeCanvasOption} option 缩放比例
 * @private
 */
function setCavansStyleSize(ctx, width, height) {
    var cvs = ctx.canvas;
    cvs.style.width = width + 'px';
    cvs.style.height = height + 'px';
}
/**
 * 改变canvas的 width 和大小等等
 *
 * zhongkai: 将ctx内容拷贝到临时画布上，然后再将临时画布的内容拷贝回ctx上。这样做应该是比较低效的(todo)
 *
 * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
 * @param {ResizeCanvasOption} option 缩放比例
 * @private
 */
function setCanvasPropSize(ctx, option) {
    var canvas = ctx.canvas;
    var skip = false;
    if (canvas.width == 0 || canvas.height == 0) {
        skip = true;
    }
    var temp = document.createElement('canvas').getContext('2d');
    if (!skip) {
        temp.canvas.width = canvas.width;
        temp.canvas.height = canvas.height;
        setpixelated(temp);
        setLineStyle(temp);
        temp.drawImage(canvas, 0, 0, canvas.width, canvas.height);
    }
    canvas.width = option.width;
    canvas.height = option.height;
    // canvas.width = option.canvasWidth
    // canvas.height = option.canvasHeight;
    setLineStyle(ctx);
    setpixelated(ctx);
    if (!skip) {
        setpixelated(temp);
        ctx.drawImage(temp.canvas, 0, 0, canvas.width, canvas.height);
    }
}
function applyCanvasLayout(canvas, _ref) {
    var paddingLeft = _ref.paddingLeft,
        paddingTop = _ref.paddingTop;

    canvas.style.left = paddingLeft + 'px';
    canvas.style.top = paddingTop + 'px';
}
/**
   * 清除某个画板的内容
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @private
   */
function clearCtx(ctx) {
    ctx.clearRect(-40, -40, ctx.canvas.width + 80, ctx.canvas.height + 80);
}
/**
   * 绘制曲线
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {Coord} start 起始点
   * @param {Coord} control 控制点
   * @param {Coord} end 终止点
   * @param {string} color 颜色
   * @param {number} size 宽度，笔大小
   * @private
   */
function free(ctx, start, control, end, color, size) {
    ctx.fillStyle = color;
    ctx.strokeStyle = color;
    ctx.beginPath();
    // 用三个点画二次曲线，使笔迹光滑，降低锯齿感
    if (start.x === end.x && start.y === end.y) {
        // IE下使用quadraticCurveTo无法画点
        ctx.lineTo(start.x, start.y);
        //  rect(ctx, start, size / 4, size / 4, false, color)
        return;
    }
    // ctx.beginPath()
    ctx.moveTo(start.x, start.y);
    ctx.quadraticCurveTo(control.x, control.y, end.x, end.y);
    ctx.stroke();
    debug('free');
}
/**
   * 绘制直线
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {Coord} start 起始点
   * @param {Coord} end 终止点
   * @private
   */
function line(ctx, start, end, color) {
    _debug4.default.log('line', arguments);
    ctx.fillStyle = color;
    ctx.strokeStyle = color;
    // ctx.save()
    ctx.beginPath();
    ctx.moveTo(start.x, start.y);
    ctx.lineTo(end.x, end.y);
    ctx.stroke();
    // ctx.closePath();
    // ctx.restore()
    debug('line');
}
/**
   * 绘制矩形
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {Coord} start 起始点
   * @param {number} w 宽度，单位px
   * @param {number} h 高度，单位px
   * @param {boolean} fill 是否填充
   * @param {string} color 填充颜色
   * @private
   */
function rect(ctx, start, w, h) {
    var fill = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
    var color = arguments[5];

    if (fill) {
        ctx.fillStyle = color;
        ctx.fillRect(start.x, start.y, w, h);
    } else {
        ctx.strokeRect(start.x, start.y, w, h);
    }
}
/**
   * 绘制圆角矩形
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {CanvasRenderingContext2D} start 起始点
   * @param {number} w 宽度，单位px
   * @param {number} h 高度，单位px
   * @param {*} radius 圆角半径，单位px
   * @param {boolean} fill 是否填充
   * @param {string} color 填充颜色
   * @private
   */
function roundRect(ctx, start, w, h, radius) {
    var fill = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;
    var color = arguments[6];

    var sx = start.x;
    var sy = start.y;
    var radiusX = w < 0 ? -radius : radius;
    var radiusY = h < 0 ? -radius : radius;
    ctx.beginPath();
    ctx.moveTo(sx + radiusX, sy);
    ctx.lineTo(sx + w - radiusX, sy);
    ctx.quadraticCurveTo(sx + w, sy, sx + w, sy + radiusY);
    ctx.lineTo(sx + w, sy + h - radiusY);
    ctx.quadraticCurveTo(sx + w, sy + h, sx + w - radiusX, sy + h);
    ctx.lineTo(sx + radiusX, sy + h);
    ctx.quadraticCurveTo(sx, sy + h, sx, sy + h - radiusY);
    ctx.lineTo(sx, sy + radiusY);
    ctx.quadraticCurveTo(sx, sy, sx + radiusX, sy);
    ctx.stroke();
    if (fill) {
        ctx.fillStyle = color;
        ctx.fill();
    }
}
/**
   * 绘制圆形
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {CanvasRenderingContext2D} center 圆心
   * @param {number} radius 半径，单位px
   * @param {boolean} fill 是否填充
   * @param {string} color 填充颜色
   * @private
   */
function circle(ctx, center, radius) {
    var fill = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
    var color = arguments[4];

    // console.log('circle', center, radius, fill, color);
    if (color) {
        ctx.strokeStyle = color;
    }
    ctx.beginPath();
    // arc(x,y,r,start,stop)
    // ctx.arc(center.x, center.y, radius, 0, Math.PI * 2, true);
    ctx.arc(center.x, center.y, radius, 0, Math.PI * 2);
    if (fill) {
        ctx.fillStyle = color;
        ctx.fill();
    }
    ctx.stroke();
}
/**
   * 绘制椭圆
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {CanvasRenderingContext2D} center 圆心
   * @param {number} xRadius x半径，单位px
   * @param {number} yRadius y半径，单位px
   * @param {boolean} fill 是否填充
   * @param {string} color 填充颜色
   * @private
   */
function ellipse(ctx, center, xRadius, yRadius) {
    var fill = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
    var color = arguments[5];

    // console.log('ellipse', center, fill, color);
    if (color) {
        ctx.strokeStyle = color;
    }
    ctx.beginPath();
    // arc(x,y,r,start,stop)
    // ctx.arc(center.x, center.y, radius, 0, Math.PI * 2, true);
    ctx.ellipse(center.x, center.y, xRadius, yRadius, 0, 0, Math.PI * 2);
    if (fill) {
        ctx.fillStyle = color;
        ctx.fill();
    }
    ctx.stroke();
}
function safeColorClamp(x) {
    if (x < 0) {
        return 0;
    } else if (x > 255) {
        return 255;
    } else {
        return x;
    }
}
/**
   * 为封闭区域填充颜色
   * 算法是 flood fill（https://en.m.wikipedia.org/wiki/Flood_fill），找了个效率比较高的实现改成了js；也可能是scanline fill。
   * TODO 为IE做Typed Array的polyfill
   * @param {CanvasRenderingContext2D} ctx
   * @param {Coord} s 起始点
   * @param {String} color 需要填充的颜色
   * @param {Shape} shape 需要填充的颜色
   * @private
   */
function fill(ctx, s, color, shape) {
    var sx = Math.round(s.x);
    var sy = Math.round(s.y);
    ctx.save();
    ctx.beginPath();
    var img = ctx.getImageData(0, 0, Math.round(ctx.canvas.width), Math.round(ctx.canvas.height));
    // logger.image(ctx.canvas.toDataURL(), 'fill, playground')
    var fullDisplayHeight = img.height,
        fullDisplayWidth = img.width;

    if (shape) {
        shape.ctx.canvas.width = fullDisplayWidth;
        shape.ctx.canvas.height = fullDisplayHeight;
        setpixelated(shape.ctx);
        setLineStyle(shape.ctx);
    }
    var X = 0;
    var Y = 1;
    var stroke = color || ctx.strokeStyle;
    var r = parseInt(stroke.substr(1, 2), 16);
    var g = parseInt(stroke.substr(3, 2), 16);
    var b = parseInt(stroke.substr(5, 2), 16);
    // >>> 0 运算转换为无符号32位整数
    var fillColor = (255 << 24 | b << 16 | g << 8 | r) >>> 0;
    var start = [sx, sy];
    // 临时空间，用来缓存填充区域的数据，然后注入到Shape里
    var shapeImageData = shape.ctx.createImageData(fullDisplayWidth, fullDisplayHeight);
    var shapeData = new Uint32Array(shapeImageData.data.buffer);
    // buf8.set(img.data);
    var data = new Uint32Array(img.data.buffer);
    var startColor = data[sy * fullDisplayWidth + sx];
    if (((startColor ^ fillColor) & 0xffffff) === 0) {
        // 颜色值相等
        if (startColor >>> 24 === fillColor >>> 24) {
            return;
        }
    }
    var rgb = startColor & 0x00ffffff;
    var r_start = (rgb & 0xff) >>> 0;
    var g_start = (rgb & 0xff00) >>> 8;
    var b_start = (rgb & 0xff0000) >>> 16;
    var alpha_start = (startColor & 0xff000000) >>> 24;
    // 色彩抖动范围
    var R_MIN = safeColorClamp(r_start - 15);
    var G_MIN = safeColorClamp(g_start - 15);
    var B_MIN = safeColorClamp(b_start - 15);
    var R_MAX = safeColorClamp(r_start + 15);
    var G_MAX = safeColorClamp(g_start + 15);
    var B_MAX = safeColorClamp(b_start + 15);
    // 起点入队列
    var queue = [start];
    var curPixel = void 0;
    var maxX = fullDisplayWidth - 1;
    var maxY = fullDisplayHeight - 1;
    // 比较颜色是否可以填充
    function canFill(color) {
        // return color === startColor
        if (color === startColor) {
            return true;
        }
        var alpha = (color & 0xff000000) >>> 24;
        if (alpha_start < 10) {
            // 如果一开始的颜色是透明的，那么透明色是可以填充的
            if (alpha === 0) {
                return true;
            }
        }
        var rgb = (color & 0x00ffffff) >>> 0;
        var r = (rgb & 0xff) >>> 0;
        var g = (rgb & 0xff00) >>> 8;
        var b = (rgb & 0xff0000) >>> 16;
        // 在颜色抖动范围内
        if (r >= R_MIN && r <= R_MAX && g >= G_MIN && g <= G_MAX && b >= B_MIN && b <= B_MAX) {
            // 如果颜色相同 ,且透明度变化在20内
            if (Math.abs(alpha_start - alpha) < 10) {
                return true;
            }
        }
        return false;
        // return color === startColor || (color & 0xff000000) >>> 0 < 0xff000000;
    }
    var seen = {};
    var topLeft = new _Point.Coord(Math.round(fullDisplayWidth), Math.round(fullDisplayHeight));
    var bottomRight = new _Point.Coord(0, 0);
    var getImageDataIndex = function getImageDataIndex(x, y) {
        return y * fullDisplayWidth + x;
    };
    var getColor = function getColor(x, y) {
        return data[getImageDataIndex(x, y)];
    };
    while (curPixel = queue.pop()) {
        var x = curPixel[X];
        var y = curPixel[Y];
        // 从当前点往上查找，
        while (--y >= 0 && canFill(getColor(x, y))) {}
        y++;
        var reachLeft = false;
        var reachRight = false;
        while (y++ < maxY && canFill(getColor(x, y))) {
            // 设置坐标点边界，好切出正确的大小
            topLeft.topLeft(x, y);
            bottomRight.bottomRight(x + 1, y + 1);
            var imgDataIndex = getImageDataIndex(x, y); // curPixel[Y] * fullDisplayWidth + curPixel[X]
            data[imgDataIndex] = fillColor;
            shapeData[imgDataIndex] = fillColor;
            seen[imgDataIndex] = true;
            if (x > 0 && !seen[imgDataIndex - 1]) {
                if (canFill(data[imgDataIndex - 1])) {
                    if (!reachLeft) {
                        queue.push([x - 1, y]);
                        reachLeft = true;
                    }
                } else if (reachLeft) {
                    reachLeft = false;
                }
            }
            if (x < maxX && !seen[imgDataIndex + 1]) {
                if (canFill(data[imgDataIndex + 1])) {
                    if (!reachRight) {
                        if (!seen[imgDataIndex + 1]) {
                            queue.push([x + 1, y]);
                        }
                        reachRight = true;
                    }
                } else if (reachRight) {
                    reachRight = false;
                }
            }
        }
    }
    // img.data.set(buf8);
    var finalArea = _Point.Coord.areaSize(topLeft, bottomRight);
    _debug4.default.log('fill area is ', finalArea);
    _debug4.default.log('fill corner is ', topLeft, bottomRight);
    shape.corner = [topLeft, bottomRight];
    shape.ctx.putImageData(shapeImageData, 0, 0);
    var smallImageData = shape.ctx.getImageData(topLeft.x, topLeft.y, finalArea.width, finalArea.height);
    _debug4.default.log(smallImageData);
    shape.ctx.canvas.height = smallImageData.height;
    shape.ctx.canvas.width = smallImageData.width;
    setpixelated(shape.ctx);
    setLineStyle(shape.ctx);
    shape.ctx.putImageData(smallImageData, 0, 0);
    console.log('shape:', shape.ctx.canvas.toDataURL());
    clearCtx(ctx);
    _debug4.default.image(ctx.canvas.toDataURL(), 'ctx.canvas');
    _debug4.default.image(shape.ctx.canvas.toDataURL(), 'shape.ctx');
    ctx.putImageData(img, 0, 0);
    console.error(shape.ctx.canvas.toDataURL());
    _debug4.default.image(ctx.canvas.toDataURL(), 'final');
    shape.ctx.beginPath();
    ctx.restore();
}
/**
   * 绘制字
   * @param {CanvasRenderingContext2D} ctx 目标Canvas的context
   * @param {CanvasRenderingContext2D} start 起始点
   * @param {string} text 文本内容
   * @param {number} size 字体大小，单位px
   * @param {boolean} fill 是否填充
   * @private
   */
function text(ctx, start, text, size) {
    var fill = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;
    var color = arguments[5];

    var x = start.x;
    var y = start.y;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.font = size + 'px "微软雅黑",Arial';
    ctx.textBaseline = 'top';
    // ctx.textBaseline = 'bottom';
    ctx.textAlign = 'left';
    if (fill) {
        ctx.fillStyle = color;
        ctx.fillText(text, x, y);
    } else {
        ctx.strokeText(text, x, y);
    }
    ctx.beginPath();
}

/***/ }),

/***/ "./src/core/DrawWorker/ContainerManager.ts":
/*!*************************************************!*\
  !*** ./src/core/DrawWorker/ContainerManager.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

exports.applyState = applyState;

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _CanvasHelper = __webpack_require__(/*! ./CanvasHelper */ "./src/core/DrawWorker/CanvasHelper.ts");

var CanvasHelper = _interopRequireWildcard(_CanvasHelper);

var _debug = __webpack_require__(/*! ../../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ContainerManager = function (_EventEmitter) {
    (0, _inherits3.default)(ContainerManager, _EventEmitter);

    function ContainerManager(container, opt) {
        (0, _classCallCheck3.default)(this, ContainerManager);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ContainerManager.__proto__ || (0, _getPrototypeOf2.default)(ContainerManager)).call(this));

        _this.paddingTop = 0; //  这个是画布距离容器顶部的距离
        _this.paddingLeft = 0; // 这个是画布距离容器左边的距离
        _this.canvasRatio = null;
        // 调整窗口大小后，需要动态调整 canvas 大小，目前 width 为准等比例缩放
        _this.onResize = function () {
            if (!_this.container) {
                return;
            }
            if (_this.onResize.waiting) {
                return;
            } else {
                _this.onResize.waiting = true;
                setTimeout(function () {
                    _this.onResize.waiting = false;
                    _this.resize();
                }, 300);
            }
        };
        /**
         * 重新设置画布大小，等比例
         * @param {number} width 画布宽度
         * @public
         */
        _this.resize = function () {
            var width = parseInt('' + _this.container.clientWidth);
            if (isNaN(width) || width <= 0) throw new Error('白板宽度应是大于0的数字');
            var height = parseInt('' + _this.container.clientHeight);
            if (isNaN(height) || height <= 0) throw new Error('白板高度应是大于0的数字');
            if (width === 0 || height === 0) {
                return;
            }
            _this.containerWidth = width;
            _this.containerHeight = height;
            if (_this.canvasRatio === null) {
                _this.calcCanvasLayout(width / height);
            } else {
                _this.calcCanvasLayout();
            }
            _this.updateCanvasStyleSize({
                // ownerCanvasHeight: ownerCanvasHeight!, ownerCanvasWidth: ownerCanvasWidth!,
                paddingLeft: _this.paddingLeft, paddingTop: _this.paddingTop,
                canvasWidth: _this.canvasWidth, canvasHeight: _this.canvasHeight
            });
            console.log('resize');
            if (_this.opt && _this.opt.identity === 'owner') {
                if (_this.canvasWidth && _this.canvasHeight) {}
                _this.emit('ownerCanavasUpdate', _this.canvasWidth, _this.canvasHeight);
                var prevHeight = _this.containerHeight,
                    prevWidth = _this.containerWidth,
                    ownerCanvasHeight = _this.ownerCanvasHeight,
                    ownerCanvasWidth = _this.ownerCanvasWidth;

                _this.updateCanvasPropSize(_this.canvasWidth, _this.canvasHeight);
            }
        };
        _this.onUndo = function () {
            if (_this.displayCtx && _this.shapes && _this.users) {
                _this.fullRender();
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = (0, _getIterator3.default)(_this.users.all), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var user = _step.value;

                        if (user.isMouseDown) {
                            // 防止在clear时 擦除了其他用户正在绘制的笔记，
                            _this.displayCtx.drawImage(user.ctx.canvas, 0, 0);
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }
            }
        };
        _this.onRedo = function () {
            if (_this.displayCtx && _this.shapes && _this.users) {
                _this.fullRender();
                var _iteratorNormalCompletion2 = true;
                var _didIteratorError2 = false;
                var _iteratorError2 = undefined;

                try {
                    for (var _iterator2 = (0, _getIterator3.default)(_this.users.all), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                        var user = _step2.value;

                        if (user.isMouseDown) {
                            // 防止在clear时 擦除了其他用户正在绘制的笔记，
                            _this.displayCtx.drawImage(user.ctx.canvas, 0, 0);
                        }
                    }
                } catch (err) {
                    _didIteratorError2 = true;
                    _iteratorError2 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion2 && _iterator2.return) {
                            _iterator2.return();
                        }
                    } finally {
                        if (_didIteratorError2) {
                            throw _iteratorError2;
                        }
                    }
                }
            }
        };
        _this.inputDom = buildInputDom(); // 输入文字的输入框
        _this.opt = opt;
        _this.inited = false;
        if (!container) return (0, _possibleConstructorReturn3.default)(_this);
        _this.setContainer(container, opt, true);
        return _this;
    }

    (0, _createClass3.default)(ContainerManager, [{
        key: 'wrap',
        value: function wrap(shapesmanager, users) {
            this.clearListener();
            this.shapes = shapesmanager;
            this.users = users;
            this.shapes.on('undo', this.onUndo);
            this.shapes.on('redo', this.onRedo);
        }
    }, {
        key: 'clearListener',
        value: function clearListener() {
            if (this.shapes) {
                this.shapes.removeAllListeners();
            }
        }
        // 动态设置container

    }, {
        key: 'setContainer',
        value: function setContainer(container, opt, init) {
            _debug2.default.m.containermanager('setContainer', container, opt);
            if (!(container instanceof HTMLElement)) {
                throw new Error('画板容器不是HTMLElement实例');
            }
            if (this.container) {
                this.container.removeEventListener('resize', this.onResize);
                this.container.remove();
            }
            this.container = container;
            container.style.position = 'relative';
            if (!opt) {
                if (this.opt) {
                    opt = this.opt;
                } else {
                    opt = {};
                }
            }
            this.containerHeight = container.clientHeight;
            this.containerWidth = container.clientWidth;
            console.warn('canvas height!', opt, this.canvasRatio);
            // 计算容器宽高比例
            if (this.canvasRatio === null) {
                if (opt.height && opt.width) {
                    //如果用户设置了宽高
                    this.canvasHeight = opt.height;
                    this.canvasWidth = opt.width;
                    this.updateCanvasPropSize(this.canvasWidth, this.canvasHeight);
                    this.canvasRatio = this.canvasWidth / this.canvasHeight;
                    // 目前使用的是长宽比去放大图像或者缩小图像
                } else {
                    this.canvasRatio = this.containerWidth / this.containerHeight;
                }
            }
            var canvasRatio = this.canvasRatio;
            if (canvasRatio === null) {
                canvasRatio = this.containerWidth / this.containerHeight;
            }
            if (typeof canvasRatio === 'number') {
                this.calcCanvasLayout(canvasRatio);
            }
            this.opt = (0, _assign2.default)(this.opt, opt);
            // 设置自己容器的大小
            if (!this.inited) {
                this.initEssential();
            }
            // 更新 canvas 外部表现的大小，由style属性控制
            this.updateCanvasStyleSize({
                // ownerCanvasHeight: ownerCanvasHeight!, ownerCanvasWidth: ownerCanvasWidth!,
                paddingLeft: this.paddingLeft, paddingTop: this.paddingTop,
                canvasWidth: this.canvasWidth, canvasHeight: this.canvasHeight
            });
            // 如果是初始化，并且是老师端，需要更新 canvas 内部表现的大小，由width属性控制
            if (init && this.opt.identity === 'owner') {
                this.updateCanvasPropSize(this.canvasWidth, this.canvasHeight);
            }
            _debug2.default.m.containermanager('setContainer/appendChild', this.displayCanvas, this.inputDom);
            container.appendChild(this.displayCanvas);
            container.appendChild(this.maskCanvas);
            container.appendChild(this.inputDom);
            this.adjustSize = false;
            window.addEventListener('resize', this.onResize);
            window.addEventListener("orientationchange", this.onResize, false);
        }
        // 计算容器和canvas的布局

    }, {
        key: 'calcCanvasLayout',
        value: function calcCanvasLayout() {
            var ratio = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.canvasRatio;

            var containerRatio = this.containerWidth / this.containerHeight;
            if (containerRatio > ratio) {
                // 说明容器的宽度要比canvas的宽度要宽一些，应该使用容器的高度作为标准
                this.canvasHeight = Math.floor(this.containerHeight || 0);
                this.canvasWidth = Math.floor(this.canvasHeight * ratio);
            } else {
                this.canvasWidth = Math.floor(this.containerWidth || 0);
                this.canvasHeight = Math.floor(this.canvasWidth / ratio);
            }
            var heightGap = this.containerHeight - this.canvasHeight;
            var widthGap = this.containerWidth - this.canvasWidth;
            this.paddingTop = Math.floor(heightGap / 2);
            this.paddingLeft = Math.floor(widthGap / 2);
        }
        // 初始化canvas环境

    }, {
        key: 'initEssential',
        value: function initEssential() {
            var _this2 = this;

            if (typeof this.containerWidth !== 'number') throw new Error('画板宽度不是数字');
            if (typeof this.containerHeight !== 'number') throw new Error('画板高度不是数字');
            var displayCanvas = document.createElement('canvas');
            this.displayCtx = displayCanvas.getContext('2d');
            // CanvasHelper.setpixelated(this.displayCtx)
            CanvasHelper.setLineStyle(this.displayCtx);
            displayCanvas.setAttribute('data-id', 'displayCanvas');
            var displayStyle = ('\n    position: relative;\n    top: ' + this.paddingTop + 'px;\n    left: ' + this.paddingLeft + 'px;\n    box-sizing: content-box;\n    background-position: center;\n    background-repeat: no-repeat;\n    background-color: #ffffff;\n    background-size: contain;\n    z-index: ' + 2 + ';\n    ').trim().replace('\n', '');
            displayCanvas.style.cssText = displayStyle;
            this.displayCanvas = displayCanvas;
            var maskCanvas = document.createElement('canvas');
            this.maskCtx = maskCanvas.getContext('2d');
            CanvasHelper.setpixelated(this.maskCtx);
            CanvasHelper.setLineStyle(this.maskCtx);
            this.maskCtx.lineWidth = 1;
            maskCanvas.setAttribute('data-id', 'maskCanvas');
            var maskStyle = ('\n    position: absolute;\n    top: ' + this.paddingTop + ';\n    left: ' + this.paddingLeft + ';\n    box-sizing: content-box;\n    transform: translate3d(0,0,0);\n    z-index: ' + 500 + ';\n    ').trim().replace('\n', '');
            maskCanvas.style.cssText = maskStyle;
            this.maskCanvas = maskCanvas;
            this.inited = true;
            _debug2.default.m.containermanager('initCanvas');
            // 对于可能出现在构造函数里的事件，需要异步抛出，避免初始化时，监听函数还未绑定
            setTimeout(function () {
                _this2.emit('init-canvas');
                if (_this2.opt && _this2.opt.identity === 'owner') {
                    _this2.emit('ownerCanavasUpdate', _this2.canvasWidth, _this2.canvasHeight);
                }
            });
        }
        /**
         * 按比例重新变换画布大小
         * @param {number} scale 变换比例
         * @public
         */

    }, {
        key: 'updateCanvasStyleSize',
        value: function updateCanvasStyleSize(config) {
            var canvasWidth = config.canvasWidth,
                canvasHeight = config.canvasHeight;

            if (this.maskCtx && this.maskCanvas) {
                CanvasHelper.setCavansStyleSize(this.maskCtx, canvasWidth, canvasHeight);
                CanvasHelper.applyCanvasLayout(this.maskCanvas, config);
            }
            if (this.displayCtx && this.displayCanvas) {
                CanvasHelper.setCavansStyleSize(this.displayCtx, config.canvasWidth, config.canvasHeight);
                CanvasHelper.applyCanvasLayout(this.displayCanvas, config);
            }
            // if (this.shapes) {
            //   this.shapes.resizeCanvas(config)
            // }
            if (this.users) {
                var _iteratorNormalCompletion3 = true;
                var _didIteratorError3 = false;
                var _iteratorError3 = undefined;

                try {
                    for (var _iterator3 = (0, _getIterator3.default)(this.users.all), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                        var user = _step3.value;

                        CanvasHelper.setCavansStyleSize(user.ctx, canvasWidth, canvasHeight);
                        CanvasHelper.applyCanvasLayout(user.ctx.canvas, config);
                    }
                } catch (err) {
                    _didIteratorError3 = true;
                    _iteratorError3 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion3 && _iterator3.return) {
                            _iterator3.return();
                        }
                    } finally {
                        if (_didIteratorError3) {
                            throw _iteratorError3;
                        }
                    }
                }
            }
        }
    }, {
        key: 'updateCanvasPropSize',
        value: function updateCanvasPropSize(width, height) {
            var prevHeight = this.ownerCanvasHeight,
                prevWidth = this.ownerCanvasWidth;

            this.ownerCanvasWidth = width || 300;
            this.ownerCanvasHeight = height || 300;
            var opt = { width: this.ownerCanvasWidth, height: this.ownerCanvasHeight };
            if (this.maskCtx) {
                CanvasHelper.setCanvasPropSize(this.maskCtx, opt);
            }
            if (this.displayCtx) {
                CanvasHelper.setCanvasPropSize(this.displayCtx, opt);
            }
            if (this.users) {
                var _iteratorNormalCompletion4 = true;
                var _didIteratorError4 = false;
                var _iteratorError4 = undefined;

                try {
                    for (var _iterator4 = (0, _getIterator3.default)(this.users.all), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
                        var user = _step4.value;

                        CanvasHelper.setCanvasPropSize(user.ctx, { width: width, height: height });
                    }
                } catch (err) {
                    _didIteratorError4 = true;
                    _iteratorError4 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion4 && _iterator4.return) {
                            _iterator4.return();
                        }
                    } finally {
                        if (_didIteratorError4) {
                            throw _iteratorError4;
                        }
                    }
                }
            }
            if (this.shapes) {
                this.shapes.resizeCanvas({
                    widthScale: width / prevWidth, heightScale: height / prevHeight
                });
            }
            // 需要fullrender一下
            this.fullRender();
        }
        // add UserCanvas 

    }, {
        key: 'addUser',
        value: function addUser(currentAccount, user) {
            var canvas = user.ctx.canvas;
            var account = user.account;
            var displayCanvas = this.displayCanvas;
            // canvas.style.transform = 'translate3d(0,0,0)'
            canvas.style.position = 'absolute';
            canvas.style.boxSizing = 'content-box';
            // canvas.style.transform = 'translate3d(0,0,0)'
            canvas.style.top = this.paddingTop + 'px';
            canvas.style.left = this.paddingLeft + 'px';
            canvas.style.width = this.canvasWidth + 'px';
            canvas.style.height = this.canvasHeight + 'px';
            canvas.width = this.ownerCanvasWidth;
            canvas.height = this.ownerCanvasHeight;
            _debug2.default.m.containermanager('addUser', account, user);
            if (account === currentAccount) {
                canvas.style.cursor = 'not-allowed';
            } else {
                canvas.style.cursor = 'crosshair';
            }
            this.container.appendChild(canvas);
            CanvasHelper.setpixelated(user.ctx);
            CanvasHelper.setLineStyle(user.ctx);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.container.removeChild(this.maskCanvas);
            this.container.removeChild(this.displayCtx.canvas);
            this.removeAllListeners();
            window.removeEventListener('resize', this.onResize);
            window.removeEventListener("orientationchange", this.onResize, false);
        }
    }, {
        key: 'fullRender',
        value: function fullRender() {
            if (this.displayCtx) {
                var playCanvas = this.displayCtx.canvas;
                CanvasHelper.clearCtx(this.displayCtx);
                this.displayCtx.getImageData(0, 0, 1, 1); // 这里是为了让canvas重新渲染一下，Chrome，偶尔会有Canvas不更新的问题
                // playCanvas.width = playCanvas.width;
            }
            if (this.shapes && this.displayCtx) {
                var targetCtx = this.displayCtx;
                var shapes = this.shapes.visibles;
                // logger.image(targetCtx.canvas.toDataURL(), 'beforeRender, displayCtx')
                targetCtx.save();
                _debug2.default.log('displayCtx');
                for (var i = 0, len = shapes.length; i < len; i++) {
                    var shape = shapes[i];
                    console.assert(typeof shape.ctx !== 'undefined', 'shape ctx is ubdefined', shape);
                    var skip = shape.ctx && (shape.ctx.canvas.width === 0 || shape.ctx.canvas.height === 0);
                    _debug2.default.m.containermanager('render shape:', shape, 'skip', skip);
                    if (skip) {
                        continue;
                    }
                    applyState(targetCtx, shape);
                    // if (shape.mode === 'fill') return fill(ctx, shape.corner[0], shape.color,shape);
                    // -0.5是为了防止重绘时的抖动
                    // targetCtx.drawImage(shape.ctx.canvas, shape.corner[0].x - 0.5, shape.corner[0].y)
                    if (shape.tool === 'erase') {
                        console.log(targetCtx.globalCompositeOperation);
                    }
                    targetCtx.drawImage(shape.ctx.canvas, shape.corner[0].x, shape.corner[0].y);
                }
                targetCtx.restore();
            } else {
                _debug2.default.m.containermanager('no render', this.shapes, this.displayCtx);
            }
        }
    }]);
    return ContainerManager;
}(_eventemitter.EventEmitter);

exports.default = ContainerManager;

function buildInputDom() {
    var inputDom = document.createElement('input');
    inputDom.type = 'text';
    inputDom.autofocus = true;
    inputDom.className = 'wb-canvas__input';
    var style = inputDom.style;
    style.position = 'absolute';
    style.display = 'none';
    style.padding = '0px';
    style.zIndex = '999';
    return inputDom;
}
/**
 * 不同用户的模式、笔大小、颜色都是不同的，在对displayCtx操作时先应用状态
 * @param {string} account 对应用户的ID
 * @param {number} size 笔大小
 * @param {string} color 颜色
 * @param {string} mode 模式
 * @private
 */
function applyState(targetCtx, shapeOrUser) {
    var ctx = shapeOrUser.ctx,
        size = shapeOrUser.size,
        color = shapeOrUser.color,
        tool = shapeOrUser.tool;
    // logger.log('applyState', ctx, size, color, tool);

    if (targetCtx === undefined) {
        console.warn('applyState上下文为空!');
        return;
    }
    targetCtx.lineWidth = size;
    targetCtx.strokeStyle = color;
    targetCtx.fillStyle = color;
    // 如果 erase 设置了 workCtx 为 destination-out 取到的img不能做正常 撤销 重做
    if (tool === 'erase' && targetCtx !== ctx) {
        var opreation = targetCtx.globalCompositeOperation;
        if (opreation !== 'destination-out') {
            targetCtx.globalCompositeOperation = 'destination-out'; // 在新图外显示已有图像。只有新图外的已有图像部分会被显示，新图像是透明的。
        }
    } else {
        targetCtx.globalCompositeOperation = 'source-over'; // 默认。在已有图上显示新图像。
    }
}

/***/ }),

/***/ "./src/core/DrawWorker/ShapesManger.ts":
/*!*********************************************!*\
  !*** ./src/core/DrawWorker/ShapesManger.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _UserManager = __webpack_require__(/*! ./UserManager */ "./src/core/DrawWorker/UserManager.ts");

var _CanvasHelper = __webpack_require__(/*! ./CanvasHelper */ "./src/core/DrawWorker/CanvasHelper.ts");

var CanvasHelper = _interopRequireWildcard(_CanvasHelper);

var _GlobalHub = __webpack_require__(/*! ../Model/GlobalHub */ "./src/core/Model/GlobalHub.ts");

var _GlobalHub2 = _interopRequireDefault(_GlobalHub);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ShapesManager = function (_EventEmitter) {
    (0, _inherits3.default)(ShapesManager, _EventEmitter);

    function ShapesManager() {
        (0, _classCallCheck3.default)(this, ShapesManager);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ShapesManager.__proto__ || (0, _getPrototypeOf2.default)(ShapesManager)).call(this));

        _this.onUndo = function (user) {
            var shape = user.recycle[user.recycle.length - 1];
            _this.remove(shape);
            _this.emit('undo', user);
        };
        _this.onRedo = function (user) {
            var shape = user.shapes[user.shapes.length - 1];
            _this.push(shape);
            _this.emit('redo', user);
        };
        _this.visibles = []; // 存放所有相关的
        _this.transh = [];
        return _this;
    }

    (0, _createClass3.default)(ShapesManager, [{
        key: "push",
        value: function push(shape) {
            this.visibles.push(shape);
            this.visibles.sort(function (a, b) {
                return a.id - b.id;
            });
            // 全局的shapes改变了
            _GlobalHub2.default.emit('globalShapes', this.visibles.length);
        }
    }, {
        key: "remove",
        value: function remove(shape) {
            var index = this.visibles.indexOf(shape);
            if (~index) {
                this.visibles.splice(index, 1);
                // 全局的shapes改变了
                _GlobalHub2.default.emit('globalShapes', this.visibles.length);
            }
        }
    }, {
        key: "wrap",
        value: function wrap(another) {
            if (another instanceof _UserManager.UserManager) {
                this.clearListener(); // 清除之前的数据
                this._usernameger = another;
                this._usernameger.on('undo', this.onUndo);
                this._usernameger.on('redo', this.onRedo);
            }
        }
    }, {
        key: "clear",
        value: function clear() {
            this.visibles.forEach(function (shape) {
                shape.destroy();
            });
            this.visibles.length = 0;
            _GlobalHub2.default.emit('globalShapes', this.visibles.length);
        }
    }, {
        key: "destroy",
        value: function destroy() {
            // TODO 清空一些数据
            this.clearListener();
        }
    }, {
        key: "clearListener",
        value: function clearListener() {
            if (this._usernameger) {
                this._usernameger.removeAllListeners();
                delete this._usernameger;
            }
        }
    }, {
        key: "resizeCanvas",
        value: function resizeCanvas(config) {
            var widthScale = config.widthScale,
                heightScale = config.heightScale;

            this.visibles.forEach(function (shape) {
                var _shape$ctx$canvas = shape.ctx.canvas,
                    width = _shape$ctx$canvas.width,
                    height = _shape$ctx$canvas.height;

                var newWidth = width * widthScale;
                var newHeight = height * heightScale;
                CanvasHelper.setCanvasPropSize(shape.ctx, {
                    height: newHeight, width: newWidth
                });
                // CanvasHelper.applyCanvasLayout(shape.ctx.canvas, config)
                // 这里的corner计算可能有问题。如果不按照相同的比例来缩放图形的话
                shape.corner[0].x *= widthScale;
                shape.corner[0].y *= heightScale;
                shape.corner[1].x *= widthScale;
                shape.corner[1].y *= heightScale;
            });
        }
    }]);
    return ShapesManager;
}(_eventemitter.EventEmitter);

exports.default = ShapesManager;

/***/ }),

/***/ "./src/core/DrawWorker/UserManager.ts":
/*!********************************************!*\
  !*** ./src/core/DrawWorker/UserManager.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.UserManager = undefined;

var _toConsumableArray2 = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "./node_modules/babel-runtime/helpers/toConsumableArray.js");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _map = __webpack_require__(/*! babel-runtime/core-js/map */ "./node_modules/babel-runtime/core-js/map.js");

var _map2 = _interopRequireDefault(_map);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _User = __webpack_require__(/*! ../Model/User */ "./src/core/Model/User.ts");

var _User2 = _interopRequireDefault(_User);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 所有用户的合集管理
 */
var UserManager = exports.UserManager = function (_EventEmitter) {
    (0, _inherits3.default)(UserManager, _EventEmitter);

    function UserManager(_ref) {
        var account = _ref.account,
            maxUserHistory = _ref.maxUserHistory;
        (0, _classCallCheck3.default)(this, UserManager);

        var _this = (0, _possibleConstructorReturn3.default)(this, (UserManager.__proto__ || (0, _getPrototypeOf2.default)(UserManager)).call(this));

        _this.userKeys = [];
        _this.userMap = new _map2.default();
        _this.onUndo = function (user) {
            _this.emit('undo', user);
        };
        _this.onRedo = function (user) {
            _this.emit('redo', user);
        };
        _this.account = account;
        _this.maxUserHistory = typeof maxUserHistory === 'number' ? maxUserHistory : 10;
        return _this;
    }

    (0, _createClass3.default)(UserManager, [{
        key: "getUser",
        value: function getUser(account) {
            return this.userMap.get(account);
        }
    }, {
        key: "addUser",
        value: function addUser(account) {
            if (this.userMap.has(account)) {
                return this.userMap.get(account);
            } else {
                var user = new _User2.default(account, this.maxUserHistory);
                // 创建监听
                user.on('undo', this.onUndo);
                user.on('redo', this.onRedo);
                this.userMap.set(account, user);
                return user;
            }
        }
    }, {
        key: "hasUser",
        value: function hasUser(account) {
            return this.userMap.has(account);
        }
    }, {
        key: "remove",
        value: function remove(account) {
            // 清除监听
            if (this.userMap.has(account)) {
                var user = this.userMap.get(account);
                user.removeAllListeners();
            }
            return this.userMap.delete(account);
        }
    }, {
        key: "removeOtherUsers",
        value: function removeOtherUsers() {
            var _this2 = this;

            this.others.forEach(function (user) {
                user.removeAllListeners();
                _this2.userMap.delete(user.account);
            });
        }
    }, {
        key: "destroy",
        value: function destroy() {
            // 清除监听
            this.all.forEach(function (user) {
                return user.removeAllListeners();
            });
            this.userMap.clear();
            // delete this.account
        }
    }, {
        key: "toSnapshot",
        value: function toSnapshot(opt) {
            return this.all.map(function (user) {
                return {
                    account: user.account,
                    recycle: user.recycle.map(function (shape) {
                        return shape.toSnapshot(opt);
                    }),
                    calibrate: user.getCalibrateAction().toString()
                };
            });
        }
    }, {
        key: "myself",
        get: function get() {
            return this.userMap.get(this.account);
        }
    }, {
        key: "others",
        get: function get() {
            var _this3 = this;

            var others = [];
            this.userMap.forEach(function (user, uid) {
                if (uid === _this3.account) {} else {
                    others.push(user);
                }
            });
            return others;
        }
    }, {
        key: "uids",
        get: function get() {
            return [].concat((0, _toConsumableArray3.default)(this.userMap.keys()));
        }
    }, {
        key: "all",
        get: function get() {
            return [].concat((0, _toConsumableArray3.default)(this.userMap.values()));
        }
    }]);
    return UserManager;
}(_eventemitter.EventEmitter);

/***/ }),

/***/ "./src/core/DrawWorker/index.ts":
/*!**************************************!*\
  !*** ./src/core/DrawWorker/index.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ "./node_modules/babel-runtime/core-js/object/keys.js");

var _keys2 = _interopRequireDefault(_keys);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

var _CanvasHelper = __webpack_require__(/*! ./CanvasHelper */ "./src/core/DrawWorker/CanvasHelper.ts");

var CanvasHelper = _interopRequireWildcard(_CanvasHelper);

var _Point = __webpack_require__(/*! ../Model/Point */ "./src/core/Model/Point.ts");

var _Point2 = _interopRequireDefault(_Point);

var _Shape = __webpack_require__(/*! ../Model/Shape */ "./src/core/Model/Shape.ts");

var _Shape2 = _interopRequireDefault(_Shape);

var _debug = __webpack_require__(/*! ../../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

var _UserManager = __webpack_require__(/*! ./UserManager */ "./src/core/DrawWorker/UserManager.ts");

var _ShapesManger = __webpack_require__(/*! ./ShapesManger */ "./src/core/DrawWorker/ShapesManger.ts");

var _ShapesManger2 = _interopRequireDefault(_ShapesManger);

var _ContainerManager = __webpack_require__(/*! ./ContainerManager */ "./src/core/DrawWorker/ContainerManager.ts");

var _ContainerManager2 = _interopRequireDefault(_ContainerManager);

var _Itypes = __webpack_require__(/*! ../Itypes */ "./src/core/Itypes.ts");

var _validator = __webpack_require__(/*! ../validator */ "./src/core/validator.ts");

var _Actions = __webpack_require__(/*! ../Actions */ "./src/core/Actions/index.ts");

var _ActionUtils = __webpack_require__(/*! ../ActionUtils */ "./src/core/ActionUtils.ts");

var _utils = __webpack_require__(/*! ../utils */ "./src/core/utils.ts");

var _GlobalHub = __webpack_require__(/*! ../Model/GlobalHub */ "./src/core/Model/GlobalHub.ts");

var _GlobalHub2 = _interopRequireDefault(_GlobalHub);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

// * @param { string } opt.account uid
//   * @param { number } opt.width
//   * @param { number } opt.height
//   * @param { string } opt.backgroundUrl 默认背景图
//   * @param { string } opt.color
//   * @param { string } opt.mode 绘图模式：激光笔flag 、 free
//   * @param { number } opt.zIndex
var LOADING_IMAGE = 'data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAAANACwAAAAAEAAQAAAEPbDJSau9OOvNew0AEHDA8wCkiW6g6AXHMU4LgizUYRgEZdsUggFAQCgUP+AERggcFYHaDaMgEBQchBNhiQAAIfkECQAADQAsAAAAABAAEAAABDuwyUmrvTYAEDAFzwN4EyiSksaRyHF06GEYBNoQ82EHBwHbCIUCYRMKiwSCYoFALDCIwLDZBFJtTKclAgAh+QQJAAANACwAAAAAEAAQAAAEPrDJGQAIM2vwHtAUcVTdBzaHYRCKip2EepxacBAvjSgKQmc83m+iILCGEkSgh5wsEIhFEwqdUpvPaHPLnUQAACH5BAkAAA0ALAAAAAAQABAAAAQ+sMkZyAkz62MM0ROiKAjRXQCATeOIHEQAPA+QKQShZHOdIQFSRqaSLBCIBQiERC41TcQzc0xOr9isdsvtPiMAIfkECQAADQAsAAAAABAAEAAABD2wyYmUQjNra/VcCLIoBKEExBFkYRtcBGAQbJsdhnFkoMimGI8wAACshBnA4wFAJpdNp4RolFqv2Kx2q4kAACH5BAkAAA0ALAAAAAAQABAAAAQ9sMm5EFoza2u1b5ylKMjXVFdAjGamrEo7IWMpz8QR3A0BGATewWA48BA5mykAAOxugMcDwItOeUwnb9uKAAAh+QQJAAANACwAAAAAEAAQAAAEO7DJSau92C6EVp4c90khMjZbd5KKYo4B0Z4KIZ9I4H7IQQSng8FwwAQAgJgBQMAAHo+kD3h5Rk/HpCUCACH5BAkAAA0ALAAAAAAQABAAAAQ8sMlJq7046827nwuCLJwoliYXjlIAAAGFKApCAc8DULQSTzgd4kCYEQgKigt2MBgOC5rtQnAeOAHilBIBADs=';

var DrawWorker = function (_EventEmitter) {
    (0, _inherits3.default)(DrawWorker, _EventEmitter);

    function DrawWorker(container, opt) {
        (0, _classCallCheck3.default)(this, DrawWorker);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DrawWorker.__proto__ || (0, _getPrototypeOf2.default)(DrawWorker)).call(this));

        _this.handleInputDomBlur = function () {
            console.log('blur');
            var inputDom = _this.container.inputDom;

            var account = _this.account;
            if (!_this.localUser) {
                return;
            }
            var pointStr = inputDom.getAttribute('data-point');
            if (!pointStr) return;
            var _this$container = _this.container,
                ownerCanvasHeight = _this$container.ownerCanvasHeight,
                ownerCanvasWidth = _this$container.ownerCanvasWidth;

            var prevEnd = _Point2.default.fromString(pointStr);
            inputDom.style.display = 'none';
            var text = (inputDom.value || '').trim();
            inputDom.value = '';
            if (ownerCanvasHeight && ownerCanvasWidth && text) {
                var action = new _Actions.TextAction(prevEnd.x, prevEnd.y, text);
                _this.renderText(action, account);
                _this.emitAction({ account: account, action: action });
            }
        };
        /**
         * 对事件数据进行预处理，再调用对应的处理函数
         * @param {Event} e 鼠标或触摸屏事件
         * @private
         */
        _this.dispatcher = function (e) {
            if (e.type !== 'keydown' && e.type !== 'keyup') {
                e.preventDefault();
            }
            e = e.originalEvent ? e.originalEvent : e;
            if (!_this.container.displayCtx) return;
            var rect = _this.container.displayCtx.canvas.getBoundingClientRect();
            var x = void 0,
                y = void 0;
            if (e.touches && e.touches.length === 1) {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else if (e.changedTouches && e.changedTouches.length === 1) {
                x = e.changedTouches[0].clientX;
                y = e.changedTouches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }
            var _e = e,
                ctrlKey = _e.ctrlKey,
                shiftKey = _e.shiftKey,
                altKey = _e.altKey,
                which = _e.which;

            if (!x && x !== 0) x = 0;
            if (!y && y !== 0) y = 0;
            var realX = Math.round(x - rect.left);
            var realY = Math.round(y - rect.top);
            var _this$container2 = _this.container,
                ownerCanvasHeight = _this$container2.ownerCanvasHeight,
                ownerCanvasWidth = _this$container2.ownerCanvasWidth,
                canvasWidth = _this$container2.canvasWidth,
                canvasHeight = _this$container2.canvasHeight;

            if (!ownerCanvasHeight || !ownerCanvasWidth || !canvasWidth || !canvasHeight) {
                return;
            }
            // 点坐标转换为相对位置
            var offset = new _Point2.default(+(realX / canvasWidth).toFixed(4), +(realY / canvasHeight).toFixed(4));
            var type = e.type;
            if (type === 'touchstart') type = 'mousedown';
            if (type === 'touchmove') type = 'mousemove';
            if (type === 'touchend') type = 'mouseup';
            // debug(type)
            if (which === 2 || which === 3) {
                // 如果是右键或者中键，就不触发对应的
                return;
            }
            // console.log(e.buttons);
            _this[type](offset, _this.account, { ctrlKey: ctrlKey, shiftKey: shiftKey, altKey: altKey, which: which });
        };
        if (typeof opt === 'undefined') {
            throw new Error('Option is Undefined!');
        }
        _this.state = 'created';
        _this.opt = opt;
        _this.account = opt.account || 0; // 本地用户的UID
        // 组装层级关系
        _this.users = new _UserManager.UserManager(opt);
        _this.shapes = new _ShapesManger2.default(); // 所有用户绘制内容的列表
        _this.shapes.wrap(_this.users);
        _this.container = new _ContainerManager2.default(container, opt);
        _this.container.on('init-canvas', function () {
            // 创建cancas之后才创建用户，因为需要用到canvas的宽高
            _debug2.default.m.worker('init-canvas event');
            var user = _this.addUser(_this.account);
            _this.localUser = user; // 缓存一下自己
            _this.state = 'inited';
            _this.afterInit();
        });
        _this.container.on('ownerCanavasUpdate', function () {
            var timmer = void 0;
            return function (width, height) {
                console.log('ownerCanavasUpdate timmer');
                clearTimeout(timmer);
                timmer = setTimeout(function () {
                    console.log('ownerCanavasUpdate timmer');
                    _this.emit('instantAction', {
                        account: _this.account,
                        action: new _Actions.CalibrateAction({
                            ownerCanvasHeight: height,
                            ownerCanvasWidth: width
                        })
                    });
                }, 200);
            };
        }());
        _this.container.wrap(_this.shapes, _this.users);
        _this.container.inputDom.addEventListener('blur', _this.handleInputDomBlur);
        _this.isEnable = false; // 默认情况下都不可以写
        return _this;
    }

    (0, _createClass3.default)(DrawWorker, [{
        key: 'setContainer',
        value: function setContainer(container, opt) {
            _debug2.default.m.worker('setContainer');
            this.container.setContainer(container, opt);
        }
    }, {
        key: 'isDrawEnable',
        value: function isDrawEnable() {
            return this.isEnable;
        }
        // 是否有权限进行画布操作

    }, {
        key: 'enableDraw',
        value: function enableDraw(enable) {
            _debug2.default.m.worker('enableDraw', enable);
            this.isEnable = !!enable;
            _GlobalHub2.default.emit('canDraw', this.isEnable);
            this.switchEventListener(!!enable);
            // 切换为观众后，如果当前在激光笔，先保存当前状态
            if (this.localUser) {
                var tool = this.localUser.tool;

                if (!enable) {
                    if (/flag/.test(this.localUser.tool)) {
                        this.clearFlag();
                        this.emitAction({ account: this.account, action: new _Actions.LaserPenEndAction() });
                    }
                    this.setCursor('not-allowed');
                } else {
                    var cursorType = void 0;
                    if (tool === 'flag') {
                        cursorType = 'flag';
                    } else {
                        cursorType = 'crosshair';
                    }
                    this.setCursor(cursorType);
                }
            }
        }
    }, {
        key: 'updateCursor',
        value: function updateCursor() {
            if (this.localUser) {
                var tool = this.localUser.tool;

                if (!this.isEnable) {
                    if (/flag/.test(this.localUser.tool)) {
                        this.clearFlag();
                        this.emitAction({ account: this.account, action: new _Actions.LaserPenEndAction() });
                    }
                    this.setCursor('not-allowed');
                } else {
                    var cursorType = void 0;
                    if (tool === 'flag') {
                        cursorType = 'flag';
                    } else {
                        cursorType = 'crosshair';
                    }
                    this.setCursor(cursorType);
                }
            }
        }
        /**
         * 增加或移除事件监听
         * @param {Boolean} add 是否增加事件监听
         * @private
         */

    }, {
        key: 'switchEventListener',
        value: function switchEventListener(add) {
            var _this2 = this;

            var op = add ? 'add' : 'remove';
            var canvasList = [this.container.maskCanvas];
            // const currentUserCanvas = this.users.myself.ctx.canvas
            // if (currentUserCanvas) {
            //   currentUserCanvas.style.visibility = add ? 'visible' : 'hidden'
            //   canvasList.push(currentUserCanvas)
            // }
            var dispatcher = this.dispatcher;
            // 绑定到canvas上的事件
            canvasList.forEach(function (canvas) {
                ['mouseleave', 'mousedown', 'mousemove', 'touchmove', 'touchstart'].forEach(function (event) {
                    var addOrRemove = op + 'EventListener';
                    canvas[addOrRemove](event, dispatcher);
                });
            });
            // 绑定在body上的事件
            ['mouseup', 'touchend'].forEach(function (event) {
                var addOrRemove = op + 'EventListener';
                _this2.container.container[addOrRemove](event, dispatcher);
            });
            ['keydown', 'keyup'].forEach(function (event) {
                var addOrRemove = op + 'EventListener';
                document.documentElement[addOrRemove](event, dispatcher);
            });
        }
        // 设置光标样式

    }, {
        key: 'setCursor',
        value: function setCursor() {
            var _this3 = this;

            var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'not-allowed';

            _debug2.default.m.worker('setCursor', type);
            var canvasList = [this.container.maskCanvas];
            type = /(flag|crosshair|not-allowed)/.test(type) ? type : 'crosshair';
            this.cursor = type || this.cursor;
            if (this.cursor === 'flag') {
                this.cursor = 'none';
            }
            canvasList.forEach(function (c) {
                c.style.cursor = _this3.cursor;
            });
        }
    }, {
        key: 'afterInit',
        value: function afterInit() {
            this.emit('inited');
        }
    }, {
        key: 'emitAction',
        value: function emitAction(anyAction) {
            this.emit('action', anyAction);
        }
        /**
         * 获取或者设置操作模式。Worker的模式设置必须是标准的，对外暴露可以使用转换
         * @param {string} tool 'flag', 'free', 'erase', 'fill', 'select'
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'useTool',
        value: function useTool(tool) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;

            _debug2.default.m.worker('use tool:', tool, account);
            if (this.state == 'created') {
                console.warn('未初始化容器，请在inited事件后调整当前模式');
                return;
            }
            var validTool = (0, _validator.isValidTool)(tool);
            if (!validTool) {
                console.error('useTool 参数不正确！', tool);
                return;
            }
            var user = this.getUser(account);
            if (!tool) return user.tool;
            if (!user) {
                user = this.addUser(account);
            }
            _debug2.default.m.worker('use tool:', user);
            // 如果要设置的模式就是当前模式，直接返回
            if (user.tool === tool) return;
            var updator = { tool: tool };
            user.update(updator);
            if (tool === 'flag') {
                user.ctx.canvas.style.visibility = 'visible';
            } else {
                this.clearFlag(account);
            }
            _debug2.default.m.worker('useTool check account', account);
            if (account !== this.account) {
                return;
            }
            // // 当前是观众模式
            // if (!this.isEnable) {
            //   return
            // }
            if (user.tool !== 'text') {
                // 修改为非 text 模式隐藏输入框
                this.container.inputDom.style.display = 'none';
            }
            this.setCursor(user.tool);
            _debug2.default.m.worker('useTool check account', account);
            this.dispatchCalibrateAction(updator);
        }
    }, {
        key: 'clearFlag',
        value: function clearFlag() {
            var account = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.account;

            var user = this.getUser(account);
            if (!user) return;
            user.flagPos = new _Point2.default(3, 3).toString();
            this.renderFlag();
            this.emitAction({
                account: account,
                action: new _Actions.LaserPenEndAction()
            });
        }
        /**
         * 获取或者设置笔&橡皮擦的大小
         * @param {number} value 笔&橡皮擦的大小
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'setSize',
        value: function setSize(value) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;

            var user = this.getUser(account);
            _debug2.default.m.worker('setSize', value, account, user);
            if (this.state == 'created') {
                console.warn('未初始化容器，请在inited事件后调整当前模式');
                return;
            }
            if (!user) {
                user = this.addUser(account);
            }
            if (!value) return user.size;
            if (typeof +value !== 'number') {
                throw new Error('Type Error: size');
            }
            var updator = { size: +value };
            user.update(updator);
            this.dispatchCalibrateAction(updator);
        }
        // 获取自己的按钮坐标等等的参数

    }, {
        key: 'getSelfCalibrate',
        value: function getSelfCalibrate() {
            if (this.localUser) {
                return this.localUser.getCalibrateAction();
            } else {
                return null;
            }
        }
        /**
         * 获取或者设置笔的颜色
         * @param {number} value 笔的颜色
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'setColor',
        value: function setColor(value) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;

            var user = this.getUser(account);
            if (this.state == 'created') {
                console.warn('未初始化容器，请在inited事件后调整当前模式');
                return;
            }
            if (!user) {
                user = this.addUser(account);
            }
            if (!value) return user.color;
            var updator = { color: value.toLowerCase() };
            this.dispatchCalibrateAction(updator);
            user.update(updator);
        }
        /**
         * 获取或者设置文字的大小
         * @param {number} value 字体大小
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'setFontsize',
        value: function setFontsize(value) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;

            var user = this.getUser(account);
            _debug2.default.m.worker('set font size', value, account, user);
            if (this.state == 'created') {
                console.warn('未初始化容器，请在inited事件后调整当前模式');
                return;
            }
            if (!user) {
                user = this.addUser(account);
            }
            if (!value) return user.fontsize;
            if (typeof +value !== 'number') {
                throw new Error('Type Error: fontsize');
            }
            var updator = { fontsize: +value };
            user.update(updator);
            this.dispatchCalibrateAction(updator);
            // this.container.inputDom.style.height = value + 'px'
            this.container.inputDom.style.fontSize = value + 'px';
        }
    }, {
        key: 'keydown',
        value: function keydown(point, account, ext) {
            var user = this.users.getUser(account);
            if (!user) {
                user = this.addUser(account);
            }
            var ctrlKey = ext.ctrlKey,
                shiftKey = ext.shiftKey,
                altKey = ext.altKey,
                which = ext.which;
            // 当前只响应 ctrl shift alt 这三个键的响应
            // 17-ctrl  16-shif 18-alt

            if ([16, 17, 18].indexOf(which) > -1) {
                var userKeyDown = user.keyDown;
                var newWhich = userKeyDown === null ? -1 : userKeyDown.which;
                // 如果后期需要对其他更多按键进行处理的话，就在这里处理
                // 没有其他按键的情况下， whichkey 传输-1过去
                var updator = {
                    keyDown: {
                        ctrlKey: ctrlKey, altKey: altKey, shiftKey: shiftKey,
                        which: newWhich
                    }
                };
                user.update(updator);
                this.dispatchCalibrateAction(updator);
                this._afterKeyChange(user, account, ext);
            }
        }
    }, {
        key: 'keyup',
        value: function keyup(point, account, ext) {
            var ctrlKey = ext.ctrlKey,
                shiftKey = ext.shiftKey,
                altKey = ext.altKey,
                which = ext.which;

            var user = this.users.getUser(account);
            if (!user) {
                user = this.addUser(account);
            }
            // 当前只响应 ctrl shift alt 这三个键的响应
            // 17-ctrl  16-shif 18-alt
            if ([16, 17, 18].indexOf(which) > -1) {
                var userKeyDown = user.keyDown;
                var newWhich = userKeyDown === null ? -1 : userKeyDown.which;
                if (which === newWhich) {
                    newWhich = -1;
                }
                var updator = {
                    keyDown: {
                        altKey: altKey, shiftKey: shiftKey, ctrlKey: ctrlKey,
                        which: which
                    }
                };
                user.update(updator);
                this.dispatchCalibrateAction(updator);
                this._afterKeyChange(user, account, ext);
            }
        }
    }, {
        key: '_afterKeyChange',
        value: function _afterKeyChange(user, account, ext) {
            if (user.isMouseDown) {
                if (user.tool !== 'flag' && user.tool !== 'free' && user.tool !== 'erase') {
                    this.mousemove(user.end, account, ext); // TODO,这里的which 应该替换
                }
            }
        }
        /**
         * 鼠标按下&开始触摸时的处理函数
         * @param {Point} offset 当前位置坐标
         * @param {string} account 进行操作的用户的ID
         */

    }, {
        key: 'mousedown',
        value: function mousedown(offset) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;
            var ext = arguments[2];

            var shape = void 0;
            var user = this.getUser(account);
            var mode = user.mode,
                tool = user.tool,
                color = user.color,
                size = user.size,
                fontsize = user.fontsize,
                keyDown = user.keyDown;

            var userCtx = user.ctx;
            var displayCtx = this.container.displayCtx;
            // 如果是激光笔工具或者文本工具，就返回
            if (user.isFlag && (!tool || tool === 'flag') || tool === 'text') {
                return;
            }
            if (tool === 'erase' && this.shapes.visibles.length === 0) {
                // 如果画板没有内容，不能使用橡皮擦工具
                return;
            }
            user.whenMouseDown(_Point2.default.clone(offset));
            var end = user.end;
            if (user.isMouseDown) {
                // '兼容iOS未抬笔直接落笔的情况'
                _debug2.default.mouse('user.isMouseDown->true');
                this.mouseup(end, account);
            }
            if (tool === 'free' || tool === 'erase') {
                // 1. free 会 直接在 displayCtx 上绘制；2. 当 erase 时 workCtx 要保证 source-over；3. 所以隐藏
                userCtx.canvas.style.visibility = 'hidden';
                userCtx.beginPath();
            } else {
                userCtx.canvas.style.visibility = 'visible';
            }
            _debug2.default.m.worker('switch mode = ', mode, tool);
            // 缓存上一次applyState的用户
            this.lastStateAccount = user.account;
            (0, _ContainerManager.applyState)(userCtx, user);
            (0, _ContainerManager.applyState)(displayCtx, user);
            var _container = this.container,
                height = _container.ownerCanvasHeight,
                width = _container.ownerCanvasWidth;

            var action = void 0;
            if (height && width) {
                action = new _Actions.StartAction(offset.x, offset.y);
            }
            switch (mode) {
                case 'draw':
                    {
                        user.isMouseDown = true;
                        _debug2.default.log('user is mouseDown', user.isMouseDown, user);
                        shape = new _Shape2.default({
                            user: user, mode: mode, tool: tool, size: size, color: color, fontsize: fontsize,
                            start: _Point2.default.clone(offset),
                            actions: action,
                            keyDown: user.keyDown
                        });
                        user.pushShape(shape);
                        this.shapes.push(shape);
                        switch (tool) {
                            case 'circle':
                            case 'ellipse':
                            case 'line':
                            case 'rect':
                            case 'roundRect':
                            case 'solidCircle':
                            case 'solidEllipse':
                            case 'solidRoundRect':
                            case 'solidRect':
                            case 'erase':
                            case 'free':
                            case 'flag':
                                // 'free' 用三个点画二次曲线，使笔迹光滑，降低锯齿感
                                break;
                            case 'fill':
                                {
                                    // shape = new Shape({
                                    //   user, mode, tool, size, color,
                                    //   start: Point.clone(offset)
                                    // })
                                    // user.pushShape(shape)
                                    // this.shapes.push(shape)
                                    this.lastStateAccount = user.account;
                                    (0, _ContainerManager.applyState)(shape.ctx, user);
                                    (0, _ContainerManager.applyState)(displayCtx, user);
                                    shape.draw(displayCtx);
                                    user.isMouseDown = false; // 保证isMouseDown的标记位是正常的
                                    break;
                                }
                            default:
                                var fullCaseChecker = tool;
                        }
                        break;
                    }
            }
            _debug2.default.m.worker('emit on mousedown');
            if (width && height) {
                this.emitAction({ account: account, action: action });
            }
        }
        /**
         * 鼠标移动&触摸移动时的处理函数
         * @param {Point} offset 当前位置坐标
         * @param {string} account 进行操作的用户的ID
         */

    }, {
        key: 'mousemove',
        value: function mousemove(offset) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;
            var ext = arguments[2];

            var user = this.getUser(account);
            _debug2.default.mouse('mousemove', user, !user.isMouseDown && !user.isFlag);
            if (!user.isFlag) {
                // 如果不是flag模式，
                if (!user.isMouseDown) {
                    console.log('pre return when mouse down is false');
                    return;
                }
            }
            user.whenMouseMove(_Point2.default.clone(offset));
            var mode = user.mode,
                tool = user.tool,
                keyDown = user.keyDown,
                end = user.end;

            if (tool === 'erase' && this.shapes.visibles.length === 0) {
                // 如果画板没有内容，不能使用橡皮擦工具
                return;
            }
            var userCtx = user.ctx;
            var displayCtx = this.container.displayCtx;
            _debug2.default.mouse('mousemove', offset, user);
            var activeShape = user.activeShape;
            var action = new _Actions.MoveAction(offset.x, offset.y);
            // 如果按键不一致，就更新
            if (ext && (0, _keys2.default)(keyDown).some(function (key) {
                return ext[key] !== keyDown[key];
            })) {
                user.update({ keyDown: ext });
            }
            if (tool !== 'flag') {
                this.shiftKeyTool(user, activeShape, function (toolName) {
                    tool = toolName;
                });
            }
            // 检查上一次的使用的状态的用户，如果帐号相同，为了性能，就不重新作用applyState
            if (user.account !== this.lastStateAccount) {
                if (tool !== 'flag') {
                    this.lastStateAccount = user.account;
                    (0, _ContainerManager.applyState)(userCtx, user);
                    (0, _ContainerManager.applyState)(displayCtx, user);
                }
            }
            switch (mode) {
                case 'draw':
                    {
                        switch (tool) {
                            case 'flag':
                                {
                                    // 光标模式
                                    user.flagPos = _Point2.default.clone(offset).toString();
                                    this.renderFlag();
                                    // renderFlag(user, offset, size, color)
                                    break;
                                }
                            case 'erase':
                            case 'free':
                                if (activeShape) {
                                    activeShape.updateCorner(end);
                                    activeShape.actions.push(action);
                                    activeShape.freeMove(userCtx);
                                    activeShape.freeMove(displayCtx);
                                }
                                break;
                            case 'line':
                                CanvasHelper.clearCtx(userCtx);
                                activeShape.updateCorner(end);
                                activeShape.draw(userCtx);
                                break;
                            case 'rect':
                            case 'solidRect':
                                {
                                    if (activeShape) {
                                        CanvasHelper.clearCtx(userCtx);
                                        activeShape.updateCorner(end);
                                        activeShape.draw(userCtx);
                                    }
                                    break;
                                }
                            case 'roundRect':
                            case 'solidRoundRect':
                                {
                                    CanvasHelper.clearCtx(userCtx);
                                    if (activeShape) {
                                        activeShape.updateCorner(end);
                                        activeShape.draw(userCtx);
                                    }
                                    break;
                                }
                            case 'circle':
                            case 'solidCircle':
                                {
                                    CanvasHelper.clearCtx(userCtx);
                                    if (activeShape) {
                                        activeShape.updateCorner(end);
                                        activeShape.draw(userCtx);
                                    }
                                    break;
                                }
                            case 'ellipse':
                            case 'solidEllipse':
                                {
                                    CanvasHelper.clearCtx(userCtx);
                                    if (activeShape) {
                                        activeShape.updateCorner(end);
                                        activeShape.draw(userCtx);
                                    }
                                    break;
                                }
                            case 'fill':
                            case 'text':
                                // 什么也不做，
                                action = null;
                                break;
                            default:
                                var fullCaseChecker = tool;
                        }
                        break;
                    }
            }
            if (action) {
                this.emitAction({ account: account, action: action });
            }
        }
    }, {
        key: 'shiftKeyTool',
        value: function shiftKeyTool(user, activeShape, callback) {
            if (user.keyDown.shiftKey) {
                var tool = user.tool;
                // 取消shift 需要变更工具后还原
                if (tool === 'ellipse') {
                    tool = 'circle';
                    if (activeShape) {
                        activeShape.tool = tool;
                    }
                    callback(tool);
                } else if (tool === 'circle') {
                    tool = 'ellipse';
                    if (activeShape) {
                        activeShape.tool = tool;
                    }
                    callback(tool);
                }
            } else {
                // 取消shift key后还原
                if (activeShape && activeShape.tool !== user.tool) {
                    activeShape.tool = user.tool;
                }
            }
        }
        /**
         * 鼠标松开&触摸结束时的处理函数
         * @param {Point} offset 当前位置坐标
         * @param {string} account 进行操作的用户的ID
         * @private
         */

    }, {
        key: 'mouseup',
        value: function mouseup(offset) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;
            var ext = arguments[2];

            var user = this.getUser(account);
            var textActionText = offset.text;
            console.warn('mouse up');
            _debug2.default.m.worker('mouse up', account);
            var mode = user.mode,
                tool = user.tool,
                color = user.color,
                size = user.size,
                fontsize = user.fontsize,
                start = user.start,
                oldMid = user.oldMid,
                end = user.end;

            if (tool === 'erase' && this.shapes.visibles.length === 0) {
                // 如果画板没有内容，不能使用橡皮擦工具
                return;
            }
            var mid = _Point2.default.middle(end, offset);
            // free 模式需要知道上一次的情况
            var prevOldMid = oldMid.clone();
            var prevEnd = end.clone();
            // 作用到user对象上
            oldMid.copy(mid);
            end.copy(offset);
            user.oldMid = oldMid.clone();
            user.end = end.clone();
            if (user.isFlag) {
                // 激光笔直接返回
                this.clearFlag();
                this.emitAction({
                    account: account,
                    action: new _Actions.LaserPenEndAction()
                });
                ;
                return;
            }
            if (!user.isMouseDown && tool !== 'text') return;
            user.isMouseDown = false;
            console.warn('turn use mouse down to false', user.isMouseDown, user.account);
            var userCtx = user.ctx;
            var displayCtx = this.container.displayCtx;
            var activeShape = user.activeShape;
            var shapeCtx = activeShape && activeShape.ctx;
            if (tool === 'text') {
                // 如果是 text 工具， 这里需要做输入框的展示以及输入框的消失的操作
                // applyState 不在这里作用，在renderText方法里作用，
                // 这样接收端也能更新shape状态
                var endCoord = this.getCanvasCoord(end);
                var _container2 = this.container,
                    width = _container2.canvasWidth,
                    height = _container2.canvasHeight,
                    inputDom = _container2.inputDom;
                var style = inputDom.style;
                var display = style.display;

                if (endCoord.x < 0 || endCoord.x > width || endCoord.y < 0 || endCoord.y > height) {
                    return;
                }
                if (display === 'none') {
                    // 如果是隐藏的就展示对应的DOM
                    var iptWidth = width - endCoord.x - 10;
                    var iptHeight = height - endCoord.y - 10;
                    if (fontsize * 10 > iptWidth) {
                        style.width = (iptWidth > 0 ? iptWidth : 0) + 'px';
                    } else {
                        style.width = iptWidth + 'px';
                    }
                    // style.height = fontsize + 'px'
                    style.padding = "1px 0";
                    style.verticalAlign = "top"; // fix ios safari input font height
                    style.lineHeight = fontsize + 'px';
                    style.top = endCoord.y + this.container.paddingTop + 'px';
                    style.left = endCoord.x + this.container.paddingLeft + 'px';
                    style.fontSize = fontsize + 'px';
                    style.display = 'block';
                    style.color = color;
                    inputDom.setAttribute('data-point', end.toString());
                    inputDom.focus();
                    user.end.copy(end);
                } else {
                    // 如果是展示状态下，就消失并且抛出TextAction
                    inputDom.blur();
                }
                return;
            }
            if (!activeShape || !shapeCtx) {
                return;
            }
            var needMoveUserCtxData = true;
            userCtx.canvas.style.visibility = 'visible';
            activeShape.updateCorner(end);
            var action = new _Actions.EndAction(end.x, end.y);
            if (tool !== 'flag') {
                this.shiftKeyTool(user, activeShape, function (toolName) {
                    tool = toolName;
                });
                // 如果有两个用户在画画，必须要更新Canvas状态
                this.lastStateAccount = user.account;
                (0, _ContainerManager.applyState)(userCtx, user);
                (0, _ContainerManager.applyState)(displayCtx, user);
            }
            switch (mode) {
                case 'draw':
                    // 如果 erase 设置了 workCtx 为 destination-out 取到的img不能做正常 撤销 重做
                    switch (tool) {
                        case 'erase':
                        case 'free':
                            // 自由画笔需要拓展边界
                            activeShape.expandCorner();
                            activeShape.freeEnd(userCtx);
                            activeShape.freeEnd(displayCtx);
                            break;
                        case 'line':
                            CanvasHelper.clearCtx(userCtx);
                            activeShape.draw(userCtx);
                            break;
                        case 'rect':
                        case 'solidRect':
                            {
                                CanvasHelper.clearCtx(userCtx);
                                activeShape.draw(userCtx);
                                break;
                            }
                        case 'roundRect':
                        case 'solidRoundRect':
                            {
                                CanvasHelper.clearCtx(userCtx);
                                activeShape.draw(userCtx);
                                break;
                            }
                        case 'circle':
                        case 'solidCircle':
                            {
                                CanvasHelper.clearCtx(userCtx);
                                activeShape.draw(userCtx);
                                break;
                            }
                        case 'ellipse':
                        case 'solidEllipse':
                            {
                                CanvasHelper.clearCtx(userCtx);
                                activeShape.draw(userCtx);
                            }
                            break;
                        case 'flag':
                        case 'fill':
                            // 不放置数据到shape里
                            action = null;
                            needMoveUserCtxData = false;
                            break;
                        default:
                            var fullCaseChecker = tool;
                    }
                    if (needMoveUserCtxData) {
                        this.moveUserShapeToDisplay(user);
                    }
                    break;
            }
            activeShape.keyDown = user.keyDown;
            if (action) {
                activeShape.actions.push(action);
                this.emitAction({ account: account, action: action });
            }
        }
    }, {
        key: 'mouseleave',
        value: function mouseleave(point) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;
            var ext = arguments[2];

            console.log('mouse leave');
            if (account === this.account) {
                var user = this.getUser(account);
                switch (user.tool) {
                    case 'flag':
                        {
                            this.clearFlag(account);
                            this.emitAction({
                                account: account,
                                action: new _Actions.LaserPenEndAction()
                            });
                            break;
                        }
                    case 'text':
                        break;
                    default:
                        this.mouseup(point, account, ext);
                }
            }
        }
    }, {
        key: 'renderText',
        value: function renderText(offset, account) {
            var inputDomValue = void 0;
            var action = void 0;
            action = offset;
            var end = new _Point2.default(offset.x, offset.y);
            var endCoord = this.getOwnerCoord(end);
            inputDomValue = (offset.text || '').trim();
            if (!inputDomValue || !account) {
                return;
            }
            var user = this.getUser(account);
            if (!user) {
                user = this.addUser(account);
            }
            var _user = user,
                tool = _user.tool,
                mode = _user.mode,
                size = _user.size,
                color = _user.color,
                fontsize = _user.fontsize;

            var displayCtx = this.container.displayCtx;
            var shape = new _Shape2.default({
                user: user, mode: mode, tool: tool, size: size, color: color, fontsize: fontsize,
                start: _Point2.default.clone(end),
                actions: action,
                keyDown: user.keyDown
            });
            this.shapes.push(shape);
            user.pushShape(shape);
            // 这个fontSize是设置的字体测试的用户的大小，具体到画布上以后，字体大小会发生变化
            var userCtx = user.ctx;
            this.lastStateAccount = user.account;
            (0, _ContainerManager.applyState)(userCtx, user);
            (0, _ContainerManager.applyState)(displayCtx, user);
            CanvasHelper.text(userCtx, endCoord, inputDomValue, fontsize, true, color);
            var corner = user.activeShape.corner;
            corner[0].x = endCoord.x - size;
            corner[0].y = endCoord.y - 20;
            corner[1].x = endCoord.x + fontsize * inputDomValue.length;
            corner[1].y = endCoord.y + fontsize + 20;
            this.moveUserShapeToDisplay(user);
        }
    }, {
        key: 'clearTransparentPix',
        value: function clearTransparentPix(imgData) {
            var total = imgData.length;
            var dataBytes = imgData;
            for (var i = 0; i < total; i += 4) {
                var alpha = dataBytes[3 + i];
                if (alpha < 243) {
                    dataBytes[0 + i] = 0;
                    dataBytes[1 + i] = 0;
                    dataBytes[2 + i] = 0;
                    dataBytes[3 + i] = 0;
                }
            }
        }
    }, {
        key: 'moveUserShapeToDisplay',
        value: function moveUserShapeToDisplay(user, antiAlais) {
            var activeShape = user.activeShape,
                userCtx = user.ctx;
            var displayCtx = this.container.displayCtx;

            if (!activeShape || !displayCtx) {
                console.error('activeShape is ', activeShape, 'displayCtx is ', displayCtx);
                return;
            }
            var tool = activeShape.tool,
                shapeCtx = activeShape.ctx,
                color = activeShape.color,
                corner = activeShape.corner;

            _debug2.default.log('corner', corner);
            var shapeWidth = Math.ceil(corner[1].x - corner[0].x);
            var shapeHeight = Math.ceil(corner[1].y - corner[0].y);
            if (shapeWidth === 0 || shapeHeight === 0) {
                _debug2.default.m.worker('mouseup shape is zero size');
                console.error('mouseup shape is zero size');
                return;
            }
            _debug2.default.m.worker('mouseup going to anti shape', user.account);
            // 需要获取看得见的数据，才能使其他 canvas 上 globalCompositeOperation 有效应用
            var imgData = userCtx.getImageData(corner[0].x, corner[0].y, shapeWidth, shapeHeight);
            if (tool === 'erase') {
                _debug2.default.image(userCtx.canvas.toDataURL(), 'erase');
            }
            // 过滤锯齿
            if (this.opt.clearTransparentPix && (!['text'].includes(tool) || antiAlais)) {
                this.clearTransparentPix(imgData.data);
            }
            shapeCtx.canvas.width = shapeWidth;
            shapeCtx.canvas.height = shapeHeight;
            // 每次重新改变canvas大小 ，都要重新设置这个属性
            CanvasHelper.setpixelated(shapeCtx);
            CanvasHelper.setLineStyle(shapeCtx);
            shapeCtx.putImageData(imgData, 0, 0); // 这里 workCtx 的数据截取了有效部分，存到了 shape ，可以做 undo redo
            displayCtx.imageSmoothingEnabled = false;
            if (tool !== 'free') {
                displayCtx.drawImage(shapeCtx.canvas, Math.round(corner[0].x), Math.round(corner[0].y)); // displayCtx 一直在实时绘制
            }
            CanvasHelper.clearCtx(userCtx);
        }
        /**
         * 渲染激光笔，绘制单个，没有任何轨迹
         * @param {Object} user 激光笔的用户
         * @param {Point} center 激光笔经过的点圆心
         * @param {Number} size 激光笔直径
         * @param {String} color 激光笔颜色
         * @private
         */

    }, {
        key: 'renderFlag',
        value: function renderFlag() {
            var _this4 = this;

            var maskCtx = this.container.maskCtx;

            if (maskCtx) {
                // 清空图层
                CanvasHelper.clearCtx(maskCtx);
                var _container3 = this.container,
                    width = _container3.ownerCanvasWidth,
                    height = _container3.ownerCanvasHeight;
                // 将每个用户的激光笔绘制上去

                this.users.all.forEach(function (user) {
                    var mode = user.mode,
                        tool = user.tool,
                        color = user.color,
                        flagPos = user.flagPos;

                    if (mode == 'draw' && tool === 'flag' && width && height) {
                        var pos = _Point2.default.fromString(flagPos);
                        var posCoord = _this4.getOwnerCoord(pos);
                        console.log('render flag', pos, flagPos, user.account);
                        CanvasHelper.circle(maskCtx, posCoord, 5, false, '#ff0000');
                        CanvasHelper.circle(maskCtx, posCoord, 4, true, '#ff0000'); //默认的激光笔颜色为红色
                    }
                });
            }
        }
    }, {
        key: 'getCanvasCoord',
        value: function getCanvasCoord(offset) {
            var _container4 = this.container,
                height = _container4.canvasHeight,
                width = _container4.canvasWidth;

            if (height && width) {
                return new _Point.Coord(offset.x * width, offset.y * height);
            }
            return new _Point.Coord(0, 0);
        }
    }, {
        key: 'getOwnerCoord',
        value: function getOwnerCoord(offset) {
            var _container5 = this.container,
                height = _container5.ownerCanvasHeight,
                width = _container5.ownerCanvasWidth;

            if (height && width) {
                return new _Point.Coord(offset.x * width, offset.y * height);
            }
            return new _Point.Coord(0, 0);
        }
        /**
         * 撤销绘制，本地撤销模型，即只能撤销自己的绘制
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'undo',
        value: function undo() {
            var account = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.account;

            var user = this.getUser(account);
            if (!user) return;
            if (user.shapes.length === 0) return;
            var length = user.undo(); // 其他操作通过事件冒泡到ContainerManager去处理了
            this.emitAction({ account: account, action: new _Actions.RevokeAction() });
            return length;
        }
        /**
         * 反撤销绘制，取消本地撤销模型，即只能取消撤销自己的绘制
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'redo',
        value: function redo() {
            var account = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.account;

            var user = this.getUser(account);
            if (!user) return;
            if (user.recycle.length === 0) return;
            var length = user.redo();
            this.emitAction({ account: account, action: new _Actions.RedoAction() });
            return length;
        }
        /**
         * 绘制图片
         * @param {string} url 图片地址
         * @private
         */

    }, {
        key: 'image',
        value: function image(opt) {
            var _this5 = this;

            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;
            var _opt$url = opt.url,
                url = _opt$url === undefined ? '' : _opt$url,
                _opt$docId = opt.docId,
                docId = _opt$docId === undefined ? '' : _opt$docId,
                _opt$currentPage = opt.currentPage,
                currentPage = _opt$currentPage === undefined ? 0 : _opt$currentPage,
                _opt$pageCount = opt.pageCount,
                pageCount = _opt$pageCount === undefined ? 0 : _opt$pageCount,
                _opt$type = opt.type,
                type = _opt$type === undefined ? 'clear' : _opt$type,
                _opt$urlStr = opt.urlStr,
                urlStr = _opt$urlStr === undefined ? '' : _opt$urlStr,
                _opt$h5Cmd = opt.h5Cmd,
                h5Cmd = _opt$h5Cmd === undefined ? '' : _opt$h5Cmd;

            if (!url) return;
            if (this.container && this.container.displayCtx) {
                var canvas = this.container.displayCtx.canvas;
                var img = new Image();
                var tmpUrl = this.opt.backgroundUrl === undefined ? LOADING_IMAGE : this.opt.backgroundUrl;
                img.onload = function () {
                    _this5.container.container.classList.remove('canvas-loading');
                    canvas.style.backgroundSize = 'contain';
                    canvas.style.backgroundImage = 'url(' + url + ')';
                };
                this.container.container.classList.add('canvas-loading');
                canvas.style.backgroundSize = 'auto';
                canvas.style.backgroundImage = 'url(' + tmpUrl + ')';
                img.src = url;
            }
            this.emitAction({
                account: account,
                action: new _Actions.FileAction({
                    url: url,
                    docId: docId,
                    currentPage: currentPage,
                    pageCount: pageCount,
                    type: type,
                    urlStr: urlStr,
                    h5Cmd: h5Cmd
                })
            });
        }
        // 取消背景绘制

    }, {
        key: 'clearImage',
        value: function clearImage() {
            var account = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.account;

            if (this.container.displayCtx) {
                this.container.displayCtx.canvas.style.backgroundImage = '';
            }
            this.emitAction({
                account: account,
                action: new _Actions.FileAction({
                    docId: '',
                    type: 'clear'
                })
            });
        }
        /**
         * 清除画板或者清除某个用户的绘制
         * @param {string} target 需要清除操作的用户ID
         * @param {string} account 进行操作的用户的ID
         * @public
         */

    }, {
        key: 'clear',
        value: function clear(target) {
            var _this6 = this;

            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;
            var opt = arguments[2];

            var force = opt && opt.force; // 是否强力清除，包括用户正在绘制的内容
            var quiet = opt && opt.quiet; // 是否静默清除，不抛出事件
            if (this.container.displayCtx) {
                CanvasHelper.clearCtx(this.container.displayCtx);
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = (0, _getIterator3.default)(this.users.all), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var user = _step.value;

                        if (user.isMouseDown && !force) {
                            // 防止在clear时 擦除了其他用户正在绘制的笔记，
                            _debug2.default.m.worker('user.isMouseDown = true');
                            this.container.displayCtx.drawImage(user.ctx.canvas, 0, 0);
                        } else {
                            user.ctx && CanvasHelper.clearCtx(user.ctx);
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }
            }
            var uidToRemove = void 0;
            if (target) {
                if (!Array.isArray(target)) {
                    target = [target];
                }
                if (target.length != 0) {
                    uidToRemove = target;
                }
            }
            if (uidToRemove) {
                uidToRemove.forEach(function (uid) {
                    var user = _this6.getUser(uid);
                    if (user) {
                        // user.isMouseDown = false
                        user.shapes.forEach(function (shape) {
                            _this6.shapes.remove(shape);
                        });
                        user.clearShapes();
                    }
                });
                if (this.container.displayCtx) {
                    this.container.fullRender();
                }
            } else {
                // 清空全部
                this.shapes.clear();
                var _iteratorNormalCompletion2 = true;
                var _didIteratorError2 = false;
                var _iteratorError2 = undefined;

                try {
                    for (var _iterator2 = (0, _getIterator3.default)(this.users.all), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                        var _user2 = _step2.value;

                        _user2.clearShapes();
                        // user.isMouseDown = false
                    }
                } catch (err) {
                    _didIteratorError2 = true;
                    _iteratorError2 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion2 && _iterator2.return) {
                            _iterator2.return();
                        }
                    } finally {
                        if (_didIteratorError2) {
                            throw _iteratorError2;
                        }
                    }
                }
            }
            if (!quiet) {
                this.emitAction({ account: account, action: new _Actions.ClearAction(uidToRemove) });
            }
        }
        /**
         * 收到指令后进行对应操作
         * @param {string} account 用户ID
         * @param {string} op 操作
         * @param {any} [value] 操作值
         * @public
         */

    }, {
        key: 'act',
        value: function act(anyAction) {
            _debug2.default.m.worker('act->', anyAction);
            var account = anyAction.account,
                actionData = anyAction.action;

            if (account && !this.users.hasUser(account)) {
                this.addUser(account);
            }
            var action = anyAction.action;
            switch (action.TYPE) {
                case _Itypes.WActions.START:
                    {
                        this.mousedown(action, account);
                        // 鼠标点击
                        break;
                    }
                case _Itypes.WActions.MOVE:
                case _Itypes.WActions.LASER_PEN:
                    {
                        // 激光笔
                        this.mousemove(action, account);
                        break;
                    }
                case _Itypes.WActions.TEXT:
                    {
                        this.renderText(action, account);
                        break;
                    }
                case _Itypes.WActions.END:
                    {
                        // 鼠标移上
                        this.mouseup(action, account);
                        break;
                    }
                case _Itypes.WActions.LASER_PEN_END:
                    {
                        this.clearFlag(account);
                        break;
                    }
                case _Itypes.WActions.REDO:
                    {
                        this.redo(account);
                        break;
                    }
                case _Itypes.WActions.REVOKE:
                    {
                        this.undo(account);
                        break;
                    }
                case _Itypes.WActions.CLEAR:
                    {
                        // this.clear((action as ClearAction).accounts, account);// 特殊处理，不在此处
                        break;
                    }
                case _Itypes.WActions.CALIBRATE:
                    {
                        this.calibrate(account, action);
                        break;
                    }
                case _Itypes.WActions.SYNC_PREPARE_ACK:
                case _Itypes.WActions.SERIAL:
                    {
                        break;
                    }
                case _Itypes.WActions.CLEAR_ACK:
                    // 再次清除对应用户的绘制内容
                    this.clear(account, account, { quiet: true, force: true });
                    break;
                case _Itypes.WActions.SYNC_REQUEST:
                case _Itypes.WActions.FILE:
                case _Itypes.WActions.SYNC:
                case _Itypes.WActions.SYNC_PREPARE:
                case _Itypes.WActions.VERSION:
                    break;
                default:
                    var fullCaseChecker = action;
            }
        }
        /**
         * 重新设置画布大小，等比例
         * @param {number} width 画布宽度
         * @public
         */

    }, {
        key: 'resize',
        value: function resize() {
            this.container.resize();
        }
    }, {
        key: 'dispatchCalibrateAction',
        value: function dispatchCalibrateAction(opt) {
            this.emit('action', {
                account: this.account,
                action: new _Actions.CalibrateAction(opt)
            });
        }
    }, {
        key: 'calibrate',
        value: function calibrate(account, action) {
            if (account) {
                // 更新容器的属性
                var ownerCanvasHeight = action.ownerCanvasHeight,
                    ownerCanvasWidth = action.ownerCanvasWidth;

                if (ownerCanvasHeight && ownerCanvasWidth) {
                    console.warn('update owner canvas');
                    this.container.canvasRatio = ownerCanvasWidth / ownerCanvasHeight;
                    this.container.resize();
                    this.container.updateCanvasPropSize(ownerCanvasWidth, ownerCanvasHeight);
                }
                // 更新用户的属性
                var userOptions = _Actions.CalibrateAction.USER_PROPS.reduce(function (obj, prop) {
                    if (prop in action) {
                        obj[prop] = action[prop];
                    }
                    return obj;
                }, {});
                var user = this.getUser(account);
                if (user) {
                    user.update(userOptions);
                }
            }
        }
        /**
         * 增加一个用户并初始化其canvas，已存在则直接返回
         * @param {String | Number} account 用户ID
         * @return {User} 用户
         */

    }, {
        key: 'addUser',
        value: function addUser(account) {
            _debug2.default.m.worker('addUser', account);
            if (this.users.hasUser(account)) {
                return this.getUser(account);
            }
            var user = this.users.addUser(account);
            this.container.addUser(this.account, user);
            // 依据用户的UID进行排序，制作
            this.users.all.sort(function (a, b) {
                return a.account > b.account ? 1 : -1;
            }).forEach(function (user, index) {
                user.ctx.canvas.style.zIndex = '' + (10 + index);
            });
            _debug2.default.m.worker('create User ->', user);
            return user;
        }
    }, {
        key: 'getUser',
        value: function getUser(account) {
            if (account == this.account && this.localUser) {
                return this.localUser;
            } else {
                return this.users.getUser(account);
            }
        }
        /**
         * 移除一个用户, 删除其canvas
         * @param {String | Number} account 用户ID
         * @return {User} 用户
         */

    }, {
        key: 'removeUser',
        value: function removeUser(account) {
            account && this.clearFlag(account) && this._removeUser(account);
        }
    }, {
        key: '_removeUser',
        value: function _removeUser(account) {
            var user = this.getUser(account);
            if (!user) return;
            try {
                this.container.container.removeChild(user.ctx.canvas);
            } catch (e) {}
            this.users.remove(account);
        }
        /**
         * 销毁白板, 移除所有用户
         * 实际上只移除了事件监听，并将内存占用较大的对象清空，等待垃圾回收
         * @private
         */

    }, {
        key: 'destroy',
        value: function destroy() {
            var _this7 = this;

            this.container.inputDom.removeEventListener('blur', this.handleInputDomBlur);
            this.users.destroy();
            this.switchEventListener(false);
            this.users.uids.map(function (key) {
                _this7._removeUser(key);
            });
            this.shapes.destroy();
            this.container.destroy();
            this.removeAllListeners();
        }
    }, {
        key: 'getSnapshot',
        value: function getSnapshot() {
            var _shapes = this.shapes,
                transh = _shapes.transh,
                visibles = _shapes.visibles;
            var _container6 = this.container,
                canvasWidth = _container6.canvasWidth,
                canvasHeight = _container6.canvasHeight,
                ownerCanvasHeight = _container6.ownerCanvasHeight,
                ownerCanvasWidth = _container6.ownerCanvasWidth;

            var shapeSnapshotOption = { width: canvasWidth, height: canvasHeight };
            var users = this.users.toSnapshot(shapeSnapshotOption);
            return {
                users: users,
                ownerWidth: ownerCanvasWidth,
                ownerHeight: ownerCanvasHeight,
                canvasWidth: canvasWidth,
                canvasHeight: canvasHeight,
                canvasRatio: canvasWidth / (canvasHeight === 0 ? 0.000001 : canvasHeight),
                transhShapes: transh.map(function (shape) {
                    return shape.toSnapshot(shapeSnapshotOption);
                }),
                shapes: visibles.map(function (shape) {
                    return shape.toSnapshot(shapeSnapshotOption);
                })
            };
        }
    }, {
        key: 'restoreShape',
        value: function restoreShape(shape, isInTrash) {
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var _this8 = this;

                var id, start, account, color, fontsize, size, mode, actionStr, optimized, imageData, corner, keyDown, tool, actions, actionsLenth, user, _container7, width, height, restoreShape, _corner$map, _corner$map2, topLeft, bottomRight, coordinateOffset, _Coord$areaSize, shapeWidth, shapeHeight, shapeCtx, getStartAndEnd, needClearPix, _getStartAndEnd, _getStartAndEnd2, startOffset, endOffset, _start, oldMid, end, i, len, offset, mid, prevOldMid, prevEnd, _mid, _prevOldMid, _prevEnd, _getStartAndEnd3, _getStartAndEnd4, _start2, _end, _getStartAndEnd5, _getStartAndEnd6, _start3, _end2, _Shape$calculateRadiu, radius, _getStartAndEnd7, _getStartAndEnd8, _start4, _end3, _Shape$calculateRadiu2, _radius, xRadius, yRadius, _getStartAndEnd9, _getStartAndEnd10, _start5, _end4, xOffset, yOffset, _offset, _getStartAndEnd11, _getStartAndEnd12, _start6, _end5, _xOffset, _yOffset, _offset2, cornerRadius, textAction, inputDomValue, _end6, _width, _height, fullCaseChecker, imgData;

                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                id = shape.id, start = shape.start, account = shape.user, color = shape.color, fontsize = shape.fontsize, size = shape.size, mode = shape.mode, actionStr = shape.actions, optimized = shape.optimized, imageData = shape.imageData, corner = shape.corner, keyDown = shape.keyDown;
                                tool = shape.tool;
                                actions = (0, _ActionUtils.unpackBulk)(actionStr);
                                actionsLenth = actions.length;
                                // 这个图形的所有动作
                                // 保证用户存在

                                user = this.users.getUser(account);

                                if (!user) {
                                    user = this.addUser(account);
                                }
                                _container7 = this.container, width = _container7.ownerCanvasWidth, height = _container7.ownerCanvasHeight;
                                restoreShape = new _Shape2.default({
                                    user: user, mode: mode, tool: tool, size: size, color: color, fontsize: fontsize,
                                    start: _Point2.default.fromString(start),
                                    actions: actions,
                                    keyDown: keyDown
                                });

                                restoreShape.id = id;
                                restoreShape.optimized = optimized;
                                _corner$map = corner.map(function (str) {
                                    return _Point2.default.fromString(str).toCoord(width, height);
                                }), _corner$map2 = (0, _slicedToArray3.default)(_corner$map, 2), topLeft = _corner$map2[0], bottomRight = _corner$map2[1];
                                coordinateOffset = topLeft; // 作为坐标的偏移点
                                // 原来绘图，参考的坐标系是画板那么大，action里的坐标也是那么大， 
                                // 为了更快的恢复出shape，我们只在图层那么小的区域里绘图，所以原来的坐标需要减去图形的偏移坐标。

                                _Coord$areaSize = _Point.Coord.areaSize(topLeft, bottomRight), shapeWidth = _Coord$areaSize.width, shapeHeight = _Coord$areaSize.height;
                                shapeCtx = restoreShape.ctx;

                                CanvasHelper.setCanvasPropSize(shapeCtx, { width: shapeWidth, height: shapeHeight });
                                restoreShape.corner = [topLeft, bottomRight];
                                (0, _ContainerManager.applyState)(shapeCtx, { ctx: shapeCtx, color: color, size: size, tool: tool });
                                console.assert(shapeCtx.lineWidth === size, 'shape line width is not the same', size, shapeCtx.lineWidth);
                                if (isInTrash) {
                                    user.recycle.push(restoreShape);
                                    // 这里只是把数据推进去了，计算可回退步骤和当前已回退步骤需要自己来做
                                } else {
                                    user.shapes.push(restoreShape);
                                    this.shapes.push(restoreShape);
                                }

                                getStartAndEnd = function getStartAndEnd(offset) {
                                    var startAction = actions[0];
                                    var endAction = actions[actionsLenth - 1];
                                    var startOffset = _this8.getOwnerCoord(startAction);
                                    var endOffset = _this8.getOwnerCoord(endAction);
                                    if (offset) {
                                        return [startOffset.minus(offset), endOffset.minus(offset)];
                                    }
                                    return [startOffset, endOffset];
                                };

                                needClearPix = true;
                                _context.t0 = tool;
                                _context.next = _context.t0 === 'free' ? 24 : _context.t0 === 'erase' ? 24 : _context.t0 === 'line' ? 26 : _context.t0 === 'circle' ? 29 : _context.t0 === 'solidCircle' ? 29 : _context.t0 === 'ellipse' ? 33 : _context.t0 === 'solidEllipse' ? 33 : _context.t0 === 'rect' ? 37 : _context.t0 === 'solidRect' ? 37 : _context.t0 === 'roundRect' ? 44 : _context.t0 === 'solidRoundRect' ? 44 : _context.t0 === 'text' ? 52 : _context.t0 === 'fill' ? 58 : _context.t0 === "flag" ? 64 : 66;
                                break;

                            case 24:
                                // 这个是自由绘制,actions是持续的
                                if (actionsLenth >= 2) {
                                    // 必须大于2
                                    _getStartAndEnd = getStartAndEnd(coordinateOffset), _getStartAndEnd2 = (0, _slicedToArray3.default)(_getStartAndEnd, 2), startOffset = _getStartAndEnd2[0], endOffset = _getStartAndEnd2[1];
                                    // 初始化

                                    _start = startOffset.clone();
                                    oldMid = startOffset.clone();
                                    end = startOffset.clone();

                                    if (actionsLenth === 2) {
                                        CanvasHelper.line(shapeCtx, _start, end, color);
                                    } else {
                                        // 循环
                                        for (i = 1, len = actionsLenth - 1; i < len; i++) {
                                            // 跳过第一个和最后一个点
                                            offset = this.getOwnerCoord(actions[i]).minus(coordinateOffset);
                                            mid = _Point.Coord.middle(end, offset);
                                            prevOldMid = oldMid.clone();
                                            prevEnd = end.clone();

                                            oldMid.copy(mid);
                                            end.copy(offset);
                                            CanvasHelper.free(shapeCtx, prevOldMid, prevEnd, mid, color, size);
                                        }
                                        {
                                            // 最后一划
                                            _mid = _Point.Coord.middle(end, endOffset);
                                            _prevOldMid = oldMid.clone();
                                            _prevEnd = end.clone();

                                            CanvasHelper.free(shapeCtx, _prevOldMid, _mid, endOffset, color, size);
                                        }
                                        // 终止
                                    }
                                }
                                return _context.abrupt('break', 69);

                            case 26:
                                _getStartAndEnd3 = getStartAndEnd(coordinateOffset), _getStartAndEnd4 = (0, _slicedToArray3.default)(_getStartAndEnd3, 2), _start2 = _getStartAndEnd4[0], _end = _getStartAndEnd4[1];

                                CanvasHelper.line(shapeCtx, _start2, _end, color);
                                return _context.abrupt('break', 69);

                            case 29:
                                _getStartAndEnd5 = getStartAndEnd(coordinateOffset), _getStartAndEnd6 = (0, _slicedToArray3.default)(_getStartAndEnd5, 2), _start3 = _getStartAndEnd6[0], _end2 = _getStartAndEnd6[1];
                                _Shape$calculateRadiu = _Shape2.default.calculateRadius(tool, _start3, _end2), radius = _Shape$calculateRadiu.radius;

                                CanvasHelper.circle(shapeCtx, _start3, radius, tool === 'solidCircle', color);
                                return _context.abrupt('break', 69);

                            case 33:
                                _getStartAndEnd7 = getStartAndEnd(coordinateOffset), _getStartAndEnd8 = (0, _slicedToArray3.default)(_getStartAndEnd7, 2), _start4 = _getStartAndEnd8[0], _end3 = _getStartAndEnd8[1];
                                _Shape$calculateRadiu2 = _Shape2.default.calculateRadius(tool, _start4, _end3), _radius = _Shape$calculateRadiu2.radius, xRadius = _Shape$calculateRadiu2.xRadius, yRadius = _Shape$calculateRadiu2.yRadius;

                                CanvasHelper.ellipse(shapeCtx, _start4, xRadius, yRadius, tool === 'solidEllipse', color);
                                return _context.abrupt('break', 69);

                            case 37:
                                _getStartAndEnd9 = getStartAndEnd(coordinateOffset), _getStartAndEnd10 = (0, _slicedToArray3.default)(_getStartAndEnd9, 2), _start5 = _getStartAndEnd10[0], _end4 = _getStartAndEnd10[1];
                                xOffset = _end4.x - _start5.x;
                                yOffset = _end4.y - _start5.y;
                                _offset = Math.min(Math.abs(xOffset), Math.abs(yOffset));

                                if (keyDown.shiftKey) {
                                    xOffset = (0, _utils.sign)(xOffset) * _offset;
                                    yOffset = (0, _utils.sign)(yOffset) * _offset;
                                }
                                CanvasHelper.rect(shapeCtx, _start5, xOffset, yOffset, tool === 'solidRect', color);
                                return _context.abrupt('break', 69);

                            case 44:
                                //这种是两点的图形，可以直接绘制
                                _getStartAndEnd11 = getStartAndEnd(coordinateOffset), _getStartAndEnd12 = (0, _slicedToArray3.default)(_getStartAndEnd11, 2), _start6 = _getStartAndEnd12[0], _end5 = _getStartAndEnd12[1];
                                _xOffset = _end5.x - _start6.x;
                                _yOffset = _end5.y - _start6.y;
                                _offset2 = Math.min(Math.abs(_xOffset), Math.abs(_yOffset));

                                if (keyDown.shiftKey) {
                                    _xOffset = (0, _utils.sign)(_xOffset) * _offset2;
                                    _yOffset = (0, _utils.sign)(_yOffset) * _offset2;
                                }
                                cornerRadius = _offset2 < size ? 2 : _offset2 * 0.1;

                                CanvasHelper.roundRect(shapeCtx, _start6, _xOffset, _yOffset, cornerRadius, tool === 'solidRoundRect', color);
                                return _context.abrupt('break', 69);

                            case 52:
                                textAction = actions[0];
                                inputDomValue = textAction.text;
                                _end6 = this.getOwnerCoord(textAction).minus(coordinateOffset);

                                CanvasHelper.text(shapeCtx, _end6, inputDomValue, fontsize, true, color);
                                needClearPix = false;
                                return _context.abrupt('break', 69);

                            case 58:
                                // 这个是填充图层,填充图层传输的是base64的png图片
                                _width = Math.abs(topLeft.x - bottomRight.x);
                                _height = Math.abs(topLeft.y - bottomRight.y);
                                _context.next = 62;
                                return new _promise2.default(function (resolve) {
                                    var image = new Image();
                                    image.src = imageData;
                                    // image.style.cssText = 'object-fit:///'
                                    image.onerror = function () {
                                        return resolve();
                                    };
                                    image.onload = function () {
                                        console.log('fill');
                                        shapeCtx.drawImage(image, 0, 0, _width, _height);
                                        resolve();
                                    };
                                });

                            case 62:
                                needClearPix = false;
                                return _context.abrupt('break', 69);

                            case 64:
                                // 不做任何操作
                                needClearPix = false;
                                return _context.abrupt('break', 69);

                            case 66:
                                needClearPix = false;
                                fullCaseChecker = tool;

                                console.warn('尝试恢复未知的图形');

                            case 69:
                                if (this.opt.clearTransparentPix && needClearPix) {
                                    try {
                                        imgData = shapeCtx.getImageData(0, 0, shapeWidth, shapeHeight);

                                        this.clearTransparentPix(imgData.data);
                                        shapeCtx.putImageData(imgData, shapeWidth, shapeHeight);
                                    } catch (err) {
                                        console.error(err);
                                    }
                                }

                            case 70:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));
        }
    }, {
        key: 'mesure',
        value: function mesure(points) {
            var _this9 = this;

            var styleId = document.getElementById('worker-mesure-anim');
            if (!styleId) {
                document.head.insertAdjacentHTML('beforeend', '<style>@keyframes xxx-xxx{from{background:red;}to{background:green}}</style>');
            }
            if (!Array.isArray(points)) {
                points = [points];
            }
            points.forEach(function (point) {
                _this9.container.container.insertAdjacentHTML('afterbegin', '<div style="z-index:2222;display:inline-block;position:absolute;background:red;top:' + point.x + 'px;left:' + point.y + 'px;width:2px;height:2px;animation:xxx-xxx 1s infinite"></div>');
            });
        }
    }]);
    return DrawWorker;
}(_eventemitter2.default);

exports.default = DrawWorker;

/***/ }),

/***/ "./src/core/Itypes.ts":
/*!****************************!*\
  !*** ./src/core/Itypes.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// type OP_MODE = '' | 'flag' | 'free' | 'erase' | 'fill' | 'select' | 'draw' | 'image' // todo
var WActions = exports.WActions = undefined;
(function (WActions) {
    WActions[WActions["VERSION"] = 0] = "VERSION";
    WActions[WActions["START"] = 1] = "START";
    WActions[WActions["MOVE"] = 2] = "MOVE";
    WActions[WActions["END"] = 3] = "END";
    WActions[WActions["REVOKE"] = 4] = "REVOKE";
    WActions[WActions["SERIAL"] = 5] = "SERIAL";
    WActions[WActions["CLEAR"] = 6] = "CLEAR";
    WActions[WActions["CLEAR_ACK"] = 7] = "CLEAR_ACK";
    WActions[WActions["SYNC_REQUEST"] = 8] = "SYNC_REQUEST";
    WActions[WActions["SYNC"] = 9] = "SYNC";
    WActions[WActions["SYNC_PREPARE"] = 10] = "SYNC_PREPARE";
    WActions[WActions["SYNC_PREPARE_ACK"] = 11] = "SYNC_PREPARE_ACK";
    WActions[WActions["LASER_PEN"] = 12] = "LASER_PEN";
    WActions[WActions["LASER_PEN_END"] = 13] = "LASER_PEN_END";
    WActions[WActions["FILE"] = 14] = "FILE";
    WActions[WActions["REDO"] = 15] = "REDO";
    WActions[WActions["CALIBRATE"] = 16] = "CALIBRATE";
    WActions[WActions["TEXT"] = 17] = "TEXT";
})(WActions || (exports.WActions = WActions = {}));
var StateRelatedActions = exports.StateRelatedActions = [WActions.CALIBRATE, WActions.FILE];
// 这个是表示白板组件整体处于一个什么状态的
var WB_MODE = exports.WB_MODE = undefined;
(function (WB_MODE) {
    WB_MODE[WB_MODE["readonly"] = -1] = "readonly";
    WB_MODE[WB_MODE["draw"] = 1] = "draw";
    // mousedown = 3, // 鼠标按下了
    // mousemove = 4, // 鼠标移动中
    // mouseup = 5,   // 鼠标抬起
})(WB_MODE || (exports.WB_MODE = WB_MODE = {}));
var WB_TOOL = exports.WB_TOOL = undefined;
(function (WB_TOOL) {
    WB_TOOL[WB_TOOL["flag"] = -1] = "flag";
    WB_TOOL[WB_TOOL["free"] = 1] = "free";
    WB_TOOL[WB_TOOL["line"] = 2] = "line";
    WB_TOOL[WB_TOOL["rect"] = 3] = "rect";
    WB_TOOL[WB_TOOL["solidRect"] = 4] = "solidRect";
    WB_TOOL[WB_TOOL["roundRect"] = 5] = "roundRect";
    WB_TOOL[WB_TOOL["solidRoundRect"] = 6] = "solidRoundRect";
    WB_TOOL[WB_TOOL["circle"] = 7] = "circle";
    WB_TOOL[WB_TOOL["solidCircle"] = 8] = "solidCircle";
    WB_TOOL[WB_TOOL["ellipse"] = 9] = "ellipse";
    WB_TOOL[WB_TOOL["solidEllipse"] = 10] = "solidEllipse";
    WB_TOOL[WB_TOOL["fill"] = 11] = "fill";
    WB_TOOL[WB_TOOL["text"] = 12] = "text";
    WB_TOOL[WB_TOOL["erase"] = 13] = "erase";
    // select = 14, //  TODO 选择工具
})(WB_TOOL || (exports.WB_TOOL = WB_TOOL = {}));

/***/ }),

/***/ "./src/core/Model/GlobalHub.ts":
/*!*************************************!*\
  !*** ./src/core/Model/GlobalHub.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var globalHub = new _eventemitter2.default();
exports.default = globalHub;

/***/ }),

/***/ "./src/core/Model/Point.ts":
/*!*********************************!*\
  !*** ./src/core/Model/Point.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Coord = undefined;

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var POINT_MATCHER = /\(x:([.\d]+),y:([.\d]+)\)/;
// 点坐标，只能是相对位置的百分比

var Point = function () {
    function Point(x, y) {
        (0, _classCallCheck3.default)(this, Point);

        this.x = x || 0;
        this.y = y || 0;
    }

    (0, _createClass3.default)(Point, [{
        key: 'destroy',
        value: function destroy() {}
    }, {
        key: 'clone',
        value: function clone() {
            return new Point(this.x, this.y);
        }
    }, {
        key: 'toString',
        value: function toString() {
            return '(x:' + this.x.toFixed(8) + ',y:' + this.y.toFixed(8) + ')';
        }
    }, {
        key: 'toCoord',
        value: function toCoord(width, height) {
            return new Coord(this.x * width, this.y * height);
        }
    }, {
        key: 'copy',
        value: function copy(point) {
            this.x = point.x;
            this.y = point.y;
        }
    }, {
        key: 'minus',
        value: function minus(p) {
            return new Point(this.x - p.x, this.y - p.y);
        }
    }, {
        key: 'topLeft',
        value: function topLeft(x, y) {
            if (typeof x == 'number' && typeof y === 'number') {
                if (x < this.x) {
                    this.x = x;
                }
                if (y < this.y) {
                    this.y = y;
                }
            } else if (x instanceof Point) {
                this.topLeft(x.x, x.y);
            }
            return this;
        }
    }, {
        key: 'bottomRight',
        value: function bottomRight(x, y) {
            if (typeof x == 'number' && typeof y === 'number') {
                if (x > this.x) {
                    this.x = x;
                }
                if (y > this.y) {
                    this.y = y;
                }
            } else if (x instanceof Point) {
                this.bottomRight(x.x, x.y);
            }
            return this;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str) {
            var match = POINT_MATCHER.exec(str);
            if (match) {
                return new Point(+match[1], +match[2]);
            } else {
                return new Point(0, 0);
            }
        }
    }, {
        key: 'middle',
        value: function middle(a, b) {
            return new Point((a.x + b.x) / 2, (a.y + b.y) / 2);
        }
    }, {
        key: 'areaSize',
        value: function areaSize(a, b) {
            return {
                width: Math.ceil(Math.abs(a.x - b.x)),
                height: Math.ceil(Math.abs(a.y - b.y))
            };
        }
    }, {
        key: 'clone',
        value: function clone(_ref) {
            var x = _ref.x,
                y = _ref.y;

            return new Point(x, y);
        }
    }]);
    return Point;
}();

exports.default = Point;

var Coord = exports.Coord = function () {
    function Coord(x, y) {
        (0, _classCallCheck3.default)(this, Coord);

        this.x = x;
        this.y = y;
    }

    (0, _createClass3.default)(Coord, [{
        key: 'destroy',
        value: function destroy() {}
    }, {
        key: 'clone',
        value: function clone() {
            return new Coord(this.x, this.y);
        }
    }, {
        key: 'toPoint',
        value: function toPoint(width, height) {
            return new Point(this.x / width, this.y / height);
        }
    }, {
        key: 'copy',
        value: function copy(point) {
            this.x = point.x;
            this.y = point.y;
        }
    }, {
        key: 'minus',
        value: function minus(p) {
            return new Coord(this.x - p.x, this.y - p.y);
        }
    }, {
        key: 'topLeft',
        value: function topLeft(x, y) {
            if (typeof x == 'number' && typeof y === 'number') {
                if (x < this.x) {
                    this.x = x;
                }
                if (y < this.y) {
                    this.y = y;
                }
            } else if (x instanceof Coord) {
                this.topLeft(x.x, x.y);
            }
            return this;
        }
    }, {
        key: 'bottomRight',
        value: function bottomRight(x, y) {
            if (typeof x == 'number' && typeof y === 'number') {
                if (x > this.x) {
                    this.x = x;
                }
                if (y > this.y) {
                    this.y = y;
                }
            } else if (x instanceof Coord) {
                this.bottomRight(x.x, x.y);
            }
            return this;
        }
    }], [{
        key: 'fromString',
        value: function fromString(str, width, height) {
            var match = POINT_MATCHER.exec(str);
            if (match) {
                return new Coord(Math.round(+match[1] * width), Math.round(+match[2] * height));
            } else {
                return new Coord(0, 0);
            }
        }
    }, {
        key: 'middle',
        value: function middle(a, b) {
            return new Coord((a.x + b.x) / 2, (a.y + b.y) / 2);
        }
    }, {
        key: 'areaSize',
        value: function areaSize(a, b) {
            return {
                width: Math.ceil(Math.abs(a.x - b.x)),
                height: Math.ceil(Math.abs(a.y - b.y))
            };
        }
    }, {
        key: 'clone',
        value: function clone(_ref2) {
            var x = _ref2.x,
                y = _ref2.y;

            return new Coord(x, y);
        }
    }]);
    return Coord;
}();

/***/ }),

/***/ "./src/core/Model/Shape.ts":
/*!*********************************!*\
  !*** ./src/core/Model/Shape.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _CanvasHelper = __webpack_require__(/*! ../DrawWorker/CanvasHelper */ "./src/core/DrawWorker/CanvasHelper.ts");

var CanvasHelper = _interopRequireWildcard(_CanvasHelper);

var _debug = __webpack_require__(/*! ../../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

var _utils = __webpack_require__(/*! ../utils */ "./src/core/utils.ts");

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Shape = function () {
    function Shape(_ref) {
        var user = _ref.user,
            mode = _ref.mode,
            tool = _ref.tool,
            size = _ref.size,
            color = _ref.color,
            start = _ref.start,
            actions = _ref.actions,
            fontsize = _ref.fontsize,
            keyDown = _ref.keyDown;
        (0, _classCallCheck3.default)(this, Shape);

        var id = performance && performance.timing && performance.timing.navigationStart + performance.now();
        this.id = id || Date.now();
        this.user = user;
        this.visible = true;
        // 在画完之后把绘制轨迹截取为图片保存在Canvas中
        this.ctx = document.createElement('canvas').getContext('2d');
        var shapeCanvas = this.ctx.canvas;
        var userCanvas = user.ctx.canvas;
        shapeCanvas.style.width = userCanvas.style.width;
        shapeCanvas.style.height = userCanvas.style.height;
        this.ctx.lineWidth = user.ctx.lineWidth;
        this.coordWidth = userCanvas.width;
        this.coordHeight = userCanvas.height;
        CanvasHelper.setCanvasPropSize(this.ctx, { width: this.coordWidth, height: this.coordHeight });
        this.tool = tool;
        this.mode = mode;
        this.color = color;
        this.size = size;
        this.fontsize = fontsize;
        // 缓存创建这个图层所使用的action，同步数据时，将会把创建这个图层使用的action给发送出去
        if (Array.isArray(actions)) {
            this.actions = actions;
        } else if (typeof actions === 'undefined') {
            console.warn('action undefined! create a shape');
            this.actions = [];
        } else {
            this.actions = [actions];
        }
        this.keyDown = keyDown;
        // 填充类型，保存一份填充点击的位置
        this.start = start.toCoord(this.coordWidth, this.coordHeight);
        // 绘制内容保存为Canvas上所处位置
        this.corner = [this.start.clone(), this.start.clone()];
        this.transform = [];
        this.path = [];
        this.zIndex = 1;
        this.detail = Shape.calculateRadius(this.tool, this.start, this.start);
    }

    (0, _createClass3.default)(Shape, [{
        key: 'updateCorner',
        value: function updateCorner(offset) {
            var end = this.getCoord(offset);
            var start = this.start;
            var size = this.size;

            var _corner = (0, _slicedToArray3.default)(this.corner, 2),
                topLeft = _corner[0],
                bottomRight = _corner[1];

            var detail = Shape.calculateRadius(this.tool, start, end);
            this.detail = detail;
            var xRadius = detail.xRadius,
                yRadius = detail.yRadius,
                radius = detail.radius,
                width = detail.width,
                height = detail.height;
            // const width = Math.abs(end.x - start.x);
            // const height = Math.abs(end.y - start.y)
            // let radius: number | undefined;
            // let xRadius: number | undefined;
            // let yRadius: number | undefined;

            switch (this.tool) {
                case 'solidCircle':
                case 'circle':
                    {
                        topLeft.x = start.x - radius - size;
                        topLeft.y = start.y - radius - size;
                        bottomRight.x = start.x + radius + size;
                        bottomRight.y = start.y + radius + size;
                        break;
                    }
                case 'ellipse':
                case 'solidEllipse':
                    {
                        topLeft.x = start.x - xRadius - size;
                        topLeft.y = start.y - yRadius - size;
                        bottomRight.x = start.x + xRadius + size;
                        bottomRight.y = start.y + yRadius + size;
                        break;
                    }
                case 'rect':
                case 'roundRect':
                case 'solidRect':
                case 'solidRoundRect':
                case 'line':
                    {
                        // 从起点开始，计算其他的四个角角
                        topLeft.copy(start.clone().topLeft(end));
                        bottomRight.copy(start.clone().bottomRight(end));
                        break;
                    }
                case 'text':
                case 'free':
                case "erase":
                    {
                        // 划过的地方都需要添加到内容区域
                        topLeft.topLeft(end);
                        bottomRight.bottomRight(end);
                        break;
                    }
                case 'flag': // 这个没有corner和shape
                case 'fill':
                    // 填充的corner重新计算
                    // case 'select':
                    break;
                default:
                    var fullCaseChecker = this.tool;
            }
            // 因为stroke有size ，所以会超出边界，所以需要将corner的大小拓展size的大小
            if (this.tool !== 'fill' && this.tool !== 'text' && this.tool !== 'free' && this.tool !== 'erase') {
                topLeft.x -= size;
                topLeft.y -= size;
                bottomRight.x += size;
                bottomRight.y += size;
            }
            return detail;
        }
    }, {
        key: 'expandCorner',
        value: function expandCorner() {
            var size = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.size;

            var _corner2 = (0, _slicedToArray3.default)(this.corner, 2),
                topLeft = _corner2[0],
                bottomRight = _corner2[1];

            topLeft.x -= size;
            topLeft.y -= size;
            bottomRight.x += size;
            bottomRight.y += size;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            _debug2.default.shape('shape delete ctx', this.user, this.ctx, this.actions);
            // console.error(new Error('delete shapes'))
            // delete this.user;
            // delete this.ctx;
            // delete this.actions;
        }
    }, {
        key: 'toSnapshot',
        value: function toSnapshot(_ref2) {
            var width = _ref2.width,
                height = _ref2.height;
            var id = this.id,
                mode = this.mode,
                tool = this.tool,
                size = this.size,
                fontsize = this.fontsize,
                color = this.color,
                start = this.start,
                actions = this.actions,
                keyDown = this.keyDown;

            if (tool === 'fill') {
                return {
                    id: id,
                    user: this.user.account,
                    mode: mode, tool: tool, size: size, fontsize: fontsize, color: color,
                    start: start.toPoint(width, height).toString(),
                    optimized: true,
                    imageData: this.ctx.canvas.toDataURL(),
                    keyDown: keyDown,
                    corner: this.corner.map(function (x) {
                        return x.toPoint(width, height).toString();
                    }),
                    actions: actions.filter(function (x) {
                        return x;
                    }).map(function (action) {
                        return action.toString();
                    }).join(';') + ';'
                };
            } else {
                return {
                    id: id,
                    user: this.user.account,
                    mode: mode, tool: tool, size: size, fontsize: fontsize, color: color,
                    start: start.toPoint(width, height).toString(),
                    optimized: false,
                    imageData: '',
                    corner: this.corner.map(function (x) {
                        return x.toPoint(width, height).toString();
                    }),
                    keyDown: keyDown,
                    actions: actions.filter(function (x) {
                        return x;
                    }).map(function (action) {
                        return action.toString();
                    }).join(';') + ';'
                };
            }
        }
    }, {
        key: 'draw',
        value: function draw(displayCtx) {
            var ownerCoord = this.user.end.toCoord(this.coordWidth, this.coordHeight);
            switch (this.tool) {
                case 'fill':
                    {
                        CanvasHelper.fill(displayCtx, ownerCoord, this.color, this);
                        break;
                    }
                case 'erase':
                case 'free':
                    {
                        CanvasHelper.free(displayCtx, this.getCoord(this.user.prevOldMid), this.getCoord(this.user.prevEnd), this.getCoord(this.user.oldMid), this.color, this.size);
                        break;
                    }
                case 'line':
                    {
                        CanvasHelper.line(displayCtx, this.getCoord(this.user.start), this.getCoord(this.user.end), this.color);
                        break;
                    }
                case 'rect':
                case 'solidRect':
                    {
                        var endCoord = this.getCoord(this.user.end);
                        var startCoord = this.getCoord(this.user.start);
                        var xOffset = endCoord.x - startCoord.x;
                        var yOffset = endCoord.y - startCoord.y;
                        var offset = Math.min(Math.abs(xOffset), Math.abs(yOffset));
                        if (this.user.keyDown.shiftKey) {
                            xOffset = (0, _utils.sign)(xOffset) * offset;
                            yOffset = (0, _utils.sign)(yOffset) * offset;
                        }
                        CanvasHelper.rect(displayCtx, startCoord, xOffset, yOffset, this.tool === 'solidRect', this.color);
                        break;
                    }
                case 'roundRect':
                case 'solidRoundRect':
                    {
                        var _endCoord = this.getCoord(this.user.end);
                        var _startCoord = this.getCoord(this.user.start);
                        var _xOffset = _endCoord.x - _startCoord.x;
                        var _yOffset = _endCoord.y - _startCoord.y;
                        var _offset = Math.min(Math.abs(_xOffset), Math.abs(_yOffset));
                        var radius = _offset < this.size ? 2 : _offset * 0.1;
                        if (this.user.keyDown.shiftKey) {
                            _xOffset = (0, _utils.sign)(_xOffset) * _offset;
                            _yOffset = (0, _utils.sign)(_yOffset) * _offset;
                        }
                        CanvasHelper.roundRect(displayCtx, _startCoord, _xOffset, _yOffset, radius, this.tool === 'solidRoundRect', this.color);
                        break;
                    }
                case 'circle':
                case 'solidCircle':
                    {
                        var _radius = this.detail.radius;

                        var _startCoord2 = this.getCoord(this.user.start);
                        CanvasHelper.circle(displayCtx, _startCoord2, _radius, this.tool === 'solidCircle', this.color);
                        break;
                    }
                case 'ellipse':
                case 'solidEllipse':
                    {
                        var _startCoord3 = this.getCoord(this.user.start);
                        var _detail = this.detail,
                            xRadius = _detail.xRadius,
                            yRadius = _detail.yRadius;

                        CanvasHelper.ellipse(displayCtx, _startCoord3, xRadius, yRadius, this.tool === 'solidEllipse', this.color);
                        break;
                    }
            }
        }
    }, {
        key: 'freeMove',
        value: function freeMove(displayCtx) {
            CanvasHelper.free(displayCtx, this.getCoord(this.user.prevOldMid), this.getCoord(this.user.prevEnd), this.getCoord(this.user.oldMid), this.color, this.size);
        }
    }, {
        key: 'freeEnd',
        value: function freeEnd(displayCtx) {
            CanvasHelper.free(displayCtx, this.getCoord(this.user.prevOldMid), this.getCoord(this.user.oldMid), this.getCoord(this.user.end), this.color, this.size);
        }
    }, {
        key: 'getCoord',
        value: function getCoord(offset) {
            return offset.toCoord(this.coordWidth, this.coordHeight);
        }
    }], [{
        key: 'calculateRadius',
        value: function calculateRadius(tool, start, end) {
            var width = Math.abs(end.x - start.x);
            var height = Math.abs(end.y - start.y);
            var radius = void 0;
            var xRadius = void 0;
            var yRadius = void 0;
            switch (tool) {
                case 'circle':
                case 'solidCircle':
                case 'ellipse':
                case 'solidEllipse':
                    {
                        xRadius = width;
                        yRadius = height;
                        radius = xRadius > yRadius ? xRadius : yRadius;
                        break;
                    }
            }
            return {
                xRadius: xRadius,
                yRadius: yRadius,
                radius: radius,
                width: width,
                height: height
            };
        }
    }]);
    return Shape;
}();

exports.default = Shape;

/***/ }),

/***/ "./src/core/Model/User.ts":
/*!********************************!*\
  !*** ./src/core/Model/User.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _CanvasHelper = __webpack_require__(/*! ../DrawWorker/CanvasHelper */ "./src/core/DrawWorker/CanvasHelper.ts");

var CanvasHelper = _interopRequireWildcard(_CanvasHelper);

var _Point = __webpack_require__(/*! ./Point */ "./src/core/Model/Point.ts");

var _Point2 = _interopRequireDefault(_Point);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _debug = __webpack_require__(/*! ../../debug */ "./src/debug.ts");

var _debug2 = _interopRequireDefault(_debug);

var _Actions = __webpack_require__(/*! ../Actions */ "./src/core/Actions/index.ts");

var _GlobalHub = __webpack_require__(/*! ./GlobalHub */ "./src/core/Model/GlobalHub.ts");

var _GlobalHub2 = _interopRequireDefault(_GlobalHub);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var User = function (_EventEmitter) {
    (0, _inherits3.default)(User, _EventEmitter);

    function User(UID, maxUserHistory) {
        (0, _classCallCheck3.default)(this, User);

        var _this = (0, _possibleConstructorReturn3.default)(this, (User.__proto__ || (0, _getPrototypeOf2.default)(User)).call(this));

        _this.undoCount = 0; // 指示测销或者重做了多少次
        _this.account = UID;
        // 默认为自由绘图模式
        //zhongkai: 这个感叹号是语法错误吧？？。另外，每个用户创建一个画布是否有必要？
        _this.ctx = document.createElement('canvas').getContext('2d');
        // this.ctx.canvas.style.transform = 'translate3d(0,0,0)'
        _this.ctx.canvas.className = 'wb_-_-' + UID;
        CanvasHelper.setpixelated(_this.ctx);
        CanvasHelper.setLineStyle(_this.ctx);
        _this.shapes = []; // 保存用户所做的可视操作的index
        _this.recycle = [];
        _this.mode = 'draw'; // 依据鼠标的状态划分状态
        _this.tool = 'flag';
        _this.flagPos = new _Point2.default(99999, 99999).toString();
        _this.size = 4;
        _this.color = '#000000';
        _this.fontsize = 24;
        _this.isMouseDown = false; // 鼠标未按下
        _this.start = new _Point2.default(0, 0);
        _this.oldMid = new _Point2.default(0, 0);
        _this.prevOldMid = new _Point2.default(0, 0);
        _this.end = new _Point2.default(0, 0);
        _this.prevEnd = new _Point2.default(0, 0);
        // 只有null，才会在JSON格式化时发送出去
        _this.keyDown = {
            altKey: false,
            ctrlKey: false,
            shiftKey: false,
            which: -1
        }; // 记录当前按下的按键情况
        // local undo/redo model
        _GlobalHub2.default.emit('userUpdate', _this.account, {
            tool: _this.tool,
            size: _this.size,
            color: _this.color,
            fontsize: _this.fontsize,
            mode: _this.mode,
            keyDown: _this.keyDown
        });
        // private data
        _this.maxUserHistory = maxUserHistory;
        _this._resetCalibrate = _this.getCalibrateAction();
        return _this;
    }
    // isFlag?: boolean;// TODO


    (0, _createClass3.default)(User, [{
        key: 'update',
        value: function update(opt) {
            var _this2 = this;

            User.PROPS.forEach(function (key) {
                if (key in opt) {
                    _this2[key] = opt[key];
                }
            });
            this.emit('update', this.account, opt);
            _GlobalHub2.default.emit('userUpdate', this.account, opt);
            _debug2.default.user('update user ', this, 'with ', opt);
            // Object.assign(this, opt);
        }
    }, {
        key: 'pushShape',
        value: function pushShape(shape) {
            if (this.recycle.length) {
                this.recycle.forEach(function (shape) {
                    return shape.destroy();
                });
                this.recycle.length = 0;
            }
            this.undoCount = 0; // 指示说，当前测销或者重做向量为0了
            this.shapes.push(shape);
            this.configActiveShape();
            // 用户的shapes改变了
            this.emitUserShape();
            return shape;
        }
    }, {
        key: 'configActiveShape',
        value: function configActiveShape() {
            console.log('config active shape ');
            this.activeShape = this.shapes[this.shapes.length - 1];
        }
    }, {
        key: 'undo',
        value: function undo() {
            if (this.undoCount >= this.maxUserHistory) {
                console.warn('reach maxUserHistory! abort undo');
                return this.shapes.length;
            }
            this.undoCount++;
            var shape = this.shapes.pop();
            if (shape) {
                this.recycle.push(shape);
                this.configActiveShape();
                _debug2.default.log('undo:', this);
                this.emit('undo', this);
                // 用户的shapes改变了
                this.emitUserShape();
            }
            return this.shapes.length;
        }
    }, {
        key: 'redo',
        value: function redo() {
            if (this.undoCount === 0) {
                // 说明没有undo过，所以没法重做
                return this.recycle.length;
            }
            this.undoCount--;
            var shape = this.recycle.pop();
            if (shape) {
                this.shapes.push(shape);
                this.configActiveShape();
                this.emit('redo', this);
                // 用户的shapes改变了
                this.emitUserShape();
            }
            return this.recycle.length;
            ;
        }
        // 同步其他端的参数

    }, {
        key: 'getCalibrateAction',
        value: function getCalibrateAction() {
            var mode = this.mode,
                tool = this.tool,
                size = this.size,
                color = this.color,
                fontsize = this.fontsize,
                isMouseDown = this.isMouseDown,
                keyDown = this.keyDown,
                flagPos = this.flagPos;

            return new _Actions.CalibrateAction({
                mode: mode, tool: tool, size: size, color: color, fontsize: fontsize,
                isMouseDown: isMouseDown, flagPos: flagPos, keyDown: keyDown
            });
        }
    }, {
        key: 'clearShapes',
        value: function clearShapes() {
            _debug2.default.user('user reset:', this);
            this.shapes.forEach(function (shape) {
                return shape.destroy();
            });
            this.shapes = [];
            this.recycle = [];
            this.undoCount = 0;
            // 用户的shapes改变了
            this.emitUserShape();
        }
    }, {
        key: 'emitUserShape',
        value: function emitUserShape() {
            var undoCount = this.undoCount; // 撤销或者重做的向量步数

            var redoLength = this.recycle.length; // 当前可以前进的步数
            var undoLength = this.shapes.length; // 当前可以减去的步数
            var avaliableUndoCount = this.maxUserHistory - undoCount;
            if (undoLength < avaliableUndoCount) {
                avaliableUndoCount = undoLength;
            }
            _GlobalHub2.default.emit('userShapes', this.account, avaliableUndoCount, this.recycle.length);
        }
        /**
         * 这个接口是用于数据同步后还原之后，需要对undoCount进行一个计算
         */

    }, {
        key: 'guessMyUndoCount',
        value: function guessMyUndoCount() {
            this.undoCount = this.recycle.length;
        }
    }, {
        key: 'whenMouseDown',
        value: function whenMouseDown(offset) {
            this.prevOldMid = offset.clone();
            this.prevEnd = offset.clone();
            this.start = offset.clone();
            this.oldMid = offset.clone();
            this.end = offset.clone();
        }
    }, {
        key: 'whenMouseMove',
        value: function whenMouseMove(offset) {
            this.prevOldMid = this.oldMid.clone();
            this.prevEnd = this.end.clone();
            this.oldMid = _Point2.default.middle(this.end, offset);
            this.end = offset.clone();
        }
    }, {
        key: 'whenMouseUp',
        value: function whenMouseUp(offset) {
            this.prevOldMid = this.oldMid.clone();
            this.prevEnd = this.end.clone();
            this.oldMid = _Point2.default.middle(this.end, offset);
            this.end = offset.clone();
        }
    }, {
        key: 'reset',
        value: function reset() {
            this.update(this._resetCalibrate);
            _GlobalHub2.default.emit('userUpdate', this.account, this._resetCalibrate);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            if (this.shapes.length || this.recycle.length) {
                this.clearShapes();
            }
            _debug2.default.user('delete user ctx:', this);
            // delete this.ctx;
        }
    }, {
        key: 'isFlag',
        get: function get() {
            return this.tool === 'flag';
        }
    }]);
    return User;
}(_eventemitter.EventEmitter);

User.PROPS = ['mode', 'tool', 'size', 'color', 'fontsize', 'isMouseDown', 'flagPos', 'keyDown'];
exports.default = User;

/***/ }),

/***/ "./src/core/adapterDraw.ts":
/*!*********************************!*\
  !*** ./src/core/adapterDraw.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _index = __webpack_require__(/*! ./DrawWorker/index */ "./src/core/DrawWorker/index.ts");

var _index2 = _interopRequireDefault(_index);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

var _utils = __webpack_require__(/*! ./utils */ "./src/core/utils.ts");

var _debug = __webpack_require__(/*! debug */ "./node_modules/debug/src/index.js");

var _debug2 = _interopRequireDefault(_debug);

var _debug3 = __webpack_require__(/*! ../debug */ "./src/debug.ts");

var _debug4 = _interopRequireDefault(_debug3);

var _validator = __webpack_require__(/*! ./validator */ "./src/core/validator.ts");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 绘制层。将任务交给worker(DrawWorker)。同时将DrawWorker中发出的动作发送给服务器。
 *
 * 钟凯：感觉这一层是多余的。
 */
var adapterLog = (0, _debug2.default)('AdapterDraw');

var AdapterDraw = function (_EventEmitter) {
    (0, _inherits3.default)(AdapterDraw, _EventEmitter);

    function AdapterDraw(container, opt) {
        (0, _classCallCheck3.default)(this, AdapterDraw);

        var _this = (0, _possibleConstructorReturn3.default)(this, (AdapterDraw.__proto__ || (0, _getPrototypeOf2.default)(AdapterDraw)).call(this));

        _this.onInited = function () {
            _this.emit('inited');
        };
        // opt.color = '#000000'
        _this.worker = new _index2.default(container, opt);
        _this.worker.on('action', _this.onAction.bind(_this));
        _this.worker.on('instantAction', _this.onInstantAction.bind(_this));
        _this.worker.on('inited', _this.onInited);
        return _this;
    }
    /**
     *
     *
     * @param account
     * @param action
     */


    (0, _createClass3.default)(AdapterDraw, [{
        key: 'act',
        value: function act(account, action) {
            // var action = this.command2Action(account, action)
            if (!action) return;
            var anyAction = { account: account, action: action };
            _debug4.default.m.adapter('act->', action, account);
            this.worker.act(anyAction);
        }
        // 收到worker内部抛出的action，然后发送到服务器

    }, {
        key: 'onAction',
        value: function onAction(anyAction) {
            if (anyAction.account !== this.worker.account || !this.worker.isEnable) return;
            _debug4.default.m.adapter('onAction', anyAction);
            if (!anyAction) return;
            this.emit('action', anyAction);
        }
        // 收到worker内部抛出的action，然后发送到服务器

    }, {
        key: 'onInstantAction',
        value: function onInstantAction(anyAction) {
            _debug4.default.m.adapter('onInstantAction', anyAction);
            if (!anyAction) return;
            this.emit('instantAction', anyAction);
        }
    }, {
        key: 'enableDraw',
        value: function enableDraw(value) {
            return this.worker.enableDraw(value);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.worker.destroy();
            this.removeAllListeners();
            // delete this.worker;
            return;
        }
    }, {
        key: 'useTool',
        value: function useTool(value, account) {
            _debug4.default.m.adapter(value, account);
            if ((0, _validator.isValidTool)(value)) {
                this.worker.useTool(value, account);
            } else {
                console.warn('画笔工具不正确!->', value);
            }
        }
    }, {
        key: 'resize',
        value: function resize() {
            return this.worker.resize();
        }
    }, {
        key: 'removeUser',
        value: function removeUser(account) {
            return this.worker.removeUser(account);
        }
    }, {
        key: 'setContainer',
        value: function setContainer(container, opt) {
            return this.worker.setContainer(container, opt);
        }
    }, {
        key: 'image',
        value: function image(opt, account) {
            return this.worker.image(opt, account);
        }
    }, {
        key: 'clearImage',
        value: function clearImage(account) {
            return this.worker.clearImage(account);
        }
    }, {
        key: 'undo',
        value: function undo(account) {
            return this.worker.undo(account);
        }
    }, {
        key: 'redo',
        value: function redo(account) {
            return this.worker.redo(account);
        }
    }, {
        key: 'clear',
        value: function clear(target, account, opt) {
            return this.worker.clear(target, account, opt);
        }
    }, {
        key: 'setColor',
        value: function setColor(color, account) {
            if (!color) return;
            if ((0, _utils.formatColor)(color, 10) === _utils.formatColor.INVALID) {
                console.error('whiteboard::setColor:设置颜色失败:不合法的色值');
            } else {
                console.log('adapterDraw::setColor', color);
                this.worker.setColor(color, account);
            }
        }
    }, {
        key: 'setSize',
        value: function setSize(size, account) {
            if (!size) return;
            if (!/^[\d]+$/.test('' + size)) {
                console.error('whiteboard::setSize:设置画笔粗细失败:不合法的数值:', size);
                return;
            }
            console.log('adapterDraw::setSize', size);
            this.worker.setSize(size, account);
        }
    }, {
        key: 'setFontsize',
        value: function setFontsize(size, account) {
            if (!size) return;
            if (!/^[\d]+$/.test('' + size)) {
                console.error('whiteboard::setFontsize:设置文字大小失败:不合法的数值:', size);
                return;
            }
            console.log('adapterDraw::setFontsize', size);
            this.worker.setFontsize(size, account);
        }
    }]);
    return AdapterDraw;
}(_eventemitter2.default);

exports.default = AdapterDraw;

/***/ }),

/***/ "./src/core/index.ts":
/*!***************************!*\
  !*** ./src/core/index.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ "./node_modules/babel-runtime/regenerator/index.js");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ "./node_modules/babel-runtime/core-js/json/stringify.js");

var _stringify2 = _interopRequireDefault(_stringify);

var _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ "./node_modules/babel-runtime/helpers/slicedToArray.js");

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ "./node_modules/babel-runtime/core-js/object/assign.js");

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ "./node_modules/babel-runtime/core-js/object/get-prototype-of.js");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ "./node_modules/babel-runtime/helpers/possibleConstructorReturn.js");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ "./node_modules/babel-runtime/helpers/inherits.js");

var _inherits3 = _interopRequireDefault(_inherits2);

var _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "./node_modules/babel-runtime/core-js/get-iterator.js");

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _symbol = __webpack_require__(/*! babel-runtime/core-js/symbol */ "./node_modules/babel-runtime/core-js/symbol.js");

var _symbol2 = _interopRequireDefault(_symbol);

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _debug = __webpack_require__(/*! debug */ "./node_modules/debug/src/index.js");

var _debug2 = _interopRequireDefault(_debug);

var _eventemitter = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/umd/eventemitter3.min.js");

var _eventemitter2 = _interopRequireDefault(_eventemitter);

var _pako = __webpack_require__(/*! pako */ "./node_modules/pako/dist/pako.min.js");

var _pako2 = _interopRequireDefault(_pako);

var _debug3 = __webpack_require__(/*! ../debug */ "./src/debug.ts");

var _debug4 = _interopRequireDefault(_debug3);

var _simulator = __webpack_require__(/*! ../simulator */ "./src/simulator.ts");

var _simulator2 = _interopRequireDefault(_simulator);

var _ActionManager = __webpack_require__(/*! ./ActionManager */ "./src/core/ActionManager.ts");

var _ActionManager2 = _interopRequireDefault(_ActionManager);

var _Actions = __webpack_require__(/*! ./Actions */ "./src/core/Actions/index.ts");

var _ActionUtils = __webpack_require__(/*! ./ActionUtils */ "./src/core/ActionUtils.ts");

var ActionUtils = _interopRequireWildcard(_ActionUtils);

var _adapterDraw = __webpack_require__(/*! ./adapterDraw */ "./src/core/adapterDraw.ts");

var _adapterDraw2 = _interopRequireDefault(_adapterDraw);

var _Itypes = __webpack_require__(/*! ./Itypes */ "./src/core/Itypes.ts");

var _GlobalHub = __webpack_require__(/*! ./Model/GlobalHub */ "./src/core/Model/GlobalHub.ts");

var _GlobalHub2 = _interopRequireDefault(_GlobalHub);

var _utils = __webpack_require__(/*! ./utils */ "./src/core/utils.ts");

var utils = _interopRequireWildcard(_utils);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
        });
    }
    return new (P || (P = _promise2.default))(function (resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }
        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }
        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __asyncValues = undefined && undefined.__asyncValues || function (o) {
    if (!_symbol2.default.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[_symbol2.default.asyncIterator],
        i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : (0, _getIterator3.default)(o), i = {}, verb("next"), verb("throw"), verb("return"), i[_symbol2.default.asyncIterator] = function () {
        return this;
    }, i);
    function verb(n) {
        i[n] = o[n] && function (v) {
            return new _promise2.default(function (resolve, reject) {
                v = o[n](v), settle(resolve, reject, v.done, v.value);
            });
        };
    }
    function settle(resolve, reject, d, v) {
        _promise2.default.resolve(v).then(function (v) {
            resolve({ value: v, done: d });
        }, reject);
    }
};
var __await = undefined && undefined.__await || function (v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
};
var __asyncGenerator = undefined && undefined.__asyncGenerator || function (thisArg, _arguments, generator) {
    if (!_symbol2.default.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []),
        i,
        q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[_symbol2.default.asyncIterator] = function () {
        return this;
    }, i;
    function verb(n) {
        if (g[n]) i[n] = function (v) {
            return new _promise2.default(function (a, b) {
                q.push([n, v, a, b]) > 1 || resume(n, v);
            });
        };
    }
    function resume(n, v) {
        try {
            step(g[n](v));
        } catch (e) {
            settle(q[0][3], e);
        }
    }
    function step(r) {
        r.value instanceof __await ? _promise2.default.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);
    }
    function fulfill(value) {
        resume("next", value);
    }
    function reject(value) {
        resume("throw", value);
    }
    function settle(f, v) {
        if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]);
    }
};

var logData = (0, _debug2.default)('data');
var fileTypeMap = {
    '10': 'jpg',
    '11': 'png',
    '0': 'unknown'
};
var toKB = function toKB(data) {
    return (0, _utils.getKiloBytes)(data).toFixed(2) + 'KB';
};
var ungzip = function ungzip(gziped) {
    var gzipedSize = gziped.length;
    var data = _pako2.default.ungzip(gziped, { to: 'string' });
    console.debug("GZIP\u6570\u636E\u5927\u5C0F:" + toKB(gzipedSize) + ",\u539F\u59CB\u6570\u636E\u5927\u5C0F\uFF1A" + toKB(data) + "\uFF0C\u538B\u7F29\u6BD4\u7387\u4E3A " + (gzipedSize * 100 / data.length).toFixed(2) + "%");
    return data;
};

var WorkerManager = function (_EventEmitter) {
    (0, _inherits3.default)(WorkerManager, _EventEmitter);

    function WorkerManager(container) {
        var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        (0, _classCallCheck3.default)(this, WorkerManager);

        var _this = (0, _possibleConstructorReturn3.default)(this, (WorkerManager.__proto__ || (0, _getPrototypeOf2.default)(WorkerManager)).call(this));

        _this.afterInit = function () {
            _this.state = 'inited';
            _this.syncManager.send({
                toAccount: 0, actions: [{
                    action: new _Actions.VersionAction({
                        ver: 1.0, account: _this.account,
                        gzip: true
                    })
                }]
            });
            _this.emit('inited');
        };
        _this.afterSync = function (snapshot) {
            _this.syncState = 'done';
            _this.flushInCommingQueue();
            _this.emit('afterSync', snapshot);
        };
        _this.readyToSyncData = function () {
            if (_this.identity === 'owner') {
                _this.syncState = 'begin';
                _this.syncBegin();
            }
            if (_this.identity === 'normal') {
                _this.syncState = 'waiting';
                _this.syncRequest(_this.ownerAccount); // 不是 owner 则向 owner 请求同步
            }
        };
        _this.onIframeMessage = function (event) {
            _debug4.default.h5('onIframeMessage', event.data);
            var data = event.data || {};
            if (data.identity !== 'to_yunxin_wb') {
                return;
            }
            var fileData = _this.syncManager.fileData;
            if (fileData) {
                var currentFile = (0, _assign2.default)({}, fileData);
                var page = data.page,
                    anim = data.anim,
                    trigger = data.trigger,
                    time = data.time;

                var isBack = data.isBack ? '1' : '0';
                time = '0';
                var h5Cmd = [page, anim, trigger, isBack, time].join('&');
                console.warn('onIframeMessage');
                console.warn(h5Cmd, currentFile.h5Cmd);
                if (parseInt(page) === 0) {
                    return;
                }
                if (currentFile.h5Cmd === h5Cmd) {
                    console.warn('the same cmd');
                }
                if (currentFile.currentPage != page) {
                    // page 不一样了，通过上下步翻页了，清空
                    _this.drawAdapter.clear();
                }
                currentFile.currentPage = parseInt(page);
                currentFile.h5Cmd = h5Cmd;
                _debug4.default.h5('onIframeMessage->emit action', event.data);
                // setTimeout(() => {
                //   this.pagedHtmlFile([page, anim, trigger, isBack, time])
                // })
                _this.drawAdapter.worker.emitAction({
                    account: _this.account,
                    action: new _Actions.FileAction(currentFile)
                });
            }
        };
        _this.simulator = new _simulator2.default(_this);
        _this.container = container;
        _this.opt = opt;
        _this.account = opt.account;
        _this.nim = opt.nim;
        _this.identity = opt.identity;
        _this.ownerAccount = opt.ownerAccount;
        _this.connector = opt.whiteboard;
        _this.incommingQueue = [];
        _this.actionProcessing = false;
        console.log('init wb adapter');
        // Model层 负责数据的存储与发送
        _this.syncManager = new _ActionManager2.default(_this.account);
        _this.syncManager.on('flush', function (data) {
            if (_this.connector && _this.connector.sendData) {
                // this.emit('data', data) // 抛出给外部，看有没有必要
                _this.connector.sendData(data);
            }
        });
        _this.fileMap = {};
        _this.eventHub = _GlobalHub2.default;
        // 当前状态
        _this.state = 'created';
        _this.syncState = 'inited';
        // View层 负责绘制
        _this.drawAdapter = new _adapterDraw2.default(container, _this.opt);
        _this.drawAdapter.on('inited', _this.afterInit);
        _this.drawAdapter.on('action', function (anyAction) {
            console.log('syncState', _this.syncState);
            if (_this.syncState !== 'waiting') {
                // 如果是在同步等待中，则不会发出请求
                _this.syncManager.broadcastAction(anyAction);
            }
        });
        _this.drawAdapter.on('instantAction', function (anyAction) {
            console.warn('instant action', _this.syncState);
            if (_this.syncState !== 'waiting') {
                // 如果是在同步等待中，则不会发出请求
                setTimeout(function () {
                    _this.syncManager.send({ toAccount: 0, actions: [anyAction] }, 1);
                });
            }
        });
        _this.connectorStatus = 'off'; // TODO: connector的状态监控
        if (_this.connector) {
            // connector的事件绑定
            _this.connector.on('data', function (obj) {
                _this.execute(obj);
            });
            _this.connector.on('joinChannel', function (obj) {
                console.log('join channel ', obj);
                if (obj.account === _this.opt.ownerAccount) {
                    // 说明房间的房主已经重新加入房间了，如果当前状态是waiting，需要将状态重置
                    if (_this.syncState === 'waiting') {
                        _this.syncState = 'done';
                        _this.flushInCommingQueue();
                    }
                }
                // 每当有新用户加入的时候，看起来我们需要重制用户的状态，其实不用重制的，只需要保证用户上线之后，会广播一次自己当前的状态就可以了
                // if (userManager.hasUser(obj.account)) {
                //   let user = userManager.getUser(obj.account);
                //   if (user) {
                //     user.reset()
                //   }
                // }
            });
        }
        _this.timmer = setInterval(function () {
            // 为了防止incommingQueue由于消息中断，或者其他原因，阻塞页面，所以需要设置超时20秒后，就抛弃一些数据，继续执行其他步骤
            // TODO
        }, 100);
        return _this;
    }
    // 该方法接收上层的数据包
    /**
     * 当 ignoreQueue 为false时
     * 收到的普通数据，直接会通过并执行这个函数，不会推入消息队列。
     * 收到的GZIP数据，如果长度为1，会解压后当作普通数据处理，直接执行这个普通消息。
     * 收到的GZIP数据，如果长度不为1，会加入到消息队列中；
     *    如果此时，队列里的GZIP数据不满足执行条件，会跳过本次执行。
     *    如果此时队列里的GZIP数据满足执行条件，会调用[清空消息队列]函数，并跳过本次执行
     * 如果普通数据长度为0，将会跳过本次执行。
     * 如果当前状态为正在处理消息队列中，无论队列是否为空，都需要推入消息队列。
     * 如果当前状态没有在处理消息队列，但是消息队列不为空，需要推入消息队列。
     * @param param0
     * @param enqueueIfNeeded 是否需要排队，默认状态下，如果incommings队列不为空，所有的消息都要推入这个队列。
     */


    (0, _createClass3.default)(WorkerManager, [{
        key: "execute",
        value: function execute(_ref) {
            var account = _ref.account,
                data = _ref.data;

            if (!account || !data || account === this.account) return;
            // 消息队列里的文件格式
            var qactions = void 0;
            var qid = void 0;
            var qtype = void 0;
            // 辅助信息
            var alreadyInMessageQueue = false;
            // fix 有时候data是数字类型的
            if (typeof data === 'number') {
                data = '' + data;
            }
            if (data.substr(0, 4) === 'GZIP') {
                // GZIP 文件解析处理
                var minimal = data.substr(5, 150); // 取一个小集合
                var match1 = _ActionManager2.default.GZIP_TESTER_1.exec(minimal);
                if (match1) {
                    minimal = '';

                    var _match = (0, _slicedToArray3.default)(match1, 4),
                        fullText = _match[0],
                        id = _match[1],
                        length = _match[2],
                        index = _match[3];

                    qid = id;
                    qtype = 'gzip';
                    var gziped = data.substr(5 + fullText.length);
                    if (length === '1') {
                        // 如果只有一条消息
                        data = ungzip(gziped);
                        qactions = ActionUtils.unpackBulk(data);
                    } else {
                        // 如果有多条消息，需要阻塞然后等到所有消息都收到后才继续
                        var incomming = this.incommingQueue.find(function (x) {
                            return x.id === id;
                        });
                        if (!incomming) {
                            // 队列中没有找到这个gzip包,就推入队列中去
                            var _gzipArr = new Array(+length);
                            _gzipArr[+index] = gziped;
                            incomming = {
                                account: account, type: qtype, id: qid,
                                total: +length, curLen: 1, data: _gzipArr, result: [new _Actions.SerialAction()]
                            };
                            this.incommingQueue.push(incomming);
                            return; // 跳过，数据不完整
                        } else {
                            // 队列中找到这个gzip包
                            incomming.curLen++;
                            incomming.data[+index] = gziped;
                            if (incomming.total === incomming.curLen) {
                                // 说明所有的数据都已经齐全了
                                // 如果在第一位，就可以执行下去了
                                var unzipedText = ungzip(incomming.data.join(''));
                                qactions = ActionUtils.unpackBulk(unzipedText);
                                incomming.result = qactions;
                                alreadyInMessageQueue = true;
                            } else {
                                return; // 跳过，数据不完整
                            }
                        }
                    }
                } else {
                    // 没有匹配到GZIP
                    console.error('未匹配到GZIP压缩格式', data);
                    return;
                }
            } else {
                // 普通文字消息的处理,判断是否需要推入队列
                qactions = ActionUtils.unpackBulk(data);
                qid = '' + Date.now() + Math.random();
                qtype = 'text';
            }
            var queueIndex = alreadyInMessageQueue ? this.incommingQueue.findIndex(function (x) {
                return x.id === qid;
            }) : -1;
            // 检测是否有同步消息,或者同步准备syncPrepare，如果有的话，就会优先执行
            var vipActionIndex = qactions.findIndex(function (x) {
                return x.TYPE === _Itypes.WActions.SYNC || x.TYPE === _Itypes.WActions.SYNC_PREPARE;
            });
            if (vipActionIndex > -1) {
                var vipAction = qactions[vipActionIndex];
                if (vipAction.TYPE === _Itypes.WActions.SYNC) {
                    this.handleSyncAction(vipAction);
                } else {
                    this.executeActions(account, qactions);
                }
                // 注意！约定同步消息是单独一次性发出的，所以qactions的长度只有一个，所以后续操作可以忽略了。
                return;
            }
            // 检测是否有syncPrepare消息，如果有的话，优先执行
            if (this.syncState === 'waiting' || this.actionProcessing) {
                // 当学生端在同步等待的时候，消息必须需要推入队列里。
                // 当消息队列正在被处理的时候，消息必须需要推入队列。
                // 如果消息队列里有数据，说明有消息阻塞了，新来的消息需要推入队列
                if (!alreadyInMessageQueue) {
                    this.incommingQueue.push({
                        account: account,
                        type: qtype,
                        id: qid,
                        total: 1, curLen: 1, data: [],
                        result: qactions
                    });
                }
            } else if (this.incommingQueue.length == 0) {
                // 如果不是等待状态，队列消息也没有处理中，消息队列的长度也为空，所以当前动作可以执行
                _debug4.default.m.worker('execute:', account, qactions);
                this.executeActions(account, qactions);
            } else {
                // 如果不是等待状态，消息队列也没有在处理中，消息队列的长度不为空，
                if (queueIndex === 0) {
                    // 如果当前消息是阻塞消息队列的原因的话，就批处理消息队列
                    this.flushInCommingQueue();
                } else {
                    // 如果当前消息不是阻塞消息队列的原因，那也推入队列里
                    if (!alreadyInMessageQueue) {
                        this.incommingQueue.push({
                            account: account,
                            type: qtype,
                            id: qid,
                            total: 1, curLen: 1, data: [],
                            result: qactions
                        });
                    }
                }
            }
        }
    }, {
        key: "executeActions",
        value: function executeActions(account, actions) {
            var actions_1, actions_1_1;
            var e_1, _a;
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var drawAdapter, action, snapshot, syncAction, file, fileData, currentFile, _FileAction$immuteUpd, _FileAction$immuteUpd2, fileDataNext, fileNext, fullCaseChecker;

                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                drawAdapter = this.drawAdapter;
                                _context.prev = 1;
                                actions_1 = __asyncValues(actions);

                            case 3:
                                _context.next = 5;
                                return actions_1.next();

                            case 5:
                                actions_1_1 = _context.sent;

                                if (actions_1_1.done) {
                                    _context.next = 69;
                                    break;
                                }

                                action = actions_1_1.value;
                                _context.t0 = action.TYPE;
                                _context.next = _context.t0 === _Itypes.WActions.REVOKE ? 11 : _context.t0 === _Itypes.WActions.REDO ? 11 : _context.t0 === _Itypes.WActions.CALIBRATE ? 11 : _context.t0 === _Itypes.WActions.TEXT ? 11 : _context.t0 === _Itypes.WActions.START ? 11 : _context.t0 === _Itypes.WActions.MOVE ? 11 : _context.t0 === _Itypes.WActions.END ? 11 : _context.t0 === _Itypes.WActions.LASER_PEN ? 11 : _context.t0 === _Itypes.WActions.LASER_PEN_END ? 11 : _context.t0 === _Itypes.WActions.SERIAL ? 13 : _context.t0 === _Itypes.WActions.CLEAR ? 15 : _context.t0 === _Itypes.WActions.CLEAR_ACK ? 19 : _context.t0 === _Itypes.WActions.SYNC_REQUEST ? 21 : _context.t0 === _Itypes.WActions.SYNC ? 25 : _context.t0 === _Itypes.WActions.SYNC_PREPARE ? 30 : _context.t0 === _Itypes.WActions.SYNC_PREPARE_ACK ? 33 : _context.t0 === _Itypes.WActions.FILE ? 35 : _context.t0 === _Itypes.WActions.VERSION ? 64 : 66;
                                break;

                            case 11:
                                drawAdapter.act(account, action);
                                return _context.abrupt("break", 67);

                            case 13:
                                console.log('serial:', action);
                                return _context.abrupt("break", 67);

                            case 15:
                                this.syncManager.clear();
                                this.syncManager.makeClearAck(account);
                                drawAdapter.clear(action.accounts, account, { force: this.ownerAccount === account, quiet: true });
                                return _context.abrupt("break", 67);

                            case 19:
                                // this.syncManager.clearCache(account)
                                drawAdapter.act(account, action);
                                return _context.abrupt("break", 67);

                            case 21:
                                console.warn('recive sync request from ', account);
                                snapshot = this.drawAdapter.worker.getSnapshot();

                                this.syncManager.syncTo(account, snapshot);
                                // drawAdapter.act(account, action)  // 这里不需要执行
                                return _context.abrupt("break", 67);

                            case 25:
                                console.warn('recive sync from ', account);
                                syncAction = action;
                                _context.next = 29;
                                return this.handleSyncAction(syncAction);

                            case 29:
                                return _context.abrupt("break", 67);

                            case 30:
                                console.warn('recive sync prepare from ', account);
                                this.syncResponse(account);
                                // drawAdapter.act(account, action) // 这里不需要执行
                                return _context.abrupt("break", 67);

                            case 33:
                                console.warn('recive sync prepare ack from ', account);
                                return _context.abrupt("break", 67);

                            case 35:
                                if (!(action.TYPE === _Itypes.WActions.FILE)) {
                                    _context.next = 64;
                                    break;
                                }

                                file = action.file;

                                _debug4.default.h5('recive h5 FileAction', file);
                                fileData = this.syncManager.fileData;
                                currentFile = fileData && (0, _assign2.default)({}, fileData);

                                if (!((0, _stringify2.default)(fileData) === (0, _stringify2.default)(file))) {
                                    _context.next = 42;
                                    break;
                                }

                                return _context.abrupt("return", console.warn('same file data'));

                            case 42:
                                if (!(file.type === 'img')) {
                                    _context.next = 62;
                                    break;
                                }

                                if (!currentFile) {
                                    _context.next = 50;
                                    break;
                                }

                                if (currentFile.type === 'h5') {
                                    // 不同类型，需要清空之前的H5
                                    this.clearHtmlFile();
                                }
                                if (file.docId && file.docId == currentFile.docId) {
                                    // 节约资源值传送了必要信息
                                    // 是相同的一个文件
                                    currentFile.currentPage = parseInt('' + (file.currentPage || 1));
                                    currentFile.url = currentFile.urlStr.replace('{index}', '' + file.currentPage);
                                    this.image(currentFile, account);
                                }
                                // 合并更新
                                _FileAction$immuteUpd = _Actions.FileAction.immuteUpdate(currentFile, file), _FileAction$immuteUpd2 = (0, _slicedToArray3.default)(_FileAction$immuteUpd, 1), fileDataNext = _FileAction$immuteUpd2[0];

                                this.syncManager.setFileData(fileDataNext);
                                _context.next = 60;
                                break;

                            case 50:
                                // 当前第一次收到这个类型的文件，直接更新
                                fileNext = void 0;

                                if (!this.opt.handleFile) {
                                    _context.next = 57;
                                    break;
                                }

                                _context.next = 54;
                                return this.opt.handleFile(file.type, file);

                            case 54:
                                fileNext = _context.sent;
                                _context.next = 58;
                                break;

                            case 57:
                                fileNext = file;

                            case 58:
                                this.syncManager.setFileData(fileNext);
                                this.image(file, account);

                            case 60:
                                _context.next = 63;
                                break;

                            case 62:
                                if (file.type === 'h5') {
                                    // 如果是h5类型的文件
                                    // this.clearImage(account)
                                    _debug4.default.h5('current file', currentFile);
                                    if (currentFile) {
                                        if (currentFile.type == 'img') {
                                            // 不同类型
                                            this.clearImage(account);
                                        }
                                        if (file.docId && file.docId == currentFile.docId) {
                                            // 是相同的一个文件
                                            _debug4.default.h5('current file h5 cmd is ', currentFile.h5Cmd);
                                            _debug4.default.h5('file h5 cmd is ', file.h5Cmd);
                                            if (currentFile.h5Cmd !== file.h5Cmd) {
                                                this.pagedHtmlFile(file.h5Cmd.split('&'));
                                            }
                                        } else {
                                            // 是不同文件
                                            this.syncManager.setFileData(file);
                                            this.setHtmlFile(file, account);
                                            if (file.h5Cmd) {
                                                // 初次进入就有页面时 等 3s ppt载入和初始动画……
                                                setTimeout(this.pagedHtmlFile.bind(this, file.h5Cmd.split('&')), 3000);
                                            }
                                        }
                                    } else {
                                        // 当前第一次收到这个类型的文件，直接更新
                                        this.syncManager.setFileData(file);
                                        this.setHtmlFile(file, account);
                                        if (file.h5Cmd) {
                                            // 初次进入就有页面时 等 3s ppt载入和初始动画……
                                            setTimeout(this.pagedHtmlFile.bind(this, file.h5Cmd.split('&')), 3000);
                                        }
                                    }
                                } else {
                                    _debug4.default.h5('delete file', currentFile);
                                    this.syncManager.setFileData(undefined);
                                    if (currentFile) {
                                        if (currentFile.type === 'img') {
                                            this.clearImage(account);
                                        } else if (currentFile.type === 'h5') {
                                            this.clearHtmlFile();
                                        }
                                    }
                                }

                            case 63:
                                return _context.abrupt("break", 67);

                            case 64:
                                if (!(action.TYPE === _Itypes.WActions.VERSION)) {
                                    _context.next = 66;
                                    break;
                                }

                                return _context.abrupt("break", 67);

                            case 66:
                                fullCaseChecker = action.TYPE;

                            case 67:
                                _context.next = 3;
                                break;

                            case 69:
                                _context.next = 74;
                                break;

                            case 71:
                                _context.prev = 71;
                                _context.t1 = _context["catch"](1);
                                e_1 = { error: _context.t1 };

                            case 74:
                                _context.prev = 74;
                                _context.prev = 75;

                                if (!(actions_1_1 && !actions_1_1.done && (_a = actions_1.return))) {
                                    _context.next = 79;
                                    break;
                                }

                                _context.next = 79;
                                return _a.call(actions_1);

                            case 79:
                                _context.prev = 79;

                                if (!e_1) {
                                    _context.next = 82;
                                    break;
                                }

                                throw e_1.error;

                            case 82:
                                return _context.finish(79);

                            case 83:
                                return _context.finish(74);

                            case 84:
                            case "end":
                                return _context.stop();
                        }
                    }
                }, _callee, this, [[1, 71, 74, 84], [75,, 79, 83]]);
            }));
        }
    }, {
        key: "flushInCommingQueue",
        value: function flushInCommingQueue() {
            var e_2, _a;
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
                var length, flushQueue, doneLen, forceWaiting, flushQueue_1, flushQueue_1_1, incomming, fullCaseChecker;
                return _regenerator2.default.wrap(function _callee2$(_context2) {
                    while (1) {
                        switch (_context2.prev = _context2.next) {
                            case 0:
                                if (!(this.syncState === 'waiting')) {
                                    _context2.next = 2;
                                    break;
                                }

                                return _context2.abrupt("return");

                            case 2:
                                length = this.incommingQueue.length;

                            case 3:
                                if (!length) {
                                    _context2.next = 63;
                                    break;
                                }

                                this.actionProcessing = true;
                                flushQueue = this.incommingQueue.slice();
                                doneLen = 0;
                                forceWaiting = false;
                                _context2.prev = 8;
                                _context2.prev = 9;
                                flushQueue_1 = (e_2 = void 0, __asyncValues(flushQueue));

                            case 11:
                                _context2.next = 13;
                                return flushQueue_1.next();

                            case 13:
                                flushQueue_1_1 = _context2.sent;

                                if (flushQueue_1_1.done) {
                                    _context2.next = 33;
                                    break;
                                }

                                incomming = flushQueue_1_1.value;
                                _context2.t0 = incomming.type;
                                _context2.next = _context2.t0 === 'text' ? 19 : _context2.t0 === 'gzip' ? 19 : _context2.t0 === 'function' ? 29 : 30;
                                break;

                            case 19:
                                if (!(incomming.total === incomming.curLen)) {
                                    _context2.next = 26;
                                    break;
                                }

                                doneLen++;

                                if (incomming.dirty) {
                                    _context2.next = 24;
                                    break;
                                }

                                _context2.next = 24;
                                return this.executeActions(incomming.account, incomming.result);

                            case 24:
                                _context2.next = 28;
                                break;

                            case 26:
                                forceWaiting = true;
                                throw new Error('message need waiting!');

                            case 28:
                                return _context2.abrupt("break", 31);

                            case 29:
                                return _context2.abrupt("break", 31);

                            case 30:
                                fullCaseChecker = incomming.type;

                            case 31:
                                _context2.next = 11;
                                break;

                            case 33:
                                _context2.next = 38;
                                break;

                            case 35:
                                _context2.prev = 35;
                                _context2.t1 = _context2["catch"](9);
                                e_2 = { error: _context2.t1 };

                            case 38:
                                _context2.prev = 38;
                                _context2.prev = 39;

                                if (!(flushQueue_1_1 && !flushQueue_1_1.done && (_a = flushQueue_1.return))) {
                                    _context2.next = 43;
                                    break;
                                }

                                _context2.next = 43;
                                return _a.call(flushQueue_1);

                            case 43:
                                _context2.prev = 43;

                                if (!e_2) {
                                    _context2.next = 46;
                                    break;
                                }

                                throw e_2.error;

                            case 46:
                                return _context2.finish(43);

                            case 47:
                                return _context2.finish(38);

                            case 48:
                                _context2.next = 53;
                                break;

                            case 50:
                                _context2.prev = 50;
                                _context2.t2 = _context2["catch"](8);

                                console.error(_context2.t2);

                            case 53:
                                _context2.prev = 53;

                                this.incommingQueue = this.incommingQueue.slice(doneLen, this.incommingQueue.length);
                                return _context2.finish(53);

                            case 56:
                                if (!forceWaiting) {
                                    _context2.next = 60;
                                    break;
                                }

                                return _context2.abrupt("break", 63);

                            case 60:
                                length = this.incommingQueue.length;

                            case 61:
                                _context2.next = 3;
                                break;

                            case 63:
                                this.actionProcessing = false;

                            case 64:
                            case "end":
                                return _context2.stop();
                        }
                    }
                }, _callee2, this, [[8, 50, 53, 56], [9, 35, 38, 48], [39,, 43, 47]]);
            }));
        }
    }, {
        key: "destroy",
        value: function destroy() {
            this.drawAdapter && this.drawAdapter.destroy();
            this.syncManager && this.syncManager.destroy();
            this.eventHub.removeAllListeners();
            ;
            this.removeAllListeners();
            // delete this.eventHub;
            // delete this.drawAdapter
            // delete this.syncManager
        }
        // 是否允许绘图操作

    }, {
        key: "enableDraw",
        value: function enableDraw(enable) {
            if (this.state === 'inited') {
                this.drawAdapter && this.drawAdapter.enableDraw(enable);
            } else {
                console.warn('inited');
            }
        }
    }, {
        key: "handleSyncAction",
        value: function handleSyncAction(action) {
            var e_3, _a, e_4, _b, e_5, _c;
            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee4() {
                var _this2 = this;

                var rawSnapshot, usersRaw, _action$sync, shapes, users, transhShapes, file, canvasRatio, canvasHeight, canvasWidth, ownerWidth, ownerHeight, shapeQueue, shapeGen, containerManager, lastSleepTime, currentUserDefaultState, prevActionProcessing, _d, _e, shape, currentTime, users_1, users_1_1, user, _f, _g, _shape, _currentTime;

                return _regenerator2.default.wrap(function _callee4$(_context4) {
                    while (1) {
                        switch (_context4.prev = _context4.next) {
                            case 0:
                                console.log(action);
                                rawSnapshot = void 0;
                                usersRaw = void 0;
                                //
                                // 先处理图层
                                //

                                _action$sync = action.sync, shapes = _action$sync.shapes, users = _action$sync.users, transhShapes = _action$sync.transhShapes, file = _action$sync.file, canvasRatio = _action$sync.canvasRatio, canvasHeight = _action$sync.canvasHeight, canvasWidth = _action$sync.canvasWidth, ownerWidth = _action$sync.ownerWidth, ownerHeight = _action$sync.ownerHeight;
                                shapeQueue = shapes.slice();
                                // 将用户回收站的图层也填充进去。

                                shapeGen = function shapeGen() {
                                    return __asyncGenerator(this, arguments, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
                                        return _regenerator2.default.wrap(function _callee3$(_context3) {
                                            while (1) {
                                                switch (_context3.prev = _context3.next) {
                                                    case 0:
                                                        if (!shapeQueue.length) {
                                                            _context3.next = 7;
                                                            break;
                                                        }

                                                        _context3.next = 3;
                                                        return __await(shapeQueue.shift());

                                                    case 3:
                                                        _context3.next = 5;
                                                        return _context3.sent;

                                                    case 5:
                                                        _context3.next = 0;
                                                        break;

                                                    case 7:
                                                    case "end":
                                                        return _context3.stop();
                                                }
                                            }
                                        }, _callee3, this);
                                    }));
                                };
                                // 调整当前画布的比例


                                containerManager = this.drawAdapter.worker.container;

                                containerManager.canvasRatio = canvasRatio;
                                containerManager.resize();
                                // 更新房主的画板的大小
                                containerManager.updateCanvasPropSize(ownerWidth, canvasHeight);
                                lastSleepTime = Date.now();
                                // 用户到默认状态

                                currentUserDefaultState = this.drawAdapter.worker.localUser.getCalibrateAction();
                                prevActionProcessing = this.actionProcessing;

                                this.actionProcessing = true;
                                // 如果有背景文件
                                if (file) {
                                    this.executeActions(this.ownerAccount, [new _Actions.FileAction(file)]);
                                }
                                _context4.prev = 15;
                                _d = __asyncValues(shapeGen());

                            case 17:
                                _context4.next = 19;
                                return _d.next();

                            case 19:
                                _e = _context4.sent;

                                if (_e.done) {
                                    _context4.next = 39;
                                    break;
                                }

                                shape = _e.value;

                                if (shape) {
                                    _context4.next = 24;
                                    break;
                                }

                                return _context4.abrupt("continue", 37);

                            case 24:
                                _context4.prev = 24;
                                _context4.next = 27;
                                return this.drawAdapter.worker.restoreShape(shape, false);

                            case 27:
                                _context4.next = 32;
                                break;

                            case 29:
                                _context4.prev = 29;
                                _context4.t0 = _context4["catch"](24);

                                console.error(_context4.t0);

                            case 32:
                                // 异步执行停顿,防止websocket心跳超时
                                currentTime = Date.now();

                                if (!(currentTime - lastSleepTime > 200)) {
                                    _context4.next = 37;
                                    break;
                                }

                                _context4.next = 36;
                                return (0, _utils.sleep)(30);

                            case 36:
                                lastSleepTime = Date.now();

                            case 37:
                                _context4.next = 17;
                                break;

                            case 39:
                                _context4.next = 44;
                                break;

                            case 41:
                                _context4.prev = 41;
                                _context4.t1 = _context4["catch"](15);
                                e_3 = { error: _context4.t1 };

                            case 44:
                                _context4.prev = 44;
                                _context4.prev = 45;

                                if (!(_e && !_e.done && (_a = _d.return))) {
                                    _context4.next = 49;
                                    break;
                                }

                                _context4.next = 49;
                                return _a.call(_d);

                            case 49:
                                _context4.prev = 49;

                                if (!e_3) {
                                    _context4.next = 52;
                                    break;
                                }

                                throw e_3.error;

                            case 52:
                                return _context4.finish(49);

                            case 53:
                                return _context4.finish(44);

                            case 54:
                                // 重新渲染出所有图像
                                this.drawAdapter.worker.container.fullRender();
                                _context4.prev = 55;
                                users_1 = __asyncValues(users);

                            case 57:
                                _context4.next = 59;
                                return users_1.next();

                            case 59:
                                users_1_1 = _context4.sent;

                                if (users_1_1.done) {
                                    _context4.next = 102;
                                    break;
                                }

                                user = users_1_1.value;

                                if (!(user.recycle && user.recycle.length)) {
                                    _context4.next = 100;
                                    break;
                                }

                                _context4.prev = 63;
                                _f = (e_5 = void 0, __asyncValues(user.recycle));

                            case 65:
                                _context4.next = 67;
                                return _f.next();

                            case 67:
                                _g = _context4.sent;

                                if (_g.done) {
                                    _context4.next = 85;
                                    break;
                                }

                                _shape = _g.value;
                                _context4.prev = 70;
                                _context4.next = 73;
                                return this.drawAdapter.worker.restoreShape(_shape, true);

                            case 73:
                                _context4.next = 78;
                                break;

                            case 75:
                                _context4.prev = 75;
                                _context4.t2 = _context4["catch"](70);

                                console.error(_context4.t2);

                            case 78:
                                // 异步执行停顿,防止websocket心跳超时
                                _currentTime = Date.now();

                                if (!(_currentTime - lastSleepTime > 200)) {
                                    _context4.next = 83;
                                    break;
                                }

                                _context4.next = 82;
                                return (0, _utils.sleep)(30);

                            case 82:
                                lastSleepTime = Date.now();

                            case 83:
                                _context4.next = 65;
                                break;

                            case 85:
                                _context4.next = 90;
                                break;

                            case 87:
                                _context4.prev = 87;
                                _context4.t3 = _context4["catch"](63);
                                e_5 = { error: _context4.t3 };

                            case 90:
                                _context4.prev = 90;
                                _context4.prev = 91;

                                if (!(_g && !_g.done && (_c = _f.return))) {
                                    _context4.next = 95;
                                    break;
                                }

                                _context4.next = 95;
                                return _c.call(_f);

                            case 95:
                                _context4.prev = 95;

                                if (!e_5) {
                                    _context4.next = 98;
                                    break;
                                }

                                throw e_5.error;

                            case 98:
                                return _context4.finish(95);

                            case 99:
                                return _context4.finish(90);

                            case 100:
                                _context4.next = 57;
                                break;

                            case 102:
                                _context4.next = 107;
                                break;

                            case 104:
                                _context4.prev = 104;
                                _context4.t4 = _context4["catch"](55);
                                e_4 = { error: _context4.t4 };

                            case 107:
                                _context4.prev = 107;
                                _context4.prev = 108;

                                if (!(users_1_1 && !users_1_1.done && (_b = users_1.return))) {
                                    _context4.next = 112;
                                    break;
                                }

                                _context4.next = 112;
                                return _b.call(users_1);

                            case 112:
                                _context4.prev = 112;

                                if (!e_4) {
                                    _context4.next = 115;
                                    break;
                                }

                                throw e_4.error;

                            case 115:
                                return _context4.finish(112);

                            case 116:
                                return _context4.finish(107);

                            case 117:
                                // 需要对图层进行排序,但是现在好像不用手动操作，这里约定，用户回收站里的数据是等效的还原的
                                this.drawAdapter.worker.users.all.forEach(function (user) {
                                    user.guessMyUndoCount();
                                    user.emitUserShape();
                                });
                                //
                                // 最后将所有用户的状态校准一下
                                //
                                usersRaw = users.map(function (userSnapshot) {
                                    var account = userSnapshot.account,
                                        calibrate = userSnapshot.calibrate;

                                    var action = ActionUtils.unpack(calibrate.toString());
                                    // 当前用户的状态不需要恢复老师端保存的状态
                                    var notCurrentUser = account !== _this2.drawAdapter.worker.account;
                                    if (notCurrentUser && action) {
                                        _this2.drawAdapter.act(account, action);
                                    }
                                    if (!notCurrentUser && action) {
                                        currentUserDefaultState = action;
                                    }
                                    return {
                                        account: account,
                                        calibrate: action
                                    };
                                });
                                // 再还原当前用户的状态，避免刚才
                                this.drawAdapter.act(this.account, currentUserDefaultState);
                                // 同步自己的状态给其他用户
                                this.declareCalibrate(currentUserDefaultState);
                                rawSnapshot = {
                                    users: usersRaw,
                                    shapes: shapes,
                                    transhShapes: transhShapes
                                };
                                this.actionProcessing = prevActionProcessing;
                                this.afterSync(rawSnapshot);

                            case 124:
                            case "end":
                                return _context4.stop();
                        }
                    }
                }, _callee4, this, [[15, 41, 44, 54], [24, 29], [45,, 49, 53], [55, 104, 107, 117], [63, 87, 90, 100], [70, 75], [91,, 95, 99], [108,, 112, 116]]);
            }));
        }
        // 设置宽度

    }, {
        key: "setSize",
        value: function setSize(size, account) {
            this.syncManager.pushQueue(0, {
                action: new _Actions.CalibrateAction({ size: size })
            });
            this.drawAdapter.setSize(size, account);
        }
        // 设置宽度

    }, {
        key: "setFontsize",
        value: function setFontsize(size, account) {
            this.drawAdapter.setFontsize(size, account);
        }
        // 设置颜色

    }, {
        key: "setColor",
        value: function setColor(color, account) {
            this.drawAdapter.setColor(color, account);
        }
        // 撤销操作

    }, {
        key: "undo",
        value: function undo() {
            return this.drawAdapter.undo();
        }
        // 重做操作

    }, {
        key: "redo",
        value: function redo() {
            return this.drawAdapter.redo();
        }
        // 清除画布

    }, {
        key: "clear",
        value: function clear(account, actAccount, option) {
            this.drawAdapter.clear(account, actAccount, option);
        }
        // 绘制图片

    }, {
        key: "image",
        value: function image(option, account) {
            this.drawAdapter.image(option, account);
        }
        // 清除背景图

    }, {
        key: "clearImage",
        value: function clearImage() {
            var account = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.account;

            this.clear();
            this.drawAdapter.clearImage(account);
        }
    }, {
        key: "setHtmlFile",
        value: function setHtmlFile(obj) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;

            _debug4.default.h5('setHtmlFile', obj);
            var _drawAdapter$worker$c = this.drawAdapter.worker.container,
                paddingLeft = _drawAdapter$worker$c.paddingLeft,
                paddingTop = _drawAdapter$worker$c.paddingTop,
                canvasHeight = _drawAdapter$worker$c.canvasHeight,
                canvasWidth = _drawAdapter$worker$c.canvasWidth;

            if (this.iframe) {
                console.warn('已经有iframe了');
                return;
            }
            var iframe = document.createElement('iframe');
            iframe.src = obj.url;
            iframe.scrolling = 'no';
            iframe.name = 'nimHtmlFile';
            iframe.frameBorder = '0';
            iframe.style.position = 'absolute';
            iframe.style.top = '' + paddingTop + 'px';
            iframe.style.left = '' + paddingLeft + 'px';
            iframe.style.zIndex = '1';
            // iframe.style.right = '0'
            // iframe.style.bottom = '0'
            iframe.style.width = canvasWidth + 'px';
            iframe.style.height = canvasHeight + 'px';
            iframe.width = "" + canvasWidth;
            iframe.height = '' + canvasHeight;
            this.container.insertBefore(iframe, this.container.children[0]);
            // 改变背景颜色，记得要改回来
            this.drawAdapter.worker.container.displayCanvas.style.backgroundColor = 'transparent';
            this.iframe = iframe;
            window.addEventListener('message', this.onIframeMessage, false);
            this.drawAdapter.worker.emitAction({
                account: account,
                action: new _Actions.FileAction(obj)
            });
            this.syncManager.setFileData(obj);
        }
    }, {
        key: "pagedHtmlFile",
        value: function pagedHtmlFile(arr) {
            // debugger
            _debug4.default.h5('pagedHtmlFile', arr);
            var iframe = this.iframe;
            if (iframe) {
                try {
                    if (!iframe.contentWindow || iframe.contentDocument && iframe.contentDocument.readyState !== 'complete') {
                        setTimeout(this.pagedHtmlFile.bind(this, arr), 800);
                        return;
                    }
                } catch (e) {
                    console.error(e);
                    return false;
                }
                var data = {
                    identity: 'from_yunxin_wb',
                    page: parseInt(arr[0]),
                    anim: parseInt(arr[1]),
                    trigger: parseInt(arr[2]),
                    isBack: arr[3] == '1',
                    time: 0 //+arr[4]
                };
                //@ts-ignore
                iframe.currentPage = parseInt(data.page);
                var page = data.page,
                    anim = data.anim,
                    trigger = data.trigger,
                    time = data.time,
                    isBack = data.isBack;

                var h5Cmd = [page, anim, trigger, isBack, time].join('&');
                console.warn('toPage');
                console.warn(h5Cmd, this.syncManager.fileData && this.syncManager.fileData.h5Cmd);
                _debug4.default.h5('toHtmlPage', data);
                iframe.contentWindow.postMessage(data, '*');
            }
        }
    }, {
        key: "toPageHtmlFile",
        value: function toPageHtmlFile(direction, index, num) {
            var iframe = this.iframe;
            _debug4.default.h5('toPageHtmlFile', direction, index, num);
            if (iframe) {
                try {
                    if (!iframe.contentWindow || iframe.contentDocument && iframe.contentDocument.readyState !== 'complete') {
                        return false;
                    }
                } catch (e) {
                    return false;
                }
                var data = void 0;
                switch (direction) {
                    case 'leftEnd':
                        data = {
                            page: 0,
                            anim: -1,
                            trigger: -1,
                            isBack: false
                        };
                        break;
                    case 'left':
                        data = {
                            page: index - 1,
                            anim: -1,
                            trigger: -1,
                            isBack: false
                        };
                        break;
                    case 'up':
                        data = { which: 37 };
                        break;
                    case 'down':
                        data = { which: 39 };
                        break;
                    case 'right':
                        data = {
                            page: index,
                            anim: -1,
                            trigger: -1,
                            isBack: false
                        };
                        break;
                    case 'rightEnd':
                        data = {
                            page: num - 1,
                            anim: -1,
                            trigger: -1,
                            isBack: false
                        };
                        break;
                    default:
                        console.warn('');
                }
                if (typeof data !== 'undefined') {
                    data.identity = 'from_yunxin_wb';
                    _debug4.default.h5('current file h5 cmd is ', this.syncManager.fileData && this.syncManager.fileData.h5Cmd);
                    _debug4.default.h5('toPageHtmlFile->post', data);
                    iframe.contentWindow.postMessage(data, '*');
                    //@ts-ignore
                    iframe.currentPage = parseInt(data.page);
                    //@ts-ignore
                    iframe.pageNum = num;
                }
                return true;
            }
        }
    }, {
        key: "clearHtmlFile",
        value: function clearHtmlFile() {
            this.clear();
            _debug4.default.h5('clearHtmlFile');
            if (!this.iframe || !this.container || this.iframe && this.iframe.parentNode !== this.container) {
                return;
            }
            this.syncManager.setFileData(undefined);
            window.removeEventListener('message', this.onIframeMessage, false);
            this.container.removeChild(this.iframe);
            this.drawAdapter.worker.container.displayCanvas.style.backgroundColor = '#ffffff';
        }
    }, {
        key: "_image",
        value: function _image(option) {
            var account = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.account;

            console.log('_image', option);
            var docId = option.docId,
                currentPage = option.currentPage;

            if (!docId || currentPage - 0 === 0) {
                this.clearImage(account);
                return;
            }
            var nim = this.nim;
            var file = this.fileMap[docId];
            if (!file && !nim) return;
            console.log('file!!!', file);
            if (file) {
                var url = file.prefix + "_" + file.type + "_" + currentPage + "." + fileTypeMap[file.transType];
                // this.draw!.image(url, account)
                // this.drawAdapter.image(url)
                return;
            }
            var that = this;
            if (!nim) {
                console.warn('缺少nim实例，无法拉取文件');
                return;
            }
            nim.getFile({
                docId: docId,
                success: function success(data) {
                    // console.log('getFile success', data)
                    that.fileMap[docId] = data;
                    that._image(option, account);
                },
                error: function error(_error) {
                    console.error('getFile error', _error);
                }
            });
        }
    }, {
        key: "setContainer",
        value: function setContainer(container, opt) {
            this.drawAdapter.setContainer(container, opt);
        }
    }, {
        key: "removeUser",
        value: function removeUser(account) {
            account && this.drawAdapter.removeUser(account);
        }
        /**
         * 等比例调整画布大小，
         * @public
         */

    }, {
        key: "resize",
        value: function resize() {
            this.drawAdapter.resize();
        }
    }, {
        key: "useTool",
        value: function useTool(tool, account) {
            this.drawAdapter.useTool(tool, account);
        }
        // 同步准备清空，主播重新登录聊天室后，广播该协议给其他人，其他人收到后进行本地清空

    }, {
        key: "syncBegin",
        value: function syncBegin() {
            _debug4.default.m.worker('owner sync begin');
            this.syncManager.clear();
            this.syncManager.makeSyncPrepare();
            this.clear();
            this.clearImage();
            this.syncState = 'done';
            this.declareCalibrate(); // 将自己的状态广播一下
            this.afterSync();
        }
        // 同步请求，非主播重新登录后发请求给主播

    }, {
        key: "syncRequest",
        value: function syncRequest(account) {
            this.syncState = 'waiting';
            _debug4.default.m.worker('sync request->', account);
            this.syncManager.makeSyncRequest(account);
        }
        // 同步响应，主播重新登录后,非主播响应请求给主播

    }, {
        key: "syncResponse",
        value: function syncResponse(account) {
            _debug4.default.m.worker('sync response->', account);
            this.clear(undefined, account, { force: true });
            this.clearHtmlFile();
            this.clearImage(account);
            this.syncManager.clear();
            this.syncManager.makeSyncPrepareAck(account);
            this.declareCalibrate(); // 将自己的状态更新一下
        }
    }, {
        key: "declareCalibrate",
        value: function declareCalibrate(action) {
            if (!action) {
                var selfCalibrateAction = this.drawAdapter.worker.getSelfCalibrate();
                if (selfCalibrateAction) {
                    action = selfCalibrateAction;
                }
            }
            if (action) {
                // 同步自己的当前状态过去
                _debug4.default.m.worker('sync response calibrate->', action);
                // 这里不需要等待，必须发送，防止被删除
                this.syncManager.send({ toAccount: 0, actions: [{ action: action }] });
            } else {
                console.warn('no self calibrate action');
            }
        }
        /**
         *  观众切换到互动者, 可以进行绘图操作
         *  @method changeRoleToPlayer
         *  @memberOf WhiteBoard#
         *  @return {Promise}
         */

    }, {
        key: "changeRoleToPlayer",
        value: function changeRoleToPlayer() {
            if (this.role === 0) return _promise2.default.resolve({ role: 'player' });
            this.enableDraw(true);
            this.role = 0;
            return _promise2.default.resolve({ role: 'player' });
        }
        /**
         *  互动者切换到观众, 禁止绘图操作
         *  @method changeRoleToAudience
         *  @memberOf WhiteBoard#
         *  @return {Promise}
         */

    }, {
        key: "changeRoleToAudience",
        value: function changeRoleToAudience() {
            var _this3 = this;

            if (this.role === 1) return _promise2.default.resolve({ role: 'audience' });
            this.enableDraw(false);
            // 这么写的目的: 切换观众前，如果是标记，先发一个标记结束的通知
            return new _promise2.default(function (resolve, reject) {
                setTimeout(function () {
                    _this3.role = 1;
                    resolve({ role: 'audience' });
                }, 1000);
            });
        }
        // 主要是给断线重连之后的房主重连房间后，重制状态

    }, {
        key: "resetState",
        value: function resetState() {
            this.syncManager.clear();
            var _drawAdapter$worker = this.drawAdapter.worker,
                users = _drawAdapter$worker.users,
                container = _drawAdapter$worker.container,
                shapes = _drawAdapter$worker.shapes;

            users.all.forEach(function (user) {
                user.clearShapes();
            });
            shapes.clear();
            this.drawAdapter.worker.updateCursor();
            users.removeOtherUsers();
        }
    }]);
    return WorkerManager;
}(_eventemitter2.default);

exports.default = WorkerManager;

WorkerManager.util = utils;

/***/ }),

/***/ "./src/core/utils.ts":
/*!***************************!*\
  !*** ./src/core/utils.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.sleep = exports.pako = undefined;

var _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ "./node_modules/babel-runtime/core-js/promise.js");

var _promise2 = _interopRequireDefault(_promise);

var _pako = __webpack_require__(/*! pako */ "./node_modules/pako/dist/pako.min.js");

Object.defineProperty(exports, 'pako', {
    enumerable: true,
    get: function get() {
        return _interopRequireDefault(_pako).default;
    }
});
exports.formatColor = formatColor;
exports.hex2rgb = hex2rgb;
exports.getKiloBytes = getKiloBytes;
exports.sign = sign;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 格式化颜色值, 默认为十六进制(16), 默认自动补齐
 * @param {string} color 十六进制请不要带#号
 * @param {number} format 需要转换的进制, 默认为十六进制
 */
function formatColor(color) {
    var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;

    if (!color) return formatColor.INVALID;
    var res = void 0;
    if (format === 16) {
        var colorNumber = +color;
        if (colorNumber < 0) {
            res = hex2rgb(colorNumber);
            console.log('hex2rgb', colorNumber, res);
            return res;
        }
        res = colorNumber.toString(16);
        if (res.length < 3) {
            res = ('000' + res).slice(-3);
        }
        if (res.length > 3 && res.length < 6) {
            res = ('000' + res).slice(-6);
        }
        res = '#' + res;
        // console.log('formatColor 16', color, res)
        return res;
    } else if (format === 10) {
        res = color.replace(/#/gi, '');
        res = parseInt('0x' + res);
        // console.log('formatColor 10', color, res)
        return isNaN(res) ? formatColor.INVALID : '' + res;
    } else {
        return formatColor.INVALID;
    }
}
formatColor.INVALID = '++bad-color++';
// rgba转rgb
function hex2rgb(val) {
    // return '#' + (0x00FFFFFF & val)
    var alpha = val >> 24 & 0xff;
    var red = val >> 16 & 0xff;
    var green = val >> 8 & 0xff;
    var blue = val & 0xff;
    var red$ = red.toString(16);
    var green$ = green.toString(16);
    var blue$ = blue.toString(16);
    console.log('rgb', red$, green$, blue$);
    return '#' + ('0' + red$).slice(-2) + ('0' + green$).slice(-2) + ('0' + blue$).slice(-2);
}
/**
 *  颜色模块，默认都是字符串类型的 16进制全称，不含透明度的字符串
 */
// 得到KB 单位
function getKiloBytes(length) {
    if (typeof length === 'number') {
        return length * 2 / 1024;
    }
    if (typeof length === 'string') {
        return length.length * 2 / 1024;
    }
    return 0;
}
var sleep = exports.sleep = function sleep() {
    var time = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 100;
    return new _promise2.default(function (res) {
        setTimeout(res, time);
    });
};
function sign(x) {
    return x ? x < 0 ? -1 : 1 : 0;
}

/***/ }),

/***/ "./src/core/validator.ts":
/*!*******************************!*\
  !*** ./src/core/validator.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.isStandardCursor = isStandardCursor;
exports.isStandardMode = isStandardMode;
exports.isValidTool = isValidTool;
function isStandardCursor(cursor) {}
function isStandardMode(mode) {
    if (typeof mode !== 'string') {
        return [false, '模式必须是字符串'];
    }
    mode = mode.trim();
    if (mode === '') {
        return [false, '模式不能为空！'];
    }
    if (mode === 'player') {
        return [true];
    }
    if (!~mode.indexOf(':')) {
        return [false, '模式格式不正确！没有找到分割符-> ：'];
    }
    var modeArr = mode.split(':');
    // TODO: 验证mode Arr
    return [true];
}
function isValidTool(tool) {
    if (typeof tool !== 'string') {
        return false;
    }
    switch (tool) {
        case 'fill':
        case 'flag':
        case 'free':
        case 'line':
        case 'rect':
        case 'circle':
        case 'roundRect':
        case 'solidRect':
        case 'solidRoundRect':
        case 'solidCircle':
        case 'text':
        // case 'select':
        case 'ellipse':
        case 'solidEllipse':
        case 'erase':
            {
                return true;
            }
        default:
            {
                var fullCaseChecker = tool;
                return false;
            }
    }
}

/***/ }),

/***/ "./src/debug.ts":
/*!**********************!*\
  !*** ./src/debug.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _debug = __webpack_require__(/*! debug */ "./node_modules/debug/src/index.js");

var _debug2 = _interopRequireDefault(_debug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var noop = function noop() {}; /**
                                * debug 模块需要在浏览器的localstorage中，执行
                                *  localstorage.Debug = "*"  -- 表明显示所有的debug. 可以在文件最下方，选择关闭哪些调试
                                *
                                *
                                * 从这里创建一些共用的调试模块，
                                * 大致分为有下面几类
                                * - 鼠标相关事件
                                * - 与服务器通信的事件比如收发包
                                *  2.1 一个包从完整的接收到途径的过程
                                *  2.2 对各种包的处理
                                * - 模块
                                * - 画板状态变更事件
                                * - 画板的函数调用事件
                                * - 具体的某个函数调用事件
                                *
                                * 模块内的调试在模块内创建
                                */

var logger = {
    mouse: (0, _debug2.default)('mouse'),
    h5: (0, _debug2.default)('h5'),
    package: (0, _debug2.default)('package'),
    shape: (0, _debug2.default)('shape'),
    user: (0, _debug2.default)('user'),
    command: (0, _debug2.default)('command'),
    image: function image(url) {
        var note = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

        var image = new Image();
        image.onload = function () {
            var style = ['font-size: 14px;', 'padding: ' + image.height / 2 + 'px ' + image.width / 2 + 'px;', 'background: url(' + url + ') no-repeat;', 'background-size: contain;'].join(' ');
            console.log(note + '%c ', style);
        };
        image.src = url;
    },
    m: {
        adapter: (0, _debug2.default)('adapter'),
        worker: (0, _debug2.default)('worker'),
        containermanager: (0, _debug2.default)('containermanager'),
        shapemanager: (0, _debug2.default)('shapemanager'),
        usermanager: (0, _debug2.default)('usermanager'),
        syncmanager: (0, _debug2.default)('syncmanager')
    },
    log: console.log.bind(console),
    warn: console.warn.bind(console),
    error: console.error.bind(console)
};
// 在这里替换掉原来的调试函数，控制哪些调试信息不输出
if (!localStorage.getItem('debugMouse')) {
    logger.mouse = noop;
}
exports.default = logger;

/***/ }),

/***/ "./src/simulator.ts":
/*!**************************!*\
  !*** ./src/simulator.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ "./node_modules/babel-runtime/helpers/classCallCheck.js");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ "./node_modules/babel-runtime/helpers/createClass.js");

var _createClass3 = _interopRequireDefault(_createClass2);

var _Point = __webpack_require__(/*! ./core/Model/Point */ "./src/core/Model/Point.ts");

var _Point2 = _interopRequireDefault(_Point);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Simulator = function () {
    function Simulator(app) {
        (0, _classCallCheck3.default)(this, Simulator);

        this.app = app;
    }

    (0, _createClass3.default)(Simulator, [{
        key: 'freeDraw',
        value: function freeDraw() {
            var times = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;
            var scale = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0.0003;

            this.app.useTool('free', this.app.account);
            for (var i = 0; i < times; i++) {
                var sx = Math.random();
                var sy = Math.random();
                var dx = Math.random() * scale;
                var dy = Math.random() * scale;
                this.app.drawAdapter.worker.mousedown(new _Point2.default(sx, sy), this.app.account);
                this.app.drawAdapter.worker.mousemove(new _Point2.default(sx + dx, sy + dy), this.app.account);
                this.app.drawAdapter.worker.mouseup(new _Point2.default(sx + dx, sy + dy), this.app.account);
            }
        }
    }, {
        key: 'rectDraw',
        value: function rectDraw() {
            var times = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;
            var scale = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0.0003;

            this.app.useTool('rect', this.app.account);
            for (var i = 0; i < times; i++) {
                var sx = Math.random();
                var sy = Math.random();
                var dx = Math.random() * scale;
                var dy = Math.random() * scale;
                this.app.drawAdapter.worker.mousedown(new _Point2.default(sx, sy), this.app.account);
                this.app.drawAdapter.worker.mousemove(new _Point2.default(sx + dx, sy + dy), this.app.account);
                this.app.drawAdapter.worker.mouseup(new _Point2.default(sx + dx, sy + dy), this.app.account);
            }
        }
    }]);
    return Simulator;
}();
/**
 simulate mouse event in other products
function mouseEventSimulate(canvas, x, y) {
        let event = document.createEvent('MouseEvent')
        event.initMouseEvent('mousedown', true, true, window, 0, event.screenX, event.screenY, x, y, false, false, false, false, 0, null)
        canvas.dispatchEvent(event)

        const dx = Math.random() * 30
        const dy = Math.random() * 30

        event = document.createEvent('MouseEvent')
        event.initMouseEvent('mousemove', true, true, window, 0, event.screenX, event.screenY, x+dx, y+dy, false, false, false, false, 0, null)
        canvas.dispatchEvent(event)

        event = document.createEvent('MouseEvent')
        event.initMouseEvent('mouseup', true, true, window, 0, event.screenX, event.screenY, x+dx, y+dy, false, false, false, false, 0, null)
        canvas.dispatchEvent(event)
    }

    function multipleMouseSimulate(canvas, count, range=1000) {
        for (let i = 0; i < count; i++) {
            const sx = 100 + Math.random() * range
            const sy = 100 + Math.random() * range
            this.mouseEventSimulate(canvas, sx, sy)
        }
    }

    //netless
    whiteboard_div = document.getElementsByClassName('tx_board_canvas_wrap')
    multipleMouseSimulate(whiteboard_div[0], 10, 100)

    //tencent board
    whiteboard_div = document.getElementsByClassName('tx_board_canvas_box')
    multipleMouseSimulate(whiteboard_div[0], 10, 100)
 */


exports.default = Simulator;

/***/ }),

/***/ 1:
/*!*********************************************!*\
  !*** multi ./new_src/recordPlayer/index.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! ./new_src/recordPlayer/index.ts */"./new_src/recordPlayer/index.ts");


/***/ })

/******/ })["default"];
});
//# sourceMappingURL=RecordPlayer_v3.1.2_test.js.map